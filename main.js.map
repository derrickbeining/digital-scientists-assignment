{"version":3,"sources":["webpack:///webpack/bootstrap ddd0f87dc39543b1c222","webpack:///./src/mediaDevice.js","webpack:///./src/Component.js","webpack:///./node_modules/webrtc-adapter/out/adapter_no_global.js","webpack:///(webpack)/buildin/global.js","webpack:///./src/index.js","webpack:///./src/components/ButtonCameraPermission.js","webpack:///./src/components/CameraScreen.js"],"names":["hasMediaDeviceAPI","startingCamera","Boolean","navigator","mediaDevices","getUserMedia","generateConstraints","supportedConstraints","getSupportedConstraints","hasOwnProperty","video","facingMode","then","srcObject","mediaStream","onloadedmetadata","e","play","catch","console","warn","err","name","message","merge","one","two","Object","assign","Component","id","defaultState","state","getState","setState","arg","renderer","dom","document","getElementById","noop","classname","classList","add","remove","toggle","event","eventHandler","addEventListener","fn","t","n","r","s","o","u","a","require","i","f","Error","code","l","exports","call","length","module","SDPUtils","writeMediaSection","transceiver","caps","type","stream","dtlsRole","sdp","writeRtpDescription","kind","writeIceParameters","iceGatherer","getLocalParameters","writeDtlsParameters","dtlsTransport","mid","rtpSender","rtpReceiver","msid","track","sendEncodingParameters","ssrc","rtx","localCName","filterIceServers","iceServers","edgeVersion","hasTurn","JSON","parse","stringify","filter","server","urls","url","isString","validTurn","indexOf","getCommonCapabilities","localCapabilities","remoteCapabilities","commonCapabilities","codecs","headerExtensions","fecMechanisms","findCodecByPayloadType","pt","parseInt","payloadType","preferredPayloadType","rtxCapabilityMatches","lRtx","rRtx","lCodecs","rCodecs","lCodec","parameters","apt","rCodec","toLowerCase","forEach","clockRate","numChannels","Math","min","push","rtcpFeedback","fb","j","parameter","lHeaderExtension","rHeaderExtension","uri","isActionAllowedInSignalingState","action","signalingState","offer","setLocalDescription","setRemoteDescription","answer","maybeAddCandidate","iceTransport","candidate","alreadyAdded","getRemoteCandidates","find","remoteCandidate","foundation","ip","port","priority","protocol","addRemoteCandidate","addTrackToStreamAndFireEvent","addTrack","Event","dispatchEvent","removeTrackFromStreamAndFireEvent","removeTrack","fireAddTrack","pc","receiver","streams","trackEvent","window","setTimeout","_dispatchEvent","makeError","description","RTCPeerConnection","config","_eventTarget","createDocumentFragment","method","bind","canTrickleIceCandidates","needNegotiation","localStreams","remoteStreams","localDescription","remoteDescription","iceConnectionState","iceGatheringState","usingBundle","bundlePolicy","rtcpMuxPolicy","iceTransportPolicy","_iceGatherers","iceCandidatePoolSize","RTCIceGatherer","gatherPolicy","_config","transceivers","_sdpSessionId","generateSessionId","_sdpSessionVersion","_dtlsRole","undefined","_isClosed","prototype","onicecandidate","onaddstream","ontrack","onremovestream","onsignalingstatechange","oniceconnectionstatechange","onicegatheringstatechange","onnegotiationneeded","ondatachannel","_emitGatheringStateChange","getConfiguration","getLocalStreams","getRemoteStreams","_createTransceiver","hasBundleTransport","recvEncodingParameters","associatedRemoteMediaStreams","wantReceive","transports","_createIceAndDtlsTransports","alreadyExists","_maybeFireNegotiationNeeded","RTCRtpSender","addStream","getTracks","clonedStream","clone","idx","clonedTrack","enabled","sender","TypeError","stop","map","splice","removeStream","getSenders","getReceivers","_createIceGatherer","sdpMLineIndex","shift","defineProperty","value","writable","candidates","bufferCandidates","end","keys","_gather","onlocalcandidate","removeEventListener","evt","sdpMid","cand","component","writeCandidate","sections","splitSections","join","complete","every","RTCIceTransport","onicestatechange","_updateConnectionState","RTCDtlsTransport","ondtlsstatechange","onerror","_disposeIceAndDtlsTransports","_transceive","send","recv","params","encodings","rtcp","cname","compound","rtcpParameters","p","receive","Promise","reject","sessionpart","mediaSection","parseRtpParameters","isIceLite","matchPrefix","rejected","isRejected","isDatachannel","remoteIceParameters","getIceParameters","remoteDtlsParameters","getDtlsParameters","role","start","_updateSignalingState","resolve","receiverList","iceOptions","substr","split","lines","splitLines","getKind","direction","getDirection","remoteMsid","parseMsid","getMid","generateIdentifier","parseRtpEncodingParameters","parseRtcpParameters","isComplete","cands","parseCandidate","setTransport","setRemoteCandidates","RTCRtpReceiver","getCapabilities","codec","isNewTrack","MediaStream","get","default","nativeTrack","sid","item","close","newState","states","closed","connecting","checking","connected","completed","disconnected","failed","new","createOffer","numAudioTracks","numVideoTracks","offerOptions","arguments","mandatory","optional","offerToReceiveAudio","offerToReceiveVideo","writeSessionBoilerplate","getLocalCandidates","desc","RTCSessionDescription","createAnswer","mediaSectionsInOffer","localTrack","getAudioTracks","getVideoTracks","hasRtx","c","reducedSize","addIceCandidate","candidateString","trim","getStats","promises","fixStatsType","stat","inboundrtp","outboundrtp","candidatepair","localcandidate","remotecandidate","results","Map","all","res","result","set","methods","nativeMethod","args","apply","error","random","toString","blob","line","parts","part","index","prefix","substring","relatedAddress","relatedPort","tcpType","ufrag","usernameFragment","toUpperCase","parseIceOptions","parseRtpMap","parsed","writeRtpMap","parseExtmap","writeExtmap","headerExtension","preferredId","parseFmtp","kv","writeFmtp","param","parseRtcpFb","writeRtcpFb","parseSsrcMedia","sp","colon","attribute","parseFingerprint","algorithm","fingerprints","setupType","fp","concat","iceParameters","password","mline","rtpmapline","fmtps","maxptime","extension","encodingParameters","hasRed","hasUlpfec","ssrcs","primarySsrc","secondarySsrc","flows","encParam","codecPayloadType","fec","mechanism","bandwidth","maxBitrate","remoteSsrc","obj","rsize","mux","spec","planB","sessId","sessVer","sessionId","version","parseMLine","fmt","slice","global","adapterFactory","self","utils","dependencies","opts","options","shimChrome","shimFirefox","shimEdge","shimSafari","key","logging","log","browserDetails","detectBrowser","adapter","extractVersion","disableLog","disableWarnings","chromeShim","edgeShim","firefoxShim","safariShim","commonShim","browser","shimPeerConnection","browserShim","shimCreateObjectURL","shimGetUserMedia","shimMediaStream","shimSourceObject","shimOnTrack","shimAddTrackRemoveTrack","shimGetSendersWithDtmf","shimRTCIceCandidate","shimRemoveStream","shimReplaceTrack","shimRTCIceServerUrls","shimCallbacksAPI","shimLocalStreamsAPI","shimRemoteStreamsAPI","shimTrackEventTransceiver","shimCreateOfferLegacy","webkitMediaStream","_ontrack","origSetRemoteDescription","_ontrackpoly","te","shimSenderWithDtmf","dtmf","_dtmf","createDTMFSender","_pc","_senders","origAddTrack","origRemoveTrack","origAddStream","origRemoveStream","origGetSenders","senders","URL","HTMLMediaElement","_srcObject","src","revokeObjectURL","createObjectURL","shimAddTrackRemoveTrackWithNative","_shimmedLocalStreams","streamId","DOMException","existingSenders","newSenders","newSender","origGetLocalStreams","nativeStreams","_reverseStreams","_streams","newStream","oldStream","replaceInternalStreamId","internalId","externalStream","internalStream","replace","RegExp","replaceExternalStreamId","isLegacyCall","origSetLocalDescription","origLocalDescription","getOwnPropertyDescriptor","isLocal","streamid","hasTrack","pcConfig","pcConstraints","iceTransports","webkitRTCPeerConnection","generateCertificate","OrigPeerConnection","newIceServers","deprecated","origGetStats","selector","successCallback","errorCallback","fixChromeStats_","response","standardReport","reports","report","standardStats","timestamp","names","makeMapStats","stats","successCallbackWrapper_","promise","RTCIceCandidate","nativeAddIceCandidate","constraintsToChrome_","cc","ideal","exact","max","oldname_","charAt","oc","mix","advanced","shimConstraints_","constraints","func","audio","remap","b","face","getSupportedFacingModeLies","matches","enumerateDevices","devices","d","dev","some","match","label","deviceId","shimError_","PermissionDeniedError","InvalidStateError","DevicesNotFoundError","ConstraintNotSatisfiedError","TrackStartError","MediaDeviceFailedDueToShutdown","MediaDeviceKillSwitchOn","constraint","constraintName","getUserMedia_","onSuccess","onError","webkitGetUserMedia","getUserMediaPromise_","kinds","MediaStreamTrack","getSources","device","groupId","echoCancellation","frameRate","height","width","origGetUserMedia","cs","wrapPeerConnectionEvent","eventNameToWrap","wrapper","proto","nativeAddEventListener","nativeEventName","cb","wrappedCallback","_eventMap","nativeRemoveEventListener","unwrappedCb","NativeRTCIceCandidate","nativeCandidate","parsedCandidate","augmentedCandidate","toJSON","nativeCreateObjectURL","nativeRevokeObjectURL","newId","delete","dsc","nativeSetAttribute","setAttribute","shimRTCPeerConnection","origMSTEnabled","ev","RTCDtmfSender","replaceTrack","setTrack","RTCTrackEvent","mozSrcObject","mozRTCPeerConnection","newServer","username","credential","mozRTCSessionDescription","mozRTCIceCandidate","modernStatsTypes","nativeGetStats","onSucc","onErr","InternalError","NotSupportedError","SecurityError","constraintsToFF37_","mozGetUserMedia","infos","orgEnumerateDevices","nativeGetUserMedia","getSettings","nativeGetSettings","applyConstraints","nativeApplyConstraints","_localStreams","getStreamById","_remoteStreams","_addTrack","tracks","_onaddstream","_onaddstreampoly","failureCallback","withCallback","errcb","RTCTransceiver","origCreateOffer","audioTransceiver","getTransceivers","setDirection","addTransceiver","videoTransceiver","logDisabled_","deprecationWarnings_","uastring","expr","pos","bool","oldMethod","newMethod","userAgent","g","Function","eval","ButtonCameraPermission","permitted","on","show","render","CameraScreen","addClass","removeClass"],"mappings":"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","file":"main.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, {\n \t\t\t\tconfigurable: false,\n \t\t\t\tenumerable: true,\n \t\t\t\tget: getter\n \t\t\t});\n \t\t}\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 2);\n\n\n\n// WEBPACK FOOTER //\n// webpack/bootstrap ddd0f87dc39543b1c222","export function hasMediaDeviceAPI () {\n  return Boolean(navigator.mediaDevices)\n    && Boolean(navigator.mediaDevices.getUserMedia);\n}\n\nfunction generateConstraints() {\n  const supportedConstraints = navigator.mediaDevices.getSupportedConstraints();\n  if (supportedConstraints.hasOwnProperty('facingMode')) {\n    return {video: { facingMode: 'environment' }};\n  } else {\n    return { video: true };\n  }\n}\n\nexport function startingCamera (video) {\n  return navigator.mediaDevices\n    .getUserMedia(generateConstraints())\n    .then(mediaStream => {\n      video.srcObject = mediaStream;\n      video.onloadedmetadata = function(e) {\n        video.play();\n      };\n    })\n    .catch(err => console.warn(`${err.name}: ${err.message}`));\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/mediaDevice.js","\nfunction merge(one, two) {\n  return Object.assign({}, one, two);\n}\n\nexport default class Component {\n\n  constructor(id, defaultState = {}) {\n\n    let state = defaultState;\n\n    const getState = () => state;\n\n    const setState = arg => {\n      if (typeof arg === 'function') {\n        setState(arg(getState()));\n      } else {\n        state = merge(state, arg);\n        this.renderer(getState())\n      }\n    }\n\n    this.dom = document.getElementById(id);\n    this.getState = getState;\n    this.setState = setState;\n    this.renderer = function noop() { };\n  }\n\n  addClass(classname) {\n    this.dom.classList.add(classname);\n  }\n\n  removeClass(classname) {\n    this.dom.classList.remove(classname);\n  }\n\n  toggleClass(classname) {\n    this.dom.classList.toggle(classname);\n  }\n\n  on(event, eventHandler) {\n    return this.dom.addEventListener(event, eventHandler);\n  }\n\n  render(fn) {\n    this.renderer = fn;\n    fn(this.getState());\n  }\n\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/Component.js","(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require==\"function\"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error(\"Cannot find module '\"+o+\"'\");throw f.code=\"MODULE_NOT_FOUND\",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require==\"function\"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){\n/*\n *  Copyright (c) 2017 The WebRTC project authors. All Rights Reserved.\n *\n *  Use of this source code is governed by a BSD-style license\n *  that can be found in the LICENSE file in the root of the source\n *  tree.\n */\n /* eslint-env node */\n'use strict';\n\nvar SDPUtils = require('sdp');\n\nfunction writeMediaSection(transceiver, caps, type, stream, dtlsRole) {\n  var sdp = SDPUtils.writeRtpDescription(transceiver.kind, caps);\n\n  // Map ICE parameters (ufrag, pwd) to SDP.\n  sdp += SDPUtils.writeIceParameters(\n      transceiver.iceGatherer.getLocalParameters());\n\n  // Map DTLS parameters to SDP.\n  sdp += SDPUtils.writeDtlsParameters(\n      transceiver.dtlsTransport.getLocalParameters(),\n      type === 'offer' ? 'actpass' : dtlsRole || 'active');\n\n  sdp += 'a=mid:' + transceiver.mid + '\\r\\n';\n\n  if (transceiver.rtpSender && transceiver.rtpReceiver) {\n    sdp += 'a=sendrecv\\r\\n';\n  } else if (transceiver.rtpSender) {\n    sdp += 'a=sendonly\\r\\n';\n  } else if (transceiver.rtpReceiver) {\n    sdp += 'a=recvonly\\r\\n';\n  } else {\n    sdp += 'a=inactive\\r\\n';\n  }\n\n  if (transceiver.rtpSender) {\n    // spec.\n    var msid = 'msid:' + stream.id + ' ' +\n        transceiver.rtpSender.track.id + '\\r\\n';\n    sdp += 'a=' + msid;\n\n    // for Chrome.\n    sdp += 'a=ssrc:' + transceiver.sendEncodingParameters[0].ssrc +\n        ' ' + msid;\n    if (transceiver.sendEncodingParameters[0].rtx) {\n      sdp += 'a=ssrc:' + transceiver.sendEncodingParameters[0].rtx.ssrc +\n          ' ' + msid;\n      sdp += 'a=ssrc-group:FID ' +\n          transceiver.sendEncodingParameters[0].ssrc + ' ' +\n          transceiver.sendEncodingParameters[0].rtx.ssrc +\n          '\\r\\n';\n    }\n  }\n  // FIXME: this should be written by writeRtpDescription.\n  sdp += 'a=ssrc:' + transceiver.sendEncodingParameters[0].ssrc +\n      ' cname:' + SDPUtils.localCName + '\\r\\n';\n  if (transceiver.rtpSender && transceiver.sendEncodingParameters[0].rtx) {\n    sdp += 'a=ssrc:' + transceiver.sendEncodingParameters[0].rtx.ssrc +\n        ' cname:' + SDPUtils.localCName + '\\r\\n';\n  }\n  return sdp;\n}\n\n// Edge does not like\n// 1) stun: filtered after 14393 unless ?transport=udp is present\n// 2) turn: that does not have all of turn:host:port?transport=udp\n// 3) turn: with ipv6 addresses\n// 4) turn: occurring muliple times\nfunction filterIceServers(iceServers, edgeVersion) {\n  var hasTurn = false;\n  iceServers = JSON.parse(JSON.stringify(iceServers));\n  return iceServers.filter(function(server) {\n    if (server && (server.urls || server.url)) {\n      var urls = server.urls || server.url;\n      if (server.url && !server.urls) {\n        console.warn('RTCIceServer.url is deprecated! Use urls instead.');\n      }\n      var isString = typeof urls === 'string';\n      if (isString) {\n        urls = [urls];\n      }\n      urls = urls.filter(function(url) {\n        var validTurn = url.indexOf('turn:') === 0 &&\n            url.indexOf('transport=udp') !== -1 &&\n            url.indexOf('turn:[') === -1 &&\n            !hasTurn;\n\n        if (validTurn) {\n          hasTurn = true;\n          return true;\n        }\n        return url.indexOf('stun:') === 0 && edgeVersion >= 14393 &&\n            url.indexOf('?transport=udp') === -1;\n      });\n\n      delete server.url;\n      server.urls = isString ? urls[0] : urls;\n      return !!urls.length;\n    }\n  });\n}\n\n// Determines the intersection of local and remote capabilities.\nfunction getCommonCapabilities(localCapabilities, remoteCapabilities) {\n  var commonCapabilities = {\n    codecs: [],\n    headerExtensions: [],\n    fecMechanisms: []\n  };\n\n  var findCodecByPayloadType = function(pt, codecs) {\n    pt = parseInt(pt, 10);\n    for (var i = 0; i < codecs.length; i++) {\n      if (codecs[i].payloadType === pt ||\n          codecs[i].preferredPayloadType === pt) {\n        return codecs[i];\n      }\n    }\n  };\n\n  var rtxCapabilityMatches = function(lRtx, rRtx, lCodecs, rCodecs) {\n    var lCodec = findCodecByPayloadType(lRtx.parameters.apt, lCodecs);\n    var rCodec = findCodecByPayloadType(rRtx.parameters.apt, rCodecs);\n    return lCodec && rCodec &&\n        lCodec.name.toLowerCase() === rCodec.name.toLowerCase();\n  };\n\n  localCapabilities.codecs.forEach(function(lCodec) {\n    for (var i = 0; i < remoteCapabilities.codecs.length; i++) {\n      var rCodec = remoteCapabilities.codecs[i];\n      if (lCodec.name.toLowerCase() === rCodec.name.toLowerCase() &&\n          lCodec.clockRate === rCodec.clockRate) {\n        if (lCodec.name.toLowerCase() === 'rtx' &&\n            lCodec.parameters && rCodec.parameters.apt) {\n          // for RTX we need to find the local rtx that has a apt\n          // which points to the same local codec as the remote one.\n          if (!rtxCapabilityMatches(lCodec, rCodec,\n              localCapabilities.codecs, remoteCapabilities.codecs)) {\n            continue;\n          }\n        }\n        rCodec = JSON.parse(JSON.stringify(rCodec)); // deepcopy\n        // number of channels is the highest common number of channels\n        rCodec.numChannels = Math.min(lCodec.numChannels,\n            rCodec.numChannels);\n        // push rCodec so we reply with offerer payload type\n        commonCapabilities.codecs.push(rCodec);\n\n        // determine common feedback mechanisms\n        rCodec.rtcpFeedback = rCodec.rtcpFeedback.filter(function(fb) {\n          for (var j = 0; j < lCodec.rtcpFeedback.length; j++) {\n            if (lCodec.rtcpFeedback[j].type === fb.type &&\n                lCodec.rtcpFeedback[j].parameter === fb.parameter) {\n              return true;\n            }\n          }\n          return false;\n        });\n        // FIXME: also need to determine .parameters\n        //  see https://github.com/openpeer/ortc/issues/569\n        break;\n      }\n    }\n  });\n\n  localCapabilities.headerExtensions.forEach(function(lHeaderExtension) {\n    for (var i = 0; i < remoteCapabilities.headerExtensions.length;\n         i++) {\n      var rHeaderExtension = remoteCapabilities.headerExtensions[i];\n      if (lHeaderExtension.uri === rHeaderExtension.uri) {\n        commonCapabilities.headerExtensions.push(rHeaderExtension);\n        break;\n      }\n    }\n  });\n\n  // FIXME: fecMechanisms\n  return commonCapabilities;\n}\n\n// is action=setLocalDescription with type allowed in signalingState\nfunction isActionAllowedInSignalingState(action, type, signalingState) {\n  return {\n    offer: {\n      setLocalDescription: ['stable', 'have-local-offer'],\n      setRemoteDescription: ['stable', 'have-remote-offer']\n    },\n    answer: {\n      setLocalDescription: ['have-remote-offer', 'have-local-pranswer'],\n      setRemoteDescription: ['have-local-offer', 'have-remote-pranswer']\n    }\n  }[type][action].indexOf(signalingState) !== -1;\n}\n\nfunction maybeAddCandidate(iceTransport, candidate) {\n  // Edge's internal representation adds some fields therefore\n  // not all fieldѕ are taken into account.\n  var alreadyAdded = iceTransport.getRemoteCandidates()\n      .find(function(remoteCandidate) {\n        return candidate.foundation === remoteCandidate.foundation &&\n            candidate.ip === remoteCandidate.ip &&\n            candidate.port === remoteCandidate.port &&\n            candidate.priority === remoteCandidate.priority &&\n            candidate.protocol === remoteCandidate.protocol &&\n            candidate.type === remoteCandidate.type;\n      });\n  if (!alreadyAdded) {\n    iceTransport.addRemoteCandidate(candidate);\n  }\n  return !alreadyAdded;\n}\n\n\n// https://w3c.github.io/mediacapture-main/#mediastream\n// Helper function to add the track to the stream and\n// dispatch the event ourselves.\nfunction addTrackToStreamAndFireEvent(track, stream) {\n  stream.addTrack(track);\n  var e = new Event('addtrack'); // TODO: MediaStreamTrackEvent\n  e.track = track;\n  stream.dispatchEvent(e);\n}\n\nfunction removeTrackFromStreamAndFireEvent(track, stream) {\n  stream.removeTrack(track);\n  var e = new Event('removetrack'); // TODO: MediaStreamTrackEvent\n  e.track = track;\n  stream.dispatchEvent(e);\n}\n\nfunction fireAddTrack(pc, track, receiver, streams) {\n  var trackEvent = new Event('track');\n  trackEvent.track = track;\n  trackEvent.receiver = receiver;\n  trackEvent.transceiver = {receiver: receiver};\n  trackEvent.streams = streams;\n  window.setTimeout(function() {\n    pc._dispatchEvent('track', trackEvent);\n  });\n}\n\nfunction makeError(name, description) {\n  var e = new Error(description);\n  e.name = name;\n  return e;\n}\n\nmodule.exports = function(window, edgeVersion) {\n  var RTCPeerConnection = function(config) {\n    var pc = this;\n\n    var _eventTarget = document.createDocumentFragment();\n    ['addEventListener', 'removeEventListener', 'dispatchEvent']\n        .forEach(function(method) {\n          pc[method] = _eventTarget[method].bind(_eventTarget);\n        });\n\n    this.canTrickleIceCandidates = null;\n\n    this.needNegotiation = false;\n\n    this.localStreams = [];\n    this.remoteStreams = [];\n\n    this.localDescription = null;\n    this.remoteDescription = null;\n\n    this.signalingState = 'stable';\n    this.iceConnectionState = 'new';\n    this.iceGatheringState = 'new';\n\n    config = JSON.parse(JSON.stringify(config || {}));\n\n    this.usingBundle = config.bundlePolicy === 'max-bundle';\n    if (config.rtcpMuxPolicy === 'negotiate') {\n      throw(makeError('NotSupportedError',\n          'rtcpMuxPolicy \\'negotiate\\' is not supported'));\n    } else if (!config.rtcpMuxPolicy) {\n      config.rtcpMuxPolicy = 'require';\n    }\n\n    switch (config.iceTransportPolicy) {\n      case 'all':\n      case 'relay':\n        break;\n      default:\n        config.iceTransportPolicy = 'all';\n        break;\n    }\n\n    switch (config.bundlePolicy) {\n      case 'balanced':\n      case 'max-compat':\n      case 'max-bundle':\n        break;\n      default:\n        config.bundlePolicy = 'balanced';\n        break;\n    }\n\n    config.iceServers = filterIceServers(config.iceServers || [], edgeVersion);\n\n    this._iceGatherers = [];\n    if (config.iceCandidatePoolSize) {\n      for (var i = config.iceCandidatePoolSize; i > 0; i--) {\n        this._iceGatherers = new window.RTCIceGatherer({\n          iceServers: config.iceServers,\n          gatherPolicy: config.iceTransportPolicy\n        });\n      }\n    } else {\n      config.iceCandidatePoolSize = 0;\n    }\n\n    this._config = config;\n\n    // per-track iceGathers, iceTransports, dtlsTransports, rtpSenders, ...\n    // everything that is needed to describe a SDP m-line.\n    this.transceivers = [];\n\n    this._sdpSessionId = SDPUtils.generateSessionId();\n    this._sdpSessionVersion = 0;\n\n    this._dtlsRole = undefined; // role for a=setup to use in answers.\n\n    this._isClosed = false;\n  };\n\n  // set up event handlers on prototype\n  RTCPeerConnection.prototype.onicecandidate = null;\n  RTCPeerConnection.prototype.onaddstream = null;\n  RTCPeerConnection.prototype.ontrack = null;\n  RTCPeerConnection.prototype.onremovestream = null;\n  RTCPeerConnection.prototype.onsignalingstatechange = null;\n  RTCPeerConnection.prototype.oniceconnectionstatechange = null;\n  RTCPeerConnection.prototype.onicegatheringstatechange = null;\n  RTCPeerConnection.prototype.onnegotiationneeded = null;\n  RTCPeerConnection.prototype.ondatachannel = null;\n\n  RTCPeerConnection.prototype._dispatchEvent = function(name, event) {\n    if (this._isClosed) {\n      return;\n    }\n    this.dispatchEvent(event);\n    if (typeof this['on' + name] === 'function') {\n      this['on' + name](event);\n    }\n  };\n\n  RTCPeerConnection.prototype._emitGatheringStateChange = function() {\n    var event = new Event('icegatheringstatechange');\n    this._dispatchEvent('icegatheringstatechange', event);\n  };\n\n  RTCPeerConnection.prototype.getConfiguration = function() {\n    return this._config;\n  };\n\n  RTCPeerConnection.prototype.getLocalStreams = function() {\n    return this.localStreams;\n  };\n\n  RTCPeerConnection.prototype.getRemoteStreams = function() {\n    return this.remoteStreams;\n  };\n\n  // internal helper to create a transceiver object.\n  // (whih is not yet the same as the WebRTC 1.0 transceiver)\n  RTCPeerConnection.prototype._createTransceiver = function(kind) {\n    var hasBundleTransport = this.transceivers.length > 0;\n    var transceiver = {\n      track: null,\n      iceGatherer: null,\n      iceTransport: null,\n      dtlsTransport: null,\n      localCapabilities: null,\n      remoteCapabilities: null,\n      rtpSender: null,\n      rtpReceiver: null,\n      kind: kind,\n      mid: null,\n      sendEncodingParameters: null,\n      recvEncodingParameters: null,\n      stream: null,\n      associatedRemoteMediaStreams: [],\n      wantReceive: true\n    };\n    if (this.usingBundle && hasBundleTransport) {\n      transceiver.iceTransport = this.transceivers[0].iceTransport;\n      transceiver.dtlsTransport = this.transceivers[0].dtlsTransport;\n    } else {\n      var transports = this._createIceAndDtlsTransports();\n      transceiver.iceTransport = transports.iceTransport;\n      transceiver.dtlsTransport = transports.dtlsTransport;\n    }\n    this.transceivers.push(transceiver);\n    return transceiver;\n  };\n\n  RTCPeerConnection.prototype.addTrack = function(track, stream) {\n    var alreadyExists = this.transceivers.find(function(s) {\n      return s.track === track;\n    });\n\n    if (alreadyExists) {\n      throw makeError('InvalidAccessError', 'Track already exists.');\n    }\n\n    if (this.signalingState === 'closed') {\n      throw makeError('InvalidStateError',\n          'Attempted to call addTrack on a closed peerconnection.');\n    }\n\n    var transceiver;\n    for (var i = 0; i < this.transceivers.length; i++) {\n      if (!this.transceivers[i].track &&\n          this.transceivers[i].kind === track.kind) {\n        transceiver = this.transceivers[i];\n      }\n    }\n    if (!transceiver) {\n      transceiver = this._createTransceiver(track.kind);\n    }\n\n    this._maybeFireNegotiationNeeded();\n\n    if (this.localStreams.indexOf(stream) === -1) {\n      this.localStreams.push(stream);\n    }\n\n    transceiver.track = track;\n    transceiver.stream = stream;\n    transceiver.rtpSender = new window.RTCRtpSender(track,\n        transceiver.dtlsTransport);\n    return transceiver.rtpSender;\n  };\n\n  RTCPeerConnection.prototype.addStream = function(stream) {\n    var pc = this;\n    if (edgeVersion >= 15025) {\n      stream.getTracks().forEach(function(track) {\n        pc.addTrack(track, stream);\n      });\n    } else {\n      // Clone is necessary for local demos mostly, attaching directly\n      // to two different senders does not work (build 10547).\n      // Fixed in 15025 (or earlier)\n      var clonedStream = stream.clone();\n      stream.getTracks().forEach(function(track, idx) {\n        var clonedTrack = clonedStream.getTracks()[idx];\n        track.addEventListener('enabled', function(event) {\n          clonedTrack.enabled = event.enabled;\n        });\n      });\n      clonedStream.getTracks().forEach(function(track) {\n        pc.addTrack(track, clonedStream);\n      });\n    }\n  };\n\n  RTCPeerConnection.prototype.removeTrack = function(sender) {\n    if (!(sender instanceof window.RTCRtpSender)) {\n      throw new TypeError('Argument 1 of RTCPeerConnection.removeTrack ' +\n          'does not implement interface RTCRtpSender.');\n    }\n\n    var transceiver = this.transceivers.find(function(t) {\n      return t.rtpSender === sender;\n    });\n\n    if (!transceiver) {\n      throw makeError('InvalidAccessError',\n          'Sender was not created by this connection.');\n    }\n    var stream = transceiver.stream;\n\n    transceiver.rtpSender.stop();\n    transceiver.rtpSender = null;\n    transceiver.track = null;\n    transceiver.stream = null;\n\n    // remove the stream from the set of local streams\n    var localStreams = this.transceivers.map(function(t) {\n      return t.stream;\n    });\n    if (localStreams.indexOf(stream) === -1 &&\n        this.localStreams.indexOf(stream) > -1) {\n      this.localStreams.splice(this.localStreams.indexOf(stream), 1);\n    }\n\n    this._maybeFireNegotiationNeeded();\n  };\n\n  RTCPeerConnection.prototype.removeStream = function(stream) {\n    var pc = this;\n    stream.getTracks().forEach(function(track) {\n      var sender = pc.getSenders().find(function(s) {\n        return s.track === track;\n      });\n      if (sender) {\n        pc.removeTrack(sender);\n      }\n    });\n  };\n\n  RTCPeerConnection.prototype.getSenders = function() {\n    return this.transceivers.filter(function(transceiver) {\n      return !!transceiver.rtpSender;\n    })\n    .map(function(transceiver) {\n      return transceiver.rtpSender;\n    });\n  };\n\n  RTCPeerConnection.prototype.getReceivers = function() {\n    return this.transceivers.filter(function(transceiver) {\n      return !!transceiver.rtpReceiver;\n    })\n    .map(function(transceiver) {\n      return transceiver.rtpReceiver;\n    });\n  };\n\n\n  RTCPeerConnection.prototype._createIceGatherer = function(sdpMLineIndex,\n      usingBundle) {\n    var pc = this;\n    if (usingBundle && sdpMLineIndex > 0) {\n      return this.transceivers[0].iceGatherer;\n    } else if (this._iceGatherers.length) {\n      return this._iceGatherers.shift();\n    }\n    var iceGatherer = new window.RTCIceGatherer({\n      iceServers: this._config.iceServers,\n      gatherPolicy: this._config.iceTransportPolicy\n    });\n    Object.defineProperty(iceGatherer, 'state',\n        {value: 'new', writable: true}\n    );\n\n    this.transceivers[sdpMLineIndex].candidates = [];\n    this.transceivers[sdpMLineIndex].bufferCandidates = function(event) {\n      var end = !event.candidate || Object.keys(event.candidate).length === 0;\n      // polyfill since RTCIceGatherer.state is not implemented in\n      // Edge 10547 yet.\n      iceGatherer.state = end ? 'completed' : 'gathering';\n      if (pc.transceivers[sdpMLineIndex].candidates !== null) {\n        pc.transceivers[sdpMLineIndex].candidates.push(event.candidate);\n      }\n    };\n    iceGatherer.addEventListener('localcandidate',\n      this.transceivers[sdpMLineIndex].bufferCandidates);\n    return iceGatherer;\n  };\n\n  // start gathering from an RTCIceGatherer.\n  RTCPeerConnection.prototype._gather = function(mid, sdpMLineIndex) {\n    var pc = this;\n    var iceGatherer = this.transceivers[sdpMLineIndex].iceGatherer;\n    if (iceGatherer.onlocalcandidate) {\n      return;\n    }\n    var candidates = this.transceivers[sdpMLineIndex].candidates;\n    this.transceivers[sdpMLineIndex].candidates = null;\n    iceGatherer.removeEventListener('localcandidate',\n      this.transceivers[sdpMLineIndex].bufferCandidates);\n    iceGatherer.onlocalcandidate = function(evt) {\n      if (pc.usingBundle && sdpMLineIndex > 0) {\n        // if we know that we use bundle we can drop candidates with\n        // ѕdpMLineIndex > 0. If we don't do this then our state gets\n        // confused since we dispose the extra ice gatherer.\n        return;\n      }\n      var event = new Event('icecandidate');\n      event.candidate = {sdpMid: mid, sdpMLineIndex: sdpMLineIndex};\n\n      var cand = evt.candidate;\n      // Edge emits an empty object for RTCIceCandidateComplete‥\n      var end = !cand || Object.keys(cand).length === 0;\n      if (end) {\n        // polyfill since RTCIceGatherer.state is not implemented in\n        // Edge 10547 yet.\n        if (iceGatherer.state === 'new' || iceGatherer.state === 'gathering') {\n          iceGatherer.state = 'completed';\n        }\n      } else {\n        if (iceGatherer.state === 'new') {\n          iceGatherer.state = 'gathering';\n        }\n        // RTCIceCandidate doesn't have a component, needs to be added\n        cand.component = 1;\n        event.candidate.candidate = SDPUtils.writeCandidate(cand);\n      }\n\n      // update local description.\n      var sections = SDPUtils.splitSections(pc.localDescription.sdp);\n      if (!end) {\n        sections[event.candidate.sdpMLineIndex + 1] +=\n            'a=' + event.candidate.candidate + '\\r\\n';\n      } else {\n        sections[event.candidate.sdpMLineIndex + 1] +=\n            'a=end-of-candidates\\r\\n';\n      }\n      pc.localDescription.sdp = sections.join('');\n      var complete = pc.transceivers.every(function(transceiver) {\n        return transceiver.iceGatherer &&\n            transceiver.iceGatherer.state === 'completed';\n      });\n\n      if (pc.iceGatheringState !== 'gathering') {\n        pc.iceGatheringState = 'gathering';\n        pc._emitGatheringStateChange();\n      }\n\n      // Emit candidate. Also emit null candidate when all gatherers are\n      // complete.\n      if (!end) {\n        pc._dispatchEvent('icecandidate', event);\n      }\n      if (complete) {\n        pc._dispatchEvent('icecandidate', new Event('icecandidate'));\n        pc.iceGatheringState = 'complete';\n        pc._emitGatheringStateChange();\n      }\n    };\n\n    // emit already gathered candidates.\n    window.setTimeout(function() {\n      candidates.forEach(function(candidate) {\n        var e = new Event('RTCIceGatherEvent');\n        e.candidate = candidate;\n        iceGatherer.onlocalcandidate(e);\n      });\n    }, 0);\n  };\n\n  // Create ICE transport and DTLS transport.\n  RTCPeerConnection.prototype._createIceAndDtlsTransports = function() {\n    var pc = this;\n    var iceTransport = new window.RTCIceTransport(null);\n    iceTransport.onicestatechange = function() {\n      pc._updateConnectionState();\n    };\n\n    var dtlsTransport = new window.RTCDtlsTransport(iceTransport);\n    dtlsTransport.ondtlsstatechange = function() {\n      pc._updateConnectionState();\n    };\n    dtlsTransport.onerror = function() {\n      // onerror does not set state to failed by itpc.\n      Object.defineProperty(dtlsTransport, 'state',\n          {value: 'failed', writable: true});\n      pc._updateConnectionState();\n    };\n\n    return {\n      iceTransport: iceTransport,\n      dtlsTransport: dtlsTransport\n    };\n  };\n\n  // Destroy ICE gatherer, ICE transport and DTLS transport.\n  // Without triggering the callbacks.\n  RTCPeerConnection.prototype._disposeIceAndDtlsTransports = function(\n      sdpMLineIndex) {\n    var iceGatherer = this.transceivers[sdpMLineIndex].iceGatherer;\n    if (iceGatherer) {\n      delete iceGatherer.onlocalcandidate;\n      delete this.transceivers[sdpMLineIndex].iceGatherer;\n    }\n    var iceTransport = this.transceivers[sdpMLineIndex].iceTransport;\n    if (iceTransport) {\n      delete iceTransport.onicestatechange;\n      delete this.transceivers[sdpMLineIndex].iceTransport;\n    }\n    var dtlsTransport = this.transceivers[sdpMLineIndex].dtlsTransport;\n    if (dtlsTransport) {\n      delete dtlsTransport.ondtlsstatechange;\n      delete dtlsTransport.onerror;\n      delete this.transceivers[sdpMLineIndex].dtlsTransport;\n    }\n  };\n\n  // Start the RTP Sender and Receiver for a transceiver.\n  RTCPeerConnection.prototype._transceive = function(transceiver,\n      send, recv) {\n    var params = getCommonCapabilities(transceiver.localCapabilities,\n        transceiver.remoteCapabilities);\n    if (send && transceiver.rtpSender) {\n      params.encodings = transceiver.sendEncodingParameters;\n      params.rtcp = {\n        cname: SDPUtils.localCName,\n        compound: transceiver.rtcpParameters.compound\n      };\n      if (transceiver.recvEncodingParameters.length) {\n        params.rtcp.ssrc = transceiver.recvEncodingParameters[0].ssrc;\n      }\n      transceiver.rtpSender.send(params);\n    }\n    if (recv && transceiver.rtpReceiver && params.codecs.length > 0) {\n      // remove RTX field in Edge 14942\n      if (transceiver.kind === 'video'\n          && transceiver.recvEncodingParameters\n          && edgeVersion < 15019) {\n        transceiver.recvEncodingParameters.forEach(function(p) {\n          delete p.rtx;\n        });\n      }\n      if (transceiver.recvEncodingParameters.length) {\n        params.encodings = transceiver.recvEncodingParameters;\n      }\n      params.rtcp = {\n        compound: transceiver.rtcpParameters.compound\n      };\n      if (transceiver.rtcpParameters.cname) {\n        params.rtcp.cname = transceiver.rtcpParameters.cname;\n      }\n      if (transceiver.sendEncodingParameters.length) {\n        params.rtcp.ssrc = transceiver.sendEncodingParameters[0].ssrc;\n      }\n      transceiver.rtpReceiver.receive(params);\n    }\n  };\n\n  RTCPeerConnection.prototype.setLocalDescription = function(description) {\n    var pc = this;\n\n    if (!isActionAllowedInSignalingState('setLocalDescription',\n        description.type, this.signalingState) || this._isClosed) {\n      return Promise.reject(makeError('InvalidStateError',\n          'Can not set local ' + description.type +\n          ' in state ' + pc.signalingState));\n    }\n\n    var sections;\n    var sessionpart;\n    if (description.type === 'offer') {\n      // VERY limited support for SDP munging. Limited to:\n      // * changing the order of codecs\n      sections = SDPUtils.splitSections(description.sdp);\n      sessionpart = sections.shift();\n      sections.forEach(function(mediaSection, sdpMLineIndex) {\n        var caps = SDPUtils.parseRtpParameters(mediaSection);\n        pc.transceivers[sdpMLineIndex].localCapabilities = caps;\n      });\n\n      this.transceivers.forEach(function(transceiver, sdpMLineIndex) {\n        pc._gather(transceiver.mid, sdpMLineIndex);\n      });\n    } else if (description.type === 'answer') {\n      sections = SDPUtils.splitSections(pc.remoteDescription.sdp);\n      sessionpart = sections.shift();\n      var isIceLite = SDPUtils.matchPrefix(sessionpart,\n          'a=ice-lite').length > 0;\n      sections.forEach(function(mediaSection, sdpMLineIndex) {\n        var transceiver = pc.transceivers[sdpMLineIndex];\n        var iceGatherer = transceiver.iceGatherer;\n        var iceTransport = transceiver.iceTransport;\n        var dtlsTransport = transceiver.dtlsTransport;\n        var localCapabilities = transceiver.localCapabilities;\n        var remoteCapabilities = transceiver.remoteCapabilities;\n\n        // treat bundle-only as not-rejected.\n        var rejected = SDPUtils.isRejected(mediaSection) &&\n            SDPUtils.matchPrefix(mediaSection, 'a=bundle-only').length === 0;\n\n        if (!rejected && !transceiver.isDatachannel) {\n          var remoteIceParameters = SDPUtils.getIceParameters(\n              mediaSection, sessionpart);\n          var remoteDtlsParameters = SDPUtils.getDtlsParameters(\n              mediaSection, sessionpart);\n          if (isIceLite) {\n            remoteDtlsParameters.role = 'server';\n          }\n\n          if (!pc.usingBundle || sdpMLineIndex === 0) {\n            pc._gather(transceiver.mid, sdpMLineIndex);\n            if (iceTransport.state === 'new') {\n              iceTransport.start(iceGatherer, remoteIceParameters,\n                  isIceLite ? 'controlling' : 'controlled');\n            }\n            if (dtlsTransport.state === 'new') {\n              dtlsTransport.start(remoteDtlsParameters);\n            }\n          }\n\n          // Calculate intersection of capabilities.\n          var params = getCommonCapabilities(localCapabilities,\n              remoteCapabilities);\n\n          // Start the RTCRtpSender. The RTCRtpReceiver for this\n          // transceiver has already been started in setRemoteDescription.\n          pc._transceive(transceiver,\n              params.codecs.length > 0,\n              false);\n        }\n      });\n    }\n\n    this.localDescription = {\n      type: description.type,\n      sdp: description.sdp\n    };\n    switch (description.type) {\n      case 'offer':\n        this._updateSignalingState('have-local-offer');\n        break;\n      case 'answer':\n        this._updateSignalingState('stable');\n        break;\n      default:\n        throw new TypeError('unsupported type \"' + description.type +\n            '\"');\n    }\n\n    return Promise.resolve();\n  };\n\n  RTCPeerConnection.prototype.setRemoteDescription = function(description) {\n    var pc = this;\n\n    if (!isActionAllowedInSignalingState('setRemoteDescription',\n        description.type, this.signalingState) || this._isClosed) {\n      return Promise.reject(makeError('InvalidStateError',\n          'Can not set remote ' + description.type +\n          ' in state ' + pc.signalingState));\n    }\n\n    var streams = {};\n    this.remoteStreams.forEach(function(stream) {\n      streams[stream.id] = stream;\n    });\n    var receiverList = [];\n    var sections = SDPUtils.splitSections(description.sdp);\n    var sessionpart = sections.shift();\n    var isIceLite = SDPUtils.matchPrefix(sessionpart,\n        'a=ice-lite').length > 0;\n    var usingBundle = SDPUtils.matchPrefix(sessionpart,\n        'a=group:BUNDLE ').length > 0;\n    this.usingBundle = usingBundle;\n    var iceOptions = SDPUtils.matchPrefix(sessionpart,\n        'a=ice-options:')[0];\n    if (iceOptions) {\n      this.canTrickleIceCandidates = iceOptions.substr(14).split(' ')\n          .indexOf('trickle') >= 0;\n    } else {\n      this.canTrickleIceCandidates = false;\n    }\n\n    sections.forEach(function(mediaSection, sdpMLineIndex) {\n      var lines = SDPUtils.splitLines(mediaSection);\n      var kind = SDPUtils.getKind(mediaSection);\n      // treat bundle-only as not-rejected.\n      var rejected = SDPUtils.isRejected(mediaSection) &&\n          SDPUtils.matchPrefix(mediaSection, 'a=bundle-only').length === 0;\n      var protocol = lines[0].substr(2).split(' ')[2];\n\n      var direction = SDPUtils.getDirection(mediaSection, sessionpart);\n      var remoteMsid = SDPUtils.parseMsid(mediaSection);\n\n      var mid = SDPUtils.getMid(mediaSection) || SDPUtils.generateIdentifier();\n\n      // Reject datachannels which are not implemented yet.\n      if (kind === 'application' && protocol === 'DTLS/SCTP') {\n        pc.transceivers[sdpMLineIndex] = {\n          mid: mid,\n          isDatachannel: true\n        };\n        return;\n      }\n\n      var transceiver;\n      var iceGatherer;\n      var iceTransport;\n      var dtlsTransport;\n      var rtpReceiver;\n      var sendEncodingParameters;\n      var recvEncodingParameters;\n      var localCapabilities;\n\n      var track;\n      // FIXME: ensure the mediaSection has rtcp-mux set.\n      var remoteCapabilities = SDPUtils.parseRtpParameters(mediaSection);\n      var remoteIceParameters;\n      var remoteDtlsParameters;\n      if (!rejected) {\n        remoteIceParameters = SDPUtils.getIceParameters(mediaSection,\n            sessionpart);\n        remoteDtlsParameters = SDPUtils.getDtlsParameters(mediaSection,\n            sessionpart);\n        remoteDtlsParameters.role = 'client';\n      }\n      recvEncodingParameters =\n          SDPUtils.parseRtpEncodingParameters(mediaSection);\n\n      var rtcpParameters = SDPUtils.parseRtcpParameters(mediaSection);\n\n      var isComplete = SDPUtils.matchPrefix(mediaSection,\n          'a=end-of-candidates', sessionpart).length > 0;\n      var cands = SDPUtils.matchPrefix(mediaSection, 'a=candidate:')\n          .map(function(cand) {\n            return SDPUtils.parseCandidate(cand);\n          })\n          .filter(function(cand) {\n            return cand.component === 1;\n          });\n\n      // Check if we can use BUNDLE and dispose transports.\n      if ((description.type === 'offer' || description.type === 'answer') &&\n          !rejected && usingBundle && sdpMLineIndex > 0 &&\n          pc.transceivers[sdpMLineIndex]) {\n        pc._disposeIceAndDtlsTransports(sdpMLineIndex);\n        pc.transceivers[sdpMLineIndex].iceGatherer =\n            pc.transceivers[0].iceGatherer;\n        pc.transceivers[sdpMLineIndex].iceTransport =\n            pc.transceivers[0].iceTransport;\n        pc.transceivers[sdpMLineIndex].dtlsTransport =\n            pc.transceivers[0].dtlsTransport;\n        if (pc.transceivers[sdpMLineIndex].rtpSender) {\n          pc.transceivers[sdpMLineIndex].rtpSender.setTransport(\n              pc.transceivers[0].dtlsTransport);\n        }\n        if (pc.transceivers[sdpMLineIndex].rtpReceiver) {\n          pc.transceivers[sdpMLineIndex].rtpReceiver.setTransport(\n              pc.transceivers[0].dtlsTransport);\n        }\n      }\n      if (description.type === 'offer' && !rejected) {\n        transceiver = pc.transceivers[sdpMLineIndex] ||\n            pc._createTransceiver(kind);\n        transceiver.mid = mid;\n\n        if (!transceiver.iceGatherer) {\n          transceiver.iceGatherer = pc._createIceGatherer(sdpMLineIndex,\n              usingBundle);\n        }\n\n        if (cands.length && transceiver.iceTransport.state === 'new') {\n          if (isComplete && (!usingBundle || sdpMLineIndex === 0)) {\n            transceiver.iceTransport.setRemoteCandidates(cands);\n          } else {\n            cands.forEach(function(candidate) {\n              maybeAddCandidate(transceiver.iceTransport, candidate);\n            });\n          }\n        }\n\n        localCapabilities = window.RTCRtpReceiver.getCapabilities(kind);\n\n        // filter RTX until additional stuff needed for RTX is implemented\n        // in adapter.js\n        if (edgeVersion < 15019) {\n          localCapabilities.codecs = localCapabilities.codecs.filter(\n              function(codec) {\n                return codec.name !== 'rtx';\n              });\n        }\n\n        sendEncodingParameters = transceiver.sendEncodingParameters || [{\n          ssrc: (2 * sdpMLineIndex + 2) * 1001\n        }];\n\n        // TODO: rewrite to use http://w3c.github.io/webrtc-pc/#set-associated-remote-streams\n        var isNewTrack = false;\n        if (direction === 'sendrecv' || direction === 'sendonly') {\n          isNewTrack = !transceiver.rtpReceiver;\n          rtpReceiver = transceiver.rtpReceiver ||\n              new window.RTCRtpReceiver(transceiver.dtlsTransport, kind);\n\n          if (isNewTrack) {\n            var stream;\n            track = rtpReceiver.track;\n            // FIXME: does not work with Plan B.\n            if (remoteMsid && remoteMsid.stream === '-') {\n              // no-op. a stream id of '-' means: no associated stream.\n            } else if (remoteMsid) {\n              if (!streams[remoteMsid.stream]) {\n                streams[remoteMsid.stream] = new window.MediaStream();\n                Object.defineProperty(streams[remoteMsid.stream], 'id', {\n                  get: function() {\n                    return remoteMsid.stream;\n                  }\n                });\n              }\n              Object.defineProperty(track, 'id', {\n                get: function() {\n                  return remoteMsid.track;\n                }\n              });\n              stream = streams[remoteMsid.stream];\n            } else {\n              if (!streams.default) {\n                streams.default = new window.MediaStream();\n              }\n              stream = streams.default;\n            }\n            if (stream) {\n              addTrackToStreamAndFireEvent(track, stream);\n              transceiver.associatedRemoteMediaStreams.push(stream);\n            }\n            receiverList.push([track, rtpReceiver, stream]);\n          }\n        } else if (transceiver.rtpReceiver && transceiver.rtpReceiver.track) {\n          transceiver.associatedRemoteMediaStreams.forEach(function(s) {\n            var nativeTrack = s.getTracks().find(function(t) {\n              return t.id === transceiver.rtpReceiver.track.id;\n            });\n            if (nativeTrack) {\n              removeTrackFromStreamAndFireEvent(nativeTrack, s);\n            }\n          });\n          transceiver.associatedRemoteMediaStreams = [];\n        }\n\n        transceiver.localCapabilities = localCapabilities;\n        transceiver.remoteCapabilities = remoteCapabilities;\n        transceiver.rtpReceiver = rtpReceiver;\n        transceiver.rtcpParameters = rtcpParameters;\n        transceiver.sendEncodingParameters = sendEncodingParameters;\n        transceiver.recvEncodingParameters = recvEncodingParameters;\n\n        // Start the RTCRtpReceiver now. The RTPSender is started in\n        // setLocalDescription.\n        pc._transceive(pc.transceivers[sdpMLineIndex],\n            false,\n            isNewTrack);\n      } else if (description.type === 'answer' && !rejected) {\n        transceiver = pc.transceivers[sdpMLineIndex];\n        iceGatherer = transceiver.iceGatherer;\n        iceTransport = transceiver.iceTransport;\n        dtlsTransport = transceiver.dtlsTransport;\n        rtpReceiver = transceiver.rtpReceiver;\n        sendEncodingParameters = transceiver.sendEncodingParameters;\n        localCapabilities = transceiver.localCapabilities;\n\n        pc.transceivers[sdpMLineIndex].recvEncodingParameters =\n            recvEncodingParameters;\n        pc.transceivers[sdpMLineIndex].remoteCapabilities =\n            remoteCapabilities;\n        pc.transceivers[sdpMLineIndex].rtcpParameters = rtcpParameters;\n\n        if (cands.length && iceTransport.state === 'new') {\n          if ((isIceLite || isComplete) &&\n              (!usingBundle || sdpMLineIndex === 0)) {\n            iceTransport.setRemoteCandidates(cands);\n          } else {\n            cands.forEach(function(candidate) {\n              maybeAddCandidate(transceiver.iceTransport, candidate);\n            });\n          }\n        }\n\n        if (!usingBundle || sdpMLineIndex === 0) {\n          if (iceTransport.state === 'new') {\n            iceTransport.start(iceGatherer, remoteIceParameters,\n                'controlling');\n          }\n          if (dtlsTransport.state === 'new') {\n            dtlsTransport.start(remoteDtlsParameters);\n          }\n        }\n\n        pc._transceive(transceiver,\n            direction === 'sendrecv' || direction === 'recvonly',\n            direction === 'sendrecv' || direction === 'sendonly');\n\n        // TODO: rewrite to use http://w3c.github.io/webrtc-pc/#set-associated-remote-streams\n        if (rtpReceiver &&\n            (direction === 'sendrecv' || direction === 'sendonly')) {\n          track = rtpReceiver.track;\n          if (remoteMsid) {\n            if (!streams[remoteMsid.stream]) {\n              streams[remoteMsid.stream] = new window.MediaStream();\n            }\n            addTrackToStreamAndFireEvent(track, streams[remoteMsid.stream]);\n            receiverList.push([track, rtpReceiver, streams[remoteMsid.stream]]);\n          } else {\n            if (!streams.default) {\n              streams.default = new window.MediaStream();\n            }\n            addTrackToStreamAndFireEvent(track, streams.default);\n            receiverList.push([track, rtpReceiver, streams.default]);\n          }\n        } else {\n          // FIXME: actually the receiver should be created later.\n          delete transceiver.rtpReceiver;\n        }\n      }\n    });\n\n    if (this._dtlsRole === undefined) {\n      this._dtlsRole = description.type === 'offer' ? 'active' : 'passive';\n    }\n\n    this.remoteDescription = {\n      type: description.type,\n      sdp: description.sdp\n    };\n    switch (description.type) {\n      case 'offer':\n        this._updateSignalingState('have-remote-offer');\n        break;\n      case 'answer':\n        this._updateSignalingState('stable');\n        break;\n      default:\n        throw new TypeError('unsupported type \"' + description.type +\n            '\"');\n    }\n    Object.keys(streams).forEach(function(sid) {\n      var stream = streams[sid];\n      if (stream.getTracks().length) {\n        if (pc.remoteStreams.indexOf(stream) === -1) {\n          pc.remoteStreams.push(stream);\n          var event = new Event('addstream');\n          event.stream = stream;\n          window.setTimeout(function() {\n            pc._dispatchEvent('addstream', event);\n          });\n        }\n\n        receiverList.forEach(function(item) {\n          var track = item[0];\n          var receiver = item[1];\n          if (stream.id !== item[2].id) {\n            return;\n          }\n          fireAddTrack(pc, track, receiver, [stream]);\n        });\n      }\n    });\n    receiverList.forEach(function(item) {\n      if (item[2]) {\n        return;\n      }\n      fireAddTrack(pc, item[0], item[1], []);\n    });\n\n    // check whether addIceCandidate({}) was called within four seconds after\n    // setRemoteDescription.\n    window.setTimeout(function() {\n      if (!(pc && pc.transceivers)) {\n        return;\n      }\n      pc.transceivers.forEach(function(transceiver) {\n        if (transceiver.iceTransport &&\n            transceiver.iceTransport.state === 'new' &&\n            transceiver.iceTransport.getRemoteCandidates().length > 0) {\n          console.warn('Timeout for addRemoteCandidate. Consider sending ' +\n              'an end-of-candidates notification');\n          transceiver.iceTransport.addRemoteCandidate({});\n        }\n      });\n    }, 4000);\n\n    return Promise.resolve();\n  };\n\n  RTCPeerConnection.prototype.close = function() {\n    this.transceivers.forEach(function(transceiver) {\n      /* not yet\n      if (transceiver.iceGatherer) {\n        transceiver.iceGatherer.close();\n      }\n      */\n      if (transceiver.iceTransport) {\n        transceiver.iceTransport.stop();\n      }\n      if (transceiver.dtlsTransport) {\n        transceiver.dtlsTransport.stop();\n      }\n      if (transceiver.rtpSender) {\n        transceiver.rtpSender.stop();\n      }\n      if (transceiver.rtpReceiver) {\n        transceiver.rtpReceiver.stop();\n      }\n    });\n    // FIXME: clean up tracks, local streams, remote streams, etc\n    this._isClosed = true;\n    this._updateSignalingState('closed');\n  };\n\n  // Update the signaling state.\n  RTCPeerConnection.prototype._updateSignalingState = function(newState) {\n    this.signalingState = newState;\n    var event = new Event('signalingstatechange');\n    this._dispatchEvent('signalingstatechange', event);\n  };\n\n  // Determine whether to fire the negotiationneeded event.\n  RTCPeerConnection.prototype._maybeFireNegotiationNeeded = function() {\n    var pc = this;\n    if (this.signalingState !== 'stable' || this.needNegotiation === true) {\n      return;\n    }\n    this.needNegotiation = true;\n    window.setTimeout(function() {\n      if (pc.needNegotiation === false) {\n        return;\n      }\n      pc.needNegotiation = false;\n      var event = new Event('negotiationneeded');\n      pc._dispatchEvent('negotiationneeded', event);\n    }, 0);\n  };\n\n  // Update the connection state.\n  RTCPeerConnection.prototype._updateConnectionState = function() {\n    var newState;\n    var states = {\n      'new': 0,\n      closed: 0,\n      connecting: 0,\n      checking: 0,\n      connected: 0,\n      completed: 0,\n      disconnected: 0,\n      failed: 0\n    };\n    this.transceivers.forEach(function(transceiver) {\n      states[transceiver.iceTransport.state]++;\n      states[transceiver.dtlsTransport.state]++;\n    });\n    // ICETransport.completed and connected are the same for this purpose.\n    states.connected += states.completed;\n\n    newState = 'new';\n    if (states.failed > 0) {\n      newState = 'failed';\n    } else if (states.connecting > 0 || states.checking > 0) {\n      newState = 'connecting';\n    } else if (states.disconnected > 0) {\n      newState = 'disconnected';\n    } else if (states.new > 0) {\n      newState = 'new';\n    } else if (states.connected > 0 || states.completed > 0) {\n      newState = 'connected';\n    }\n\n    if (newState !== this.iceConnectionState) {\n      this.iceConnectionState = newState;\n      var event = new Event('iceconnectionstatechange');\n      this._dispatchEvent('iceconnectionstatechange', event);\n    }\n  };\n\n  RTCPeerConnection.prototype.createOffer = function() {\n    var pc = this;\n\n    if (this._isClosed) {\n      return Promise.reject(makeError('InvalidStateError',\n          'Can not call createOffer after close'));\n    }\n\n    var numAudioTracks = this.transceivers.filter(function(t) {\n      return t.kind === 'audio';\n    }).length;\n    var numVideoTracks = this.transceivers.filter(function(t) {\n      return t.kind === 'video';\n    }).length;\n\n    // Determine number of audio and video tracks we need to send/recv.\n    var offerOptions = arguments[0];\n    if (offerOptions) {\n      // Reject Chrome legacy constraints.\n      if (offerOptions.mandatory || offerOptions.optional) {\n        throw new TypeError(\n            'Legacy mandatory/optional constraints not supported.');\n      }\n      if (offerOptions.offerToReceiveAudio !== undefined) {\n        if (offerOptions.offerToReceiveAudio === true) {\n          numAudioTracks = 1;\n        } else if (offerOptions.offerToReceiveAudio === false) {\n          numAudioTracks = 0;\n        } else {\n          numAudioTracks = offerOptions.offerToReceiveAudio;\n        }\n      }\n      if (offerOptions.offerToReceiveVideo !== undefined) {\n        if (offerOptions.offerToReceiveVideo === true) {\n          numVideoTracks = 1;\n        } else if (offerOptions.offerToReceiveVideo === false) {\n          numVideoTracks = 0;\n        } else {\n          numVideoTracks = offerOptions.offerToReceiveVideo;\n        }\n      }\n    }\n\n    this.transceivers.forEach(function(transceiver) {\n      if (transceiver.kind === 'audio') {\n        numAudioTracks--;\n        if (numAudioTracks < 0) {\n          transceiver.wantReceive = false;\n        }\n      } else if (transceiver.kind === 'video') {\n        numVideoTracks--;\n        if (numVideoTracks < 0) {\n          transceiver.wantReceive = false;\n        }\n      }\n    });\n\n    // Create M-lines for recvonly streams.\n    while (numAudioTracks > 0 || numVideoTracks > 0) {\n      if (numAudioTracks > 0) {\n        this._createTransceiver('audio');\n        numAudioTracks--;\n      }\n      if (numVideoTracks > 0) {\n        this._createTransceiver('video');\n        numVideoTracks--;\n      }\n    }\n\n    var sdp = SDPUtils.writeSessionBoilerplate(this._sdpSessionId,\n        this._sdpSessionVersion++);\n    this.transceivers.forEach(function(transceiver, sdpMLineIndex) {\n      // For each track, create an ice gatherer, ice transport,\n      // dtls transport, potentially rtpsender and rtpreceiver.\n      var track = transceiver.track;\n      var kind = transceiver.kind;\n      var mid = SDPUtils.generateIdentifier();\n      transceiver.mid = mid;\n\n      if (!transceiver.iceGatherer) {\n        transceiver.iceGatherer = pc._createIceGatherer(sdpMLineIndex,\n            pc.usingBundle);\n      }\n\n      var localCapabilities = window.RTCRtpSender.getCapabilities(kind);\n      // filter RTX until additional stuff needed for RTX is implemented\n      // in adapter.js\n      if (edgeVersion < 15019) {\n        localCapabilities.codecs = localCapabilities.codecs.filter(\n            function(codec) {\n              return codec.name !== 'rtx';\n            });\n      }\n      localCapabilities.codecs.forEach(function(codec) {\n        // work around https://bugs.chromium.org/p/webrtc/issues/detail?id=6552\n        // by adding level-asymmetry-allowed=1\n        if (codec.name === 'H264' &&\n            codec.parameters['level-asymmetry-allowed'] === undefined) {\n          codec.parameters['level-asymmetry-allowed'] = '1';\n        }\n      });\n\n      // generate an ssrc now, to be used later in rtpSender.send\n      var sendEncodingParameters = transceiver.sendEncodingParameters || [{\n        ssrc: (2 * sdpMLineIndex + 1) * 1001\n      }];\n      if (track) {\n        // add RTX\n        if (edgeVersion >= 15019 && kind === 'video' &&\n            !sendEncodingParameters[0].rtx) {\n          sendEncodingParameters[0].rtx = {\n            ssrc: sendEncodingParameters[0].ssrc + 1\n          };\n        }\n      }\n\n      if (transceiver.wantReceive) {\n        transceiver.rtpReceiver = new window.RTCRtpReceiver(\n            transceiver.dtlsTransport, kind);\n      }\n\n      transceiver.localCapabilities = localCapabilities;\n      transceiver.sendEncodingParameters = sendEncodingParameters;\n    });\n\n    // always offer BUNDLE and dispose on return if not supported.\n    if (this._config.bundlePolicy !== 'max-compat') {\n      sdp += 'a=group:BUNDLE ' + this.transceivers.map(function(t) {\n        return t.mid;\n      }).join(' ') + '\\r\\n';\n    }\n    sdp += 'a=ice-options:trickle\\r\\n';\n\n    this.transceivers.forEach(function(transceiver, sdpMLineIndex) {\n      sdp += writeMediaSection(transceiver, transceiver.localCapabilities,\n          'offer', transceiver.stream, pc._dtlsRole);\n      sdp += 'a=rtcp-rsize\\r\\n';\n\n      if (transceiver.iceGatherer && pc.iceGatheringState !== 'new' &&\n          (sdpMLineIndex === 0 || !pc.usingBundle)) {\n        transceiver.iceGatherer.getLocalCandidates().forEach(function(cand) {\n          cand.component = 1;\n          sdp += 'a=' + SDPUtils.writeCandidate(cand) + '\\r\\n';\n        });\n\n        if (transceiver.iceGatherer.state === 'completed') {\n          sdp += 'a=end-of-candidates\\r\\n';\n        }\n      }\n    });\n\n    var desc = new window.RTCSessionDescription({\n      type: 'offer',\n      sdp: sdp\n    });\n    return Promise.resolve(desc);\n  };\n\n  RTCPeerConnection.prototype.createAnswer = function() {\n    var pc = this;\n\n    if (this._isClosed) {\n      return Promise.reject(makeError('InvalidStateError',\n          'Can not call createAnswer after close'));\n    }\n\n    var sdp = SDPUtils.writeSessionBoilerplate(this._sdpSessionId,\n        this._sdpSessionVersion++);\n    if (this.usingBundle) {\n      sdp += 'a=group:BUNDLE ' + this.transceivers.map(function(t) {\n        return t.mid;\n      }).join(' ') + '\\r\\n';\n    }\n    var mediaSectionsInOffer = SDPUtils.splitSections(\n        this.remoteDescription.sdp).length - 1;\n    this.transceivers.forEach(function(transceiver, sdpMLineIndex) {\n      if (sdpMLineIndex + 1 > mediaSectionsInOffer) {\n        return;\n      }\n      if (transceiver.isDatachannel) {\n        sdp += 'm=application 0 DTLS/SCTP 5000\\r\\n' +\n            'c=IN IP4 0.0.0.0\\r\\n' +\n            'a=mid:' + transceiver.mid + '\\r\\n';\n        return;\n      }\n\n      // FIXME: look at direction.\n      if (transceiver.stream) {\n        var localTrack;\n        if (transceiver.kind === 'audio') {\n          localTrack = transceiver.stream.getAudioTracks()[0];\n        } else if (transceiver.kind === 'video') {\n          localTrack = transceiver.stream.getVideoTracks()[0];\n        }\n        if (localTrack) {\n          // add RTX\n          if (edgeVersion >= 15019 && transceiver.kind === 'video' &&\n              !transceiver.sendEncodingParameters[0].rtx) {\n            transceiver.sendEncodingParameters[0].rtx = {\n              ssrc: transceiver.sendEncodingParameters[0].ssrc + 1\n            };\n          }\n        }\n      }\n\n      // Calculate intersection of capabilities.\n      var commonCapabilities = getCommonCapabilities(\n          transceiver.localCapabilities,\n          transceiver.remoteCapabilities);\n\n      var hasRtx = commonCapabilities.codecs.filter(function(c) {\n        return c.name.toLowerCase() === 'rtx';\n      }).length;\n      if (!hasRtx && transceiver.sendEncodingParameters[0].rtx) {\n        delete transceiver.sendEncodingParameters[0].rtx;\n      }\n\n      sdp += writeMediaSection(transceiver, commonCapabilities,\n          'answer', transceiver.stream, pc._dtlsRole);\n      if (transceiver.rtcpParameters &&\n          transceiver.rtcpParameters.reducedSize) {\n        sdp += 'a=rtcp-rsize\\r\\n';\n      }\n    });\n\n    var desc = new window.RTCSessionDescription({\n      type: 'answer',\n      sdp: sdp\n    });\n    return Promise.resolve(desc);\n  };\n\n  RTCPeerConnection.prototype.addIceCandidate = function(candidate) {\n    var sections;\n    if (!candidate || candidate.candidate === '') {\n      for (var j = 0; j < this.transceivers.length; j++) {\n        if (this.transceivers[j].isDatachannel) {\n          continue;\n        }\n        this.transceivers[j].iceTransport.addRemoteCandidate({});\n        sections = SDPUtils.splitSections(this.remoteDescription.sdp);\n        sections[j + 1] += 'a=end-of-candidates\\r\\n';\n        this.remoteDescription.sdp = sections.join('');\n        if (this.usingBundle) {\n          break;\n        }\n      }\n    } else if (!(candidate.sdpMLineIndex !== undefined || candidate.sdpMid)) {\n      throw new TypeError('sdpMLineIndex or sdpMid required');\n    } else if (!this.remoteDescription) {\n      return Promise.reject(makeError('InvalidStateError',\n          'Can not add ICE candidate without a remote description'));\n    } else {\n      var sdpMLineIndex = candidate.sdpMLineIndex;\n      if (candidate.sdpMid) {\n        for (var i = 0; i < this.transceivers.length; i++) {\n          if (this.transceivers[i].mid === candidate.sdpMid) {\n            sdpMLineIndex = i;\n            break;\n          }\n        }\n      }\n      var transceiver = this.transceivers[sdpMLineIndex];\n      if (transceiver) {\n        if (transceiver.isDatachannel) {\n          return Promise.resolve();\n        }\n        var cand = Object.keys(candidate.candidate).length > 0 ?\n            SDPUtils.parseCandidate(candidate.candidate) : {};\n        // Ignore Chrome's invalid candidates since Edge does not like them.\n        if (cand.protocol === 'tcp' && (cand.port === 0 || cand.port === 9)) {\n          return Promise.resolve();\n        }\n        // Ignore RTCP candidates, we assume RTCP-MUX.\n        if (cand.component && cand.component !== 1) {\n          return Promise.resolve();\n        }\n        // when using bundle, avoid adding candidates to the wrong\n        // ice transport. And avoid adding candidates added in the SDP.\n        if (sdpMLineIndex === 0 || (sdpMLineIndex > 0 &&\n            transceiver.iceTransport !== this.transceivers[0].iceTransport)) {\n          if (!maybeAddCandidate(transceiver.iceTransport, cand)) {\n            return Promise.reject(makeError('OperationError',\n                'Can not add ICE candidate'));\n          }\n        }\n\n        // update the remoteDescription.\n        var candidateString = candidate.candidate.trim();\n        if (candidateString.indexOf('a=') === 0) {\n          candidateString = candidateString.substr(2);\n        }\n        sections = SDPUtils.splitSections(this.remoteDescription.sdp);\n        sections[sdpMLineIndex + 1] += 'a=' +\n            (cand.type ? candidateString : 'end-of-candidates')\n            + '\\r\\n';\n        this.remoteDescription.sdp = sections.join('');\n      } else {\n        return Promise.reject(makeError('OperationError',\n            'Can not add ICE candidate'));\n      }\n    }\n    return Promise.resolve();\n  };\n\n  RTCPeerConnection.prototype.getStats = function() {\n    var promises = [];\n    this.transceivers.forEach(function(transceiver) {\n      ['rtpSender', 'rtpReceiver', 'iceGatherer', 'iceTransport',\n          'dtlsTransport'].forEach(function(method) {\n            if (transceiver[method]) {\n              promises.push(transceiver[method].getStats());\n            }\n          });\n    });\n    var fixStatsType = function(stat) {\n      return {\n        inboundrtp: 'inbound-rtp',\n        outboundrtp: 'outbound-rtp',\n        candidatepair: 'candidate-pair',\n        localcandidate: 'local-candidate',\n        remotecandidate: 'remote-candidate'\n      }[stat.type] || stat.type;\n    };\n    return new Promise(function(resolve) {\n      // shim getStats with maplike support\n      var results = new Map();\n      Promise.all(promises).then(function(res) {\n        res.forEach(function(result) {\n          Object.keys(result).forEach(function(id) {\n            result[id].type = fixStatsType(result[id]);\n            results.set(id, result[id]);\n          });\n        });\n        resolve(results);\n      });\n    });\n  };\n\n  // legacy callback shims. Should be moved to adapter.js some days.\n  var methods = ['createOffer', 'createAnswer'];\n  methods.forEach(function(method) {\n    var nativeMethod = RTCPeerConnection.prototype[method];\n    RTCPeerConnection.prototype[method] = function() {\n      var args = arguments;\n      if (typeof args[0] === 'function' ||\n          typeof args[1] === 'function') { // legacy\n        return nativeMethod.apply(this, [arguments[2]])\n        .then(function(description) {\n          if (typeof args[0] === 'function') {\n            args[0].apply(null, [description]);\n          }\n        }, function(error) {\n          if (typeof args[1] === 'function') {\n            args[1].apply(null, [error]);\n          }\n        });\n      }\n      return nativeMethod.apply(this, arguments);\n    };\n  });\n\n  methods = ['setLocalDescription', 'setRemoteDescription', 'addIceCandidate'];\n  methods.forEach(function(method) {\n    var nativeMethod = RTCPeerConnection.prototype[method];\n    RTCPeerConnection.prototype[method] = function() {\n      var args = arguments;\n      if (typeof args[1] === 'function' ||\n          typeof args[2] === 'function') { // legacy\n        return nativeMethod.apply(this, arguments)\n        .then(function() {\n          if (typeof args[1] === 'function') {\n            args[1].apply(null);\n          }\n        }, function(error) {\n          if (typeof args[2] === 'function') {\n            args[2].apply(null, [error]);\n          }\n        });\n      }\n      return nativeMethod.apply(this, arguments);\n    };\n  });\n\n  // getStats is special. It doesn't have a spec legacy method yet we support\n  // getStats(something, cb) without error callbacks.\n  ['getStats'].forEach(function(method) {\n    var nativeMethod = RTCPeerConnection.prototype[method];\n    RTCPeerConnection.prototype[method] = function() {\n      var args = arguments;\n      if (typeof args[1] === 'function') {\n        return nativeMethod.apply(this, arguments)\n        .then(function() {\n          if (typeof args[1] === 'function') {\n            args[1].apply(null);\n          }\n        });\n      }\n      return nativeMethod.apply(this, arguments);\n    };\n  });\n\n  return RTCPeerConnection;\n};\n\n},{\"sdp\":2}],2:[function(require,module,exports){\n /* eslint-env node */\n'use strict';\n\n// SDP helpers.\nvar SDPUtils = {};\n\n// Generate an alphanumeric identifier for cname or mids.\n// TODO: use UUIDs instead? https://gist.github.com/jed/982883\nSDPUtils.generateIdentifier = function() {\n  return Math.random().toString(36).substr(2, 10);\n};\n\n// The RTCP CNAME used by all peerconnections from the same JS.\nSDPUtils.localCName = SDPUtils.generateIdentifier();\n\n// Splits SDP into lines, dealing with both CRLF and LF.\nSDPUtils.splitLines = function(blob) {\n  return blob.trim().split('\\n').map(function(line) {\n    return line.trim();\n  });\n};\n// Splits SDP into sessionpart and mediasections. Ensures CRLF.\nSDPUtils.splitSections = function(blob) {\n  var parts = blob.split('\\nm=');\n  return parts.map(function(part, index) {\n    return (index > 0 ? 'm=' + part : part).trim() + '\\r\\n';\n  });\n};\n\n// Returns lines that start with a certain prefix.\nSDPUtils.matchPrefix = function(blob, prefix) {\n  return SDPUtils.splitLines(blob).filter(function(line) {\n    return line.indexOf(prefix) === 0;\n  });\n};\n\n// Parses an ICE candidate line. Sample input:\n// candidate:702786350 2 udp 41819902 8.8.8.8 60769 typ relay raddr 8.8.8.8\n// rport 55996\"\nSDPUtils.parseCandidate = function(line) {\n  var parts;\n  // Parse both variants.\n  if (line.indexOf('a=candidate:') === 0) {\n    parts = line.substring(12).split(' ');\n  } else {\n    parts = line.substring(10).split(' ');\n  }\n\n  var candidate = {\n    foundation: parts[0],\n    component: parseInt(parts[1], 10),\n    protocol: parts[2].toLowerCase(),\n    priority: parseInt(parts[3], 10),\n    ip: parts[4],\n    port: parseInt(parts[5], 10),\n    // skip parts[6] == 'typ'\n    type: parts[7]\n  };\n\n  for (var i = 8; i < parts.length; i += 2) {\n    switch (parts[i]) {\n      case 'raddr':\n        candidate.relatedAddress = parts[i + 1];\n        break;\n      case 'rport':\n        candidate.relatedPort = parseInt(parts[i + 1], 10);\n        break;\n      case 'tcptype':\n        candidate.tcpType = parts[i + 1];\n        break;\n      case 'ufrag':\n        candidate.ufrag = parts[i + 1]; // for backward compability.\n        candidate.usernameFragment = parts[i + 1];\n        break;\n      default: // extension handling, in particular ufrag\n        candidate[parts[i]] = parts[i + 1];\n        break;\n    }\n  }\n  return candidate;\n};\n\n// Translates a candidate object into SDP candidate attribute.\nSDPUtils.writeCandidate = function(candidate) {\n  var sdp = [];\n  sdp.push(candidate.foundation);\n  sdp.push(candidate.component);\n  sdp.push(candidate.protocol.toUpperCase());\n  sdp.push(candidate.priority);\n  sdp.push(candidate.ip);\n  sdp.push(candidate.port);\n\n  var type = candidate.type;\n  sdp.push('typ');\n  sdp.push(type);\n  if (type !== 'host' && candidate.relatedAddress &&\n      candidate.relatedPort) {\n    sdp.push('raddr');\n    sdp.push(candidate.relatedAddress); // was: relAddr\n    sdp.push('rport');\n    sdp.push(candidate.relatedPort); // was: relPort\n  }\n  if (candidate.tcpType && candidate.protocol.toLowerCase() === 'tcp') {\n    sdp.push('tcptype');\n    sdp.push(candidate.tcpType);\n  }\n  if (candidate.ufrag) {\n    sdp.push('ufrag');\n    sdp.push(candidate.ufrag);\n  }\n  return 'candidate:' + sdp.join(' ');\n};\n\n// Parses an ice-options line, returns an array of option tags.\n// a=ice-options:foo bar\nSDPUtils.parseIceOptions = function(line) {\n  return line.substr(14).split(' ');\n}\n\n// Parses an rtpmap line, returns RTCRtpCoddecParameters. Sample input:\n// a=rtpmap:111 opus/48000/2\nSDPUtils.parseRtpMap = function(line) {\n  var parts = line.substr(9).split(' ');\n  var parsed = {\n    payloadType: parseInt(parts.shift(), 10) // was: id\n  };\n\n  parts = parts[0].split('/');\n\n  parsed.name = parts[0];\n  parsed.clockRate = parseInt(parts[1], 10); // was: clockrate\n  // was: channels\n  parsed.numChannels = parts.length === 3 ? parseInt(parts[2], 10) : 1;\n  return parsed;\n};\n\n// Generate an a=rtpmap line from RTCRtpCodecCapability or\n// RTCRtpCodecParameters.\nSDPUtils.writeRtpMap = function(codec) {\n  var pt = codec.payloadType;\n  if (codec.preferredPayloadType !== undefined) {\n    pt = codec.preferredPayloadType;\n  }\n  return 'a=rtpmap:' + pt + ' ' + codec.name + '/' + codec.clockRate +\n      (codec.numChannels !== 1 ? '/' + codec.numChannels : '') + '\\r\\n';\n};\n\n// Parses an a=extmap line (headerextension from RFC 5285). Sample input:\n// a=extmap:2 urn:ietf:params:rtp-hdrext:toffset\n// a=extmap:2/sendonly urn:ietf:params:rtp-hdrext:toffset\nSDPUtils.parseExtmap = function(line) {\n  var parts = line.substr(9).split(' ');\n  return {\n    id: parseInt(parts[0], 10),\n    direction: parts[0].indexOf('/') > 0 ? parts[0].split('/')[1] : 'sendrecv',\n    uri: parts[1]\n  };\n};\n\n// Generates a=extmap line from RTCRtpHeaderExtensionParameters or\n// RTCRtpHeaderExtension.\nSDPUtils.writeExtmap = function(headerExtension) {\n  return 'a=extmap:' + (headerExtension.id || headerExtension.preferredId) +\n      (headerExtension.direction && headerExtension.direction !== 'sendrecv'\n          ? '/' + headerExtension.direction\n          : '') +\n      ' ' + headerExtension.uri + '\\r\\n';\n};\n\n// Parses an ftmp line, returns dictionary. Sample input:\n// a=fmtp:96 vbr=on;cng=on\n// Also deals with vbr=on; cng=on\nSDPUtils.parseFmtp = function(line) {\n  var parsed = {};\n  var kv;\n  var parts = line.substr(line.indexOf(' ') + 1).split(';');\n  for (var j = 0; j < parts.length; j++) {\n    kv = parts[j].trim().split('=');\n    parsed[kv[0].trim()] = kv[1];\n  }\n  return parsed;\n};\n\n// Generates an a=ftmp line from RTCRtpCodecCapability or RTCRtpCodecParameters.\nSDPUtils.writeFmtp = function(codec) {\n  var line = '';\n  var pt = codec.payloadType;\n  if (codec.preferredPayloadType !== undefined) {\n    pt = codec.preferredPayloadType;\n  }\n  if (codec.parameters && Object.keys(codec.parameters).length) {\n    var params = [];\n    Object.keys(codec.parameters).forEach(function(param) {\n      params.push(param + '=' + codec.parameters[param]);\n    });\n    line += 'a=fmtp:' + pt + ' ' + params.join(';') + '\\r\\n';\n  }\n  return line;\n};\n\n// Parses an rtcp-fb line, returns RTCPRtcpFeedback object. Sample input:\n// a=rtcp-fb:98 nack rpsi\nSDPUtils.parseRtcpFb = function(line) {\n  var parts = line.substr(line.indexOf(' ') + 1).split(' ');\n  return {\n    type: parts.shift(),\n    parameter: parts.join(' ')\n  };\n};\n// Generate a=rtcp-fb lines from RTCRtpCodecCapability or RTCRtpCodecParameters.\nSDPUtils.writeRtcpFb = function(codec) {\n  var lines = '';\n  var pt = codec.payloadType;\n  if (codec.preferredPayloadType !== undefined) {\n    pt = codec.preferredPayloadType;\n  }\n  if (codec.rtcpFeedback && codec.rtcpFeedback.length) {\n    // FIXME: special handling for trr-int?\n    codec.rtcpFeedback.forEach(function(fb) {\n      lines += 'a=rtcp-fb:' + pt + ' ' + fb.type +\n      (fb.parameter && fb.parameter.length ? ' ' + fb.parameter : '') +\n          '\\r\\n';\n    });\n  }\n  return lines;\n};\n\n// Parses an RFC 5576 ssrc media attribute. Sample input:\n// a=ssrc:3735928559 cname:something\nSDPUtils.parseSsrcMedia = function(line) {\n  var sp = line.indexOf(' ');\n  var parts = {\n    ssrc: parseInt(line.substr(7, sp - 7), 10)\n  };\n  var colon = line.indexOf(':', sp);\n  if (colon > -1) {\n    parts.attribute = line.substr(sp + 1, colon - sp - 1);\n    parts.value = line.substr(colon + 1);\n  } else {\n    parts.attribute = line.substr(sp + 1);\n  }\n  return parts;\n};\n\n// Extracts the MID (RFC 5888) from a media section.\n// returns the MID or undefined if no mid line was found.\nSDPUtils.getMid = function(mediaSection) {\n  var mid = SDPUtils.matchPrefix(mediaSection, 'a=mid:')[0];\n  if (mid) {\n    return mid.substr(6);\n  }\n}\n\nSDPUtils.parseFingerprint = function(line) {\n  var parts = line.substr(14).split(' ');\n  return {\n    algorithm: parts[0].toLowerCase(), // algorithm is case-sensitive in Edge.\n    value: parts[1]\n  };\n};\n\n// Extracts DTLS parameters from SDP media section or sessionpart.\n// FIXME: for consistency with other functions this should only\n//   get the fingerprint line as input. See also getIceParameters.\nSDPUtils.getDtlsParameters = function(mediaSection, sessionpart) {\n  var lines = SDPUtils.matchPrefix(mediaSection + sessionpart,\n      'a=fingerprint:');\n  // Note: a=setup line is ignored since we use the 'auto' role.\n  // Note2: 'algorithm' is not case sensitive except in Edge.\n  return {\n    role: 'auto',\n    fingerprints: lines.map(SDPUtils.parseFingerprint)\n  };\n};\n\n// Serializes DTLS parameters to SDP.\nSDPUtils.writeDtlsParameters = function(params, setupType) {\n  var sdp = 'a=setup:' + setupType + '\\r\\n';\n  params.fingerprints.forEach(function(fp) {\n    sdp += 'a=fingerprint:' + fp.algorithm + ' ' + fp.value + '\\r\\n';\n  });\n  return sdp;\n};\n// Parses ICE information from SDP media section or sessionpart.\n// FIXME: for consistency with other functions this should only\n//   get the ice-ufrag and ice-pwd lines as input.\nSDPUtils.getIceParameters = function(mediaSection, sessionpart) {\n  var lines = SDPUtils.splitLines(mediaSection);\n  // Search in session part, too.\n  lines = lines.concat(SDPUtils.splitLines(sessionpart));\n  var iceParameters = {\n    usernameFragment: lines.filter(function(line) {\n      return line.indexOf('a=ice-ufrag:') === 0;\n    })[0].substr(12),\n    password: lines.filter(function(line) {\n      return line.indexOf('a=ice-pwd:') === 0;\n    })[0].substr(10)\n  };\n  return iceParameters;\n};\n\n// Serializes ICE parameters to SDP.\nSDPUtils.writeIceParameters = function(params) {\n  return 'a=ice-ufrag:' + params.usernameFragment + '\\r\\n' +\n      'a=ice-pwd:' + params.password + '\\r\\n';\n};\n\n// Parses the SDP media section and returns RTCRtpParameters.\nSDPUtils.parseRtpParameters = function(mediaSection) {\n  var description = {\n    codecs: [],\n    headerExtensions: [],\n    fecMechanisms: [],\n    rtcp: []\n  };\n  var lines = SDPUtils.splitLines(mediaSection);\n  var mline = lines[0].split(' ');\n  for (var i = 3; i < mline.length; i++) { // find all codecs from mline[3..]\n    var pt = mline[i];\n    var rtpmapline = SDPUtils.matchPrefix(\n        mediaSection, 'a=rtpmap:' + pt + ' ')[0];\n    if (rtpmapline) {\n      var codec = SDPUtils.parseRtpMap(rtpmapline);\n      var fmtps = SDPUtils.matchPrefix(\n          mediaSection, 'a=fmtp:' + pt + ' ');\n      // Only the first a=fmtp:<pt> is considered.\n      codec.parameters = fmtps.length ? SDPUtils.parseFmtp(fmtps[0]) : {};\n      codec.rtcpFeedback = SDPUtils.matchPrefix(\n          mediaSection, 'a=rtcp-fb:' + pt + ' ')\n        .map(SDPUtils.parseRtcpFb);\n      description.codecs.push(codec);\n      // parse FEC mechanisms from rtpmap lines.\n      switch (codec.name.toUpperCase()) {\n        case 'RED':\n        case 'ULPFEC':\n          description.fecMechanisms.push(codec.name.toUpperCase());\n          break;\n        default: // only RED and ULPFEC are recognized as FEC mechanisms.\n          break;\n      }\n    }\n  }\n  SDPUtils.matchPrefix(mediaSection, 'a=extmap:').forEach(function(line) {\n    description.headerExtensions.push(SDPUtils.parseExtmap(line));\n  });\n  // FIXME: parse rtcp.\n  return description;\n};\n\n// Generates parts of the SDP media section describing the capabilities /\n// parameters.\nSDPUtils.writeRtpDescription = function(kind, caps) {\n  var sdp = '';\n\n  // Build the mline.\n  sdp += 'm=' + kind + ' ';\n  sdp += caps.codecs.length > 0 ? '9' : '0'; // reject if no codecs.\n  sdp += ' UDP/TLS/RTP/SAVPF ';\n  sdp += caps.codecs.map(function(codec) {\n    if (codec.preferredPayloadType !== undefined) {\n      return codec.preferredPayloadType;\n    }\n    return codec.payloadType;\n  }).join(' ') + '\\r\\n';\n\n  sdp += 'c=IN IP4 0.0.0.0\\r\\n';\n  sdp += 'a=rtcp:9 IN IP4 0.0.0.0\\r\\n';\n\n  // Add a=rtpmap lines for each codec. Also fmtp and rtcp-fb.\n  caps.codecs.forEach(function(codec) {\n    sdp += SDPUtils.writeRtpMap(codec);\n    sdp += SDPUtils.writeFmtp(codec);\n    sdp += SDPUtils.writeRtcpFb(codec);\n  });\n  var maxptime = 0;\n  caps.codecs.forEach(function(codec) {\n    if (codec.maxptime > maxptime) {\n      maxptime = codec.maxptime;\n    }\n  });\n  if (maxptime > 0) {\n    sdp += 'a=maxptime:' + maxptime + '\\r\\n';\n  }\n  sdp += 'a=rtcp-mux\\r\\n';\n\n  caps.headerExtensions.forEach(function(extension) {\n    sdp += SDPUtils.writeExtmap(extension);\n  });\n  // FIXME: write fecMechanisms.\n  return sdp;\n};\n\n// Parses the SDP media section and returns an array of\n// RTCRtpEncodingParameters.\nSDPUtils.parseRtpEncodingParameters = function(mediaSection) {\n  var encodingParameters = [];\n  var description = SDPUtils.parseRtpParameters(mediaSection);\n  var hasRed = description.fecMechanisms.indexOf('RED') !== -1;\n  var hasUlpfec = description.fecMechanisms.indexOf('ULPFEC') !== -1;\n\n  // filter a=ssrc:... cname:, ignore PlanB-msid\n  var ssrcs = SDPUtils.matchPrefix(mediaSection, 'a=ssrc:')\n  .map(function(line) {\n    return SDPUtils.parseSsrcMedia(line);\n  })\n  .filter(function(parts) {\n    return parts.attribute === 'cname';\n  });\n  var primarySsrc = ssrcs.length > 0 && ssrcs[0].ssrc;\n  var secondarySsrc;\n\n  var flows = SDPUtils.matchPrefix(mediaSection, 'a=ssrc-group:FID')\n  .map(function(line) {\n    var parts = line.split(' ');\n    parts.shift();\n    return parts.map(function(part) {\n      return parseInt(part, 10);\n    });\n  });\n  if (flows.length > 0 && flows[0].length > 1 && flows[0][0] === primarySsrc) {\n    secondarySsrc = flows[0][1];\n  }\n\n  description.codecs.forEach(function(codec) {\n    if (codec.name.toUpperCase() === 'RTX' && codec.parameters.apt) {\n      var encParam = {\n        ssrc: primarySsrc,\n        codecPayloadType: parseInt(codec.parameters.apt, 10),\n        rtx: {\n          ssrc: secondarySsrc\n        }\n      };\n      encodingParameters.push(encParam);\n      if (hasRed) {\n        encParam = JSON.parse(JSON.stringify(encParam));\n        encParam.fec = {\n          ssrc: secondarySsrc,\n          mechanism: hasUlpfec ? 'red+ulpfec' : 'red'\n        };\n        encodingParameters.push(encParam);\n      }\n    }\n  });\n  if (encodingParameters.length === 0 && primarySsrc) {\n    encodingParameters.push({\n      ssrc: primarySsrc\n    });\n  }\n\n  // we support both b=AS and b=TIAS but interpret AS as TIAS.\n  var bandwidth = SDPUtils.matchPrefix(mediaSection, 'b=');\n  if (bandwidth.length) {\n    if (bandwidth[0].indexOf('b=TIAS:') === 0) {\n      bandwidth = parseInt(bandwidth[0].substr(7), 10);\n    } else if (bandwidth[0].indexOf('b=AS:') === 0) {\n      // use formula from JSEP to convert b=AS to TIAS value.\n      bandwidth = parseInt(bandwidth[0].substr(5), 10) * 1000 * 0.95\n          - (50 * 40 * 8);\n    } else {\n      bandwidth = undefined;\n    }\n    encodingParameters.forEach(function(params) {\n      params.maxBitrate = bandwidth;\n    });\n  }\n  return encodingParameters;\n};\n\n// parses http://draft.ortc.org/#rtcrtcpparameters*\nSDPUtils.parseRtcpParameters = function(mediaSection) {\n  var rtcpParameters = {};\n\n  var cname;\n  // Gets the first SSRC. Note that with RTX there might be multiple\n  // SSRCs.\n  var remoteSsrc = SDPUtils.matchPrefix(mediaSection, 'a=ssrc:')\n      .map(function(line) {\n        return SDPUtils.parseSsrcMedia(line);\n      })\n      .filter(function(obj) {\n        return obj.attribute === 'cname';\n      })[0];\n  if (remoteSsrc) {\n    rtcpParameters.cname = remoteSsrc.value;\n    rtcpParameters.ssrc = remoteSsrc.ssrc;\n  }\n\n  // Edge uses the compound attribute instead of reducedSize\n  // compound is !reducedSize\n  var rsize = SDPUtils.matchPrefix(mediaSection, 'a=rtcp-rsize');\n  rtcpParameters.reducedSize = rsize.length > 0;\n  rtcpParameters.compound = rsize.length === 0;\n\n  // parses the rtcp-mux attrіbute.\n  // Note that Edge does not support unmuxed RTCP.\n  var mux = SDPUtils.matchPrefix(mediaSection, 'a=rtcp-mux');\n  rtcpParameters.mux = mux.length > 0;\n\n  return rtcpParameters;\n};\n\n// parses either a=msid: or a=ssrc:... msid lines and returns\n// the id of the MediaStream and MediaStreamTrack.\nSDPUtils.parseMsid = function(mediaSection) {\n  var parts;\n  var spec = SDPUtils.matchPrefix(mediaSection, 'a=msid:');\n  if (spec.length === 1) {\n    parts = spec[0].substr(7).split(' ');\n    return {stream: parts[0], track: parts[1]};\n  }\n  var planB = SDPUtils.matchPrefix(mediaSection, 'a=ssrc:')\n  .map(function(line) {\n    return SDPUtils.parseSsrcMedia(line);\n  })\n  .filter(function(parts) {\n    return parts.attribute === 'msid';\n  });\n  if (planB.length > 0) {\n    parts = planB[0].value.split(' ');\n    return {stream: parts[0], track: parts[1]};\n  }\n};\n\n// Generate a session ID for SDP.\n// https://tools.ietf.org/html/draft-ietf-rtcweb-jsep-20#section-5.2.1\n// recommends using a cryptographically random +ve 64-bit value\n// but right now this should be acceptable and within the right range\nSDPUtils.generateSessionId = function() {\n  return Math.random().toString().substr(2, 21);\n};\n\n// Write boilder plate for start of SDP\n// sessId argument is optional - if not supplied it will\n// be generated randomly\n// sessVersion is optional and defaults to 2\nSDPUtils.writeSessionBoilerplate = function(sessId, sessVer) {\n  var sessionId;\n  var version = sessVer !== undefined ? sessVer : 2;\n  if (sessId) {\n    sessionId = sessId;\n  } else {\n    sessionId = SDPUtils.generateSessionId();\n  }\n  // FIXME: sess-id should be an NTP timestamp.\n  return 'v=0\\r\\n' +\n      'o=thisisadapterortc ' + sessionId + ' ' + version + ' IN IP4 127.0.0.1\\r\\n' +\n      's=-\\r\\n' +\n      't=0 0\\r\\n';\n};\n\nSDPUtils.writeMediaSection = function(transceiver, caps, type, stream) {\n  var sdp = SDPUtils.writeRtpDescription(transceiver.kind, caps);\n\n  // Map ICE parameters (ufrag, pwd) to SDP.\n  sdp += SDPUtils.writeIceParameters(\n      transceiver.iceGatherer.getLocalParameters());\n\n  // Map DTLS parameters to SDP.\n  sdp += SDPUtils.writeDtlsParameters(\n      transceiver.dtlsTransport.getLocalParameters(),\n      type === 'offer' ? 'actpass' : 'active');\n\n  sdp += 'a=mid:' + transceiver.mid + '\\r\\n';\n\n  if (transceiver.direction) {\n    sdp += 'a=' + transceiver.direction + '\\r\\n';\n  } else if (transceiver.rtpSender && transceiver.rtpReceiver) {\n    sdp += 'a=sendrecv\\r\\n';\n  } else if (transceiver.rtpSender) {\n    sdp += 'a=sendonly\\r\\n';\n  } else if (transceiver.rtpReceiver) {\n    sdp += 'a=recvonly\\r\\n';\n  } else {\n    sdp += 'a=inactive\\r\\n';\n  }\n\n  if (transceiver.rtpSender) {\n    // spec.\n    var msid = 'msid:' + stream.id + ' ' +\n        transceiver.rtpSender.track.id + '\\r\\n';\n    sdp += 'a=' + msid;\n\n    // for Chrome.\n    sdp += 'a=ssrc:' + transceiver.sendEncodingParameters[0].ssrc +\n        ' ' + msid;\n    if (transceiver.sendEncodingParameters[0].rtx) {\n      sdp += 'a=ssrc:' + transceiver.sendEncodingParameters[0].rtx.ssrc +\n          ' ' + msid;\n      sdp += 'a=ssrc-group:FID ' +\n          transceiver.sendEncodingParameters[0].ssrc + ' ' +\n          transceiver.sendEncodingParameters[0].rtx.ssrc +\n          '\\r\\n';\n    }\n  }\n  // FIXME: this should be written by writeRtpDescription.\n  sdp += 'a=ssrc:' + transceiver.sendEncodingParameters[0].ssrc +\n      ' cname:' + SDPUtils.localCName + '\\r\\n';\n  if (transceiver.rtpSender && transceiver.sendEncodingParameters[0].rtx) {\n    sdp += 'a=ssrc:' + transceiver.sendEncodingParameters[0].rtx.ssrc +\n        ' cname:' + SDPUtils.localCName + '\\r\\n';\n  }\n  return sdp;\n};\n\n// Gets the direction from the mediaSection or the sessionpart.\nSDPUtils.getDirection = function(mediaSection, sessionpart) {\n  // Look for sendrecv, sendonly, recvonly, inactive, default to sendrecv.\n  var lines = SDPUtils.splitLines(mediaSection);\n  for (var i = 0; i < lines.length; i++) {\n    switch (lines[i]) {\n      case 'a=sendrecv':\n      case 'a=sendonly':\n      case 'a=recvonly':\n      case 'a=inactive':\n        return lines[i].substr(2);\n      default:\n        // FIXME: What should happen here?\n    }\n  }\n  if (sessionpart) {\n    return SDPUtils.getDirection(sessionpart);\n  }\n  return 'sendrecv';\n};\n\nSDPUtils.getKind = function(mediaSection) {\n  var lines = SDPUtils.splitLines(mediaSection);\n  var mline = lines[0].split(' ');\n  return mline[0].substr(2);\n};\n\nSDPUtils.isRejected = function(mediaSection) {\n  return mediaSection.split(' ', 2)[1] === '0';\n};\n\nSDPUtils.parseMLine = function(mediaSection) {\n  var lines = SDPUtils.splitLines(mediaSection);\n  var mline = lines[0].split(' ');\n  return {\n    kind: mline[0].substr(2),\n    port: parseInt(mline[1], 10),\n    protocol: mline[2],\n    fmt: mline.slice(3).join(' ')\n  };\n};\n\n// Expose public methods.\nif (typeof module === 'object') {\n  module.exports = SDPUtils;\n}\n\n},{}],3:[function(require,module,exports){\n(function (global){\n/*\n *  Copyright (c) 2016 The WebRTC project authors. All Rights Reserved.\n *\n *  Use of this source code is governed by a BSD-style license\n *  that can be found in the LICENSE file in the root of the source\n *  tree.\n */\n /* eslint-env node */\n\n'use strict';\n\nvar adapterFactory = require('./adapter_factory.js');\nmodule.exports = adapterFactory({window: global.window});\n\n}).call(this,typeof global !== \"undefined\" ? global : typeof self !== \"undefined\" ? self : typeof window !== \"undefined\" ? window : {})\n},{\"./adapter_factory.js\":4}],4:[function(require,module,exports){\n/*\n *  Copyright (c) 2016 The WebRTC project authors. All Rights Reserved.\n *\n *  Use of this source code is governed by a BSD-style license\n *  that can be found in the LICENSE file in the root of the source\n *  tree.\n */\n /* eslint-env node */\n\n'use strict';\n\nvar utils = require('./utils');\n// Shimming starts here.\nmodule.exports = function(dependencies, opts) {\n  var window = dependencies && dependencies.window;\n\n  var options = {\n    shimChrome: true,\n    shimFirefox: true,\n    shimEdge: true,\n    shimSafari: true,\n  };\n\n  for (var key in opts) {\n    if (hasOwnProperty.call(opts, key)) {\n      options[key] = opts[key];\n    }\n  }\n\n  // Utils.\n  var logging = utils.log;\n  var browserDetails = utils.detectBrowser(window);\n\n  // Export to the adapter global object visible in the browser.\n  var adapter = {\n    browserDetails: browserDetails,\n    extractVersion: utils.extractVersion,\n    disableLog: utils.disableLog,\n    disableWarnings: utils.disableWarnings\n  };\n\n  // Uncomment the line below if you want logging to occur, including logging\n  // for the switch statement below. Can also be turned on in the browser via\n  // adapter.disableLog(false), but then logging from the switch statement below\n  // will not appear.\n  // require('./utils').disableLog(false);\n\n  // Browser shims.\n  var chromeShim = require('./chrome/chrome_shim') || null;\n  var edgeShim = require('./edge/edge_shim') || null;\n  var firefoxShim = require('./firefox/firefox_shim') || null;\n  var safariShim = require('./safari/safari_shim') || null;\n  var commonShim = require('./common_shim') || null;\n\n  // Shim browser if found.\n  switch (browserDetails.browser) {\n    case 'chrome':\n      if (!chromeShim || !chromeShim.shimPeerConnection ||\n          !options.shimChrome) {\n        logging('Chrome shim is not included in this adapter release.');\n        return adapter;\n      }\n      logging('adapter.js shimming chrome.');\n      // Export to the adapter global object visible in the browser.\n      adapter.browserShim = chromeShim;\n      commonShim.shimCreateObjectURL(window);\n\n      chromeShim.shimGetUserMedia(window);\n      chromeShim.shimMediaStream(window);\n      chromeShim.shimSourceObject(window);\n      chromeShim.shimPeerConnection(window);\n      chromeShim.shimOnTrack(window);\n      chromeShim.shimAddTrackRemoveTrack(window);\n      chromeShim.shimGetSendersWithDtmf(window);\n\n      commonShim.shimRTCIceCandidate(window);\n      break;\n    case 'firefox':\n      if (!firefoxShim || !firefoxShim.shimPeerConnection ||\n          !options.shimFirefox) {\n        logging('Firefox shim is not included in this adapter release.');\n        return adapter;\n      }\n      logging('adapter.js shimming firefox.');\n      // Export to the adapter global object visible in the browser.\n      adapter.browserShim = firefoxShim;\n      commonShim.shimCreateObjectURL(window);\n\n      firefoxShim.shimGetUserMedia(window);\n      firefoxShim.shimSourceObject(window);\n      firefoxShim.shimPeerConnection(window);\n      firefoxShim.shimOnTrack(window);\n      firefoxShim.shimRemoveStream(window);\n\n      commonShim.shimRTCIceCandidate(window);\n      break;\n    case 'edge':\n      if (!edgeShim || !edgeShim.shimPeerConnection || !options.shimEdge) {\n        logging('MS edge shim is not included in this adapter release.');\n        return adapter;\n      }\n      logging('adapter.js shimming edge.');\n      // Export to the adapter global object visible in the browser.\n      adapter.browserShim = edgeShim;\n      commonShim.shimCreateObjectURL(window);\n\n      edgeShim.shimGetUserMedia(window);\n      edgeShim.shimPeerConnection(window);\n      edgeShim.shimReplaceTrack(window);\n\n      // the edge shim implements the full RTCIceCandidate object.\n      break;\n    case 'safari':\n      if (!safariShim || !options.shimSafari) {\n        logging('Safari shim is not included in this adapter release.');\n        return adapter;\n      }\n      logging('adapter.js shimming safari.');\n      // Export to the adapter global object visible in the browser.\n      adapter.browserShim = safariShim;\n      commonShim.shimCreateObjectURL(window);\n\n      safariShim.shimRTCIceServerUrls(window);\n      safariShim.shimCallbacksAPI(window);\n      safariShim.shimLocalStreamsAPI(window);\n      safariShim.shimRemoteStreamsAPI(window);\n      safariShim.shimTrackEventTransceiver(window);\n      safariShim.shimGetUserMedia(window);\n      safariShim.shimCreateOfferLegacy(window);\n\n      commonShim.shimRTCIceCandidate(window);\n      break;\n    default:\n      logging('Unsupported browser!');\n      break;\n  }\n\n  return adapter;\n};\n\n},{\"./chrome/chrome_shim\":5,\"./common_shim\":7,\"./edge/edge_shim\":8,\"./firefox/firefox_shim\":10,\"./safari/safari_shim\":12,\"./utils\":13}],5:[function(require,module,exports){\n\n/*\n *  Copyright (c) 2016 The WebRTC project authors. All Rights Reserved.\n *\n *  Use of this source code is governed by a BSD-style license\n *  that can be found in the LICENSE file in the root of the source\n *  tree.\n */\n /* eslint-env node */\n'use strict';\nvar utils = require('../utils.js');\nvar logging = utils.log;\n\nmodule.exports = {\n  shimGetUserMedia: require('./getusermedia'),\n  shimMediaStream: function(window) {\n    window.MediaStream = window.MediaStream || window.webkitMediaStream;\n  },\n\n  shimOnTrack: function(window) {\n    if (typeof window === 'object' && window.RTCPeerConnection && !('ontrack' in\n        window.RTCPeerConnection.prototype)) {\n      Object.defineProperty(window.RTCPeerConnection.prototype, 'ontrack', {\n        get: function() {\n          return this._ontrack;\n        },\n        set: function(f) {\n          if (this._ontrack) {\n            this.removeEventListener('track', this._ontrack);\n          }\n          this.addEventListener('track', this._ontrack = f);\n        }\n      });\n      var origSetRemoteDescription =\n          window.RTCPeerConnection.prototype.setRemoteDescription;\n      window.RTCPeerConnection.prototype.setRemoteDescription = function() {\n        var pc = this;\n        if (!pc._ontrackpoly) {\n          pc._ontrackpoly = function(e) {\n            // onaddstream does not fire when a track is added to an existing\n            // stream. But stream.onaddtrack is implemented so we use that.\n            e.stream.addEventListener('addtrack', function(te) {\n              var receiver;\n              if (window.RTCPeerConnection.prototype.getReceivers) {\n                receiver = pc.getReceivers().find(function(r) {\n                  return r.track && r.track.id === te.track.id;\n                });\n              } else {\n                receiver = {track: te.track};\n              }\n\n              var event = new Event('track');\n              event.track = te.track;\n              event.receiver = receiver;\n              event.transceiver = {receiver: receiver};\n              event.streams = [e.stream];\n              pc.dispatchEvent(event);\n            });\n            e.stream.getTracks().forEach(function(track) {\n              var receiver;\n              if (window.RTCPeerConnection.prototype.getReceivers) {\n                receiver = pc.getReceivers().find(function(r) {\n                  return r.track && r.track.id === track.id;\n                });\n              } else {\n                receiver = {track: track};\n              }\n              var event = new Event('track');\n              event.track = track;\n              event.receiver = receiver;\n              event.transceiver = {receiver: receiver};\n              event.streams = [e.stream];\n              pc.dispatchEvent(event);\n            });\n          };\n          pc.addEventListener('addstream', pc._ontrackpoly);\n        }\n        return origSetRemoteDescription.apply(pc, arguments);\n      };\n    }\n  },\n\n  shimGetSendersWithDtmf: function(window) {\n    // Overrides addTrack/removeTrack, depends on shimAddTrackRemoveTrack.\n    if (typeof window === 'object' && window.RTCPeerConnection &&\n        !('getSenders' in window.RTCPeerConnection.prototype) &&\n        'createDTMFSender' in window.RTCPeerConnection.prototype) {\n      var shimSenderWithDtmf = function(pc, track) {\n        return {\n          track: track,\n          get dtmf() {\n            if (this._dtmf === undefined) {\n              if (track.kind === 'audio') {\n                this._dtmf = pc.createDTMFSender(track);\n              } else {\n                this._dtmf = null;\n              }\n            }\n            return this._dtmf;\n          },\n          _pc: pc\n        };\n      };\n\n      // augment addTrack when getSenders is not available.\n      if (!window.RTCPeerConnection.prototype.getSenders) {\n        window.RTCPeerConnection.prototype.getSenders = function() {\n          this._senders = this._senders || [];\n          return this._senders.slice(); // return a copy of the internal state.\n        };\n        var origAddTrack = window.RTCPeerConnection.prototype.addTrack;\n        window.RTCPeerConnection.prototype.addTrack = function(track, stream) {\n          var pc = this;\n          var sender = origAddTrack.apply(pc, arguments);\n          if (!sender) {\n            sender = shimSenderWithDtmf(pc, track);\n            pc._senders.push(sender);\n          }\n          return sender;\n        };\n\n        var origRemoveTrack = window.RTCPeerConnection.prototype.removeTrack;\n        window.RTCPeerConnection.prototype.removeTrack = function(sender) {\n          var pc = this;\n          origRemoveTrack.apply(pc, arguments);\n          var idx = pc._senders.indexOf(sender);\n          if (idx !== -1) {\n            pc._senders.splice(idx, 1);\n          }\n        };\n      }\n      var origAddStream = window.RTCPeerConnection.prototype.addStream;\n      window.RTCPeerConnection.prototype.addStream = function(stream) {\n        var pc = this;\n        pc._senders = pc._senders || [];\n        origAddStream.apply(pc, [stream]);\n        stream.getTracks().forEach(function(track) {\n          pc._senders.push(shimSenderWithDtmf(pc, track));\n        });\n      };\n\n      var origRemoveStream = window.RTCPeerConnection.prototype.removeStream;\n      window.RTCPeerConnection.prototype.removeStream = function(stream) {\n        var pc = this;\n        pc._senders = pc._senders || [];\n        origRemoveStream.apply(pc, [stream]);\n\n        stream.getTracks().forEach(function(track) {\n          var sender = pc._senders.find(function(s) {\n            return s.track === track;\n          });\n          if (sender) {\n            pc._senders.splice(pc._senders.indexOf(sender), 1); // remove sender\n          }\n        });\n      };\n    } else if (typeof window === 'object' && window.RTCPeerConnection &&\n               'getSenders' in window.RTCPeerConnection.prototype &&\n               'createDTMFSender' in window.RTCPeerConnection.prototype &&\n               window.RTCRtpSender &&\n               !('dtmf' in window.RTCRtpSender.prototype)) {\n      var origGetSenders = window.RTCPeerConnection.prototype.getSenders;\n      window.RTCPeerConnection.prototype.getSenders = function() {\n        var pc = this;\n        var senders = origGetSenders.apply(pc, []);\n        senders.forEach(function(sender) {\n          sender._pc = pc;\n        });\n        return senders;\n      };\n\n      Object.defineProperty(window.RTCRtpSender.prototype, 'dtmf', {\n        get: function() {\n          if (this._dtmf === undefined) {\n            if (this.track.kind === 'audio') {\n              this._dtmf = this._pc.createDTMFSender(this.track);\n            } else {\n              this._dtmf = null;\n            }\n          }\n          return this._dtmf;\n        }\n      });\n    }\n  },\n\n  shimSourceObject: function(window) {\n    var URL = window && window.URL;\n\n    if (typeof window === 'object') {\n      if (window.HTMLMediaElement &&\n        !('srcObject' in window.HTMLMediaElement.prototype)) {\n        // Shim the srcObject property, once, when HTMLMediaElement is found.\n        Object.defineProperty(window.HTMLMediaElement.prototype, 'srcObject', {\n          get: function() {\n            return this._srcObject;\n          },\n          set: function(stream) {\n            var self = this;\n            // Use _srcObject as a private property for this shim\n            this._srcObject = stream;\n            if (this.src) {\n              URL.revokeObjectURL(this.src);\n            }\n\n            if (!stream) {\n              this.src = '';\n              return undefined;\n            }\n            this.src = URL.createObjectURL(stream);\n            // We need to recreate the blob url when a track is added or\n            // removed. Doing it manually since we want to avoid a recursion.\n            stream.addEventListener('addtrack', function() {\n              if (self.src) {\n                URL.revokeObjectURL(self.src);\n              }\n              self.src = URL.createObjectURL(stream);\n            });\n            stream.addEventListener('removetrack', function() {\n              if (self.src) {\n                URL.revokeObjectURL(self.src);\n              }\n              self.src = URL.createObjectURL(stream);\n            });\n          }\n        });\n      }\n    }\n  },\n\n  shimAddTrackRemoveTrackWithNative: function(window) {\n    // shim addTrack/removeTrack with native variants in order to make\n    // the interactions with legacy getLocalStreams behave as in other browsers.\n    // Keeps a mapping stream.id => [stream, rtpsenders...]\n    window.RTCPeerConnection.prototype.getLocalStreams = function() {\n      var pc = this;\n      this._shimmedLocalStreams = this._shimmedLocalStreams || {};\n      return Object.keys(this._shimmedLocalStreams).map(function(streamId) {\n        return pc._shimmedLocalStreams[streamId][0];\n      });\n    };\n\n    var origAddTrack = window.RTCPeerConnection.prototype.addTrack;\n    window.RTCPeerConnection.prototype.addTrack = function(track, stream) {\n      if (!stream) {\n        return origAddTrack.apply(this, arguments);\n      }\n      this._shimmedLocalStreams = this._shimmedLocalStreams || {};\n\n      var sender = origAddTrack.apply(this, arguments);\n      if (!this._shimmedLocalStreams[stream.id]) {\n        this._shimmedLocalStreams[stream.id] = [stream, sender];\n      } else if (this._shimmedLocalStreams[stream.id].indexOf(sender) === -1) {\n        this._shimmedLocalStreams[stream.id].push(sender);\n      }\n      return sender;\n    };\n\n    var origAddStream = window.RTCPeerConnection.prototype.addStream;\n    window.RTCPeerConnection.prototype.addStream = function(stream) {\n      var pc = this;\n      this._shimmedLocalStreams = this._shimmedLocalStreams || {};\n\n      stream.getTracks().forEach(function(track) {\n        var alreadyExists = pc.getSenders().find(function(s) {\n          return s.track === track;\n        });\n        if (alreadyExists) {\n          throw new DOMException('Track already exists.',\n              'InvalidAccessError');\n        }\n      });\n      var existingSenders = pc.getSenders();\n      origAddStream.apply(this, arguments);\n      var newSenders = pc.getSenders().filter(function(newSender) {\n        return existingSenders.indexOf(newSender) === -1;\n      });\n      this._shimmedLocalStreams[stream.id] = [stream].concat(newSenders);\n    };\n\n    var origRemoveStream = window.RTCPeerConnection.prototype.removeStream;\n    window.RTCPeerConnection.prototype.removeStream = function(stream) {\n      this._shimmedLocalStreams = this._shimmedLocalStreams || {};\n      delete this._shimmedLocalStreams[stream.id];\n      return origRemoveStream.apply(this, arguments);\n    };\n\n    var origRemoveTrack = window.RTCPeerConnection.prototype.removeTrack;\n    window.RTCPeerConnection.prototype.removeTrack = function(sender) {\n      var pc = this;\n      this._shimmedLocalStreams = this._shimmedLocalStreams || {};\n      if (sender) {\n        Object.keys(this._shimmedLocalStreams).forEach(function(streamId) {\n          var idx = pc._shimmedLocalStreams[streamId].indexOf(sender);\n          if (idx !== -1) {\n            pc._shimmedLocalStreams[streamId].splice(idx, 1);\n          }\n          if (pc._shimmedLocalStreams[streamId].length === 1) {\n            delete pc._shimmedLocalStreams[streamId];\n          }\n        });\n      }\n      return origRemoveTrack.apply(this, arguments);\n    };\n  },\n\n  shimAddTrackRemoveTrack: function(window) {\n    var browserDetails = utils.detectBrowser(window);\n    // shim addTrack and removeTrack.\n    if (window.RTCPeerConnection.prototype.addTrack &&\n        browserDetails.version >= 65) {\n      return this.shimAddTrackRemoveTrackWithNative(window);\n    }\n\n    // also shim pc.getLocalStreams when addTrack is shimmed\n    // to return the original streams.\n    var origGetLocalStreams = window.RTCPeerConnection.prototype\n        .getLocalStreams;\n    window.RTCPeerConnection.prototype.getLocalStreams = function() {\n      var pc = this;\n      var nativeStreams = origGetLocalStreams.apply(this);\n      pc._reverseStreams = pc._reverseStreams || {};\n      return nativeStreams.map(function(stream) {\n        return pc._reverseStreams[stream.id];\n      });\n    };\n\n    var origAddStream = window.RTCPeerConnection.prototype.addStream;\n    window.RTCPeerConnection.prototype.addStream = function(stream) {\n      var pc = this;\n      pc._streams = pc._streams || {};\n      pc._reverseStreams = pc._reverseStreams || {};\n\n      stream.getTracks().forEach(function(track) {\n        var alreadyExists = pc.getSenders().find(function(s) {\n          return s.track === track;\n        });\n        if (alreadyExists) {\n          throw new DOMException('Track already exists.',\n              'InvalidAccessError');\n        }\n      });\n      // Add identity mapping for consistency with addTrack.\n      // Unless this is being used with a stream from addTrack.\n      if (!pc._reverseStreams[stream.id]) {\n        var newStream = new window.MediaStream(stream.getTracks());\n        pc._streams[stream.id] = newStream;\n        pc._reverseStreams[newStream.id] = stream;\n        stream = newStream;\n      }\n      origAddStream.apply(pc, [stream]);\n    };\n\n    var origRemoveStream = window.RTCPeerConnection.prototype.removeStream;\n    window.RTCPeerConnection.prototype.removeStream = function(stream) {\n      var pc = this;\n      pc._streams = pc._streams || {};\n      pc._reverseStreams = pc._reverseStreams || {};\n\n      origRemoveStream.apply(pc, [(pc._streams[stream.id] || stream)]);\n      delete pc._reverseStreams[(pc._streams[stream.id] ?\n          pc._streams[stream.id].id : stream.id)];\n      delete pc._streams[stream.id];\n    };\n\n    window.RTCPeerConnection.prototype.addTrack = function(track, stream) {\n      var pc = this;\n      if (pc.signalingState === 'closed') {\n        throw new DOMException(\n          'The RTCPeerConnection\\'s signalingState is \\'closed\\'.',\n          'InvalidStateError');\n      }\n      var streams = [].slice.call(arguments, 1);\n      if (streams.length !== 1 ||\n          !streams[0].getTracks().find(function(t) {\n            return t === track;\n          })) {\n        // this is not fully correct but all we can manage without\n        // [[associated MediaStreams]] internal slot.\n        throw new DOMException(\n          'The adapter.js addTrack polyfill only supports a single ' +\n          ' stream which is associated with the specified track.',\n          'NotSupportedError');\n      }\n\n      var alreadyExists = pc.getSenders().find(function(s) {\n        return s.track === track;\n      });\n      if (alreadyExists) {\n        throw new DOMException('Track already exists.',\n            'InvalidAccessError');\n      }\n\n      pc._streams = pc._streams || {};\n      pc._reverseStreams = pc._reverseStreams || {};\n      var oldStream = pc._streams[stream.id];\n      if (oldStream) {\n        // this is using odd Chrome behaviour, use with caution:\n        // https://bugs.chromium.org/p/webrtc/issues/detail?id=7815\n        // Note: we rely on the high-level addTrack/dtmf shim to\n        // create the sender with a dtmf sender.\n        oldStream.addTrack(track);\n\n        // Trigger ONN async.\n        Promise.resolve().then(function() {\n          pc.dispatchEvent(new Event('negotiationneeded'));\n        });\n      } else {\n        var newStream = new window.MediaStream([track]);\n        pc._streams[stream.id] = newStream;\n        pc._reverseStreams[newStream.id] = stream;\n        pc.addStream(newStream);\n      }\n      return pc.getSenders().find(function(s) {\n        return s.track === track;\n      });\n    };\n\n    // replace the internal stream id with the external one and\n    // vice versa.\n    function replaceInternalStreamId(pc, description) {\n      var sdp = description.sdp;\n      Object.keys(pc._reverseStreams || []).forEach(function(internalId) {\n        var externalStream = pc._reverseStreams[internalId];\n        var internalStream = pc._streams[externalStream.id];\n        sdp = sdp.replace(new RegExp(internalStream.id, 'g'),\n            externalStream.id);\n      });\n      return new RTCSessionDescription({\n        type: description.type,\n        sdp: sdp\n      });\n    }\n    function replaceExternalStreamId(pc, description) {\n      var sdp = description.sdp;\n      Object.keys(pc._reverseStreams || []).forEach(function(internalId) {\n        var externalStream = pc._reverseStreams[internalId];\n        var internalStream = pc._streams[externalStream.id];\n        sdp = sdp.replace(new RegExp(externalStream.id, 'g'),\n            internalStream.id);\n      });\n      return new RTCSessionDescription({\n        type: description.type,\n        sdp: sdp\n      });\n    }\n    ['createOffer', 'createAnswer'].forEach(function(method) {\n      var nativeMethod = window.RTCPeerConnection.prototype[method];\n      window.RTCPeerConnection.prototype[method] = function() {\n        var pc = this;\n        var args = arguments;\n        var isLegacyCall = arguments.length &&\n            typeof arguments[0] === 'function';\n        if (isLegacyCall) {\n          return nativeMethod.apply(pc, [\n            function(description) {\n              var desc = replaceInternalStreamId(pc, description);\n              args[0].apply(null, [desc]);\n            },\n            function(err) {\n              if (args[1]) {\n                args[1].apply(null, err);\n              }\n            }, arguments[2]\n          ]);\n        }\n        return nativeMethod.apply(pc, arguments)\n        .then(function(description) {\n          return replaceInternalStreamId(pc, description);\n        });\n      };\n    });\n\n    var origSetLocalDescription =\n        window.RTCPeerConnection.prototype.setLocalDescription;\n    window.RTCPeerConnection.prototype.setLocalDescription = function() {\n      var pc = this;\n      if (!arguments.length || !arguments[0].type) {\n        return origSetLocalDescription.apply(pc, arguments);\n      }\n      arguments[0] = replaceExternalStreamId(pc, arguments[0]);\n      return origSetLocalDescription.apply(pc, arguments);\n    };\n\n    // TODO: mangle getStats: https://w3c.github.io/webrtc-stats/#dom-rtcmediastreamstats-streamidentifier\n\n    var origLocalDescription = Object.getOwnPropertyDescriptor(\n        window.RTCPeerConnection.prototype, 'localDescription');\n    Object.defineProperty(window.RTCPeerConnection.prototype,\n        'localDescription', {\n          get: function() {\n            var pc = this;\n            var description = origLocalDescription.get.apply(this);\n            if (description.type === '') {\n              return description;\n            }\n            return replaceInternalStreamId(pc, description);\n          }\n        });\n\n    window.RTCPeerConnection.prototype.removeTrack = function(sender) {\n      var pc = this;\n      if (pc.signalingState === 'closed') {\n        throw new DOMException(\n          'The RTCPeerConnection\\'s signalingState is \\'closed\\'.',\n          'InvalidStateError');\n      }\n      // We can not yet check for sender instanceof RTCRtpSender\n      // since we shim RTPSender. So we check if sender._pc is set.\n      if (!sender._pc) {\n        throw new DOMException('Argument 1 of RTCPeerConnection.removeTrack ' +\n            'does not implement interface RTCRtpSender.', 'TypeError');\n      }\n      var isLocal = sender._pc === pc;\n      if (!isLocal) {\n        throw new DOMException('Sender was not created by this connection.',\n            'InvalidAccessError');\n      }\n\n      // Search for the native stream the senders track belongs to.\n      pc._streams = pc._streams || {};\n      var stream;\n      Object.keys(pc._streams).forEach(function(streamid) {\n        var hasTrack = pc._streams[streamid].getTracks().find(function(track) {\n          return sender.track === track;\n        });\n        if (hasTrack) {\n          stream = pc._streams[streamid];\n        }\n      });\n\n      if (stream) {\n        if (stream.getTracks().length === 1) {\n          // if this is the last track of the stream, remove the stream. This\n          // takes care of any shimmed _senders.\n          pc.removeStream(pc._reverseStreams[stream.id]);\n        } else {\n          // relying on the same odd chrome behaviour as above.\n          stream.removeTrack(sender.track);\n        }\n        pc.dispatchEvent(new Event('negotiationneeded'));\n      }\n    };\n  },\n\n  shimPeerConnection: function(window) {\n    var browserDetails = utils.detectBrowser(window);\n\n    // The RTCPeerConnection object.\n    if (!window.RTCPeerConnection) {\n      window.RTCPeerConnection = function(pcConfig, pcConstraints) {\n        // Translate iceTransportPolicy to iceTransports,\n        // see https://code.google.com/p/webrtc/issues/detail?id=4869\n        // this was fixed in M56 along with unprefixing RTCPeerConnection.\n        logging('PeerConnection');\n        if (pcConfig && pcConfig.iceTransportPolicy) {\n          pcConfig.iceTransports = pcConfig.iceTransportPolicy;\n        }\n\n        return new window.webkitRTCPeerConnection(pcConfig, pcConstraints);\n      };\n      window.RTCPeerConnection.prototype =\n          window.webkitRTCPeerConnection.prototype;\n      // wrap static methods. Currently just generateCertificate.\n      if (window.webkitRTCPeerConnection.generateCertificate) {\n        Object.defineProperty(window.RTCPeerConnection, 'generateCertificate', {\n          get: function() {\n            return window.webkitRTCPeerConnection.generateCertificate;\n          }\n        });\n      }\n    } else {\n      // migrate from non-spec RTCIceServer.url to RTCIceServer.urls\n      var OrigPeerConnection = window.RTCPeerConnection;\n      window.RTCPeerConnection = function(pcConfig, pcConstraints) {\n        if (pcConfig && pcConfig.iceServers) {\n          var newIceServers = [];\n          for (var i = 0; i < pcConfig.iceServers.length; i++) {\n            var server = pcConfig.iceServers[i];\n            if (!server.hasOwnProperty('urls') &&\n                server.hasOwnProperty('url')) {\n              utils.deprecated('RTCIceServer.url', 'RTCIceServer.urls');\n              server = JSON.parse(JSON.stringify(server));\n              server.urls = server.url;\n              newIceServers.push(server);\n            } else {\n              newIceServers.push(pcConfig.iceServers[i]);\n            }\n          }\n          pcConfig.iceServers = newIceServers;\n        }\n        return new OrigPeerConnection(pcConfig, pcConstraints);\n      };\n      window.RTCPeerConnection.prototype = OrigPeerConnection.prototype;\n      // wrap static methods. Currently just generateCertificate.\n      Object.defineProperty(window.RTCPeerConnection, 'generateCertificate', {\n        get: function() {\n          return OrigPeerConnection.generateCertificate;\n        }\n      });\n    }\n\n    var origGetStats = window.RTCPeerConnection.prototype.getStats;\n    window.RTCPeerConnection.prototype.getStats = function(selector,\n        successCallback, errorCallback) {\n      var pc = this;\n      var args = arguments;\n\n      // If selector is a function then we are in the old style stats so just\n      // pass back the original getStats format to avoid breaking old users.\n      if (arguments.length > 0 && typeof selector === 'function') {\n        return origGetStats.apply(this, arguments);\n      }\n\n      // When spec-style getStats is supported, return those when called with\n      // either no arguments or the selector argument is null.\n      if (origGetStats.length === 0 && (arguments.length === 0 ||\n          typeof arguments[0] !== 'function')) {\n        return origGetStats.apply(this, []);\n      }\n\n      var fixChromeStats_ = function(response) {\n        var standardReport = {};\n        var reports = response.result();\n        reports.forEach(function(report) {\n          var standardStats = {\n            id: report.id,\n            timestamp: report.timestamp,\n            type: {\n              localcandidate: 'local-candidate',\n              remotecandidate: 'remote-candidate'\n            }[report.type] || report.type\n          };\n          report.names().forEach(function(name) {\n            standardStats[name] = report.stat(name);\n          });\n          standardReport[standardStats.id] = standardStats;\n        });\n\n        return standardReport;\n      };\n\n      // shim getStats with maplike support\n      var makeMapStats = function(stats) {\n        return new Map(Object.keys(stats).map(function(key) {\n          return [key, stats[key]];\n        }));\n      };\n\n      if (arguments.length >= 2) {\n        var successCallbackWrapper_ = function(response) {\n          args[1](makeMapStats(fixChromeStats_(response)));\n        };\n\n        return origGetStats.apply(this, [successCallbackWrapper_,\n          arguments[0]]);\n      }\n\n      // promise-support\n      return new Promise(function(resolve, reject) {\n        origGetStats.apply(pc, [\n          function(response) {\n            resolve(makeMapStats(fixChromeStats_(response)));\n          }, reject]);\n      }).then(successCallback, errorCallback);\n    };\n\n    // add promise support -- natively available in Chrome 51\n    if (browserDetails.version < 51) {\n      ['setLocalDescription', 'setRemoteDescription', 'addIceCandidate']\n          .forEach(function(method) {\n            var nativeMethod = window.RTCPeerConnection.prototype[method];\n            window.RTCPeerConnection.prototype[method] = function() {\n              var args = arguments;\n              var pc = this;\n              var promise = new Promise(function(resolve, reject) {\n                nativeMethod.apply(pc, [args[0], resolve, reject]);\n              });\n              if (args.length < 2) {\n                return promise;\n              }\n              return promise.then(function() {\n                args[1].apply(null, []);\n              },\n              function(err) {\n                if (args.length >= 3) {\n                  args[2].apply(null, [err]);\n                }\n              });\n            };\n          });\n    }\n\n    // promise support for createOffer and createAnswer. Available (without\n    // bugs) since M52: crbug/619289\n    if (browserDetails.version < 52) {\n      ['createOffer', 'createAnswer'].forEach(function(method) {\n        var nativeMethod = window.RTCPeerConnection.prototype[method];\n        window.RTCPeerConnection.prototype[method] = function() {\n          var pc = this;\n          if (arguments.length < 1 || (arguments.length === 1 &&\n              typeof arguments[0] === 'object')) {\n            var opts = arguments.length === 1 ? arguments[0] : undefined;\n            return new Promise(function(resolve, reject) {\n              nativeMethod.apply(pc, [resolve, reject, opts]);\n            });\n          }\n          return nativeMethod.apply(this, arguments);\n        };\n      });\n    }\n\n    // shim implicit creation of RTCSessionDescription/RTCIceCandidate\n    ['setLocalDescription', 'setRemoteDescription', 'addIceCandidate']\n        .forEach(function(method) {\n          var nativeMethod = window.RTCPeerConnection.prototype[method];\n          window.RTCPeerConnection.prototype[method] = function() {\n            arguments[0] = new ((method === 'addIceCandidate') ?\n                window.RTCIceCandidate :\n                window.RTCSessionDescription)(arguments[0]);\n            return nativeMethod.apply(this, arguments);\n          };\n        });\n\n    // support for addIceCandidate(null or undefined)\n    var nativeAddIceCandidate =\n        window.RTCPeerConnection.prototype.addIceCandidate;\n    window.RTCPeerConnection.prototype.addIceCandidate = function() {\n      if (!arguments[0]) {\n        if (arguments[1]) {\n          arguments[1].apply(null);\n        }\n        return Promise.resolve();\n      }\n      return nativeAddIceCandidate.apply(this, arguments);\n    };\n  }\n};\n\n},{\"../utils.js\":13,\"./getusermedia\":6}],6:[function(require,module,exports){\n/*\n *  Copyright (c) 2016 The WebRTC project authors. All Rights Reserved.\n *\n *  Use of this source code is governed by a BSD-style license\n *  that can be found in the LICENSE file in the root of the source\n *  tree.\n */\n /* eslint-env node */\n'use strict';\nvar utils = require('../utils.js');\nvar logging = utils.log;\n\n// Expose public methods.\nmodule.exports = function(window) {\n  var browserDetails = utils.detectBrowser(window);\n  var navigator = window && window.navigator;\n\n  var constraintsToChrome_ = function(c) {\n    if (typeof c !== 'object' || c.mandatory || c.optional) {\n      return c;\n    }\n    var cc = {};\n    Object.keys(c).forEach(function(key) {\n      if (key === 'require' || key === 'advanced' || key === 'mediaSource') {\n        return;\n      }\n      var r = (typeof c[key] === 'object') ? c[key] : {ideal: c[key]};\n      if (r.exact !== undefined && typeof r.exact === 'number') {\n        r.min = r.max = r.exact;\n      }\n      var oldname_ = function(prefix, name) {\n        if (prefix) {\n          return prefix + name.charAt(0).toUpperCase() + name.slice(1);\n        }\n        return (name === 'deviceId') ? 'sourceId' : name;\n      };\n      if (r.ideal !== undefined) {\n        cc.optional = cc.optional || [];\n        var oc = {};\n        if (typeof r.ideal === 'number') {\n          oc[oldname_('min', key)] = r.ideal;\n          cc.optional.push(oc);\n          oc = {};\n          oc[oldname_('max', key)] = r.ideal;\n          cc.optional.push(oc);\n        } else {\n          oc[oldname_('', key)] = r.ideal;\n          cc.optional.push(oc);\n        }\n      }\n      if (r.exact !== undefined && typeof r.exact !== 'number') {\n        cc.mandatory = cc.mandatory || {};\n        cc.mandatory[oldname_('', key)] = r.exact;\n      } else {\n        ['min', 'max'].forEach(function(mix) {\n          if (r[mix] !== undefined) {\n            cc.mandatory = cc.mandatory || {};\n            cc.mandatory[oldname_(mix, key)] = r[mix];\n          }\n        });\n      }\n    });\n    if (c.advanced) {\n      cc.optional = (cc.optional || []).concat(c.advanced);\n    }\n    return cc;\n  };\n\n  var shimConstraints_ = function(constraints, func) {\n    if (browserDetails.version >= 61) {\n      return func(constraints);\n    }\n    constraints = JSON.parse(JSON.stringify(constraints));\n    if (constraints && typeof constraints.audio === 'object') {\n      var remap = function(obj, a, b) {\n        if (a in obj && !(b in obj)) {\n          obj[b] = obj[a];\n          delete obj[a];\n        }\n      };\n      constraints = JSON.parse(JSON.stringify(constraints));\n      remap(constraints.audio, 'autoGainControl', 'googAutoGainControl');\n      remap(constraints.audio, 'noiseSuppression', 'googNoiseSuppression');\n      constraints.audio = constraintsToChrome_(constraints.audio);\n    }\n    if (constraints && typeof constraints.video === 'object') {\n      // Shim facingMode for mobile & surface pro.\n      var face = constraints.video.facingMode;\n      face = face && ((typeof face === 'object') ? face : {ideal: face});\n      var getSupportedFacingModeLies = browserDetails.version < 66;\n\n      if ((face && (face.exact === 'user' || face.exact === 'environment' ||\n                    face.ideal === 'user' || face.ideal === 'environment')) &&\n          !(navigator.mediaDevices.getSupportedConstraints &&\n            navigator.mediaDevices.getSupportedConstraints().facingMode &&\n            !getSupportedFacingModeLies)) {\n        delete constraints.video.facingMode;\n        var matches;\n        if (face.exact === 'environment' || face.ideal === 'environment') {\n          matches = ['back', 'rear'];\n        } else if (face.exact === 'user' || face.ideal === 'user') {\n          matches = ['front'];\n        }\n        if (matches) {\n          // Look for matches in label, or use last cam for back (typical).\n          return navigator.mediaDevices.enumerateDevices()\n          .then(function(devices) {\n            devices = devices.filter(function(d) {\n              return d.kind === 'videoinput';\n            });\n            var dev = devices.find(function(d) {\n              return matches.some(function(match) {\n                return d.label.toLowerCase().indexOf(match) !== -1;\n              });\n            });\n            if (!dev && devices.length && matches.indexOf('back') !== -1) {\n              dev = devices[devices.length - 1]; // more likely the back cam\n            }\n            if (dev) {\n              constraints.video.deviceId = face.exact ? {exact: dev.deviceId} :\n                                                        {ideal: dev.deviceId};\n            }\n            constraints.video = constraintsToChrome_(constraints.video);\n            logging('chrome: ' + JSON.stringify(constraints));\n            return func(constraints);\n          });\n        }\n      }\n      constraints.video = constraintsToChrome_(constraints.video);\n    }\n    logging('chrome: ' + JSON.stringify(constraints));\n    return func(constraints);\n  };\n\n  var shimError_ = function(e) {\n    return {\n      name: {\n        PermissionDeniedError: 'NotAllowedError',\n        InvalidStateError: 'NotReadableError',\n        DevicesNotFoundError: 'NotFoundError',\n        ConstraintNotSatisfiedError: 'OverconstrainedError',\n        TrackStartError: 'NotReadableError',\n        MediaDeviceFailedDueToShutdown: 'NotReadableError',\n        MediaDeviceKillSwitchOn: 'NotReadableError'\n      }[e.name] || e.name,\n      message: e.message,\n      constraint: e.constraintName,\n      toString: function() {\n        return this.name + (this.message && ': ') + this.message;\n      }\n    };\n  };\n\n  var getUserMedia_ = function(constraints, onSuccess, onError) {\n    shimConstraints_(constraints, function(c) {\n      navigator.webkitGetUserMedia(c, onSuccess, function(e) {\n        if (onError) {\n          onError(shimError_(e));\n        }\n      });\n    });\n  };\n\n  navigator.getUserMedia = getUserMedia_;\n\n  // Returns the result of getUserMedia as a Promise.\n  var getUserMediaPromise_ = function(constraints) {\n    return new Promise(function(resolve, reject) {\n      navigator.getUserMedia(constraints, resolve, reject);\n    });\n  };\n\n  if (!navigator.mediaDevices) {\n    navigator.mediaDevices = {\n      getUserMedia: getUserMediaPromise_,\n      enumerateDevices: function() {\n        return new Promise(function(resolve) {\n          var kinds = {audio: 'audioinput', video: 'videoinput'};\n          return window.MediaStreamTrack.getSources(function(devices) {\n            resolve(devices.map(function(device) {\n              return {label: device.label,\n                kind: kinds[device.kind],\n                deviceId: device.id,\n                groupId: ''};\n            }));\n          });\n        });\n      },\n      getSupportedConstraints: function() {\n        return {\n          deviceId: true, echoCancellation: true, facingMode: true,\n          frameRate: true, height: true, width: true\n        };\n      }\n    };\n  }\n\n  // A shim for getUserMedia method on the mediaDevices object.\n  // TODO(KaptenJansson) remove once implemented in Chrome stable.\n  if (!navigator.mediaDevices.getUserMedia) {\n    navigator.mediaDevices.getUserMedia = function(constraints) {\n      return getUserMediaPromise_(constraints);\n    };\n  } else {\n    // Even though Chrome 45 has navigator.mediaDevices and a getUserMedia\n    // function which returns a Promise, it does not accept spec-style\n    // constraints.\n    var origGetUserMedia = navigator.mediaDevices.getUserMedia.\n        bind(navigator.mediaDevices);\n    navigator.mediaDevices.getUserMedia = function(cs) {\n      return shimConstraints_(cs, function(c) {\n        return origGetUserMedia(c).then(function(stream) {\n          if (c.audio && !stream.getAudioTracks().length ||\n              c.video && !stream.getVideoTracks().length) {\n            stream.getTracks().forEach(function(track) {\n              track.stop();\n            });\n            throw new DOMException('', 'NotFoundError');\n          }\n          return stream;\n        }, function(e) {\n          return Promise.reject(shimError_(e));\n        });\n      });\n    };\n  }\n\n  // Dummy devicechange event methods.\n  // TODO(KaptenJansson) remove once implemented in Chrome stable.\n  if (typeof navigator.mediaDevices.addEventListener === 'undefined') {\n    navigator.mediaDevices.addEventListener = function() {\n      logging('Dummy mediaDevices.addEventListener called.');\n    };\n  }\n  if (typeof navigator.mediaDevices.removeEventListener === 'undefined') {\n    navigator.mediaDevices.removeEventListener = function() {\n      logging('Dummy mediaDevices.removeEventListener called.');\n    };\n  }\n};\n\n},{\"../utils.js\":13}],7:[function(require,module,exports){\n/*\n *  Copyright (c) 2017 The WebRTC project authors. All Rights Reserved.\n *\n *  Use of this source code is governed by a BSD-style license\n *  that can be found in the LICENSE file in the root of the source\n *  tree.\n */\n /* eslint-env node */\n'use strict';\n\nvar SDPUtils = require('sdp');\nvar utils = require('./utils');\n\n// Wraps the peerconnection event eventNameToWrap in a function\n// which returns the modified event object.\nfunction wrapPeerConnectionEvent(window, eventNameToWrap, wrapper) {\n  if (!window.RTCPeerConnection) {\n    return;\n  }\n  var proto = window.RTCPeerConnection.prototype;\n  var nativeAddEventListener = proto.addEventListener;\n  proto.addEventListener = function(nativeEventName, cb) {\n    if (nativeEventName !== eventNameToWrap) {\n      return nativeAddEventListener.apply(this, arguments);\n    }\n    var wrappedCallback = function(e) {\n      cb(wrapper(e));\n    };\n    this._eventMap = this._eventMap || {};\n    this._eventMap[cb] = wrappedCallback;\n    return nativeAddEventListener.apply(this, [nativeEventName,\n      wrappedCallback]);\n  };\n\n  var nativeRemoveEventListener = proto.removeEventListener;\n  proto.removeEventListener = function(nativeEventName, cb) {\n    if (nativeEventName !== eventNameToWrap || !this._eventMap\n        || !this._eventMap[cb]) {\n      return nativeRemoveEventListener.apply(this, arguments);\n    }\n    var unwrappedCb = this._eventMap[cb];\n    delete this._eventMap[cb];\n    return nativeRemoveEventListener.apply(this, [nativeEventName,\n      unwrappedCb]);\n  };\n\n  Object.defineProperty(proto, 'on' + eventNameToWrap, {\n    get: function() {\n      return this['_on' + eventNameToWrap];\n    },\n    set: function(cb) {\n      if (this['_on' + eventNameToWrap]) {\n        this.removeEventListener(eventNameToWrap,\n            this['_on' + eventNameToWrap]);\n        delete this['_on' + eventNameToWrap];\n      }\n      if (cb) {\n        this.addEventListener(eventNameToWrap,\n            this['_on' + eventNameToWrap] = cb);\n      }\n    }\n  });\n}\n\nmodule.exports = {\n  shimRTCIceCandidate: function(window) {\n    // foundation is arbitrarily chosen as an indicator for full support for\n    // https://w3c.github.io/webrtc-pc/#rtcicecandidate-interface\n    if (window.RTCIceCandidate && 'foundation' in\n        window.RTCIceCandidate.prototype) {\n      return;\n    }\n\n    var NativeRTCIceCandidate = window.RTCIceCandidate;\n    window.RTCIceCandidate = function(args) {\n      // Remove the a= which shouldn't be part of the candidate string.\n      if (typeof args === 'object' && args.candidate &&\n          args.candidate.indexOf('a=') === 0) {\n        args = JSON.parse(JSON.stringify(args));\n        args.candidate = args.candidate.substr(2);\n      }\n\n      // Augment the native candidate with the parsed fields.\n      var nativeCandidate = new NativeRTCIceCandidate(args);\n      var parsedCandidate = SDPUtils.parseCandidate(args.candidate);\n      var augmentedCandidate = Object.assign(nativeCandidate,\n          parsedCandidate);\n\n      // Add a serializer that does not serialize the extra attributes.\n      augmentedCandidate.toJSON = function() {\n        return {\n          candidate: augmentedCandidate.candidate,\n          sdpMid: augmentedCandidate.sdpMid,\n          sdpMLineIndex: augmentedCandidate.sdpMLineIndex,\n          usernameFragment: augmentedCandidate.usernameFragment,\n        };\n      };\n      return augmentedCandidate;\n    };\n\n    // Hook up the augmented candidate in onicecandidate and\n    // addEventListener('icecandidate', ...)\n    wrapPeerConnectionEvent(window, 'icecandidate', function(e) {\n      if (e.candidate) {\n        Object.defineProperty(e, 'candidate', {\n          value: new window.RTCIceCandidate(e.candidate),\n          writable: 'false'\n        });\n      }\n      return e;\n    });\n  },\n\n  // shimCreateObjectURL must be called before shimSourceObject to avoid loop.\n\n  shimCreateObjectURL: function(window) {\n    var URL = window && window.URL;\n\n    if (!(typeof window === 'object' && window.HTMLMediaElement &&\n          'srcObject' in window.HTMLMediaElement.prototype &&\n        URL.createObjectURL && URL.revokeObjectURL)) {\n      // Only shim CreateObjectURL using srcObject if srcObject exists.\n      return undefined;\n    }\n\n    var nativeCreateObjectURL = URL.createObjectURL.bind(URL);\n    var nativeRevokeObjectURL = URL.revokeObjectURL.bind(URL);\n    var streams = new Map(), newId = 0;\n\n    URL.createObjectURL = function(stream) {\n      if ('getTracks' in stream) {\n        var url = 'polyblob:' + (++newId);\n        streams.set(url, stream);\n        utils.deprecated('URL.createObjectURL(stream)',\n            'elem.srcObject = stream');\n        return url;\n      }\n      return nativeCreateObjectURL(stream);\n    };\n    URL.revokeObjectURL = function(url) {\n      nativeRevokeObjectURL(url);\n      streams.delete(url);\n    };\n\n    var dsc = Object.getOwnPropertyDescriptor(window.HTMLMediaElement.prototype,\n                                              'src');\n    Object.defineProperty(window.HTMLMediaElement.prototype, 'src', {\n      get: function() {\n        return dsc.get.apply(this);\n      },\n      set: function(url) {\n        this.srcObject = streams.get(url) || null;\n        return dsc.set.apply(this, [url]);\n      }\n    });\n\n    var nativeSetAttribute = window.HTMLMediaElement.prototype.setAttribute;\n    window.HTMLMediaElement.prototype.setAttribute = function() {\n      if (arguments.length === 2 &&\n          ('' + arguments[0]).toLowerCase() === 'src') {\n        this.srcObject = streams.get(arguments[1]) || null;\n      }\n      return nativeSetAttribute.apply(this, arguments);\n    };\n  }\n};\n\n},{\"./utils\":13,\"sdp\":2}],8:[function(require,module,exports){\n/*\n *  Copyright (c) 2016 The WebRTC project authors. All Rights Reserved.\n *\n *  Use of this source code is governed by a BSD-style license\n *  that can be found in the LICENSE file in the root of the source\n *  tree.\n */\n /* eslint-env node */\n'use strict';\n\nvar utils = require('../utils');\nvar shimRTCPeerConnection = require('rtcpeerconnection-shim');\n\nmodule.exports = {\n  shimGetUserMedia: require('./getusermedia'),\n  shimPeerConnection: function(window) {\n    var browserDetails = utils.detectBrowser(window);\n\n    if (window.RTCIceGatherer) {\n      // ORTC defines an RTCIceCandidate object but no constructor.\n      // Not implemented in Edge.\n      if (!window.RTCIceCandidate) {\n        window.RTCIceCandidate = function(args) {\n          return args;\n        };\n      }\n      // ORTC does not have a session description object but\n      // other browsers (i.e. Chrome) that will support both PC and ORTC\n      // in the future might have this defined already.\n      if (!window.RTCSessionDescription) {\n        window.RTCSessionDescription = function(args) {\n          return args;\n        };\n      }\n      // this adds an additional event listener to MediaStrackTrack that signals\n      // when a tracks enabled property was changed. Workaround for a bug in\n      // addStream, see below. No longer required in 15025+\n      if (browserDetails.version < 15025) {\n        var origMSTEnabled = Object.getOwnPropertyDescriptor(\n            window.MediaStreamTrack.prototype, 'enabled');\n        Object.defineProperty(window.MediaStreamTrack.prototype, 'enabled', {\n          set: function(value) {\n            origMSTEnabled.set.call(this, value);\n            var ev = new Event('enabled');\n            ev.enabled = value;\n            this.dispatchEvent(ev);\n          }\n        });\n      }\n    }\n\n    // ORTC defines the DTMF sender a bit different.\n    // https://github.com/w3c/ortc/issues/714\n    if (window.RTCRtpSender && !('dtmf' in window.RTCRtpSender.prototype)) {\n      Object.defineProperty(window.RTCRtpSender.prototype, 'dtmf', {\n        get: function() {\n          if (this._dtmf === undefined) {\n            if (this.track.kind === 'audio') {\n              this._dtmf = new window.RTCDtmfSender(this);\n            } else if (this.track.kind === 'video') {\n              this._dtmf = null;\n            }\n          }\n          return this._dtmf;\n        }\n      });\n    }\n\n    window.RTCPeerConnection =\n        shimRTCPeerConnection(window, browserDetails.version);\n  },\n  shimReplaceTrack: function(window) {\n    // ORTC has replaceTrack -- https://github.com/w3c/ortc/issues/614\n    if (window.RTCRtpSender &&\n        !('replaceTrack' in window.RTCRtpSender.prototype)) {\n      window.RTCRtpSender.prototype.replaceTrack =\n          window.RTCRtpSender.prototype.setTrack;\n    }\n  }\n};\n\n},{\"../utils\":13,\"./getusermedia\":9,\"rtcpeerconnection-shim\":1}],9:[function(require,module,exports){\n/*\n *  Copyright (c) 2016 The WebRTC project authors. All Rights Reserved.\n *\n *  Use of this source code is governed by a BSD-style license\n *  that can be found in the LICENSE file in the root of the source\n *  tree.\n */\n /* eslint-env node */\n'use strict';\n\n// Expose public methods.\nmodule.exports = function(window) {\n  var navigator = window && window.navigator;\n\n  var shimError_ = function(e) {\n    return {\n      name: {PermissionDeniedError: 'NotAllowedError'}[e.name] || e.name,\n      message: e.message,\n      constraint: e.constraint,\n      toString: function() {\n        return this.name;\n      }\n    };\n  };\n\n  // getUserMedia error shim.\n  var origGetUserMedia = navigator.mediaDevices.getUserMedia.\n      bind(navigator.mediaDevices);\n  navigator.mediaDevices.getUserMedia = function(c) {\n    return origGetUserMedia(c).catch(function(e) {\n      return Promise.reject(shimError_(e));\n    });\n  };\n};\n\n},{}],10:[function(require,module,exports){\n/*\n *  Copyright (c) 2016 The WebRTC project authors. All Rights Reserved.\n *\n *  Use of this source code is governed by a BSD-style license\n *  that can be found in the LICENSE file in the root of the source\n *  tree.\n */\n /* eslint-env node */\n'use strict';\n\nvar utils = require('../utils');\n\nmodule.exports = {\n  shimGetUserMedia: require('./getusermedia'),\n  shimOnTrack: function(window) {\n    if (typeof window === 'object' && window.RTCPeerConnection && !('ontrack' in\n        window.RTCPeerConnection.prototype)) {\n      Object.defineProperty(window.RTCPeerConnection.prototype, 'ontrack', {\n        get: function() {\n          return this._ontrack;\n        },\n        set: function(f) {\n          if (this._ontrack) {\n            this.removeEventListener('track', this._ontrack);\n            this.removeEventListener('addstream', this._ontrackpoly);\n          }\n          this.addEventListener('track', this._ontrack = f);\n          this.addEventListener('addstream', this._ontrackpoly = function(e) {\n            e.stream.getTracks().forEach(function(track) {\n              var event = new Event('track');\n              event.track = track;\n              event.receiver = {track: track};\n              event.transceiver = {receiver: event.receiver};\n              event.streams = [e.stream];\n              this.dispatchEvent(event);\n            }.bind(this));\n          }.bind(this));\n        }\n      });\n    }\n    if (typeof window === 'object' && window.RTCTrackEvent &&\n        ('receiver' in window.RTCTrackEvent.prototype) &&\n        !('transceiver' in window.RTCTrackEvent.prototype)) {\n      Object.defineProperty(window.RTCTrackEvent.prototype, 'transceiver', {\n        get: function() {\n          return {receiver: this.receiver};\n        }\n      });\n    }\n  },\n\n  shimSourceObject: function(window) {\n    // Firefox has supported mozSrcObject since FF22, unprefixed in 42.\n    if (typeof window === 'object') {\n      if (window.HTMLMediaElement &&\n        !('srcObject' in window.HTMLMediaElement.prototype)) {\n        // Shim the srcObject property, once, when HTMLMediaElement is found.\n        Object.defineProperty(window.HTMLMediaElement.prototype, 'srcObject', {\n          get: function() {\n            return this.mozSrcObject;\n          },\n          set: function(stream) {\n            this.mozSrcObject = stream;\n          }\n        });\n      }\n    }\n  },\n\n  shimPeerConnection: function(window) {\n    var browserDetails = utils.detectBrowser(window);\n\n    if (typeof window !== 'object' || !(window.RTCPeerConnection ||\n        window.mozRTCPeerConnection)) {\n      return; // probably media.peerconnection.enabled=false in about:config\n    }\n    // The RTCPeerConnection object.\n    if (!window.RTCPeerConnection) {\n      window.RTCPeerConnection = function(pcConfig, pcConstraints) {\n        if (browserDetails.version < 38) {\n          // .urls is not supported in FF < 38.\n          // create RTCIceServers with a single url.\n          if (pcConfig && pcConfig.iceServers) {\n            var newIceServers = [];\n            for (var i = 0; i < pcConfig.iceServers.length; i++) {\n              var server = pcConfig.iceServers[i];\n              if (server.hasOwnProperty('urls')) {\n                for (var j = 0; j < server.urls.length; j++) {\n                  var newServer = {\n                    url: server.urls[j]\n                  };\n                  if (server.urls[j].indexOf('turn') === 0) {\n                    newServer.username = server.username;\n                    newServer.credential = server.credential;\n                  }\n                  newIceServers.push(newServer);\n                }\n              } else {\n                newIceServers.push(pcConfig.iceServers[i]);\n              }\n            }\n            pcConfig.iceServers = newIceServers;\n          }\n        }\n        return new window.mozRTCPeerConnection(pcConfig, pcConstraints);\n      };\n      window.RTCPeerConnection.prototype =\n          window.mozRTCPeerConnection.prototype;\n\n      // wrap static methods. Currently just generateCertificate.\n      if (window.mozRTCPeerConnection.generateCertificate) {\n        Object.defineProperty(window.RTCPeerConnection, 'generateCertificate', {\n          get: function() {\n            return window.mozRTCPeerConnection.generateCertificate;\n          }\n        });\n      }\n\n      window.RTCSessionDescription = window.mozRTCSessionDescription;\n      window.RTCIceCandidate = window.mozRTCIceCandidate;\n    }\n\n    // shim away need for obsolete RTCIceCandidate/RTCSessionDescription.\n    ['setLocalDescription', 'setRemoteDescription', 'addIceCandidate']\n        .forEach(function(method) {\n          var nativeMethod = window.RTCPeerConnection.prototype[method];\n          window.RTCPeerConnection.prototype[method] = function() {\n            arguments[0] = new ((method === 'addIceCandidate') ?\n                window.RTCIceCandidate :\n                window.RTCSessionDescription)(arguments[0]);\n            return nativeMethod.apply(this, arguments);\n          };\n        });\n\n    // support for addIceCandidate(null or undefined)\n    var nativeAddIceCandidate =\n        window.RTCPeerConnection.prototype.addIceCandidate;\n    window.RTCPeerConnection.prototype.addIceCandidate = function() {\n      if (!arguments[0]) {\n        if (arguments[1]) {\n          arguments[1].apply(null);\n        }\n        return Promise.resolve();\n      }\n      return nativeAddIceCandidate.apply(this, arguments);\n    };\n\n    // shim getStats with maplike support\n    var makeMapStats = function(stats) {\n      var map = new Map();\n      Object.keys(stats).forEach(function(key) {\n        map.set(key, stats[key]);\n        map[key] = stats[key];\n      });\n      return map;\n    };\n\n    var modernStatsTypes = {\n      inboundrtp: 'inbound-rtp',\n      outboundrtp: 'outbound-rtp',\n      candidatepair: 'candidate-pair',\n      localcandidate: 'local-candidate',\n      remotecandidate: 'remote-candidate'\n    };\n\n    var nativeGetStats = window.RTCPeerConnection.prototype.getStats;\n    window.RTCPeerConnection.prototype.getStats = function(\n      selector,\n      onSucc,\n      onErr\n    ) {\n      return nativeGetStats.apply(this, [selector || null])\n        .then(function(stats) {\n          if (browserDetails.version < 48) {\n            stats = makeMapStats(stats);\n          }\n          if (browserDetails.version < 53 && !onSucc) {\n            // Shim only promise getStats with spec-hyphens in type names\n            // Leave callback version alone; misc old uses of forEach before Map\n            try {\n              stats.forEach(function(stat) {\n                stat.type = modernStatsTypes[stat.type] || stat.type;\n              });\n            } catch (e) {\n              if (e.name !== 'TypeError') {\n                throw e;\n              }\n              // Avoid TypeError: \"type\" is read-only, in old versions. 34-43ish\n              stats.forEach(function(stat, i) {\n                stats.set(i, Object.assign({}, stat, {\n                  type: modernStatsTypes[stat.type] || stat.type\n                }));\n              });\n            }\n          }\n          return stats;\n        })\n        .then(onSucc, onErr);\n    };\n  },\n\n  shimRemoveStream: function(window) {\n    if (!window.RTCPeerConnection ||\n        'removeStream' in window.RTCPeerConnection.prototype) {\n      return;\n    }\n    window.RTCPeerConnection.prototype.removeStream = function(stream) {\n      var pc = this;\n      utils.deprecated('removeStream', 'removeTrack');\n      this.getSenders().forEach(function(sender) {\n        if (sender.track && stream.getTracks().indexOf(sender.track) !== -1) {\n          pc.removeTrack(sender);\n        }\n      });\n    };\n  }\n};\n\n},{\"../utils\":13,\"./getusermedia\":11}],11:[function(require,module,exports){\n/*\n *  Copyright (c) 2016 The WebRTC project authors. All Rights Reserved.\n *\n *  Use of this source code is governed by a BSD-style license\n *  that can be found in the LICENSE file in the root of the source\n *  tree.\n */\n /* eslint-env node */\n'use strict';\n\nvar utils = require('../utils');\nvar logging = utils.log;\n\n// Expose public methods.\nmodule.exports = function(window) {\n  var browserDetails = utils.detectBrowser(window);\n  var navigator = window && window.navigator;\n  var MediaStreamTrack = window && window.MediaStreamTrack;\n\n  var shimError_ = function(e) {\n    return {\n      name: {\n        InternalError: 'NotReadableError',\n        NotSupportedError: 'TypeError',\n        PermissionDeniedError: 'NotAllowedError',\n        SecurityError: 'NotAllowedError'\n      }[e.name] || e.name,\n      message: {\n        'The operation is insecure.': 'The request is not allowed by the ' +\n        'user agent or the platform in the current context.'\n      }[e.message] || e.message,\n      constraint: e.constraint,\n      toString: function() {\n        return this.name + (this.message && ': ') + this.message;\n      }\n    };\n  };\n\n  // getUserMedia constraints shim.\n  var getUserMedia_ = function(constraints, onSuccess, onError) {\n    var constraintsToFF37_ = function(c) {\n      if (typeof c !== 'object' || c.require) {\n        return c;\n      }\n      var require = [];\n      Object.keys(c).forEach(function(key) {\n        if (key === 'require' || key === 'advanced' || key === 'mediaSource') {\n          return;\n        }\n        var r = c[key] = (typeof c[key] === 'object') ?\n            c[key] : {ideal: c[key]};\n        if (r.min !== undefined ||\n            r.max !== undefined || r.exact !== undefined) {\n          require.push(key);\n        }\n        if (r.exact !== undefined) {\n          if (typeof r.exact === 'number') {\n            r. min = r.max = r.exact;\n          } else {\n            c[key] = r.exact;\n          }\n          delete r.exact;\n        }\n        if (r.ideal !== undefined) {\n          c.advanced = c.advanced || [];\n          var oc = {};\n          if (typeof r.ideal === 'number') {\n            oc[key] = {min: r.ideal, max: r.ideal};\n          } else {\n            oc[key] = r.ideal;\n          }\n          c.advanced.push(oc);\n          delete r.ideal;\n          if (!Object.keys(r).length) {\n            delete c[key];\n          }\n        }\n      });\n      if (require.length) {\n        c.require = require;\n      }\n      return c;\n    };\n    constraints = JSON.parse(JSON.stringify(constraints));\n    if (browserDetails.version < 38) {\n      logging('spec: ' + JSON.stringify(constraints));\n      if (constraints.audio) {\n        constraints.audio = constraintsToFF37_(constraints.audio);\n      }\n      if (constraints.video) {\n        constraints.video = constraintsToFF37_(constraints.video);\n      }\n      logging('ff37: ' + JSON.stringify(constraints));\n    }\n    return navigator.mozGetUserMedia(constraints, onSuccess, function(e) {\n      onError(shimError_(e));\n    });\n  };\n\n  // Returns the result of getUserMedia as a Promise.\n  var getUserMediaPromise_ = function(constraints) {\n    return new Promise(function(resolve, reject) {\n      getUserMedia_(constraints, resolve, reject);\n    });\n  };\n\n  // Shim for mediaDevices on older versions.\n  if (!navigator.mediaDevices) {\n    navigator.mediaDevices = {getUserMedia: getUserMediaPromise_,\n      addEventListener: function() { },\n      removeEventListener: function() { }\n    };\n  }\n  navigator.mediaDevices.enumerateDevices =\n      navigator.mediaDevices.enumerateDevices || function() {\n        return new Promise(function(resolve) {\n          var infos = [\n            {kind: 'audioinput', deviceId: 'default', label: '', groupId: ''},\n            {kind: 'videoinput', deviceId: 'default', label: '', groupId: ''}\n          ];\n          resolve(infos);\n        });\n      };\n\n  if (browserDetails.version < 41) {\n    // Work around http://bugzil.la/1169665\n    var orgEnumerateDevices =\n        navigator.mediaDevices.enumerateDevices.bind(navigator.mediaDevices);\n    navigator.mediaDevices.enumerateDevices = function() {\n      return orgEnumerateDevices().then(undefined, function(e) {\n        if (e.name === 'NotFoundError') {\n          return [];\n        }\n        throw e;\n      });\n    };\n  }\n  if (browserDetails.version < 49) {\n    var origGetUserMedia = navigator.mediaDevices.getUserMedia.\n        bind(navigator.mediaDevices);\n    navigator.mediaDevices.getUserMedia = function(c) {\n      return origGetUserMedia(c).then(function(stream) {\n        // Work around https://bugzil.la/802326\n        if (c.audio && !stream.getAudioTracks().length ||\n            c.video && !stream.getVideoTracks().length) {\n          stream.getTracks().forEach(function(track) {\n            track.stop();\n          });\n          throw new DOMException('The object can not be found here.',\n                                 'NotFoundError');\n        }\n        return stream;\n      }, function(e) {\n        return Promise.reject(shimError_(e));\n      });\n    };\n  }\n  if (!(browserDetails.version > 55 &&\n      'autoGainControl' in navigator.mediaDevices.getSupportedConstraints())) {\n    var remap = function(obj, a, b) {\n      if (a in obj && !(b in obj)) {\n        obj[b] = obj[a];\n        delete obj[a];\n      }\n    };\n\n    var nativeGetUserMedia = navigator.mediaDevices.getUserMedia.\n        bind(navigator.mediaDevices);\n    navigator.mediaDevices.getUserMedia = function(c) {\n      if (typeof c === 'object' && typeof c.audio === 'object') {\n        c = JSON.parse(JSON.stringify(c));\n        remap(c.audio, 'autoGainControl', 'mozAutoGainControl');\n        remap(c.audio, 'noiseSuppression', 'mozNoiseSuppression');\n      }\n      return nativeGetUserMedia(c);\n    };\n\n    if (MediaStreamTrack && MediaStreamTrack.prototype.getSettings) {\n      var nativeGetSettings = MediaStreamTrack.prototype.getSettings;\n      MediaStreamTrack.prototype.getSettings = function() {\n        var obj = nativeGetSettings.apply(this, arguments);\n        remap(obj, 'mozAutoGainControl', 'autoGainControl');\n        remap(obj, 'mozNoiseSuppression', 'noiseSuppression');\n        return obj;\n      };\n    }\n\n    if (MediaStreamTrack && MediaStreamTrack.prototype.applyConstraints) {\n      var nativeApplyConstraints = MediaStreamTrack.prototype.applyConstraints;\n      MediaStreamTrack.prototype.applyConstraints = function(c) {\n        if (this.kind === 'audio' && typeof c === 'object') {\n          c = JSON.parse(JSON.stringify(c));\n          remap(c, 'autoGainControl', 'mozAutoGainControl');\n          remap(c, 'noiseSuppression', 'mozNoiseSuppression');\n        }\n        return nativeApplyConstraints.apply(this, [c]);\n      };\n    }\n  }\n  navigator.getUserMedia = function(constraints, onSuccess, onError) {\n    if (browserDetails.version < 44) {\n      return getUserMedia_(constraints, onSuccess, onError);\n    }\n    // Replace Firefox 44+'s deprecation warning with unprefixed version.\n    utils.deprecated('navigator.getUserMedia',\n        'navigator.mediaDevices.getUserMedia');\n    navigator.mediaDevices.getUserMedia(constraints).then(onSuccess, onError);\n  };\n};\n\n},{\"../utils\":13}],12:[function(require,module,exports){\n/*\n *  Copyright (c) 2016 The WebRTC project authors. All Rights Reserved.\n *\n *  Use of this source code is governed by a BSD-style license\n *  that can be found in the LICENSE file in the root of the source\n *  tree.\n */\n'use strict';\nvar utils = require('../utils');\n\nmodule.exports = {\n  shimLocalStreamsAPI: function(window) {\n    if (typeof window !== 'object' || !window.RTCPeerConnection) {\n      return;\n    }\n    if (!('getLocalStreams' in window.RTCPeerConnection.prototype)) {\n      window.RTCPeerConnection.prototype.getLocalStreams = function() {\n        if (!this._localStreams) {\n          this._localStreams = [];\n        }\n        return this._localStreams;\n      };\n    }\n    if (!('getStreamById' in window.RTCPeerConnection.prototype)) {\n      window.RTCPeerConnection.prototype.getStreamById = function(id) {\n        var result = null;\n        if (this._localStreams) {\n          this._localStreams.forEach(function(stream) {\n            if (stream.id === id) {\n              result = stream;\n            }\n          });\n        }\n        if (this._remoteStreams) {\n          this._remoteStreams.forEach(function(stream) {\n            if (stream.id === id) {\n              result = stream;\n            }\n          });\n        }\n        return result;\n      };\n    }\n    if (!('addStream' in window.RTCPeerConnection.prototype)) {\n      var _addTrack = window.RTCPeerConnection.prototype.addTrack;\n      window.RTCPeerConnection.prototype.addStream = function(stream) {\n        if (!this._localStreams) {\n          this._localStreams = [];\n        }\n        if (this._localStreams.indexOf(stream) === -1) {\n          this._localStreams.push(stream);\n        }\n        var pc = this;\n        stream.getTracks().forEach(function(track) {\n          _addTrack.call(pc, track, stream);\n        });\n      };\n\n      window.RTCPeerConnection.prototype.addTrack = function(track, stream) {\n        if (stream) {\n          if (!this._localStreams) {\n            this._localStreams = [stream];\n          } else if (this._localStreams.indexOf(stream) === -1) {\n            this._localStreams.push(stream);\n          }\n        }\n        return _addTrack.call(this, track, stream);\n      };\n    }\n    if (!('removeStream' in window.RTCPeerConnection.prototype)) {\n      window.RTCPeerConnection.prototype.removeStream = function(stream) {\n        if (!this._localStreams) {\n          this._localStreams = [];\n        }\n        var index = this._localStreams.indexOf(stream);\n        if (index === -1) {\n          return;\n        }\n        this._localStreams.splice(index, 1);\n        var pc = this;\n        var tracks = stream.getTracks();\n        this.getSenders().forEach(function(sender) {\n          if (tracks.indexOf(sender.track) !== -1) {\n            pc.removeTrack(sender);\n          }\n        });\n      };\n    }\n  },\n  shimRemoteStreamsAPI: function(window) {\n    if (typeof window !== 'object' || !window.RTCPeerConnection) {\n      return;\n    }\n    if (!('getRemoteStreams' in window.RTCPeerConnection.prototype)) {\n      window.RTCPeerConnection.prototype.getRemoteStreams = function() {\n        return this._remoteStreams ? this._remoteStreams : [];\n      };\n    }\n    if (!('onaddstream' in window.RTCPeerConnection.prototype)) {\n      Object.defineProperty(window.RTCPeerConnection.prototype, 'onaddstream', {\n        get: function() {\n          return this._onaddstream;\n        },\n        set: function(f) {\n          if (this._onaddstream) {\n            this.removeEventListener('addstream', this._onaddstream);\n            this.removeEventListener('track', this._onaddstreampoly);\n          }\n          this.addEventListener('addstream', this._onaddstream = f);\n          this.addEventListener('track', this._onaddstreampoly = function(e) {\n            var stream = e.streams[0];\n            if (!this._remoteStreams) {\n              this._remoteStreams = [];\n            }\n            if (this._remoteStreams.indexOf(stream) >= 0) {\n              return;\n            }\n            this._remoteStreams.push(stream);\n            var event = new Event('addstream');\n            event.stream = e.streams[0];\n            this.dispatchEvent(event);\n          }.bind(this));\n        }\n      });\n    }\n  },\n  shimCallbacksAPI: function(window) {\n    if (typeof window !== 'object' || !window.RTCPeerConnection) {\n      return;\n    }\n    var prototype = window.RTCPeerConnection.prototype;\n    var createOffer = prototype.createOffer;\n    var createAnswer = prototype.createAnswer;\n    var setLocalDescription = prototype.setLocalDescription;\n    var setRemoteDescription = prototype.setRemoteDescription;\n    var addIceCandidate = prototype.addIceCandidate;\n\n    prototype.createOffer = function(successCallback, failureCallback) {\n      var options = (arguments.length >= 2) ? arguments[2] : arguments[0];\n      var promise = createOffer.apply(this, [options]);\n      if (!failureCallback) {\n        return promise;\n      }\n      promise.then(successCallback, failureCallback);\n      return Promise.resolve();\n    };\n\n    prototype.createAnswer = function(successCallback, failureCallback) {\n      var options = (arguments.length >= 2) ? arguments[2] : arguments[0];\n      var promise = createAnswer.apply(this, [options]);\n      if (!failureCallback) {\n        return promise;\n      }\n      promise.then(successCallback, failureCallback);\n      return Promise.resolve();\n    };\n\n    var withCallback = function(description, successCallback, failureCallback) {\n      var promise = setLocalDescription.apply(this, [description]);\n      if (!failureCallback) {\n        return promise;\n      }\n      promise.then(successCallback, failureCallback);\n      return Promise.resolve();\n    };\n    prototype.setLocalDescription = withCallback;\n\n    withCallback = function(description, successCallback, failureCallback) {\n      var promise = setRemoteDescription.apply(this, [description]);\n      if (!failureCallback) {\n        return promise;\n      }\n      promise.then(successCallback, failureCallback);\n      return Promise.resolve();\n    };\n    prototype.setRemoteDescription = withCallback;\n\n    withCallback = function(candidate, successCallback, failureCallback) {\n      var promise = addIceCandidate.apply(this, [candidate]);\n      if (!failureCallback) {\n        return promise;\n      }\n      promise.then(successCallback, failureCallback);\n      return Promise.resolve();\n    };\n    prototype.addIceCandidate = withCallback;\n  },\n  shimGetUserMedia: function(window) {\n    var navigator = window && window.navigator;\n\n    if (!navigator.getUserMedia) {\n      if (navigator.webkitGetUserMedia) {\n        navigator.getUserMedia = navigator.webkitGetUserMedia.bind(navigator);\n      } else if (navigator.mediaDevices &&\n          navigator.mediaDevices.getUserMedia) {\n        navigator.getUserMedia = function(constraints, cb, errcb) {\n          navigator.mediaDevices.getUserMedia(constraints)\n          .then(cb, errcb);\n        }.bind(navigator);\n      }\n    }\n  },\n  shimRTCIceServerUrls: function(window) {\n    // migrate from non-spec RTCIceServer.url to RTCIceServer.urls\n    var OrigPeerConnection = window.RTCPeerConnection;\n    window.RTCPeerConnection = function(pcConfig, pcConstraints) {\n      if (pcConfig && pcConfig.iceServers) {\n        var newIceServers = [];\n        for (var i = 0; i < pcConfig.iceServers.length; i++) {\n          var server = pcConfig.iceServers[i];\n          if (!server.hasOwnProperty('urls') &&\n              server.hasOwnProperty('url')) {\n            utils.deprecated('RTCIceServer.url', 'RTCIceServer.urls');\n            server = JSON.parse(JSON.stringify(server));\n            server.urls = server.url;\n            delete server.url;\n            newIceServers.push(server);\n          } else {\n            newIceServers.push(pcConfig.iceServers[i]);\n          }\n        }\n        pcConfig.iceServers = newIceServers;\n      }\n      return new OrigPeerConnection(pcConfig, pcConstraints);\n    };\n    window.RTCPeerConnection.prototype = OrigPeerConnection.prototype;\n    // wrap static methods. Currently just generateCertificate.\n    if ('generateCertificate' in window.RTCPeerConnection) {\n      Object.defineProperty(window.RTCPeerConnection, 'generateCertificate', {\n        get: function() {\n          return OrigPeerConnection.generateCertificate;\n        }\n      });\n    }\n  },\n  shimTrackEventTransceiver: function(window) {\n    // Add event.transceiver member over deprecated event.receiver\n    if (typeof window === 'object' && window.RTCPeerConnection &&\n        ('receiver' in window.RTCTrackEvent.prototype) &&\n        // can't check 'transceiver' in window.RTCTrackEvent.prototype, as it is\n        // defined for some reason even when window.RTCTransceiver is not.\n        !window.RTCTransceiver) {\n      Object.defineProperty(window.RTCTrackEvent.prototype, 'transceiver', {\n        get: function() {\n          return {receiver: this.receiver};\n        }\n      });\n    }\n  },\n\n  shimCreateOfferLegacy: function(window) {\n    var origCreateOffer = window.RTCPeerConnection.prototype.createOffer;\n    window.RTCPeerConnection.prototype.createOffer = function(offerOptions) {\n      var pc = this;\n      if (offerOptions) {\n        var audioTransceiver = pc.getTransceivers().find(function(transceiver) {\n          return transceiver.sender.track &&\n              transceiver.sender.track.kind === 'audio';\n        });\n        if (offerOptions.offerToReceiveAudio === false && audioTransceiver) {\n          if (audioTransceiver.direction === 'sendrecv') {\n            audioTransceiver.setDirection('sendonly');\n          } else if (audioTransceiver.direction === 'recvonly') {\n            audioTransceiver.setDirection('inactive');\n          }\n        } else if (offerOptions.offerToReceiveAudio === true &&\n            !audioTransceiver) {\n          pc.addTransceiver('audio');\n        }\n\n        var videoTransceiver = pc.getTransceivers().find(function(transceiver) {\n          return transceiver.sender.track &&\n              transceiver.sender.track.kind === 'video';\n        });\n        if (offerOptions.offerToReceiveVideo === false && videoTransceiver) {\n          if (videoTransceiver.direction === 'sendrecv') {\n            videoTransceiver.setDirection('sendonly');\n          } else if (videoTransceiver.direction === 'recvonly') {\n            videoTransceiver.setDirection('inactive');\n          }\n        } else if (offerOptions.offerToReceiveVideo === true &&\n            !videoTransceiver) {\n          pc.addTransceiver('video');\n        }\n      }\n      return origCreateOffer.apply(pc, arguments);\n    };\n  }\n};\n\n},{\"../utils\":13}],13:[function(require,module,exports){\n/*\n *  Copyright (c) 2016 The WebRTC project authors. All Rights Reserved.\n *\n *  Use of this source code is governed by a BSD-style license\n *  that can be found in the LICENSE file in the root of the source\n *  tree.\n */\n /* eslint-env node */\n'use strict';\n\nvar logDisabled_ = true;\nvar deprecationWarnings_ = true;\n\n/**\n * Extract browser version out of the provided user agent string.\n *\n * @param {!string} uastring userAgent string.\n * @param {!string} expr Regular expression used as match criteria.\n * @param {!number} pos position in the version string to be returned.\n * @return {!number} browser version.\n */\nfunction extractVersion(uastring, expr, pos) {\n  var match = uastring.match(expr);\n  return match && match.length >= pos && parseInt(match[pos], 10);\n}\n\n// Utility methods.\nmodule.exports = {\n  extractVersion: extractVersion,\n  disableLog: function(bool) {\n    if (typeof bool !== 'boolean') {\n      return new Error('Argument type: ' + typeof bool +\n          '. Please use a boolean.');\n    }\n    logDisabled_ = bool;\n    return (bool) ? 'adapter.js logging disabled' :\n        'adapter.js logging enabled';\n  },\n\n  /**\n   * Disable or enable deprecation warnings\n   * @param {!boolean} bool set to true to disable warnings.\n   */\n  disableWarnings: function(bool) {\n    if (typeof bool !== 'boolean') {\n      return new Error('Argument type: ' + typeof bool +\n          '. Please use a boolean.');\n    }\n    deprecationWarnings_ = !bool;\n    return 'adapter.js deprecation warnings ' + (bool ? 'disabled' : 'enabled');\n  },\n\n  log: function() {\n    if (typeof window === 'object') {\n      if (logDisabled_) {\n        return;\n      }\n      if (typeof console !== 'undefined' && typeof console.log === 'function') {\n        console.log.apply(console, arguments);\n      }\n    }\n  },\n\n  /**\n   * Shows a deprecation warning suggesting the modern and spec-compatible API.\n   */\n  deprecated: function(oldMethod, newMethod) {\n    if (!deprecationWarnings_) {\n      return;\n    }\n    console.warn(oldMethod + ' is deprecated, please use ' + newMethod +\n        ' instead.');\n  },\n\n  /**\n   * Browser detector.\n   *\n   * @return {object} result containing browser and version\n   *     properties.\n   */\n  detectBrowser: function(window) {\n    var navigator = window && window.navigator;\n\n    // Returned result object.\n    var result = {};\n    result.browser = null;\n    result.version = null;\n\n    // Fail early if it's not a browser\n    if (typeof window === 'undefined' || !window.navigator) {\n      result.browser = 'Not a browser.';\n      return result;\n    }\n\n    // Firefox.\n    if (navigator.mozGetUserMedia) {\n      result.browser = 'firefox';\n      result.version = extractVersion(navigator.userAgent,\n          /Firefox\\/(\\d+)\\./, 1);\n    } else if (navigator.webkitGetUserMedia) {\n      // Chrome, Chromium, Webview, Opera, all use the chrome shim for now\n      if (window.webkitRTCPeerConnection) {\n        result.browser = 'chrome';\n        result.version = extractVersion(navigator.userAgent,\n          /Chrom(e|ium)\\/(\\d+)\\./, 2);\n      } else { // Safari (in an unpublished version) or unknown webkit-based.\n        if (navigator.userAgent.match(/Version\\/(\\d+).(\\d+)/)) {\n          result.browser = 'safari';\n          result.version = extractVersion(navigator.userAgent,\n            /AppleWebKit\\/(\\d+)\\./, 1);\n        } else { // unknown webkit-based browser.\n          result.browser = 'Unsupported webkit-based browser ' +\n              'with GUM support but no WebRTC support.';\n          return result;\n        }\n      }\n    } else if (navigator.mediaDevices &&\n        navigator.userAgent.match(/Edge\\/(\\d+).(\\d+)$/)) { // Edge.\n      result.browser = 'edge';\n      result.version = extractVersion(navigator.userAgent,\n          /Edge\\/(\\d+).(\\d+)$/, 2);\n    } else if (navigator.mediaDevices &&\n        navigator.userAgent.match(/AppleWebKit\\/(\\d+)\\./)) {\n        // Safari, with webkitGetUserMedia removed.\n      result.browser = 'safari';\n      result.version = extractVersion(navigator.userAgent,\n          /AppleWebKit\\/(\\d+)\\./, 1);\n    } else { // Default fallthrough: not supported.\n      result.browser = 'Not a supported browser.';\n      return result;\n    }\n\n    return result;\n  }\n};\n\n},{}]},{},[3]);\n\n\n\n// WEBPACK FOOTER //\n// ./node_modules/webrtc-adapter/out/adapter_no_global.js","var g;\r\n\r\n// This works in non-strict mode\r\ng = (function() {\r\n\treturn this;\r\n})();\r\n\r\ntry {\r\n\t// This works if eval is allowed (see CSP)\r\n\tg = g || Function(\"return this\")() || (1,eval)(\"this\");\r\n} catch(e) {\r\n\t// This works if the window reference is available\r\n\tif(typeof window === \"object\")\r\n\t\tg = window;\r\n}\r\n\r\n// g can still be undefined, but nothing to do about it...\r\n// We return undefined, instead of nothing here, so it's\r\n// easier to handle this case. if(!global) { ...}\r\n\r\nmodule.exports = g;\r\n\n\n\n// WEBPACK FOOTER //\n// (webpack)/buildin/global.js","import initializeCamera from './mediaDevice';\nimport ButtonCameraPermission from './components/ButtonCameraPermission';\n// initializeCamera();\n\n\n\n// WEBPACK FOOTER //\n// ./src/index.js","import Component from '../Component';\nimport CameraScreen from './CameraScreen';\n\nconst ButtonCameraPermission = new Component('ButtonCameraPermission', {\n  permitted: false\n});\n\nButtonCameraPermission.on('click', function(evt) {\n  CameraScreen.setState({show: true});\n})\n\nButtonCameraPermission.render((state) => {\n  console.log(state.permitted);\n\n})\n\nexport default ButtonCameraPermission;\n\n\n\n// WEBPACK FOOTER //\n// ./src/components/ButtonCameraPermission.js","import Component from '../Component';\nimport {hasMediaDeviceAPI, startingCamera} from '../mediaDevice';\n\nconst CameraScreen = new Component('CameraScreen', {\n  show: false\n})\n\nCameraScreen.render((state) => {\n  if (CameraScreen.getState().show) {\n    if (hasMediaDeviceAPI()) {\n      startingCamera(CameraScreen.dom)\n        .then(() => CameraScreen.addClass('camera__screen--show'))\n    }\n\n  } else {\n    CameraScreen.removeClass('camera__screen--show');\n  }\n})\n\nexport default CameraScreen;\n\n\n\n// WEBPACK FOOTER //\n// ./src/components/CameraScreen.js"],"sourceRoot":""}