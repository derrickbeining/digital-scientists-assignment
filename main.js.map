{"version":3,"sources":["webpack:///webpack/bootstrap 49078380b96a8f4b7e45","webpack:///./src/Component.js","webpack:///./src/components/CameraScreen.js","webpack:///./src/mediaDevice.js","webpack:///./src/index.js","webpack:///./node_modules/webrtc-adapter/out/adapter.js","webpack:///(webpack)/buildin/global.js","webpack:///./src/components/Error.js","webpack:///./src/components/ButtonCameraPower.js","webpack:///./src/components/ButtonCameraFacing.js","webpack:///./src/components/Canvas.js","webpack:///./src/components/ButtonCameraCapture.js"],"names":["merge","one","two","Object","assign","Component","id","defaultState","state","getState","setState","arg","renderer","dom","document","getElementById","noop","classname","classList","add","remove","toggle","event","eventHandler","options","addEventListener","fn","CameraScreen","show","facingMode","render","then","addClass","catch","message","err","name","removeClass","hasMediaDeviceAPI","startingCamera","stopCamera","Boolean","navigator","mediaDevices","getUserMedia","isMobileDevice","userAgent","search","generateConstraints","supportedConstraints","getSupportedConstraints","constraints","width","offsetWidth","height","aspectRatio","hasOwnProperty","video","srcObject","mediaStream","play","f","exports","module","define","g","window","global","self","adapter","e","t","n","r","s","o","u","a","require","i","Error","code","l","call","length","SDPUtils","writeMediaSection","transceiver","caps","type","stream","dtlsRole","sdp","writeRtpDescription","kind","writeIceParameters","iceGatherer","getLocalParameters","writeDtlsParameters","dtlsTransport","mid","rtpSender","rtpReceiver","msid","track","sendEncodingParameters","ssrc","rtx","localCName","filterIceServers","iceServers","edgeVersion","hasTurn","JSON","parse","stringify","filter","server","urls","url","console","warn","isString","validTurn","indexOf","getCommonCapabilities","localCapabilities","remoteCapabilities","commonCapabilities","codecs","headerExtensions","fecMechanisms","findCodecByPayloadType","pt","parseInt","payloadType","preferredPayloadType","rtxCapabilityMatches","lRtx","rRtx","lCodecs","rCodecs","lCodec","parameters","apt","rCodec","toLowerCase","forEach","clockRate","numChannels","Math","min","push","rtcpFeedback","fb","j","parameter","lHeaderExtension","rHeaderExtension","uri","isActionAllowedInSignalingState","action","signalingState","offer","setLocalDescription","setRemoteDescription","answer","maybeAddCandidate","iceTransport","candidate","alreadyAdded","getRemoteCandidates","find","remoteCandidate","foundation","ip","port","priority","protocol","addRemoteCandidate","addTrackToStreamAndFireEvent","addTrack","Event","dispatchEvent","removeTrackFromStreamAndFireEvent","removeTrack","fireAddTrack","pc","receiver","streams","trackEvent","setTimeout","_dispatchEvent","makeError","description","RTCPeerConnection","config","_eventTarget","createDocumentFragment","method","bind","canTrickleIceCandidates","needNegotiation","localStreams","remoteStreams","localDescription","remoteDescription","iceConnectionState","iceGatheringState","usingBundle","bundlePolicy","rtcpMuxPolicy","iceTransportPolicy","_iceGatherers","iceCandidatePoolSize","RTCIceGatherer","gatherPolicy","_config","transceivers","_sdpSessionId","generateSessionId","_sdpSessionVersion","_dtlsRole","undefined","_isClosed","prototype","onicecandidate","onaddstream","ontrack","onremovestream","onsignalingstatechange","oniceconnectionstatechange","onicegatheringstatechange","onnegotiationneeded","ondatachannel","_emitGatheringStateChange","getConfiguration","getLocalStreams","getRemoteStreams","_createTransceiver","hasBundleTransport","recvEncodingParameters","associatedRemoteMediaStreams","wantReceive","transports","_createIceAndDtlsTransports","alreadyExists","_maybeFireNegotiationNeeded","RTCRtpSender","addStream","getTracks","clonedStream","clone","idx","clonedTrack","enabled","sender","TypeError","stop","map","splice","removeStream","getSenders","getReceivers","_createIceGatherer","sdpMLineIndex","shift","defineProperty","value","writable","candidates","bufferCandidates","end","keys","_gather","onlocalcandidate","removeEventListener","evt","sdpMid","cand","component","writeCandidate","sections","splitSections","join","complete","every","RTCIceTransport","onicestatechange","_updateConnectionState","RTCDtlsTransport","ondtlsstatechange","onerror","_disposeIceAndDtlsTransports","_transceive","send","recv","params","encodings","rtcp","cname","compound","rtcpParameters","p","receive","Promise","reject","sessionpart","mediaSection","parseRtpParameters","isIceLite","matchPrefix","rejected","isRejected","isDatachannel","remoteIceParameters","getIceParameters","remoteDtlsParameters","getDtlsParameters","role","start","_updateSignalingState","resolve","receiverList","iceOptions","substr","split","lines","splitLines","getKind","direction","getDirection","remoteMsid","parseMsid","getMid","generateIdentifier","parseRtpEncodingParameters","parseRtcpParameters","isComplete","cands","parseCandidate","setTransport","setRemoteCandidates","RTCRtpReceiver","getCapabilities","codec","isNewTrack","MediaStream","get","default","nativeTrack","sid","item","close","newState","states","closed","connecting","checking","connected","completed","disconnected","failed","new","createOffer","numAudioTracks","numVideoTracks","offerOptions","arguments","mandatory","optional","offerToReceiveAudio","offerToReceiveVideo","writeSessionBoilerplate","getLocalCandidates","desc","RTCSessionDescription","createAnswer","mediaSectionsInOffer","localTrack","getAudioTracks","getVideoTracks","hasRtx","c","reducedSize","addIceCandidate","candidateString","trim","getStats","promises","fixStatsType","stat","inboundrtp","outboundrtp","candidatepair","localcandidate","remotecandidate","results","Map","all","res","result","set","methods","nativeMethod","args","apply","error","random","toString","blob","line","parts","part","index","prefix","substring","relatedAddress","relatedPort","tcpType","ufrag","usernameFragment","toUpperCase","parseIceOptions","parseRtpMap","parsed","writeRtpMap","parseExtmap","writeExtmap","headerExtension","preferredId","parseFmtp","kv","writeFmtp","param","parseRtcpFb","writeRtcpFb","parseSsrcMedia","sp","colon","attribute","parseFingerprint","algorithm","fingerprints","setupType","fp","concat","iceParameters","password","mline","rtpmapline","fmtps","maxptime","extension","encodingParameters","hasRed","hasUlpfec","ssrcs","primarySsrc","secondarySsrc","flows","encParam","codecPayloadType","fec","mechanism","bandwidth","maxBitrate","remoteSsrc","obj","rsize","mux","spec","planB","sessId","sessVer","sessionId","version","parseMLine","fmt","slice","adapterFactory","utils","dependencies","opts","shimChrome","shimFirefox","shimEdge","shimSafari","key","logging","log","browserDetails","detectBrowser","extractVersion","disableLog","disableWarnings","chromeShim","edgeShim","firefoxShim","safariShim","commonShim","browser","shimPeerConnection","browserShim","shimCreateObjectURL","shimGetUserMedia","shimMediaStream","shimSourceObject","shimOnTrack","shimAddTrackRemoveTrack","shimGetSendersWithDtmf","shimRTCIceCandidate","shimRemoveStream","shimReplaceTrack","shimRTCIceServerUrls","shimCallbacksAPI","shimLocalStreamsAPI","shimRemoteStreamsAPI","shimTrackEventTransceiver","shimCreateOfferLegacy","webkitMediaStream","_ontrack","origSetRemoteDescription","_ontrackpoly","te","shimSenderWithDtmf","dtmf","_dtmf","createDTMFSender","_pc","_senders","origAddTrack","origRemoveTrack","origAddStream","origRemoveStream","origGetSenders","senders","URL","HTMLMediaElement","_srcObject","src","revokeObjectURL","createObjectURL","shimAddTrackRemoveTrackWithNative","_shimmedLocalStreams","streamId","DOMException","existingSenders","newSenders","newSender","origGetLocalStreams","nativeStreams","_reverseStreams","_streams","newStream","oldStream","replaceInternalStreamId","internalId","externalStream","internalStream","replace","RegExp","replaceExternalStreamId","isLegacyCall","origSetLocalDescription","origLocalDescription","getOwnPropertyDescriptor","isLocal","streamid","hasTrack","pcConfig","pcConstraints","iceTransports","webkitRTCPeerConnection","generateCertificate","OrigPeerConnection","newIceServers","deprecated","origGetStats","selector","successCallback","errorCallback","fixChromeStats_","response","standardReport","reports","report","standardStats","timestamp","names","makeMapStats","stats","successCallbackWrapper_","promise","RTCIceCandidate","nativeAddIceCandidate","constraintsToChrome_","cc","ideal","exact","max","oldname_","charAt","oc","mix","advanced","shimConstraints_","func","audio","remap","b","face","getSupportedFacingModeLies","matches","enumerateDevices","devices","d","dev","some","match","label","deviceId","shimError_","PermissionDeniedError","InvalidStateError","DevicesNotFoundError","ConstraintNotSatisfiedError","TrackStartError","MediaDeviceFailedDueToShutdown","MediaDeviceKillSwitchOn","constraint","constraintName","getUserMedia_","onSuccess","onError","webkitGetUserMedia","getUserMediaPromise_","kinds","MediaStreamTrack","getSources","device","groupId","echoCancellation","frameRate","origGetUserMedia","cs","wrapPeerConnectionEvent","eventNameToWrap","wrapper","proto","nativeAddEventListener","nativeEventName","cb","wrappedCallback","_eventMap","nativeRemoveEventListener","unwrappedCb","NativeRTCIceCandidate","nativeCandidate","parsedCandidate","augmentedCandidate","toJSON","nativeCreateObjectURL","nativeRevokeObjectURL","newId","delete","dsc","nativeSetAttribute","setAttribute","shimRTCPeerConnection","origMSTEnabled","ev","RTCDtmfSender","replaceTrack","setTrack","RTCTrackEvent","mozSrcObject","mozRTCPeerConnection","newServer","username","credential","mozRTCSessionDescription","mozRTCIceCandidate","modernStatsTypes","nativeGetStats","onSucc","onErr","InternalError","NotSupportedError","SecurityError","constraintsToFF37_","mozGetUserMedia","infos","orgEnumerateDevices","nativeGetUserMedia","getSettings","nativeGetSettings","applyConstraints","nativeApplyConstraints","_localStreams","getStreamById","_remoteStreams","_addTrack","tracks","_onaddstream","_onaddstreampoly","failureCallback","withCallback","errcb","RTCTransceiver","origCreateOffer","audioTransceiver","getTransceivers","setDirection","addTransceiver","videoTransceiver","logDisabled_","deprecationWarnings_","uastring","expr","pos","bool","oldMethod","newMethod","Function","eval","textContent","ButtonCameraPower","on","ButtonCameraFacing","Canvas","clearPhoto","ctx","getContext","fillStyle","fillRect","takePicture","cameraScreen","offsetHeight","drawImage","toBlob","fulfillWith","ButtonCameraCapture","sendImageForAnalysis","imageData","headers","Headers","append","fetch","mode","cache","body","image","json","data","labelAnnotations","speakResult","utterance","SpeechSynthesisUtterance","speechSynthesis","speak","fileReader","FileReader","readAsDataURL","imageBlob"],"mappings":"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","file":"main.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, {\n \t\t\t\tconfigurable: false,\n \t\t\t\tenumerable: true,\n \t\t\t\tget: getter\n \t\t\t});\n \t\t}\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 3);\n\n\n\n// WEBPACK FOOTER //\n// webpack/bootstrap 49078380b96a8f4b7e45","\nfunction merge(one, two) {\n  return Object.assign({}, one, two);\n}\n\nexport default class Component {\n\n  constructor(id, defaultState = {}) {\n\n    let state = defaultState;\n\n    const getState = () => state;\n\n    const setState = arg => {\n      if (typeof arg === 'function') {\n        setState(arg(getState()));\n      } else {\n        state = merge(state, arg);\n        this.renderer(getState())\n      }\n    }\n\n    this.dom = document.getElementById(id);\n    this.getState = getState;\n    this.setState = setState;\n    this.renderer = function noop() { };\n  }\n\n  addClass(classname) {\n    this.dom.classList.add(classname);\n  }\n\n  removeClass(classname) {\n    this.dom.classList.remove(classname);\n  }\n\n  toggleClass(classname) {\n    this.dom.classList.toggle(classname);\n  }\n\n  on(event, eventHandler, options = false) {\n    return this.dom.addEventListener(event, eventHandler, options);\n  }\n\n  render(fn) {\n    this.renderer = fn;\n    fn(this.getState());\n  }\n\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/Component.js","import Component from '../Component';\nimport Error from './Error';\nimport {hasMediaDeviceAPI, startingCamera, stopCamera} from '../mediaDevice';\n\nconst CameraScreen = new Component('CameraScreen', {\n  show: false,\n  facingMode: 'environment'\n})\n\nCameraScreen.render((state) => {\n  const {show, facingMode} = state;\n  if (hasMediaDeviceAPI()) {\n\n    if (show) {\n      startingCamera(CameraScreen.dom, facingMode)\n        .then(() => CameraScreen.addClass('camera__screen--show'))\n        .catch(err => Error.setState({message: `${err.name}: \\n${err.message}`}))\n    }\n\n    else {\n      stopCamera(CameraScreen.dom);\n      CameraScreen.removeClass('camera__screen--show');\n    }\n  }\n})\n\nexport default CameraScreen;\n\n\n\n// WEBPACK FOOTER //\n// ./src/components/CameraScreen.js","import CameraScreen from './components/CameraScreen';\n\nexport function hasMediaDeviceAPI () {\n  return Boolean(navigator.mediaDevices)\n    && Boolean(navigator.mediaDevices.getUserMedia);\n}\n\nfunction isMobileDevice () {\n  return navigator.userAgent.search(/mobi/i) !== -1;\n}\n\nfunction generateConstraints(facingMode = 'environment') {\n  const supportedConstraints = navigator.mediaDevices.getSupportedConstraints();\n  const constraints = {\n    width: CameraScreen.dom.offsetWidth,\n    height: CameraScreen.dom.offsetWidth,\n    aspectRatio: 1\n  }\n\n  if (isMobileDevice() && supportedConstraints.hasOwnProperty('facingMode')) {\n    constraints.video = { facingMode: facingMode };\n  } else {\n    constraints.video = true;\n  }\n\n  return constraints;\n}\n\nexport function startingCamera (video, facingMode = 'environment') {\n  return navigator.mediaDevices\n    .getUserMedia(generateConstraints(facingMode))\n    .then(mediaStream => {\n      video.srcObject = mediaStream;\n      video.play();\n    })\n}\n\nexport function stopCamera (video) {\n  video.srcObject = null;\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/mediaDevice.js","import 'webrtc-adapter/out/adapter';\n\nimport ButtonCameraPower from './components/ButtonCameraPower';\nimport ButtonCameraFacing from './components/ButtonCameraFacing';\nimport ButtonCameraCapture from './components/ButtonCameraCapture';\nimport Canvas from './components/Canvas';\n\n\n\n// WEBPACK FOOTER //\n// ./src/index.js","(function(f){if(typeof exports===\"object\"&&typeof module!==\"undefined\"){module.exports=f()}else if(typeof define===\"function\"&&define.amd){define([],f)}else{var g;if(typeof window!==\"undefined\"){g=window}else if(typeof global!==\"undefined\"){g=global}else if(typeof self!==\"undefined\"){g=self}else{g=this}g.adapter = f()}})(function(){var define,module,exports;return (function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require==\"function\"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error(\"Cannot find module '\"+o+\"'\");throw f.code=\"MODULE_NOT_FOUND\",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require==\"function\"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){\n/*\n *  Copyright (c) 2017 The WebRTC project authors. All Rights Reserved.\n *\n *  Use of this source code is governed by a BSD-style license\n *  that can be found in the LICENSE file in the root of the source\n *  tree.\n */\n /* eslint-env node */\n'use strict';\n\nvar SDPUtils = require('sdp');\n\nfunction writeMediaSection(transceiver, caps, type, stream, dtlsRole) {\n  var sdp = SDPUtils.writeRtpDescription(transceiver.kind, caps);\n\n  // Map ICE parameters (ufrag, pwd) to SDP.\n  sdp += SDPUtils.writeIceParameters(\n      transceiver.iceGatherer.getLocalParameters());\n\n  // Map DTLS parameters to SDP.\n  sdp += SDPUtils.writeDtlsParameters(\n      transceiver.dtlsTransport.getLocalParameters(),\n      type === 'offer' ? 'actpass' : dtlsRole || 'active');\n\n  sdp += 'a=mid:' + transceiver.mid + '\\r\\n';\n\n  if (transceiver.rtpSender && transceiver.rtpReceiver) {\n    sdp += 'a=sendrecv\\r\\n';\n  } else if (transceiver.rtpSender) {\n    sdp += 'a=sendonly\\r\\n';\n  } else if (transceiver.rtpReceiver) {\n    sdp += 'a=recvonly\\r\\n';\n  } else {\n    sdp += 'a=inactive\\r\\n';\n  }\n\n  if (transceiver.rtpSender) {\n    // spec.\n    var msid = 'msid:' + stream.id + ' ' +\n        transceiver.rtpSender.track.id + '\\r\\n';\n    sdp += 'a=' + msid;\n\n    // for Chrome.\n    sdp += 'a=ssrc:' + transceiver.sendEncodingParameters[0].ssrc +\n        ' ' + msid;\n    if (transceiver.sendEncodingParameters[0].rtx) {\n      sdp += 'a=ssrc:' + transceiver.sendEncodingParameters[0].rtx.ssrc +\n          ' ' + msid;\n      sdp += 'a=ssrc-group:FID ' +\n          transceiver.sendEncodingParameters[0].ssrc + ' ' +\n          transceiver.sendEncodingParameters[0].rtx.ssrc +\n          '\\r\\n';\n    }\n  }\n  // FIXME: this should be written by writeRtpDescription.\n  sdp += 'a=ssrc:' + transceiver.sendEncodingParameters[0].ssrc +\n      ' cname:' + SDPUtils.localCName + '\\r\\n';\n  if (transceiver.rtpSender && transceiver.sendEncodingParameters[0].rtx) {\n    sdp += 'a=ssrc:' + transceiver.sendEncodingParameters[0].rtx.ssrc +\n        ' cname:' + SDPUtils.localCName + '\\r\\n';\n  }\n  return sdp;\n}\n\n// Edge does not like\n// 1) stun: filtered after 14393 unless ?transport=udp is present\n// 2) turn: that does not have all of turn:host:port?transport=udp\n// 3) turn: with ipv6 addresses\n// 4) turn: occurring muliple times\nfunction filterIceServers(iceServers, edgeVersion) {\n  var hasTurn = false;\n  iceServers = JSON.parse(JSON.stringify(iceServers));\n  return iceServers.filter(function(server) {\n    if (server && (server.urls || server.url)) {\n      var urls = server.urls || server.url;\n      if (server.url && !server.urls) {\n        console.warn('RTCIceServer.url is deprecated! Use urls instead.');\n      }\n      var isString = typeof urls === 'string';\n      if (isString) {\n        urls = [urls];\n      }\n      urls = urls.filter(function(url) {\n        var validTurn = url.indexOf('turn:') === 0 &&\n            url.indexOf('transport=udp') !== -1 &&\n            url.indexOf('turn:[') === -1 &&\n            !hasTurn;\n\n        if (validTurn) {\n          hasTurn = true;\n          return true;\n        }\n        return url.indexOf('stun:') === 0 && edgeVersion >= 14393 &&\n            url.indexOf('?transport=udp') === -1;\n      });\n\n      delete server.url;\n      server.urls = isString ? urls[0] : urls;\n      return !!urls.length;\n    }\n  });\n}\n\n// Determines the intersection of local and remote capabilities.\nfunction getCommonCapabilities(localCapabilities, remoteCapabilities) {\n  var commonCapabilities = {\n    codecs: [],\n    headerExtensions: [],\n    fecMechanisms: []\n  };\n\n  var findCodecByPayloadType = function(pt, codecs) {\n    pt = parseInt(pt, 10);\n    for (var i = 0; i < codecs.length; i++) {\n      if (codecs[i].payloadType === pt ||\n          codecs[i].preferredPayloadType === pt) {\n        return codecs[i];\n      }\n    }\n  };\n\n  var rtxCapabilityMatches = function(lRtx, rRtx, lCodecs, rCodecs) {\n    var lCodec = findCodecByPayloadType(lRtx.parameters.apt, lCodecs);\n    var rCodec = findCodecByPayloadType(rRtx.parameters.apt, rCodecs);\n    return lCodec && rCodec &&\n        lCodec.name.toLowerCase() === rCodec.name.toLowerCase();\n  };\n\n  localCapabilities.codecs.forEach(function(lCodec) {\n    for (var i = 0; i < remoteCapabilities.codecs.length; i++) {\n      var rCodec = remoteCapabilities.codecs[i];\n      if (lCodec.name.toLowerCase() === rCodec.name.toLowerCase() &&\n          lCodec.clockRate === rCodec.clockRate) {\n        if (lCodec.name.toLowerCase() === 'rtx' &&\n            lCodec.parameters && rCodec.parameters.apt) {\n          // for RTX we need to find the local rtx that has a apt\n          // which points to the same local codec as the remote one.\n          if (!rtxCapabilityMatches(lCodec, rCodec,\n              localCapabilities.codecs, remoteCapabilities.codecs)) {\n            continue;\n          }\n        }\n        rCodec = JSON.parse(JSON.stringify(rCodec)); // deepcopy\n        // number of channels is the highest common number of channels\n        rCodec.numChannels = Math.min(lCodec.numChannels,\n            rCodec.numChannels);\n        // push rCodec so we reply with offerer payload type\n        commonCapabilities.codecs.push(rCodec);\n\n        // determine common feedback mechanisms\n        rCodec.rtcpFeedback = rCodec.rtcpFeedback.filter(function(fb) {\n          for (var j = 0; j < lCodec.rtcpFeedback.length; j++) {\n            if (lCodec.rtcpFeedback[j].type === fb.type &&\n                lCodec.rtcpFeedback[j].parameter === fb.parameter) {\n              return true;\n            }\n          }\n          return false;\n        });\n        // FIXME: also need to determine .parameters\n        //  see https://github.com/openpeer/ortc/issues/569\n        break;\n      }\n    }\n  });\n\n  localCapabilities.headerExtensions.forEach(function(lHeaderExtension) {\n    for (var i = 0; i < remoteCapabilities.headerExtensions.length;\n         i++) {\n      var rHeaderExtension = remoteCapabilities.headerExtensions[i];\n      if (lHeaderExtension.uri === rHeaderExtension.uri) {\n        commonCapabilities.headerExtensions.push(rHeaderExtension);\n        break;\n      }\n    }\n  });\n\n  // FIXME: fecMechanisms\n  return commonCapabilities;\n}\n\n// is action=setLocalDescription with type allowed in signalingState\nfunction isActionAllowedInSignalingState(action, type, signalingState) {\n  return {\n    offer: {\n      setLocalDescription: ['stable', 'have-local-offer'],\n      setRemoteDescription: ['stable', 'have-remote-offer']\n    },\n    answer: {\n      setLocalDescription: ['have-remote-offer', 'have-local-pranswer'],\n      setRemoteDescription: ['have-local-offer', 'have-remote-pranswer']\n    }\n  }[type][action].indexOf(signalingState) !== -1;\n}\n\nfunction maybeAddCandidate(iceTransport, candidate) {\n  // Edge's internal representation adds some fields therefore\n  // not all field are taken into account.\n  var alreadyAdded = iceTransport.getRemoteCandidates()\n      .find(function(remoteCandidate) {\n        return candidate.foundation === remoteCandidate.foundation &&\n            candidate.ip === remoteCandidate.ip &&\n            candidate.port === remoteCandidate.port &&\n            candidate.priority === remoteCandidate.priority &&\n            candidate.protocol === remoteCandidate.protocol &&\n            candidate.type === remoteCandidate.type;\n      });\n  if (!alreadyAdded) {\n    iceTransport.addRemoteCandidate(candidate);\n  }\n  return !alreadyAdded;\n}\n\n\n// https://w3c.github.io/mediacapture-main/#mediastream\n// Helper function to add the track to the stream and\n// dispatch the event ourselves.\nfunction addTrackToStreamAndFireEvent(track, stream) {\n  stream.addTrack(track);\n  var e = new Event('addtrack'); // TODO: MediaStreamTrackEvent\n  e.track = track;\n  stream.dispatchEvent(e);\n}\n\nfunction removeTrackFromStreamAndFireEvent(track, stream) {\n  stream.removeTrack(track);\n  var e = new Event('removetrack'); // TODO: MediaStreamTrackEvent\n  e.track = track;\n  stream.dispatchEvent(e);\n}\n\nfunction fireAddTrack(pc, track, receiver, streams) {\n  var trackEvent = new Event('track');\n  trackEvent.track = track;\n  trackEvent.receiver = receiver;\n  trackEvent.transceiver = {receiver: receiver};\n  trackEvent.streams = streams;\n  window.setTimeout(function() {\n    pc._dispatchEvent('track', trackEvent);\n  });\n}\n\nfunction makeError(name, description) {\n  var e = new Error(description);\n  e.name = name;\n  return e;\n}\n\nmodule.exports = function(window, edgeVersion) {\n  var RTCPeerConnection = function(config) {\n    var pc = this;\n\n    var _eventTarget = document.createDocumentFragment();\n    ['addEventListener', 'removeEventListener', 'dispatchEvent']\n        .forEach(function(method) {\n          pc[method] = _eventTarget[method].bind(_eventTarget);\n        });\n\n    this.canTrickleIceCandidates = null;\n\n    this.needNegotiation = false;\n\n    this.localStreams = [];\n    this.remoteStreams = [];\n\n    this.localDescription = null;\n    this.remoteDescription = null;\n\n    this.signalingState = 'stable';\n    this.iceConnectionState = 'new';\n    this.iceGatheringState = 'new';\n\n    config = JSON.parse(JSON.stringify(config || {}));\n\n    this.usingBundle = config.bundlePolicy === 'max-bundle';\n    if (config.rtcpMuxPolicy === 'negotiate') {\n      throw(makeError('NotSupportedError',\n          'rtcpMuxPolicy \\'negotiate\\' is not supported'));\n    } else if (!config.rtcpMuxPolicy) {\n      config.rtcpMuxPolicy = 'require';\n    }\n\n    switch (config.iceTransportPolicy) {\n      case 'all':\n      case 'relay':\n        break;\n      default:\n        config.iceTransportPolicy = 'all';\n        break;\n    }\n\n    switch (config.bundlePolicy) {\n      case 'balanced':\n      case 'max-compat':\n      case 'max-bundle':\n        break;\n      default:\n        config.bundlePolicy = 'balanced';\n        break;\n    }\n\n    config.iceServers = filterIceServers(config.iceServers || [], edgeVersion);\n\n    this._iceGatherers = [];\n    if (config.iceCandidatePoolSize) {\n      for (var i = config.iceCandidatePoolSize; i > 0; i--) {\n        this._iceGatherers = new window.RTCIceGatherer({\n          iceServers: config.iceServers,\n          gatherPolicy: config.iceTransportPolicy\n        });\n      }\n    } else {\n      config.iceCandidatePoolSize = 0;\n    }\n\n    this._config = config;\n\n    // per-track iceGathers, iceTransports, dtlsTransports, rtpSenders, ...\n    // everything that is needed to describe a SDP m-line.\n    this.transceivers = [];\n\n    this._sdpSessionId = SDPUtils.generateSessionId();\n    this._sdpSessionVersion = 0;\n\n    this._dtlsRole = undefined; // role for a=setup to use in answers.\n\n    this._isClosed = false;\n  };\n\n  // set up event handlers on prototype\n  RTCPeerConnection.prototype.onicecandidate = null;\n  RTCPeerConnection.prototype.onaddstream = null;\n  RTCPeerConnection.prototype.ontrack = null;\n  RTCPeerConnection.prototype.onremovestream = null;\n  RTCPeerConnection.prototype.onsignalingstatechange = null;\n  RTCPeerConnection.prototype.oniceconnectionstatechange = null;\n  RTCPeerConnection.prototype.onicegatheringstatechange = null;\n  RTCPeerConnection.prototype.onnegotiationneeded = null;\n  RTCPeerConnection.prototype.ondatachannel = null;\n\n  RTCPeerConnection.prototype._dispatchEvent = function(name, event) {\n    if (this._isClosed) {\n      return;\n    }\n    this.dispatchEvent(event);\n    if (typeof this['on' + name] === 'function') {\n      this['on' + name](event);\n    }\n  };\n\n  RTCPeerConnection.prototype._emitGatheringStateChange = function() {\n    var event = new Event('icegatheringstatechange');\n    this._dispatchEvent('icegatheringstatechange', event);\n  };\n\n  RTCPeerConnection.prototype.getConfiguration = function() {\n    return this._config;\n  };\n\n  RTCPeerConnection.prototype.getLocalStreams = function() {\n    return this.localStreams;\n  };\n\n  RTCPeerConnection.prototype.getRemoteStreams = function() {\n    return this.remoteStreams;\n  };\n\n  // internal helper to create a transceiver object.\n  // (whih is not yet the same as the WebRTC 1.0 transceiver)\n  RTCPeerConnection.prototype._createTransceiver = function(kind) {\n    var hasBundleTransport = this.transceivers.length > 0;\n    var transceiver = {\n      track: null,\n      iceGatherer: null,\n      iceTransport: null,\n      dtlsTransport: null,\n      localCapabilities: null,\n      remoteCapabilities: null,\n      rtpSender: null,\n      rtpReceiver: null,\n      kind: kind,\n      mid: null,\n      sendEncodingParameters: null,\n      recvEncodingParameters: null,\n      stream: null,\n      associatedRemoteMediaStreams: [],\n      wantReceive: true\n    };\n    if (this.usingBundle && hasBundleTransport) {\n      transceiver.iceTransport = this.transceivers[0].iceTransport;\n      transceiver.dtlsTransport = this.transceivers[0].dtlsTransport;\n    } else {\n      var transports = this._createIceAndDtlsTransports();\n      transceiver.iceTransport = transports.iceTransport;\n      transceiver.dtlsTransport = transports.dtlsTransport;\n    }\n    this.transceivers.push(transceiver);\n    return transceiver;\n  };\n\n  RTCPeerConnection.prototype.addTrack = function(track, stream) {\n    var alreadyExists = this.transceivers.find(function(s) {\n      return s.track === track;\n    });\n\n    if (alreadyExists) {\n      throw makeError('InvalidAccessError', 'Track already exists.');\n    }\n\n    if (this.signalingState === 'closed') {\n      throw makeError('InvalidStateError',\n          'Attempted to call addTrack on a closed peerconnection.');\n    }\n\n    var transceiver;\n    for (var i = 0; i < this.transceivers.length; i++) {\n      if (!this.transceivers[i].track &&\n          this.transceivers[i].kind === track.kind) {\n        transceiver = this.transceivers[i];\n      }\n    }\n    if (!transceiver) {\n      transceiver = this._createTransceiver(track.kind);\n    }\n\n    this._maybeFireNegotiationNeeded();\n\n    if (this.localStreams.indexOf(stream) === -1) {\n      this.localStreams.push(stream);\n    }\n\n    transceiver.track = track;\n    transceiver.stream = stream;\n    transceiver.rtpSender = new window.RTCRtpSender(track,\n        transceiver.dtlsTransport);\n    return transceiver.rtpSender;\n  };\n\n  RTCPeerConnection.prototype.addStream = function(stream) {\n    var pc = this;\n    if (edgeVersion >= 15025) {\n      stream.getTracks().forEach(function(track) {\n        pc.addTrack(track, stream);\n      });\n    } else {\n      // Clone is necessary for local demos mostly, attaching directly\n      // to two different senders does not work (build 10547).\n      // Fixed in 15025 (or earlier)\n      var clonedStream = stream.clone();\n      stream.getTracks().forEach(function(track, idx) {\n        var clonedTrack = clonedStream.getTracks()[idx];\n        track.addEventListener('enabled', function(event) {\n          clonedTrack.enabled = event.enabled;\n        });\n      });\n      clonedStream.getTracks().forEach(function(track) {\n        pc.addTrack(track, clonedStream);\n      });\n    }\n  };\n\n  RTCPeerConnection.prototype.removeTrack = function(sender) {\n    if (!(sender instanceof window.RTCRtpSender)) {\n      throw new TypeError('Argument 1 of RTCPeerConnection.removeTrack ' +\n          'does not implement interface RTCRtpSender.');\n    }\n\n    var transceiver = this.transceivers.find(function(t) {\n      return t.rtpSender === sender;\n    });\n\n    if (!transceiver) {\n      throw makeError('InvalidAccessError',\n          'Sender was not created by this connection.');\n    }\n    var stream = transceiver.stream;\n\n    transceiver.rtpSender.stop();\n    transceiver.rtpSender = null;\n    transceiver.track = null;\n    transceiver.stream = null;\n\n    // remove the stream from the set of local streams\n    var localStreams = this.transceivers.map(function(t) {\n      return t.stream;\n    });\n    if (localStreams.indexOf(stream) === -1 &&\n        this.localStreams.indexOf(stream) > -1) {\n      this.localStreams.splice(this.localStreams.indexOf(stream), 1);\n    }\n\n    this._maybeFireNegotiationNeeded();\n  };\n\n  RTCPeerConnection.prototype.removeStream = function(stream) {\n    var pc = this;\n    stream.getTracks().forEach(function(track) {\n      var sender = pc.getSenders().find(function(s) {\n        return s.track === track;\n      });\n      if (sender) {\n        pc.removeTrack(sender);\n      }\n    });\n  };\n\n  RTCPeerConnection.prototype.getSenders = function() {\n    return this.transceivers.filter(function(transceiver) {\n      return !!transceiver.rtpSender;\n    })\n    .map(function(transceiver) {\n      return transceiver.rtpSender;\n    });\n  };\n\n  RTCPeerConnection.prototype.getReceivers = function() {\n    return this.transceivers.filter(function(transceiver) {\n      return !!transceiver.rtpReceiver;\n    })\n    .map(function(transceiver) {\n      return transceiver.rtpReceiver;\n    });\n  };\n\n\n  RTCPeerConnection.prototype._createIceGatherer = function(sdpMLineIndex,\n      usingBundle) {\n    var pc = this;\n    if (usingBundle && sdpMLineIndex > 0) {\n      return this.transceivers[0].iceGatherer;\n    } else if (this._iceGatherers.length) {\n      return this._iceGatherers.shift();\n    }\n    var iceGatherer = new window.RTCIceGatherer({\n      iceServers: this._config.iceServers,\n      gatherPolicy: this._config.iceTransportPolicy\n    });\n    Object.defineProperty(iceGatherer, 'state',\n        {value: 'new', writable: true}\n    );\n\n    this.transceivers[sdpMLineIndex].candidates = [];\n    this.transceivers[sdpMLineIndex].bufferCandidates = function(event) {\n      var end = !event.candidate || Object.keys(event.candidate).length === 0;\n      // polyfill since RTCIceGatherer.state is not implemented in\n      // Edge 10547 yet.\n      iceGatherer.state = end ? 'completed' : 'gathering';\n      if (pc.transceivers[sdpMLineIndex].candidates !== null) {\n        pc.transceivers[sdpMLineIndex].candidates.push(event.candidate);\n      }\n    };\n    iceGatherer.addEventListener('localcandidate',\n      this.transceivers[sdpMLineIndex].bufferCandidates);\n    return iceGatherer;\n  };\n\n  // start gathering from an RTCIceGatherer.\n  RTCPeerConnection.prototype._gather = function(mid, sdpMLineIndex) {\n    var pc = this;\n    var iceGatherer = this.transceivers[sdpMLineIndex].iceGatherer;\n    if (iceGatherer.onlocalcandidate) {\n      return;\n    }\n    var candidates = this.transceivers[sdpMLineIndex].candidates;\n    this.transceivers[sdpMLineIndex].candidates = null;\n    iceGatherer.removeEventListener('localcandidate',\n      this.transceivers[sdpMLineIndex].bufferCandidates);\n    iceGatherer.onlocalcandidate = function(evt) {\n      if (pc.usingBundle && sdpMLineIndex > 0) {\n        // if we know that we use bundle we can drop candidates with\n        // dpMLineIndex > 0. If we don't do this then our state gets\n        // confused since we dispose the extra ice gatherer.\n        return;\n      }\n      var event = new Event('icecandidate');\n      event.candidate = {sdpMid: mid, sdpMLineIndex: sdpMLineIndex};\n\n      var cand = evt.candidate;\n      // Edge emits an empty object for RTCIceCandidateComplete\n      var end = !cand || Object.keys(cand).length === 0;\n      if (end) {\n        // polyfill since RTCIceGatherer.state is not implemented in\n        // Edge 10547 yet.\n        if (iceGatherer.state === 'new' || iceGatherer.state === 'gathering') {\n          iceGatherer.state = 'completed';\n        }\n      } else {\n        if (iceGatherer.state === 'new') {\n          iceGatherer.state = 'gathering';\n        }\n        // RTCIceCandidate doesn't have a component, needs to be added\n        cand.component = 1;\n        event.candidate.candidate = SDPUtils.writeCandidate(cand);\n      }\n\n      // update local description.\n      var sections = SDPUtils.splitSections(pc.localDescription.sdp);\n      if (!end) {\n        sections[event.candidate.sdpMLineIndex + 1] +=\n            'a=' + event.candidate.candidate + '\\r\\n';\n      } else {\n        sections[event.candidate.sdpMLineIndex + 1] +=\n            'a=end-of-candidates\\r\\n';\n      }\n      pc.localDescription.sdp = sections.join('');\n      var complete = pc.transceivers.every(function(transceiver) {\n        return transceiver.iceGatherer &&\n            transceiver.iceGatherer.state === 'completed';\n      });\n\n      if (pc.iceGatheringState !== 'gathering') {\n        pc.iceGatheringState = 'gathering';\n        pc._emitGatheringStateChange();\n      }\n\n      // Emit candidate. Also emit null candidate when all gatherers are\n      // complete.\n      if (!end) {\n        pc._dispatchEvent('icecandidate', event);\n      }\n      if (complete) {\n        pc._dispatchEvent('icecandidate', new Event('icecandidate'));\n        pc.iceGatheringState = 'complete';\n        pc._emitGatheringStateChange();\n      }\n    };\n\n    // emit already gathered candidates.\n    window.setTimeout(function() {\n      candidates.forEach(function(candidate) {\n        var e = new Event('RTCIceGatherEvent');\n        e.candidate = candidate;\n        iceGatherer.onlocalcandidate(e);\n      });\n    }, 0);\n  };\n\n  // Create ICE transport and DTLS transport.\n  RTCPeerConnection.prototype._createIceAndDtlsTransports = function() {\n    var pc = this;\n    var iceTransport = new window.RTCIceTransport(null);\n    iceTransport.onicestatechange = function() {\n      pc._updateConnectionState();\n    };\n\n    var dtlsTransport = new window.RTCDtlsTransport(iceTransport);\n    dtlsTransport.ondtlsstatechange = function() {\n      pc._updateConnectionState();\n    };\n    dtlsTransport.onerror = function() {\n      // onerror does not set state to failed by itpc.\n      Object.defineProperty(dtlsTransport, 'state',\n          {value: 'failed', writable: true});\n      pc._updateConnectionState();\n    };\n\n    return {\n      iceTransport: iceTransport,\n      dtlsTransport: dtlsTransport\n    };\n  };\n\n  // Destroy ICE gatherer, ICE transport and DTLS transport.\n  // Without triggering the callbacks.\n  RTCPeerConnection.prototype._disposeIceAndDtlsTransports = function(\n      sdpMLineIndex) {\n    var iceGatherer = this.transceivers[sdpMLineIndex].iceGatherer;\n    if (iceGatherer) {\n      delete iceGatherer.onlocalcandidate;\n      delete this.transceivers[sdpMLineIndex].iceGatherer;\n    }\n    var iceTransport = this.transceivers[sdpMLineIndex].iceTransport;\n    if (iceTransport) {\n      delete iceTransport.onicestatechange;\n      delete this.transceivers[sdpMLineIndex].iceTransport;\n    }\n    var dtlsTransport = this.transceivers[sdpMLineIndex].dtlsTransport;\n    if (dtlsTransport) {\n      delete dtlsTransport.ondtlsstatechange;\n      delete dtlsTransport.onerror;\n      delete this.transceivers[sdpMLineIndex].dtlsTransport;\n    }\n  };\n\n  // Start the RTP Sender and Receiver for a transceiver.\n  RTCPeerConnection.prototype._transceive = function(transceiver,\n      send, recv) {\n    var params = getCommonCapabilities(transceiver.localCapabilities,\n        transceiver.remoteCapabilities);\n    if (send && transceiver.rtpSender) {\n      params.encodings = transceiver.sendEncodingParameters;\n      params.rtcp = {\n        cname: SDPUtils.localCName,\n        compound: transceiver.rtcpParameters.compound\n      };\n      if (transceiver.recvEncodingParameters.length) {\n        params.rtcp.ssrc = transceiver.recvEncodingParameters[0].ssrc;\n      }\n      transceiver.rtpSender.send(params);\n    }\n    if (recv && transceiver.rtpReceiver && params.codecs.length > 0) {\n      // remove RTX field in Edge 14942\n      if (transceiver.kind === 'video'\n          && transceiver.recvEncodingParameters\n          && edgeVersion < 15019) {\n        transceiver.recvEncodingParameters.forEach(function(p) {\n          delete p.rtx;\n        });\n      }\n      if (transceiver.recvEncodingParameters.length) {\n        params.encodings = transceiver.recvEncodingParameters;\n      }\n      params.rtcp = {\n        compound: transceiver.rtcpParameters.compound\n      };\n      if (transceiver.rtcpParameters.cname) {\n        params.rtcp.cname = transceiver.rtcpParameters.cname;\n      }\n      if (transceiver.sendEncodingParameters.length) {\n        params.rtcp.ssrc = transceiver.sendEncodingParameters[0].ssrc;\n      }\n      transceiver.rtpReceiver.receive(params);\n    }\n  };\n\n  RTCPeerConnection.prototype.setLocalDescription = function(description) {\n    var pc = this;\n\n    if (!isActionAllowedInSignalingState('setLocalDescription',\n        description.type, this.signalingState) || this._isClosed) {\n      return Promise.reject(makeError('InvalidStateError',\n          'Can not set local ' + description.type +\n          ' in state ' + pc.signalingState));\n    }\n\n    var sections;\n    var sessionpart;\n    if (description.type === 'offer') {\n      // VERY limited support for SDP munging. Limited to:\n      // * changing the order of codecs\n      sections = SDPUtils.splitSections(description.sdp);\n      sessionpart = sections.shift();\n      sections.forEach(function(mediaSection, sdpMLineIndex) {\n        var caps = SDPUtils.parseRtpParameters(mediaSection);\n        pc.transceivers[sdpMLineIndex].localCapabilities = caps;\n      });\n\n      this.transceivers.forEach(function(transceiver, sdpMLineIndex) {\n        pc._gather(transceiver.mid, sdpMLineIndex);\n      });\n    } else if (description.type === 'answer') {\n      sections = SDPUtils.splitSections(pc.remoteDescription.sdp);\n      sessionpart = sections.shift();\n      var isIceLite = SDPUtils.matchPrefix(sessionpart,\n          'a=ice-lite').length > 0;\n      sections.forEach(function(mediaSection, sdpMLineIndex) {\n        var transceiver = pc.transceivers[sdpMLineIndex];\n        var iceGatherer = transceiver.iceGatherer;\n        var iceTransport = transceiver.iceTransport;\n        var dtlsTransport = transceiver.dtlsTransport;\n        var localCapabilities = transceiver.localCapabilities;\n        var remoteCapabilities = transceiver.remoteCapabilities;\n\n        // treat bundle-only as not-rejected.\n        var rejected = SDPUtils.isRejected(mediaSection) &&\n            SDPUtils.matchPrefix(mediaSection, 'a=bundle-only').length === 0;\n\n        if (!rejected && !transceiver.isDatachannel) {\n          var remoteIceParameters = SDPUtils.getIceParameters(\n              mediaSection, sessionpart);\n          var remoteDtlsParameters = SDPUtils.getDtlsParameters(\n              mediaSection, sessionpart);\n          if (isIceLite) {\n            remoteDtlsParameters.role = 'server';\n          }\n\n          if (!pc.usingBundle || sdpMLineIndex === 0) {\n            pc._gather(transceiver.mid, sdpMLineIndex);\n            if (iceTransport.state === 'new') {\n              iceTransport.start(iceGatherer, remoteIceParameters,\n                  isIceLite ? 'controlling' : 'controlled');\n            }\n            if (dtlsTransport.state === 'new') {\n              dtlsTransport.start(remoteDtlsParameters);\n            }\n          }\n\n          // Calculate intersection of capabilities.\n          var params = getCommonCapabilities(localCapabilities,\n              remoteCapabilities);\n\n          // Start the RTCRtpSender. The RTCRtpReceiver for this\n          // transceiver has already been started in setRemoteDescription.\n          pc._transceive(transceiver,\n              params.codecs.length > 0,\n              false);\n        }\n      });\n    }\n\n    this.localDescription = {\n      type: description.type,\n      sdp: description.sdp\n    };\n    switch (description.type) {\n      case 'offer':\n        this._updateSignalingState('have-local-offer');\n        break;\n      case 'answer':\n        this._updateSignalingState('stable');\n        break;\n      default:\n        throw new TypeError('unsupported type \"' + description.type +\n            '\"');\n    }\n\n    return Promise.resolve();\n  };\n\n  RTCPeerConnection.prototype.setRemoteDescription = function(description) {\n    var pc = this;\n\n    if (!isActionAllowedInSignalingState('setRemoteDescription',\n        description.type, this.signalingState) || this._isClosed) {\n      return Promise.reject(makeError('InvalidStateError',\n          'Can not set remote ' + description.type +\n          ' in state ' + pc.signalingState));\n    }\n\n    var streams = {};\n    this.remoteStreams.forEach(function(stream) {\n      streams[stream.id] = stream;\n    });\n    var receiverList = [];\n    var sections = SDPUtils.splitSections(description.sdp);\n    var sessionpart = sections.shift();\n    var isIceLite = SDPUtils.matchPrefix(sessionpart,\n        'a=ice-lite').length > 0;\n    var usingBundle = SDPUtils.matchPrefix(sessionpart,\n        'a=group:BUNDLE ').length > 0;\n    this.usingBundle = usingBundle;\n    var iceOptions = SDPUtils.matchPrefix(sessionpart,\n        'a=ice-options:')[0];\n    if (iceOptions) {\n      this.canTrickleIceCandidates = iceOptions.substr(14).split(' ')\n          .indexOf('trickle') >= 0;\n    } else {\n      this.canTrickleIceCandidates = false;\n    }\n\n    sections.forEach(function(mediaSection, sdpMLineIndex) {\n      var lines = SDPUtils.splitLines(mediaSection);\n      var kind = SDPUtils.getKind(mediaSection);\n      // treat bundle-only as not-rejected.\n      var rejected = SDPUtils.isRejected(mediaSection) &&\n          SDPUtils.matchPrefix(mediaSection, 'a=bundle-only').length === 0;\n      var protocol = lines[0].substr(2).split(' ')[2];\n\n      var direction = SDPUtils.getDirection(mediaSection, sessionpart);\n      var remoteMsid = SDPUtils.parseMsid(mediaSection);\n\n      var mid = SDPUtils.getMid(mediaSection) || SDPUtils.generateIdentifier();\n\n      // Reject datachannels which are not implemented yet.\n      if (kind === 'application' && protocol === 'DTLS/SCTP') {\n        pc.transceivers[sdpMLineIndex] = {\n          mid: mid,\n          isDatachannel: true\n        };\n        return;\n      }\n\n      var transceiver;\n      var iceGatherer;\n      var iceTransport;\n      var dtlsTransport;\n      var rtpReceiver;\n      var sendEncodingParameters;\n      var recvEncodingParameters;\n      var localCapabilities;\n\n      var track;\n      // FIXME: ensure the mediaSection has rtcp-mux set.\n      var remoteCapabilities = SDPUtils.parseRtpParameters(mediaSection);\n      var remoteIceParameters;\n      var remoteDtlsParameters;\n      if (!rejected) {\n        remoteIceParameters = SDPUtils.getIceParameters(mediaSection,\n            sessionpart);\n        remoteDtlsParameters = SDPUtils.getDtlsParameters(mediaSection,\n            sessionpart);\n        remoteDtlsParameters.role = 'client';\n      }\n      recvEncodingParameters =\n          SDPUtils.parseRtpEncodingParameters(mediaSection);\n\n      var rtcpParameters = SDPUtils.parseRtcpParameters(mediaSection);\n\n      var isComplete = SDPUtils.matchPrefix(mediaSection,\n          'a=end-of-candidates', sessionpart).length > 0;\n      var cands = SDPUtils.matchPrefix(mediaSection, 'a=candidate:')\n          .map(function(cand) {\n            return SDPUtils.parseCandidate(cand);\n          })\n          .filter(function(cand) {\n            return cand.component === 1;\n          });\n\n      // Check if we can use BUNDLE and dispose transports.\n      if ((description.type === 'offer' || description.type === 'answer') &&\n          !rejected && usingBundle && sdpMLineIndex > 0 &&\n          pc.transceivers[sdpMLineIndex]) {\n        pc._disposeIceAndDtlsTransports(sdpMLineIndex);\n        pc.transceivers[sdpMLineIndex].iceGatherer =\n            pc.transceivers[0].iceGatherer;\n        pc.transceivers[sdpMLineIndex].iceTransport =\n            pc.transceivers[0].iceTransport;\n        pc.transceivers[sdpMLineIndex].dtlsTransport =\n            pc.transceivers[0].dtlsTransport;\n        if (pc.transceivers[sdpMLineIndex].rtpSender) {\n          pc.transceivers[sdpMLineIndex].rtpSender.setTransport(\n              pc.transceivers[0].dtlsTransport);\n        }\n        if (pc.transceivers[sdpMLineIndex].rtpReceiver) {\n          pc.transceivers[sdpMLineIndex].rtpReceiver.setTransport(\n              pc.transceivers[0].dtlsTransport);\n        }\n      }\n      if (description.type === 'offer' && !rejected) {\n        transceiver = pc.transceivers[sdpMLineIndex] ||\n            pc._createTransceiver(kind);\n        transceiver.mid = mid;\n\n        if (!transceiver.iceGatherer) {\n          transceiver.iceGatherer = pc._createIceGatherer(sdpMLineIndex,\n              usingBundle);\n        }\n\n        if (cands.length && transceiver.iceTransport.state === 'new') {\n          if (isComplete && (!usingBundle || sdpMLineIndex === 0)) {\n            transceiver.iceTransport.setRemoteCandidates(cands);\n          } else {\n            cands.forEach(function(candidate) {\n              maybeAddCandidate(transceiver.iceTransport, candidate);\n            });\n          }\n        }\n\n        localCapabilities = window.RTCRtpReceiver.getCapabilities(kind);\n\n        // filter RTX until additional stuff needed for RTX is implemented\n        // in adapter.js\n        if (edgeVersion < 15019) {\n          localCapabilities.codecs = localCapabilities.codecs.filter(\n              function(codec) {\n                return codec.name !== 'rtx';\n              });\n        }\n\n        sendEncodingParameters = transceiver.sendEncodingParameters || [{\n          ssrc: (2 * sdpMLineIndex + 2) * 1001\n        }];\n\n        // TODO: rewrite to use http://w3c.github.io/webrtc-pc/#set-associated-remote-streams\n        var isNewTrack = false;\n        if (direction === 'sendrecv' || direction === 'sendonly') {\n          isNewTrack = !transceiver.rtpReceiver;\n          rtpReceiver = transceiver.rtpReceiver ||\n              new window.RTCRtpReceiver(transceiver.dtlsTransport, kind);\n\n          if (isNewTrack) {\n            var stream;\n            track = rtpReceiver.track;\n            // FIXME: does not work with Plan B.\n            if (remoteMsid && remoteMsid.stream === '-') {\n              // no-op. a stream id of '-' means: no associated stream.\n            } else if (remoteMsid) {\n              if (!streams[remoteMsid.stream]) {\n                streams[remoteMsid.stream] = new window.MediaStream();\n                Object.defineProperty(streams[remoteMsid.stream], 'id', {\n                  get: function() {\n                    return remoteMsid.stream;\n                  }\n                });\n              }\n              Object.defineProperty(track, 'id', {\n                get: function() {\n                  return remoteMsid.track;\n                }\n              });\n              stream = streams[remoteMsid.stream];\n            } else {\n              if (!streams.default) {\n                streams.default = new window.MediaStream();\n              }\n              stream = streams.default;\n            }\n            if (stream) {\n              addTrackToStreamAndFireEvent(track, stream);\n              transceiver.associatedRemoteMediaStreams.push(stream);\n            }\n            receiverList.push([track, rtpReceiver, stream]);\n          }\n        } else if (transceiver.rtpReceiver && transceiver.rtpReceiver.track) {\n          transceiver.associatedRemoteMediaStreams.forEach(function(s) {\n            var nativeTrack = s.getTracks().find(function(t) {\n              return t.id === transceiver.rtpReceiver.track.id;\n            });\n            if (nativeTrack) {\n              removeTrackFromStreamAndFireEvent(nativeTrack, s);\n            }\n          });\n          transceiver.associatedRemoteMediaStreams = [];\n        }\n\n        transceiver.localCapabilities = localCapabilities;\n        transceiver.remoteCapabilities = remoteCapabilities;\n        transceiver.rtpReceiver = rtpReceiver;\n        transceiver.rtcpParameters = rtcpParameters;\n        transceiver.sendEncodingParameters = sendEncodingParameters;\n        transceiver.recvEncodingParameters = recvEncodingParameters;\n\n        // Start the RTCRtpReceiver now. The RTPSender is started in\n        // setLocalDescription.\n        pc._transceive(pc.transceivers[sdpMLineIndex],\n            false,\n            isNewTrack);\n      } else if (description.type === 'answer' && !rejected) {\n        transceiver = pc.transceivers[sdpMLineIndex];\n        iceGatherer = transceiver.iceGatherer;\n        iceTransport = transceiver.iceTransport;\n        dtlsTransport = transceiver.dtlsTransport;\n        rtpReceiver = transceiver.rtpReceiver;\n        sendEncodingParameters = transceiver.sendEncodingParameters;\n        localCapabilities = transceiver.localCapabilities;\n\n        pc.transceivers[sdpMLineIndex].recvEncodingParameters =\n            recvEncodingParameters;\n        pc.transceivers[sdpMLineIndex].remoteCapabilities =\n            remoteCapabilities;\n        pc.transceivers[sdpMLineIndex].rtcpParameters = rtcpParameters;\n\n        if (cands.length && iceTransport.state === 'new') {\n          if ((isIceLite || isComplete) &&\n              (!usingBundle || sdpMLineIndex === 0)) {\n            iceTransport.setRemoteCandidates(cands);\n          } else {\n            cands.forEach(function(candidate) {\n              maybeAddCandidate(transceiver.iceTransport, candidate);\n            });\n          }\n        }\n\n        if (!usingBundle || sdpMLineIndex === 0) {\n          if (iceTransport.state === 'new') {\n            iceTransport.start(iceGatherer, remoteIceParameters,\n                'controlling');\n          }\n          if (dtlsTransport.state === 'new') {\n            dtlsTransport.start(remoteDtlsParameters);\n          }\n        }\n\n        pc._transceive(transceiver,\n            direction === 'sendrecv' || direction === 'recvonly',\n            direction === 'sendrecv' || direction === 'sendonly');\n\n        // TODO: rewrite to use http://w3c.github.io/webrtc-pc/#set-associated-remote-streams\n        if (rtpReceiver &&\n            (direction === 'sendrecv' || direction === 'sendonly')) {\n          track = rtpReceiver.track;\n          if (remoteMsid) {\n            if (!streams[remoteMsid.stream]) {\n              streams[remoteMsid.stream] = new window.MediaStream();\n            }\n            addTrackToStreamAndFireEvent(track, streams[remoteMsid.stream]);\n            receiverList.push([track, rtpReceiver, streams[remoteMsid.stream]]);\n          } else {\n            if (!streams.default) {\n              streams.default = new window.MediaStream();\n            }\n            addTrackToStreamAndFireEvent(track, streams.default);\n            receiverList.push([track, rtpReceiver, streams.default]);\n          }\n        } else {\n          // FIXME: actually the receiver should be created later.\n          delete transceiver.rtpReceiver;\n        }\n      }\n    });\n\n    if (this._dtlsRole === undefined) {\n      this._dtlsRole = description.type === 'offer' ? 'active' : 'passive';\n    }\n\n    this.remoteDescription = {\n      type: description.type,\n      sdp: description.sdp\n    };\n    switch (description.type) {\n      case 'offer':\n        this._updateSignalingState('have-remote-offer');\n        break;\n      case 'answer':\n        this._updateSignalingState('stable');\n        break;\n      default:\n        throw new TypeError('unsupported type \"' + description.type +\n            '\"');\n    }\n    Object.keys(streams).forEach(function(sid) {\n      var stream = streams[sid];\n      if (stream.getTracks().length) {\n        if (pc.remoteStreams.indexOf(stream) === -1) {\n          pc.remoteStreams.push(stream);\n          var event = new Event('addstream');\n          event.stream = stream;\n          window.setTimeout(function() {\n            pc._dispatchEvent('addstream', event);\n          });\n        }\n\n        receiverList.forEach(function(item) {\n          var track = item[0];\n          var receiver = item[1];\n          if (stream.id !== item[2].id) {\n            return;\n          }\n          fireAddTrack(pc, track, receiver, [stream]);\n        });\n      }\n    });\n    receiverList.forEach(function(item) {\n      if (item[2]) {\n        return;\n      }\n      fireAddTrack(pc, item[0], item[1], []);\n    });\n\n    // check whether addIceCandidate({}) was called within four seconds after\n    // setRemoteDescription.\n    window.setTimeout(function() {\n      if (!(pc && pc.transceivers)) {\n        return;\n      }\n      pc.transceivers.forEach(function(transceiver) {\n        if (transceiver.iceTransport &&\n            transceiver.iceTransport.state === 'new' &&\n            transceiver.iceTransport.getRemoteCandidates().length > 0) {\n          console.warn('Timeout for addRemoteCandidate. Consider sending ' +\n              'an end-of-candidates notification');\n          transceiver.iceTransport.addRemoteCandidate({});\n        }\n      });\n    }, 4000);\n\n    return Promise.resolve();\n  };\n\n  RTCPeerConnection.prototype.close = function() {\n    this.transceivers.forEach(function(transceiver) {\n      /* not yet\n      if (transceiver.iceGatherer) {\n        transceiver.iceGatherer.close();\n      }\n      */\n      if (transceiver.iceTransport) {\n        transceiver.iceTransport.stop();\n      }\n      if (transceiver.dtlsTransport) {\n        transceiver.dtlsTransport.stop();\n      }\n      if (transceiver.rtpSender) {\n        transceiver.rtpSender.stop();\n      }\n      if (transceiver.rtpReceiver) {\n        transceiver.rtpReceiver.stop();\n      }\n    });\n    // FIXME: clean up tracks, local streams, remote streams, etc\n    this._isClosed = true;\n    this._updateSignalingState('closed');\n  };\n\n  // Update the signaling state.\n  RTCPeerConnection.prototype._updateSignalingState = function(newState) {\n    this.signalingState = newState;\n    var event = new Event('signalingstatechange');\n    this._dispatchEvent('signalingstatechange', event);\n  };\n\n  // Determine whether to fire the negotiationneeded event.\n  RTCPeerConnection.prototype._maybeFireNegotiationNeeded = function() {\n    var pc = this;\n    if (this.signalingState !== 'stable' || this.needNegotiation === true) {\n      return;\n    }\n    this.needNegotiation = true;\n    window.setTimeout(function() {\n      if (pc.needNegotiation === false) {\n        return;\n      }\n      pc.needNegotiation = false;\n      var event = new Event('negotiationneeded');\n      pc._dispatchEvent('negotiationneeded', event);\n    }, 0);\n  };\n\n  // Update the connection state.\n  RTCPeerConnection.prototype._updateConnectionState = function() {\n    var newState;\n    var states = {\n      'new': 0,\n      closed: 0,\n      connecting: 0,\n      checking: 0,\n      connected: 0,\n      completed: 0,\n      disconnected: 0,\n      failed: 0\n    };\n    this.transceivers.forEach(function(transceiver) {\n      states[transceiver.iceTransport.state]++;\n      states[transceiver.dtlsTransport.state]++;\n    });\n    // ICETransport.completed and connected are the same for this purpose.\n    states.connected += states.completed;\n\n    newState = 'new';\n    if (states.failed > 0) {\n      newState = 'failed';\n    } else if (states.connecting > 0 || states.checking > 0) {\n      newState = 'connecting';\n    } else if (states.disconnected > 0) {\n      newState = 'disconnected';\n    } else if (states.new > 0) {\n      newState = 'new';\n    } else if (states.connected > 0 || states.completed > 0) {\n      newState = 'connected';\n    }\n\n    if (newState !== this.iceConnectionState) {\n      this.iceConnectionState = newState;\n      var event = new Event('iceconnectionstatechange');\n      this._dispatchEvent('iceconnectionstatechange', event);\n    }\n  };\n\n  RTCPeerConnection.prototype.createOffer = function() {\n    var pc = this;\n\n    if (this._isClosed) {\n      return Promise.reject(makeError('InvalidStateError',\n          'Can not call createOffer after close'));\n    }\n\n    var numAudioTracks = this.transceivers.filter(function(t) {\n      return t.kind === 'audio';\n    }).length;\n    var numVideoTracks = this.transceivers.filter(function(t) {\n      return t.kind === 'video';\n    }).length;\n\n    // Determine number of audio and video tracks we need to send/recv.\n    var offerOptions = arguments[0];\n    if (offerOptions) {\n      // Reject Chrome legacy constraints.\n      if (offerOptions.mandatory || offerOptions.optional) {\n        throw new TypeError(\n            'Legacy mandatory/optional constraints not supported.');\n      }\n      if (offerOptions.offerToReceiveAudio !== undefined) {\n        if (offerOptions.offerToReceiveAudio === true) {\n          numAudioTracks = 1;\n        } else if (offerOptions.offerToReceiveAudio === false) {\n          numAudioTracks = 0;\n        } else {\n          numAudioTracks = offerOptions.offerToReceiveAudio;\n        }\n      }\n      if (offerOptions.offerToReceiveVideo !== undefined) {\n        if (offerOptions.offerToReceiveVideo === true) {\n          numVideoTracks = 1;\n        } else if (offerOptions.offerToReceiveVideo === false) {\n          numVideoTracks = 0;\n        } else {\n          numVideoTracks = offerOptions.offerToReceiveVideo;\n        }\n      }\n    }\n\n    this.transceivers.forEach(function(transceiver) {\n      if (transceiver.kind === 'audio') {\n        numAudioTracks--;\n        if (numAudioTracks < 0) {\n          transceiver.wantReceive = false;\n        }\n      } else if (transceiver.kind === 'video') {\n        numVideoTracks--;\n        if (numVideoTracks < 0) {\n          transceiver.wantReceive = false;\n        }\n      }\n    });\n\n    // Create M-lines for recvonly streams.\n    while (numAudioTracks > 0 || numVideoTracks > 0) {\n      if (numAudioTracks > 0) {\n        this._createTransceiver('audio');\n        numAudioTracks--;\n      }\n      if (numVideoTracks > 0) {\n        this._createTransceiver('video');\n        numVideoTracks--;\n      }\n    }\n\n    var sdp = SDPUtils.writeSessionBoilerplate(this._sdpSessionId,\n        this._sdpSessionVersion++);\n    this.transceivers.forEach(function(transceiver, sdpMLineIndex) {\n      // For each track, create an ice gatherer, ice transport,\n      // dtls transport, potentially rtpsender and rtpreceiver.\n      var track = transceiver.track;\n      var kind = transceiver.kind;\n      var mid = SDPUtils.generateIdentifier();\n      transceiver.mid = mid;\n\n      if (!transceiver.iceGatherer) {\n        transceiver.iceGatherer = pc._createIceGatherer(sdpMLineIndex,\n            pc.usingBundle);\n      }\n\n      var localCapabilities = window.RTCRtpSender.getCapabilities(kind);\n      // filter RTX until additional stuff needed for RTX is implemented\n      // in adapter.js\n      if (edgeVersion < 15019) {\n        localCapabilities.codecs = localCapabilities.codecs.filter(\n            function(codec) {\n              return codec.name !== 'rtx';\n            });\n      }\n      localCapabilities.codecs.forEach(function(codec) {\n        // work around https://bugs.chromium.org/p/webrtc/issues/detail?id=6552\n        // by adding level-asymmetry-allowed=1\n        if (codec.name === 'H264' &&\n            codec.parameters['level-asymmetry-allowed'] === undefined) {\n          codec.parameters['level-asymmetry-allowed'] = '1';\n        }\n      });\n\n      // generate an ssrc now, to be used later in rtpSender.send\n      var sendEncodingParameters = transceiver.sendEncodingParameters || [{\n        ssrc: (2 * sdpMLineIndex + 1) * 1001\n      }];\n      if (track) {\n        // add RTX\n        if (edgeVersion >= 15019 && kind === 'video' &&\n            !sendEncodingParameters[0].rtx) {\n          sendEncodingParameters[0].rtx = {\n            ssrc: sendEncodingParameters[0].ssrc + 1\n          };\n        }\n      }\n\n      if (transceiver.wantReceive) {\n        transceiver.rtpReceiver = new window.RTCRtpReceiver(\n            transceiver.dtlsTransport, kind);\n      }\n\n      transceiver.localCapabilities = localCapabilities;\n      transceiver.sendEncodingParameters = sendEncodingParameters;\n    });\n\n    // always offer BUNDLE and dispose on return if not supported.\n    if (this._config.bundlePolicy !== 'max-compat') {\n      sdp += 'a=group:BUNDLE ' + this.transceivers.map(function(t) {\n        return t.mid;\n      }).join(' ') + '\\r\\n';\n    }\n    sdp += 'a=ice-options:trickle\\r\\n';\n\n    this.transceivers.forEach(function(transceiver, sdpMLineIndex) {\n      sdp += writeMediaSection(transceiver, transceiver.localCapabilities,\n          'offer', transceiver.stream, pc._dtlsRole);\n      sdp += 'a=rtcp-rsize\\r\\n';\n\n      if (transceiver.iceGatherer && pc.iceGatheringState !== 'new' &&\n          (sdpMLineIndex === 0 || !pc.usingBundle)) {\n        transceiver.iceGatherer.getLocalCandidates().forEach(function(cand) {\n          cand.component = 1;\n          sdp += 'a=' + SDPUtils.writeCandidate(cand) + '\\r\\n';\n        });\n\n        if (transceiver.iceGatherer.state === 'completed') {\n          sdp += 'a=end-of-candidates\\r\\n';\n        }\n      }\n    });\n\n    var desc = new window.RTCSessionDescription({\n      type: 'offer',\n      sdp: sdp\n    });\n    return Promise.resolve(desc);\n  };\n\n  RTCPeerConnection.prototype.createAnswer = function() {\n    var pc = this;\n\n    if (this._isClosed) {\n      return Promise.reject(makeError('InvalidStateError',\n          'Can not call createAnswer after close'));\n    }\n\n    var sdp = SDPUtils.writeSessionBoilerplate(this._sdpSessionId,\n        this._sdpSessionVersion++);\n    if (this.usingBundle) {\n      sdp += 'a=group:BUNDLE ' + this.transceivers.map(function(t) {\n        return t.mid;\n      }).join(' ') + '\\r\\n';\n    }\n    var mediaSectionsInOffer = SDPUtils.splitSections(\n        this.remoteDescription.sdp).length - 1;\n    this.transceivers.forEach(function(transceiver, sdpMLineIndex) {\n      if (sdpMLineIndex + 1 > mediaSectionsInOffer) {\n        return;\n      }\n      if (transceiver.isDatachannel) {\n        sdp += 'm=application 0 DTLS/SCTP 5000\\r\\n' +\n            'c=IN IP4 0.0.0.0\\r\\n' +\n            'a=mid:' + transceiver.mid + '\\r\\n';\n        return;\n      }\n\n      // FIXME: look at direction.\n      if (transceiver.stream) {\n        var localTrack;\n        if (transceiver.kind === 'audio') {\n          localTrack = transceiver.stream.getAudioTracks()[0];\n        } else if (transceiver.kind === 'video') {\n          localTrack = transceiver.stream.getVideoTracks()[0];\n        }\n        if (localTrack) {\n          // add RTX\n          if (edgeVersion >= 15019 && transceiver.kind === 'video' &&\n              !transceiver.sendEncodingParameters[0].rtx) {\n            transceiver.sendEncodingParameters[0].rtx = {\n              ssrc: transceiver.sendEncodingParameters[0].ssrc + 1\n            };\n          }\n        }\n      }\n\n      // Calculate intersection of capabilities.\n      var commonCapabilities = getCommonCapabilities(\n          transceiver.localCapabilities,\n          transceiver.remoteCapabilities);\n\n      var hasRtx = commonCapabilities.codecs.filter(function(c) {\n        return c.name.toLowerCase() === 'rtx';\n      }).length;\n      if (!hasRtx && transceiver.sendEncodingParameters[0].rtx) {\n        delete transceiver.sendEncodingParameters[0].rtx;\n      }\n\n      sdp += writeMediaSection(transceiver, commonCapabilities,\n          'answer', transceiver.stream, pc._dtlsRole);\n      if (transceiver.rtcpParameters &&\n          transceiver.rtcpParameters.reducedSize) {\n        sdp += 'a=rtcp-rsize\\r\\n';\n      }\n    });\n\n    var desc = new window.RTCSessionDescription({\n      type: 'answer',\n      sdp: sdp\n    });\n    return Promise.resolve(desc);\n  };\n\n  RTCPeerConnection.prototype.addIceCandidate = function(candidate) {\n    var sections;\n    if (!candidate || candidate.candidate === '') {\n      for (var j = 0; j < this.transceivers.length; j++) {\n        if (this.transceivers[j].isDatachannel) {\n          continue;\n        }\n        this.transceivers[j].iceTransport.addRemoteCandidate({});\n        sections = SDPUtils.splitSections(this.remoteDescription.sdp);\n        sections[j + 1] += 'a=end-of-candidates\\r\\n';\n        this.remoteDescription.sdp = sections.join('');\n        if (this.usingBundle) {\n          break;\n        }\n      }\n    } else if (!(candidate.sdpMLineIndex !== undefined || candidate.sdpMid)) {\n      throw new TypeError('sdpMLineIndex or sdpMid required');\n    } else if (!this.remoteDescription) {\n      return Promise.reject(makeError('InvalidStateError',\n          'Can not add ICE candidate without a remote description'));\n    } else {\n      var sdpMLineIndex = candidate.sdpMLineIndex;\n      if (candidate.sdpMid) {\n        for (var i = 0; i < this.transceivers.length; i++) {\n          if (this.transceivers[i].mid === candidate.sdpMid) {\n            sdpMLineIndex = i;\n            break;\n          }\n        }\n      }\n      var transceiver = this.transceivers[sdpMLineIndex];\n      if (transceiver) {\n        if (transceiver.isDatachannel) {\n          return Promise.resolve();\n        }\n        var cand = Object.keys(candidate.candidate).length > 0 ?\n            SDPUtils.parseCandidate(candidate.candidate) : {};\n        // Ignore Chrome's invalid candidates since Edge does not like them.\n        if (cand.protocol === 'tcp' && (cand.port === 0 || cand.port === 9)) {\n          return Promise.resolve();\n        }\n        // Ignore RTCP candidates, we assume RTCP-MUX.\n        if (cand.component && cand.component !== 1) {\n          return Promise.resolve();\n        }\n        // when using bundle, avoid adding candidates to the wrong\n        // ice transport. And avoid adding candidates added in the SDP.\n        if (sdpMLineIndex === 0 || (sdpMLineIndex > 0 &&\n            transceiver.iceTransport !== this.transceivers[0].iceTransport)) {\n          if (!maybeAddCandidate(transceiver.iceTransport, cand)) {\n            return Promise.reject(makeError('OperationError',\n                'Can not add ICE candidate'));\n          }\n        }\n\n        // update the remoteDescription.\n        var candidateString = candidate.candidate.trim();\n        if (candidateString.indexOf('a=') === 0) {\n          candidateString = candidateString.substr(2);\n        }\n        sections = SDPUtils.splitSections(this.remoteDescription.sdp);\n        sections[sdpMLineIndex + 1] += 'a=' +\n            (cand.type ? candidateString : 'end-of-candidates')\n            + '\\r\\n';\n        this.remoteDescription.sdp = sections.join('');\n      } else {\n        return Promise.reject(makeError('OperationError',\n            'Can not add ICE candidate'));\n      }\n    }\n    return Promise.resolve();\n  };\n\n  RTCPeerConnection.prototype.getStats = function() {\n    var promises = [];\n    this.transceivers.forEach(function(transceiver) {\n      ['rtpSender', 'rtpReceiver', 'iceGatherer', 'iceTransport',\n          'dtlsTransport'].forEach(function(method) {\n            if (transceiver[method]) {\n              promises.push(transceiver[method].getStats());\n            }\n          });\n    });\n    var fixStatsType = function(stat) {\n      return {\n        inboundrtp: 'inbound-rtp',\n        outboundrtp: 'outbound-rtp',\n        candidatepair: 'candidate-pair',\n        localcandidate: 'local-candidate',\n        remotecandidate: 'remote-candidate'\n      }[stat.type] || stat.type;\n    };\n    return new Promise(function(resolve) {\n      // shim getStats with maplike support\n      var results = new Map();\n      Promise.all(promises).then(function(res) {\n        res.forEach(function(result) {\n          Object.keys(result).forEach(function(id) {\n            result[id].type = fixStatsType(result[id]);\n            results.set(id, result[id]);\n          });\n        });\n        resolve(results);\n      });\n    });\n  };\n\n  // legacy callback shims. Should be moved to adapter.js some days.\n  var methods = ['createOffer', 'createAnswer'];\n  methods.forEach(function(method) {\n    var nativeMethod = RTCPeerConnection.prototype[method];\n    RTCPeerConnection.prototype[method] = function() {\n      var args = arguments;\n      if (typeof args[0] === 'function' ||\n          typeof args[1] === 'function') { // legacy\n        return nativeMethod.apply(this, [arguments[2]])\n        .then(function(description) {\n          if (typeof args[0] === 'function') {\n            args[0].apply(null, [description]);\n          }\n        }, function(error) {\n          if (typeof args[1] === 'function') {\n            args[1].apply(null, [error]);\n          }\n        });\n      }\n      return nativeMethod.apply(this, arguments);\n    };\n  });\n\n  methods = ['setLocalDescription', 'setRemoteDescription', 'addIceCandidate'];\n  methods.forEach(function(method) {\n    var nativeMethod = RTCPeerConnection.prototype[method];\n    RTCPeerConnection.prototype[method] = function() {\n      var args = arguments;\n      if (typeof args[1] === 'function' ||\n          typeof args[2] === 'function') { // legacy\n        return nativeMethod.apply(this, arguments)\n        .then(function() {\n          if (typeof args[1] === 'function') {\n            args[1].apply(null);\n          }\n        }, function(error) {\n          if (typeof args[2] === 'function') {\n            args[2].apply(null, [error]);\n          }\n        });\n      }\n      return nativeMethod.apply(this, arguments);\n    };\n  });\n\n  // getStats is special. It doesn't have a spec legacy method yet we support\n  // getStats(something, cb) without error callbacks.\n  ['getStats'].forEach(function(method) {\n    var nativeMethod = RTCPeerConnection.prototype[method];\n    RTCPeerConnection.prototype[method] = function() {\n      var args = arguments;\n      if (typeof args[1] === 'function') {\n        return nativeMethod.apply(this, arguments)\n        .then(function() {\n          if (typeof args[1] === 'function') {\n            args[1].apply(null);\n          }\n        });\n      }\n      return nativeMethod.apply(this, arguments);\n    };\n  });\n\n  return RTCPeerConnection;\n};\n\n},{\"sdp\":2}],2:[function(require,module,exports){\n /* eslint-env node */\n'use strict';\n\n// SDP helpers.\nvar SDPUtils = {};\n\n// Generate an alphanumeric identifier for cname or mids.\n// TODO: use UUIDs instead? https://gist.github.com/jed/982883\nSDPUtils.generateIdentifier = function() {\n  return Math.random().toString(36).substr(2, 10);\n};\n\n// The RTCP CNAME used by all peerconnections from the same JS.\nSDPUtils.localCName = SDPUtils.generateIdentifier();\n\n// Splits SDP into lines, dealing with both CRLF and LF.\nSDPUtils.splitLines = function(blob) {\n  return blob.trim().split('\\n').map(function(line) {\n    return line.trim();\n  });\n};\n// Splits SDP into sessionpart and mediasections. Ensures CRLF.\nSDPUtils.splitSections = function(blob) {\n  var parts = blob.split('\\nm=');\n  return parts.map(function(part, index) {\n    return (index > 0 ? 'm=' + part : part).trim() + '\\r\\n';\n  });\n};\n\n// Returns lines that start with a certain prefix.\nSDPUtils.matchPrefix = function(blob, prefix) {\n  return SDPUtils.splitLines(blob).filter(function(line) {\n    return line.indexOf(prefix) === 0;\n  });\n};\n\n// Parses an ICE candidate line. Sample input:\n// candidate:702786350 2 udp 41819902 8.8.8.8 60769 typ relay raddr 8.8.8.8\n// rport 55996\"\nSDPUtils.parseCandidate = function(line) {\n  var parts;\n  // Parse both variants.\n  if (line.indexOf('a=candidate:') === 0) {\n    parts = line.substring(12).split(' ');\n  } else {\n    parts = line.substring(10).split(' ');\n  }\n\n  var candidate = {\n    foundation: parts[0],\n    component: parseInt(parts[1], 10),\n    protocol: parts[2].toLowerCase(),\n    priority: parseInt(parts[3], 10),\n    ip: parts[4],\n    port: parseInt(parts[5], 10),\n    // skip parts[6] == 'typ'\n    type: parts[7]\n  };\n\n  for (var i = 8; i < parts.length; i += 2) {\n    switch (parts[i]) {\n      case 'raddr':\n        candidate.relatedAddress = parts[i + 1];\n        break;\n      case 'rport':\n        candidate.relatedPort = parseInt(parts[i + 1], 10);\n        break;\n      case 'tcptype':\n        candidate.tcpType = parts[i + 1];\n        break;\n      case 'ufrag':\n        candidate.ufrag = parts[i + 1]; // for backward compability.\n        candidate.usernameFragment = parts[i + 1];\n        break;\n      default: // extension handling, in particular ufrag\n        candidate[parts[i]] = parts[i + 1];\n        break;\n    }\n  }\n  return candidate;\n};\n\n// Translates a candidate object into SDP candidate attribute.\nSDPUtils.writeCandidate = function(candidate) {\n  var sdp = [];\n  sdp.push(candidate.foundation);\n  sdp.push(candidate.component);\n  sdp.push(candidate.protocol.toUpperCase());\n  sdp.push(candidate.priority);\n  sdp.push(candidate.ip);\n  sdp.push(candidate.port);\n\n  var type = candidate.type;\n  sdp.push('typ');\n  sdp.push(type);\n  if (type !== 'host' && candidate.relatedAddress &&\n      candidate.relatedPort) {\n    sdp.push('raddr');\n    sdp.push(candidate.relatedAddress); // was: relAddr\n    sdp.push('rport');\n    sdp.push(candidate.relatedPort); // was: relPort\n  }\n  if (candidate.tcpType && candidate.protocol.toLowerCase() === 'tcp') {\n    sdp.push('tcptype');\n    sdp.push(candidate.tcpType);\n  }\n  if (candidate.ufrag) {\n    sdp.push('ufrag');\n    sdp.push(candidate.ufrag);\n  }\n  return 'candidate:' + sdp.join(' ');\n};\n\n// Parses an ice-options line, returns an array of option tags.\n// a=ice-options:foo bar\nSDPUtils.parseIceOptions = function(line) {\n  return line.substr(14).split(' ');\n}\n\n// Parses an rtpmap line, returns RTCRtpCoddecParameters. Sample input:\n// a=rtpmap:111 opus/48000/2\nSDPUtils.parseRtpMap = function(line) {\n  var parts = line.substr(9).split(' ');\n  var parsed = {\n    payloadType: parseInt(parts.shift(), 10) // was: id\n  };\n\n  parts = parts[0].split('/');\n\n  parsed.name = parts[0];\n  parsed.clockRate = parseInt(parts[1], 10); // was: clockrate\n  // was: channels\n  parsed.numChannels = parts.length === 3 ? parseInt(parts[2], 10) : 1;\n  return parsed;\n};\n\n// Generate an a=rtpmap line from RTCRtpCodecCapability or\n// RTCRtpCodecParameters.\nSDPUtils.writeRtpMap = function(codec) {\n  var pt = codec.payloadType;\n  if (codec.preferredPayloadType !== undefined) {\n    pt = codec.preferredPayloadType;\n  }\n  return 'a=rtpmap:' + pt + ' ' + codec.name + '/' + codec.clockRate +\n      (codec.numChannels !== 1 ? '/' + codec.numChannels : '') + '\\r\\n';\n};\n\n// Parses an a=extmap line (headerextension from RFC 5285). Sample input:\n// a=extmap:2 urn:ietf:params:rtp-hdrext:toffset\n// a=extmap:2/sendonly urn:ietf:params:rtp-hdrext:toffset\nSDPUtils.parseExtmap = function(line) {\n  var parts = line.substr(9).split(' ');\n  return {\n    id: parseInt(parts[0], 10),\n    direction: parts[0].indexOf('/') > 0 ? parts[0].split('/')[1] : 'sendrecv',\n    uri: parts[1]\n  };\n};\n\n// Generates a=extmap line from RTCRtpHeaderExtensionParameters or\n// RTCRtpHeaderExtension.\nSDPUtils.writeExtmap = function(headerExtension) {\n  return 'a=extmap:' + (headerExtension.id || headerExtension.preferredId) +\n      (headerExtension.direction && headerExtension.direction !== 'sendrecv'\n          ? '/' + headerExtension.direction\n          : '') +\n      ' ' + headerExtension.uri + '\\r\\n';\n};\n\n// Parses an ftmp line, returns dictionary. Sample input:\n// a=fmtp:96 vbr=on;cng=on\n// Also deals with vbr=on; cng=on\nSDPUtils.parseFmtp = function(line) {\n  var parsed = {};\n  var kv;\n  var parts = line.substr(line.indexOf(' ') + 1).split(';');\n  for (var j = 0; j < parts.length; j++) {\n    kv = parts[j].trim().split('=');\n    parsed[kv[0].trim()] = kv[1];\n  }\n  return parsed;\n};\n\n// Generates an a=ftmp line from RTCRtpCodecCapability or RTCRtpCodecParameters.\nSDPUtils.writeFmtp = function(codec) {\n  var line = '';\n  var pt = codec.payloadType;\n  if (codec.preferredPayloadType !== undefined) {\n    pt = codec.preferredPayloadType;\n  }\n  if (codec.parameters && Object.keys(codec.parameters).length) {\n    var params = [];\n    Object.keys(codec.parameters).forEach(function(param) {\n      params.push(param + '=' + codec.parameters[param]);\n    });\n    line += 'a=fmtp:' + pt + ' ' + params.join(';') + '\\r\\n';\n  }\n  return line;\n};\n\n// Parses an rtcp-fb line, returns RTCPRtcpFeedback object. Sample input:\n// a=rtcp-fb:98 nack rpsi\nSDPUtils.parseRtcpFb = function(line) {\n  var parts = line.substr(line.indexOf(' ') + 1).split(' ');\n  return {\n    type: parts.shift(),\n    parameter: parts.join(' ')\n  };\n};\n// Generate a=rtcp-fb lines from RTCRtpCodecCapability or RTCRtpCodecParameters.\nSDPUtils.writeRtcpFb = function(codec) {\n  var lines = '';\n  var pt = codec.payloadType;\n  if (codec.preferredPayloadType !== undefined) {\n    pt = codec.preferredPayloadType;\n  }\n  if (codec.rtcpFeedback && codec.rtcpFeedback.length) {\n    // FIXME: special handling for trr-int?\n    codec.rtcpFeedback.forEach(function(fb) {\n      lines += 'a=rtcp-fb:' + pt + ' ' + fb.type +\n      (fb.parameter && fb.parameter.length ? ' ' + fb.parameter : '') +\n          '\\r\\n';\n    });\n  }\n  return lines;\n};\n\n// Parses an RFC 5576 ssrc media attribute. Sample input:\n// a=ssrc:3735928559 cname:something\nSDPUtils.parseSsrcMedia = function(line) {\n  var sp = line.indexOf(' ');\n  var parts = {\n    ssrc: parseInt(line.substr(7, sp - 7), 10)\n  };\n  var colon = line.indexOf(':', sp);\n  if (colon > -1) {\n    parts.attribute = line.substr(sp + 1, colon - sp - 1);\n    parts.value = line.substr(colon + 1);\n  } else {\n    parts.attribute = line.substr(sp + 1);\n  }\n  return parts;\n};\n\n// Extracts the MID (RFC 5888) from a media section.\n// returns the MID or undefined if no mid line was found.\nSDPUtils.getMid = function(mediaSection) {\n  var mid = SDPUtils.matchPrefix(mediaSection, 'a=mid:')[0];\n  if (mid) {\n    return mid.substr(6);\n  }\n}\n\nSDPUtils.parseFingerprint = function(line) {\n  var parts = line.substr(14).split(' ');\n  return {\n    algorithm: parts[0].toLowerCase(), // algorithm is case-sensitive in Edge.\n    value: parts[1]\n  };\n};\n\n// Extracts DTLS parameters from SDP media section or sessionpart.\n// FIXME: for consistency with other functions this should only\n//   get the fingerprint line as input. See also getIceParameters.\nSDPUtils.getDtlsParameters = function(mediaSection, sessionpart) {\n  var lines = SDPUtils.matchPrefix(mediaSection + sessionpart,\n      'a=fingerprint:');\n  // Note: a=setup line is ignored since we use the 'auto' role.\n  // Note2: 'algorithm' is not case sensitive except in Edge.\n  return {\n    role: 'auto',\n    fingerprints: lines.map(SDPUtils.parseFingerprint)\n  };\n};\n\n// Serializes DTLS parameters to SDP.\nSDPUtils.writeDtlsParameters = function(params, setupType) {\n  var sdp = 'a=setup:' + setupType + '\\r\\n';\n  params.fingerprints.forEach(function(fp) {\n    sdp += 'a=fingerprint:' + fp.algorithm + ' ' + fp.value + '\\r\\n';\n  });\n  return sdp;\n};\n// Parses ICE information from SDP media section or sessionpart.\n// FIXME: for consistency with other functions this should only\n//   get the ice-ufrag and ice-pwd lines as input.\nSDPUtils.getIceParameters = function(mediaSection, sessionpart) {\n  var lines = SDPUtils.splitLines(mediaSection);\n  // Search in session part, too.\n  lines = lines.concat(SDPUtils.splitLines(sessionpart));\n  var iceParameters = {\n    usernameFragment: lines.filter(function(line) {\n      return line.indexOf('a=ice-ufrag:') === 0;\n    })[0].substr(12),\n    password: lines.filter(function(line) {\n      return line.indexOf('a=ice-pwd:') === 0;\n    })[0].substr(10)\n  };\n  return iceParameters;\n};\n\n// Serializes ICE parameters to SDP.\nSDPUtils.writeIceParameters = function(params) {\n  return 'a=ice-ufrag:' + params.usernameFragment + '\\r\\n' +\n      'a=ice-pwd:' + params.password + '\\r\\n';\n};\n\n// Parses the SDP media section and returns RTCRtpParameters.\nSDPUtils.parseRtpParameters = function(mediaSection) {\n  var description = {\n    codecs: [],\n    headerExtensions: [],\n    fecMechanisms: [],\n    rtcp: []\n  };\n  var lines = SDPUtils.splitLines(mediaSection);\n  var mline = lines[0].split(' ');\n  for (var i = 3; i < mline.length; i++) { // find all codecs from mline[3..]\n    var pt = mline[i];\n    var rtpmapline = SDPUtils.matchPrefix(\n        mediaSection, 'a=rtpmap:' + pt + ' ')[0];\n    if (rtpmapline) {\n      var codec = SDPUtils.parseRtpMap(rtpmapline);\n      var fmtps = SDPUtils.matchPrefix(\n          mediaSection, 'a=fmtp:' + pt + ' ');\n      // Only the first a=fmtp:<pt> is considered.\n      codec.parameters = fmtps.length ? SDPUtils.parseFmtp(fmtps[0]) : {};\n      codec.rtcpFeedback = SDPUtils.matchPrefix(\n          mediaSection, 'a=rtcp-fb:' + pt + ' ')\n        .map(SDPUtils.parseRtcpFb);\n      description.codecs.push(codec);\n      // parse FEC mechanisms from rtpmap lines.\n      switch (codec.name.toUpperCase()) {\n        case 'RED':\n        case 'ULPFEC':\n          description.fecMechanisms.push(codec.name.toUpperCase());\n          break;\n        default: // only RED and ULPFEC are recognized as FEC mechanisms.\n          break;\n      }\n    }\n  }\n  SDPUtils.matchPrefix(mediaSection, 'a=extmap:').forEach(function(line) {\n    description.headerExtensions.push(SDPUtils.parseExtmap(line));\n  });\n  // FIXME: parse rtcp.\n  return description;\n};\n\n// Generates parts of the SDP media section describing the capabilities /\n// parameters.\nSDPUtils.writeRtpDescription = function(kind, caps) {\n  var sdp = '';\n\n  // Build the mline.\n  sdp += 'm=' + kind + ' ';\n  sdp += caps.codecs.length > 0 ? '9' : '0'; // reject if no codecs.\n  sdp += ' UDP/TLS/RTP/SAVPF ';\n  sdp += caps.codecs.map(function(codec) {\n    if (codec.preferredPayloadType !== undefined) {\n      return codec.preferredPayloadType;\n    }\n    return codec.payloadType;\n  }).join(' ') + '\\r\\n';\n\n  sdp += 'c=IN IP4 0.0.0.0\\r\\n';\n  sdp += 'a=rtcp:9 IN IP4 0.0.0.0\\r\\n';\n\n  // Add a=rtpmap lines for each codec. Also fmtp and rtcp-fb.\n  caps.codecs.forEach(function(codec) {\n    sdp += SDPUtils.writeRtpMap(codec);\n    sdp += SDPUtils.writeFmtp(codec);\n    sdp += SDPUtils.writeRtcpFb(codec);\n  });\n  var maxptime = 0;\n  caps.codecs.forEach(function(codec) {\n    if (codec.maxptime > maxptime) {\n      maxptime = codec.maxptime;\n    }\n  });\n  if (maxptime > 0) {\n    sdp += 'a=maxptime:' + maxptime + '\\r\\n';\n  }\n  sdp += 'a=rtcp-mux\\r\\n';\n\n  caps.headerExtensions.forEach(function(extension) {\n    sdp += SDPUtils.writeExtmap(extension);\n  });\n  // FIXME: write fecMechanisms.\n  return sdp;\n};\n\n// Parses the SDP media section and returns an array of\n// RTCRtpEncodingParameters.\nSDPUtils.parseRtpEncodingParameters = function(mediaSection) {\n  var encodingParameters = [];\n  var description = SDPUtils.parseRtpParameters(mediaSection);\n  var hasRed = description.fecMechanisms.indexOf('RED') !== -1;\n  var hasUlpfec = description.fecMechanisms.indexOf('ULPFEC') !== -1;\n\n  // filter a=ssrc:... cname:, ignore PlanB-msid\n  var ssrcs = SDPUtils.matchPrefix(mediaSection, 'a=ssrc:')\n  .map(function(line) {\n    return SDPUtils.parseSsrcMedia(line);\n  })\n  .filter(function(parts) {\n    return parts.attribute === 'cname';\n  });\n  var primarySsrc = ssrcs.length > 0 && ssrcs[0].ssrc;\n  var secondarySsrc;\n\n  var flows = SDPUtils.matchPrefix(mediaSection, 'a=ssrc-group:FID')\n  .map(function(line) {\n    var parts = line.split(' ');\n    parts.shift();\n    return parts.map(function(part) {\n      return parseInt(part, 10);\n    });\n  });\n  if (flows.length > 0 && flows[0].length > 1 && flows[0][0] === primarySsrc) {\n    secondarySsrc = flows[0][1];\n  }\n\n  description.codecs.forEach(function(codec) {\n    if (codec.name.toUpperCase() === 'RTX' && codec.parameters.apt) {\n      var encParam = {\n        ssrc: primarySsrc,\n        codecPayloadType: parseInt(codec.parameters.apt, 10),\n        rtx: {\n          ssrc: secondarySsrc\n        }\n      };\n      encodingParameters.push(encParam);\n      if (hasRed) {\n        encParam = JSON.parse(JSON.stringify(encParam));\n        encParam.fec = {\n          ssrc: secondarySsrc,\n          mechanism: hasUlpfec ? 'red+ulpfec' : 'red'\n        };\n        encodingParameters.push(encParam);\n      }\n    }\n  });\n  if (encodingParameters.length === 0 && primarySsrc) {\n    encodingParameters.push({\n      ssrc: primarySsrc\n    });\n  }\n\n  // we support both b=AS and b=TIAS but interpret AS as TIAS.\n  var bandwidth = SDPUtils.matchPrefix(mediaSection, 'b=');\n  if (bandwidth.length) {\n    if (bandwidth[0].indexOf('b=TIAS:') === 0) {\n      bandwidth = parseInt(bandwidth[0].substr(7), 10);\n    } else if (bandwidth[0].indexOf('b=AS:') === 0) {\n      // use formula from JSEP to convert b=AS to TIAS value.\n      bandwidth = parseInt(bandwidth[0].substr(5), 10) * 1000 * 0.95\n          - (50 * 40 * 8);\n    } else {\n      bandwidth = undefined;\n    }\n    encodingParameters.forEach(function(params) {\n      params.maxBitrate = bandwidth;\n    });\n  }\n  return encodingParameters;\n};\n\n// parses http://draft.ortc.org/#rtcrtcpparameters*\nSDPUtils.parseRtcpParameters = function(mediaSection) {\n  var rtcpParameters = {};\n\n  var cname;\n  // Gets the first SSRC. Note that with RTX there might be multiple\n  // SSRCs.\n  var remoteSsrc = SDPUtils.matchPrefix(mediaSection, 'a=ssrc:')\n      .map(function(line) {\n        return SDPUtils.parseSsrcMedia(line);\n      })\n      .filter(function(obj) {\n        return obj.attribute === 'cname';\n      })[0];\n  if (remoteSsrc) {\n    rtcpParameters.cname = remoteSsrc.value;\n    rtcpParameters.ssrc = remoteSsrc.ssrc;\n  }\n\n  // Edge uses the compound attribute instead of reducedSize\n  // compound is !reducedSize\n  var rsize = SDPUtils.matchPrefix(mediaSection, 'a=rtcp-rsize');\n  rtcpParameters.reducedSize = rsize.length > 0;\n  rtcpParameters.compound = rsize.length === 0;\n\n  // parses the rtcp-mux attrbute.\n  // Note that Edge does not support unmuxed RTCP.\n  var mux = SDPUtils.matchPrefix(mediaSection, 'a=rtcp-mux');\n  rtcpParameters.mux = mux.length > 0;\n\n  return rtcpParameters;\n};\n\n// parses either a=msid: or a=ssrc:... msid lines and returns\n// the id of the MediaStream and MediaStreamTrack.\nSDPUtils.parseMsid = function(mediaSection) {\n  var parts;\n  var spec = SDPUtils.matchPrefix(mediaSection, 'a=msid:');\n  if (spec.length === 1) {\n    parts = spec[0].substr(7).split(' ');\n    return {stream: parts[0], track: parts[1]};\n  }\n  var planB = SDPUtils.matchPrefix(mediaSection, 'a=ssrc:')\n  .map(function(line) {\n    return SDPUtils.parseSsrcMedia(line);\n  })\n  .filter(function(parts) {\n    return parts.attribute === 'msid';\n  });\n  if (planB.length > 0) {\n    parts = planB[0].value.split(' ');\n    return {stream: parts[0], track: parts[1]};\n  }\n};\n\n// Generate a session ID for SDP.\n// https://tools.ietf.org/html/draft-ietf-rtcweb-jsep-20#section-5.2.1\n// recommends using a cryptographically random +ve 64-bit value\n// but right now this should be acceptable and within the right range\nSDPUtils.generateSessionId = function() {\n  return Math.random().toString().substr(2, 21);\n};\n\n// Write boilder plate for start of SDP\n// sessId argument is optional - if not supplied it will\n// be generated randomly\n// sessVersion is optional and defaults to 2\nSDPUtils.writeSessionBoilerplate = function(sessId, sessVer) {\n  var sessionId;\n  var version = sessVer !== undefined ? sessVer : 2;\n  if (sessId) {\n    sessionId = sessId;\n  } else {\n    sessionId = SDPUtils.generateSessionId();\n  }\n  // FIXME: sess-id should be an NTP timestamp.\n  return 'v=0\\r\\n' +\n      'o=thisisadapterortc ' + sessionId + ' ' + version + ' IN IP4 127.0.0.1\\r\\n' +\n      's=-\\r\\n' +\n      't=0 0\\r\\n';\n};\n\nSDPUtils.writeMediaSection = function(transceiver, caps, type, stream) {\n  var sdp = SDPUtils.writeRtpDescription(transceiver.kind, caps);\n\n  // Map ICE parameters (ufrag, pwd) to SDP.\n  sdp += SDPUtils.writeIceParameters(\n      transceiver.iceGatherer.getLocalParameters());\n\n  // Map DTLS parameters to SDP.\n  sdp += SDPUtils.writeDtlsParameters(\n      transceiver.dtlsTransport.getLocalParameters(),\n      type === 'offer' ? 'actpass' : 'active');\n\n  sdp += 'a=mid:' + transceiver.mid + '\\r\\n';\n\n  if (transceiver.direction) {\n    sdp += 'a=' + transceiver.direction + '\\r\\n';\n  } else if (transceiver.rtpSender && transceiver.rtpReceiver) {\n    sdp += 'a=sendrecv\\r\\n';\n  } else if (transceiver.rtpSender) {\n    sdp += 'a=sendonly\\r\\n';\n  } else if (transceiver.rtpReceiver) {\n    sdp += 'a=recvonly\\r\\n';\n  } else {\n    sdp += 'a=inactive\\r\\n';\n  }\n\n  if (transceiver.rtpSender) {\n    // spec.\n    var msid = 'msid:' + stream.id + ' ' +\n        transceiver.rtpSender.track.id + '\\r\\n';\n    sdp += 'a=' + msid;\n\n    // for Chrome.\n    sdp += 'a=ssrc:' + transceiver.sendEncodingParameters[0].ssrc +\n        ' ' + msid;\n    if (transceiver.sendEncodingParameters[0].rtx) {\n      sdp += 'a=ssrc:' + transceiver.sendEncodingParameters[0].rtx.ssrc +\n          ' ' + msid;\n      sdp += 'a=ssrc-group:FID ' +\n          transceiver.sendEncodingParameters[0].ssrc + ' ' +\n          transceiver.sendEncodingParameters[0].rtx.ssrc +\n          '\\r\\n';\n    }\n  }\n  // FIXME: this should be written by writeRtpDescription.\n  sdp += 'a=ssrc:' + transceiver.sendEncodingParameters[0].ssrc +\n      ' cname:' + SDPUtils.localCName + '\\r\\n';\n  if (transceiver.rtpSender && transceiver.sendEncodingParameters[0].rtx) {\n    sdp += 'a=ssrc:' + transceiver.sendEncodingParameters[0].rtx.ssrc +\n        ' cname:' + SDPUtils.localCName + '\\r\\n';\n  }\n  return sdp;\n};\n\n// Gets the direction from the mediaSection or the sessionpart.\nSDPUtils.getDirection = function(mediaSection, sessionpart) {\n  // Look for sendrecv, sendonly, recvonly, inactive, default to sendrecv.\n  var lines = SDPUtils.splitLines(mediaSection);\n  for (var i = 0; i < lines.length; i++) {\n    switch (lines[i]) {\n      case 'a=sendrecv':\n      case 'a=sendonly':\n      case 'a=recvonly':\n      case 'a=inactive':\n        return lines[i].substr(2);\n      default:\n        // FIXME: What should happen here?\n    }\n  }\n  if (sessionpart) {\n    return SDPUtils.getDirection(sessionpart);\n  }\n  return 'sendrecv';\n};\n\nSDPUtils.getKind = function(mediaSection) {\n  var lines = SDPUtils.splitLines(mediaSection);\n  var mline = lines[0].split(' ');\n  return mline[0].substr(2);\n};\n\nSDPUtils.isRejected = function(mediaSection) {\n  return mediaSection.split(' ', 2)[1] === '0';\n};\n\nSDPUtils.parseMLine = function(mediaSection) {\n  var lines = SDPUtils.splitLines(mediaSection);\n  var mline = lines[0].split(' ');\n  return {\n    kind: mline[0].substr(2),\n    port: parseInt(mline[1], 10),\n    protocol: mline[2],\n    fmt: mline.slice(3).join(' ')\n  };\n};\n\n// Expose public methods.\nif (typeof module === 'object') {\n  module.exports = SDPUtils;\n}\n\n},{}],3:[function(require,module,exports){\n(function (global){\n/*\n *  Copyright (c) 2016 The WebRTC project authors. All Rights Reserved.\n *\n *  Use of this source code is governed by a BSD-style license\n *  that can be found in the LICENSE file in the root of the source\n *  tree.\n */\n /* eslint-env node */\n\n'use strict';\n\nvar adapterFactory = require('./adapter_factory.js');\nmodule.exports = adapterFactory({window: global.window});\n\n}).call(this,typeof global !== \"undefined\" ? global : typeof self !== \"undefined\" ? self : typeof window !== \"undefined\" ? window : {})\n},{\"./adapter_factory.js\":4}],4:[function(require,module,exports){\n/*\n *  Copyright (c) 2016 The WebRTC project authors. All Rights Reserved.\n *\n *  Use of this source code is governed by a BSD-style license\n *  that can be found in the LICENSE file in the root of the source\n *  tree.\n */\n /* eslint-env node */\n\n'use strict';\n\nvar utils = require('./utils');\n// Shimming starts here.\nmodule.exports = function(dependencies, opts) {\n  var window = dependencies && dependencies.window;\n\n  var options = {\n    shimChrome: true,\n    shimFirefox: true,\n    shimEdge: true,\n    shimSafari: true,\n  };\n\n  for (var key in opts) {\n    if (hasOwnProperty.call(opts, key)) {\n      options[key] = opts[key];\n    }\n  }\n\n  // Utils.\n  var logging = utils.log;\n  var browserDetails = utils.detectBrowser(window);\n\n  // Export to the adapter global object visible in the browser.\n  var adapter = {\n    browserDetails: browserDetails,\n    extractVersion: utils.extractVersion,\n    disableLog: utils.disableLog,\n    disableWarnings: utils.disableWarnings\n  };\n\n  // Uncomment the line below if you want logging to occur, including logging\n  // for the switch statement below. Can also be turned on in the browser via\n  // adapter.disableLog(false), but then logging from the switch statement below\n  // will not appear.\n  // require('./utils').disableLog(false);\n\n  // Browser shims.\n  var chromeShim = require('./chrome/chrome_shim') || null;\n  var edgeShim = require('./edge/edge_shim') || null;\n  var firefoxShim = require('./firefox/firefox_shim') || null;\n  var safariShim = require('./safari/safari_shim') || null;\n  var commonShim = require('./common_shim') || null;\n\n  // Shim browser if found.\n  switch (browserDetails.browser) {\n    case 'chrome':\n      if (!chromeShim || !chromeShim.shimPeerConnection ||\n          !options.shimChrome) {\n        logging('Chrome shim is not included in this adapter release.');\n        return adapter;\n      }\n      logging('adapter.js shimming chrome.');\n      // Export to the adapter global object visible in the browser.\n      adapter.browserShim = chromeShim;\n      commonShim.shimCreateObjectURL(window);\n\n      chromeShim.shimGetUserMedia(window);\n      chromeShim.shimMediaStream(window);\n      chromeShim.shimSourceObject(window);\n      chromeShim.shimPeerConnection(window);\n      chromeShim.shimOnTrack(window);\n      chromeShim.shimAddTrackRemoveTrack(window);\n      chromeShim.shimGetSendersWithDtmf(window);\n\n      commonShim.shimRTCIceCandidate(window);\n      break;\n    case 'firefox':\n      if (!firefoxShim || !firefoxShim.shimPeerConnection ||\n          !options.shimFirefox) {\n        logging('Firefox shim is not included in this adapter release.');\n        return adapter;\n      }\n      logging('adapter.js shimming firefox.');\n      // Export to the adapter global object visible in the browser.\n      adapter.browserShim = firefoxShim;\n      commonShim.shimCreateObjectURL(window);\n\n      firefoxShim.shimGetUserMedia(window);\n      firefoxShim.shimSourceObject(window);\n      firefoxShim.shimPeerConnection(window);\n      firefoxShim.shimOnTrack(window);\n      firefoxShim.shimRemoveStream(window);\n\n      commonShim.shimRTCIceCandidate(window);\n      break;\n    case 'edge':\n      if (!edgeShim || !edgeShim.shimPeerConnection || !options.shimEdge) {\n        logging('MS edge shim is not included in this adapter release.');\n        return adapter;\n      }\n      logging('adapter.js shimming edge.');\n      // Export to the adapter global object visible in the browser.\n      adapter.browserShim = edgeShim;\n      commonShim.shimCreateObjectURL(window);\n\n      edgeShim.shimGetUserMedia(window);\n      edgeShim.shimPeerConnection(window);\n      edgeShim.shimReplaceTrack(window);\n\n      // the edge shim implements the full RTCIceCandidate object.\n      break;\n    case 'safari':\n      if (!safariShim || !options.shimSafari) {\n        logging('Safari shim is not included in this adapter release.');\n        return adapter;\n      }\n      logging('adapter.js shimming safari.');\n      // Export to the adapter global object visible in the browser.\n      adapter.browserShim = safariShim;\n      commonShim.shimCreateObjectURL(window);\n\n      safariShim.shimRTCIceServerUrls(window);\n      safariShim.shimCallbacksAPI(window);\n      safariShim.shimLocalStreamsAPI(window);\n      safariShim.shimRemoteStreamsAPI(window);\n      safariShim.shimTrackEventTransceiver(window);\n      safariShim.shimGetUserMedia(window);\n      safariShim.shimCreateOfferLegacy(window);\n\n      commonShim.shimRTCIceCandidate(window);\n      break;\n    default:\n      logging('Unsupported browser!');\n      break;\n  }\n\n  return adapter;\n};\n\n},{\"./chrome/chrome_shim\":5,\"./common_shim\":7,\"./edge/edge_shim\":8,\"./firefox/firefox_shim\":10,\"./safari/safari_shim\":12,\"./utils\":13}],5:[function(require,module,exports){\n\n/*\n *  Copyright (c) 2016 The WebRTC project authors. All Rights Reserved.\n *\n *  Use of this source code is governed by a BSD-style license\n *  that can be found in the LICENSE file in the root of the source\n *  tree.\n */\n /* eslint-env node */\n'use strict';\nvar utils = require('../utils.js');\nvar logging = utils.log;\n\nmodule.exports = {\n  shimGetUserMedia: require('./getusermedia'),\n  shimMediaStream: function(window) {\n    window.MediaStream = window.MediaStream || window.webkitMediaStream;\n  },\n\n  shimOnTrack: function(window) {\n    if (typeof window === 'object' && window.RTCPeerConnection && !('ontrack' in\n        window.RTCPeerConnection.prototype)) {\n      Object.defineProperty(window.RTCPeerConnection.prototype, 'ontrack', {\n        get: function() {\n          return this._ontrack;\n        },\n        set: function(f) {\n          if (this._ontrack) {\n            this.removeEventListener('track', this._ontrack);\n          }\n          this.addEventListener('track', this._ontrack = f);\n        }\n      });\n      var origSetRemoteDescription =\n          window.RTCPeerConnection.prototype.setRemoteDescription;\n      window.RTCPeerConnection.prototype.setRemoteDescription = function() {\n        var pc = this;\n        if (!pc._ontrackpoly) {\n          pc._ontrackpoly = function(e) {\n            // onaddstream does not fire when a track is added to an existing\n            // stream. But stream.onaddtrack is implemented so we use that.\n            e.stream.addEventListener('addtrack', function(te) {\n              var receiver;\n              if (window.RTCPeerConnection.prototype.getReceivers) {\n                receiver = pc.getReceivers().find(function(r) {\n                  return r.track && r.track.id === te.track.id;\n                });\n              } else {\n                receiver = {track: te.track};\n              }\n\n              var event = new Event('track');\n              event.track = te.track;\n              event.receiver = receiver;\n              event.transceiver = {receiver: receiver};\n              event.streams = [e.stream];\n              pc.dispatchEvent(event);\n            });\n            e.stream.getTracks().forEach(function(track) {\n              var receiver;\n              if (window.RTCPeerConnection.prototype.getReceivers) {\n                receiver = pc.getReceivers().find(function(r) {\n                  return r.track && r.track.id === track.id;\n                });\n              } else {\n                receiver = {track: track};\n              }\n              var event = new Event('track');\n              event.track = track;\n              event.receiver = receiver;\n              event.transceiver = {receiver: receiver};\n              event.streams = [e.stream];\n              pc.dispatchEvent(event);\n            });\n          };\n          pc.addEventListener('addstream', pc._ontrackpoly);\n        }\n        return origSetRemoteDescription.apply(pc, arguments);\n      };\n    }\n  },\n\n  shimGetSendersWithDtmf: function(window) {\n    // Overrides addTrack/removeTrack, depends on shimAddTrackRemoveTrack.\n    if (typeof window === 'object' && window.RTCPeerConnection &&\n        !('getSenders' in window.RTCPeerConnection.prototype) &&\n        'createDTMFSender' in window.RTCPeerConnection.prototype) {\n      var shimSenderWithDtmf = function(pc, track) {\n        return {\n          track: track,\n          get dtmf() {\n            if (this._dtmf === undefined) {\n              if (track.kind === 'audio') {\n                this._dtmf = pc.createDTMFSender(track);\n              } else {\n                this._dtmf = null;\n              }\n            }\n            return this._dtmf;\n          },\n          _pc: pc\n        };\n      };\n\n      // augment addTrack when getSenders is not available.\n      if (!window.RTCPeerConnection.prototype.getSenders) {\n        window.RTCPeerConnection.prototype.getSenders = function() {\n          this._senders = this._senders || [];\n          return this._senders.slice(); // return a copy of the internal state.\n        };\n        var origAddTrack = window.RTCPeerConnection.prototype.addTrack;\n        window.RTCPeerConnection.prototype.addTrack = function(track, stream) {\n          var pc = this;\n          var sender = origAddTrack.apply(pc, arguments);\n          if (!sender) {\n            sender = shimSenderWithDtmf(pc, track);\n            pc._senders.push(sender);\n          }\n          return sender;\n        };\n\n        var origRemoveTrack = window.RTCPeerConnection.prototype.removeTrack;\n        window.RTCPeerConnection.prototype.removeTrack = function(sender) {\n          var pc = this;\n          origRemoveTrack.apply(pc, arguments);\n          var idx = pc._senders.indexOf(sender);\n          if (idx !== -1) {\n            pc._senders.splice(idx, 1);\n          }\n        };\n      }\n      var origAddStream = window.RTCPeerConnection.prototype.addStream;\n      window.RTCPeerConnection.prototype.addStream = function(stream) {\n        var pc = this;\n        pc._senders = pc._senders || [];\n        origAddStream.apply(pc, [stream]);\n        stream.getTracks().forEach(function(track) {\n          pc._senders.push(shimSenderWithDtmf(pc, track));\n        });\n      };\n\n      var origRemoveStream = window.RTCPeerConnection.prototype.removeStream;\n      window.RTCPeerConnection.prototype.removeStream = function(stream) {\n        var pc = this;\n        pc._senders = pc._senders || [];\n        origRemoveStream.apply(pc, [stream]);\n\n        stream.getTracks().forEach(function(track) {\n          var sender = pc._senders.find(function(s) {\n            return s.track === track;\n          });\n          if (sender) {\n            pc._senders.splice(pc._senders.indexOf(sender), 1); // remove sender\n          }\n        });\n      };\n    } else if (typeof window === 'object' && window.RTCPeerConnection &&\n               'getSenders' in window.RTCPeerConnection.prototype &&\n               'createDTMFSender' in window.RTCPeerConnection.prototype &&\n               window.RTCRtpSender &&\n               !('dtmf' in window.RTCRtpSender.prototype)) {\n      var origGetSenders = window.RTCPeerConnection.prototype.getSenders;\n      window.RTCPeerConnection.prototype.getSenders = function() {\n        var pc = this;\n        var senders = origGetSenders.apply(pc, []);\n        senders.forEach(function(sender) {\n          sender._pc = pc;\n        });\n        return senders;\n      };\n\n      Object.defineProperty(window.RTCRtpSender.prototype, 'dtmf', {\n        get: function() {\n          if (this._dtmf === undefined) {\n            if (this.track.kind === 'audio') {\n              this._dtmf = this._pc.createDTMFSender(this.track);\n            } else {\n              this._dtmf = null;\n            }\n          }\n          return this._dtmf;\n        }\n      });\n    }\n  },\n\n  shimSourceObject: function(window) {\n    var URL = window && window.URL;\n\n    if (typeof window === 'object') {\n      if (window.HTMLMediaElement &&\n        !('srcObject' in window.HTMLMediaElement.prototype)) {\n        // Shim the srcObject property, once, when HTMLMediaElement is found.\n        Object.defineProperty(window.HTMLMediaElement.prototype, 'srcObject', {\n          get: function() {\n            return this._srcObject;\n          },\n          set: function(stream) {\n            var self = this;\n            // Use _srcObject as a private property for this shim\n            this._srcObject = stream;\n            if (this.src) {\n              URL.revokeObjectURL(this.src);\n            }\n\n            if (!stream) {\n              this.src = '';\n              return undefined;\n            }\n            this.src = URL.createObjectURL(stream);\n            // We need to recreate the blob url when a track is added or\n            // removed. Doing it manually since we want to avoid a recursion.\n            stream.addEventListener('addtrack', function() {\n              if (self.src) {\n                URL.revokeObjectURL(self.src);\n              }\n              self.src = URL.createObjectURL(stream);\n            });\n            stream.addEventListener('removetrack', function() {\n              if (self.src) {\n                URL.revokeObjectURL(self.src);\n              }\n              self.src = URL.createObjectURL(stream);\n            });\n          }\n        });\n      }\n    }\n  },\n\n  shimAddTrackRemoveTrackWithNative: function(window) {\n    // shim addTrack/removeTrack with native variants in order to make\n    // the interactions with legacy getLocalStreams behave as in other browsers.\n    // Keeps a mapping stream.id => [stream, rtpsenders...]\n    window.RTCPeerConnection.prototype.getLocalStreams = function() {\n      var pc = this;\n      this._shimmedLocalStreams = this._shimmedLocalStreams || {};\n      return Object.keys(this._shimmedLocalStreams).map(function(streamId) {\n        return pc._shimmedLocalStreams[streamId][0];\n      });\n    };\n\n    var origAddTrack = window.RTCPeerConnection.prototype.addTrack;\n    window.RTCPeerConnection.prototype.addTrack = function(track, stream) {\n      if (!stream) {\n        return origAddTrack.apply(this, arguments);\n      }\n      this._shimmedLocalStreams = this._shimmedLocalStreams || {};\n\n      var sender = origAddTrack.apply(this, arguments);\n      if (!this._shimmedLocalStreams[stream.id]) {\n        this._shimmedLocalStreams[stream.id] = [stream, sender];\n      } else if (this._shimmedLocalStreams[stream.id].indexOf(sender) === -1) {\n        this._shimmedLocalStreams[stream.id].push(sender);\n      }\n      return sender;\n    };\n\n    var origAddStream = window.RTCPeerConnection.prototype.addStream;\n    window.RTCPeerConnection.prototype.addStream = function(stream) {\n      var pc = this;\n      this._shimmedLocalStreams = this._shimmedLocalStreams || {};\n\n      stream.getTracks().forEach(function(track) {\n        var alreadyExists = pc.getSenders().find(function(s) {\n          return s.track === track;\n        });\n        if (alreadyExists) {\n          throw new DOMException('Track already exists.',\n              'InvalidAccessError');\n        }\n      });\n      var existingSenders = pc.getSenders();\n      origAddStream.apply(this, arguments);\n      var newSenders = pc.getSenders().filter(function(newSender) {\n        return existingSenders.indexOf(newSender) === -1;\n      });\n      this._shimmedLocalStreams[stream.id] = [stream].concat(newSenders);\n    };\n\n    var origRemoveStream = window.RTCPeerConnection.prototype.removeStream;\n    window.RTCPeerConnection.prototype.removeStream = function(stream) {\n      this._shimmedLocalStreams = this._shimmedLocalStreams || {};\n      delete this._shimmedLocalStreams[stream.id];\n      return origRemoveStream.apply(this, arguments);\n    };\n\n    var origRemoveTrack = window.RTCPeerConnection.prototype.removeTrack;\n    window.RTCPeerConnection.prototype.removeTrack = function(sender) {\n      var pc = this;\n      this._shimmedLocalStreams = this._shimmedLocalStreams || {};\n      if (sender) {\n        Object.keys(this._shimmedLocalStreams).forEach(function(streamId) {\n          var idx = pc._shimmedLocalStreams[streamId].indexOf(sender);\n          if (idx !== -1) {\n            pc._shimmedLocalStreams[streamId].splice(idx, 1);\n          }\n          if (pc._shimmedLocalStreams[streamId].length === 1) {\n            delete pc._shimmedLocalStreams[streamId];\n          }\n        });\n      }\n      return origRemoveTrack.apply(this, arguments);\n    };\n  },\n\n  shimAddTrackRemoveTrack: function(window) {\n    var browserDetails = utils.detectBrowser(window);\n    // shim addTrack and removeTrack.\n    if (window.RTCPeerConnection.prototype.addTrack &&\n        browserDetails.version >= 65) {\n      return this.shimAddTrackRemoveTrackWithNative(window);\n    }\n\n    // also shim pc.getLocalStreams when addTrack is shimmed\n    // to return the original streams.\n    var origGetLocalStreams = window.RTCPeerConnection.prototype\n        .getLocalStreams;\n    window.RTCPeerConnection.prototype.getLocalStreams = function() {\n      var pc = this;\n      var nativeStreams = origGetLocalStreams.apply(this);\n      pc._reverseStreams = pc._reverseStreams || {};\n      return nativeStreams.map(function(stream) {\n        return pc._reverseStreams[stream.id];\n      });\n    };\n\n    var origAddStream = window.RTCPeerConnection.prototype.addStream;\n    window.RTCPeerConnection.prototype.addStream = function(stream) {\n      var pc = this;\n      pc._streams = pc._streams || {};\n      pc._reverseStreams = pc._reverseStreams || {};\n\n      stream.getTracks().forEach(function(track) {\n        var alreadyExists = pc.getSenders().find(function(s) {\n          return s.track === track;\n        });\n        if (alreadyExists) {\n          throw new DOMException('Track already exists.',\n              'InvalidAccessError');\n        }\n      });\n      // Add identity mapping for consistency with addTrack.\n      // Unless this is being used with a stream from addTrack.\n      if (!pc._reverseStreams[stream.id]) {\n        var newStream = new window.MediaStream(stream.getTracks());\n        pc._streams[stream.id] = newStream;\n        pc._reverseStreams[newStream.id] = stream;\n        stream = newStream;\n      }\n      origAddStream.apply(pc, [stream]);\n    };\n\n    var origRemoveStream = window.RTCPeerConnection.prototype.removeStream;\n    window.RTCPeerConnection.prototype.removeStream = function(stream) {\n      var pc = this;\n      pc._streams = pc._streams || {};\n      pc._reverseStreams = pc._reverseStreams || {};\n\n      origRemoveStream.apply(pc, [(pc._streams[stream.id] || stream)]);\n      delete pc._reverseStreams[(pc._streams[stream.id] ?\n          pc._streams[stream.id].id : stream.id)];\n      delete pc._streams[stream.id];\n    };\n\n    window.RTCPeerConnection.prototype.addTrack = function(track, stream) {\n      var pc = this;\n      if (pc.signalingState === 'closed') {\n        throw new DOMException(\n          'The RTCPeerConnection\\'s signalingState is \\'closed\\'.',\n          'InvalidStateError');\n      }\n      var streams = [].slice.call(arguments, 1);\n      if (streams.length !== 1 ||\n          !streams[0].getTracks().find(function(t) {\n            return t === track;\n          })) {\n        // this is not fully correct but all we can manage without\n        // [[associated MediaStreams]] internal slot.\n        throw new DOMException(\n          'The adapter.js addTrack polyfill only supports a single ' +\n          ' stream which is associated with the specified track.',\n          'NotSupportedError');\n      }\n\n      var alreadyExists = pc.getSenders().find(function(s) {\n        return s.track === track;\n      });\n      if (alreadyExists) {\n        throw new DOMException('Track already exists.',\n            'InvalidAccessError');\n      }\n\n      pc._streams = pc._streams || {};\n      pc._reverseStreams = pc._reverseStreams || {};\n      var oldStream = pc._streams[stream.id];\n      if (oldStream) {\n        // this is using odd Chrome behaviour, use with caution:\n        // https://bugs.chromium.org/p/webrtc/issues/detail?id=7815\n        // Note: we rely on the high-level addTrack/dtmf shim to\n        // create the sender with a dtmf sender.\n        oldStream.addTrack(track);\n\n        // Trigger ONN async.\n        Promise.resolve().then(function() {\n          pc.dispatchEvent(new Event('negotiationneeded'));\n        });\n      } else {\n        var newStream = new window.MediaStream([track]);\n        pc._streams[stream.id] = newStream;\n        pc._reverseStreams[newStream.id] = stream;\n        pc.addStream(newStream);\n      }\n      return pc.getSenders().find(function(s) {\n        return s.track === track;\n      });\n    };\n\n    // replace the internal stream id with the external one and\n    // vice versa.\n    function replaceInternalStreamId(pc, description) {\n      var sdp = description.sdp;\n      Object.keys(pc._reverseStreams || []).forEach(function(internalId) {\n        var externalStream = pc._reverseStreams[internalId];\n        var internalStream = pc._streams[externalStream.id];\n        sdp = sdp.replace(new RegExp(internalStream.id, 'g'),\n            externalStream.id);\n      });\n      return new RTCSessionDescription({\n        type: description.type,\n        sdp: sdp\n      });\n    }\n    function replaceExternalStreamId(pc, description) {\n      var sdp = description.sdp;\n      Object.keys(pc._reverseStreams || []).forEach(function(internalId) {\n        var externalStream = pc._reverseStreams[internalId];\n        var internalStream = pc._streams[externalStream.id];\n        sdp = sdp.replace(new RegExp(externalStream.id, 'g'),\n            internalStream.id);\n      });\n      return new RTCSessionDescription({\n        type: description.type,\n        sdp: sdp\n      });\n    }\n    ['createOffer', 'createAnswer'].forEach(function(method) {\n      var nativeMethod = window.RTCPeerConnection.prototype[method];\n      window.RTCPeerConnection.prototype[method] = function() {\n        var pc = this;\n        var args = arguments;\n        var isLegacyCall = arguments.length &&\n            typeof arguments[0] === 'function';\n        if (isLegacyCall) {\n          return nativeMethod.apply(pc, [\n            function(description) {\n              var desc = replaceInternalStreamId(pc, description);\n              args[0].apply(null, [desc]);\n            },\n            function(err) {\n              if (args[1]) {\n                args[1].apply(null, err);\n              }\n            }, arguments[2]\n          ]);\n        }\n        return nativeMethod.apply(pc, arguments)\n        .then(function(description) {\n          return replaceInternalStreamId(pc, description);\n        });\n      };\n    });\n\n    var origSetLocalDescription =\n        window.RTCPeerConnection.prototype.setLocalDescription;\n    window.RTCPeerConnection.prototype.setLocalDescription = function() {\n      var pc = this;\n      if (!arguments.length || !arguments[0].type) {\n        return origSetLocalDescription.apply(pc, arguments);\n      }\n      arguments[0] = replaceExternalStreamId(pc, arguments[0]);\n      return origSetLocalDescription.apply(pc, arguments);\n    };\n\n    // TODO: mangle getStats: https://w3c.github.io/webrtc-stats/#dom-rtcmediastreamstats-streamidentifier\n\n    var origLocalDescription = Object.getOwnPropertyDescriptor(\n        window.RTCPeerConnection.prototype, 'localDescription');\n    Object.defineProperty(window.RTCPeerConnection.prototype,\n        'localDescription', {\n          get: function() {\n            var pc = this;\n            var description = origLocalDescription.get.apply(this);\n            if (description.type === '') {\n              return description;\n            }\n            return replaceInternalStreamId(pc, description);\n          }\n        });\n\n    window.RTCPeerConnection.prototype.removeTrack = function(sender) {\n      var pc = this;\n      if (pc.signalingState === 'closed') {\n        throw new DOMException(\n          'The RTCPeerConnection\\'s signalingState is \\'closed\\'.',\n          'InvalidStateError');\n      }\n      // We can not yet check for sender instanceof RTCRtpSender\n      // since we shim RTPSender. So we check if sender._pc is set.\n      if (!sender._pc) {\n        throw new DOMException('Argument 1 of RTCPeerConnection.removeTrack ' +\n            'does not implement interface RTCRtpSender.', 'TypeError');\n      }\n      var isLocal = sender._pc === pc;\n      if (!isLocal) {\n        throw new DOMException('Sender was not created by this connection.',\n            'InvalidAccessError');\n      }\n\n      // Search for the native stream the senders track belongs to.\n      pc._streams = pc._streams || {};\n      var stream;\n      Object.keys(pc._streams).forEach(function(streamid) {\n        var hasTrack = pc._streams[streamid].getTracks().find(function(track) {\n          return sender.track === track;\n        });\n        if (hasTrack) {\n          stream = pc._streams[streamid];\n        }\n      });\n\n      if (stream) {\n        if (stream.getTracks().length === 1) {\n          // if this is the last track of the stream, remove the stream. This\n          // takes care of any shimmed _senders.\n          pc.removeStream(pc._reverseStreams[stream.id]);\n        } else {\n          // relying on the same odd chrome behaviour as above.\n          stream.removeTrack(sender.track);\n        }\n        pc.dispatchEvent(new Event('negotiationneeded'));\n      }\n    };\n  },\n\n  shimPeerConnection: function(window) {\n    var browserDetails = utils.detectBrowser(window);\n\n    // The RTCPeerConnection object.\n    if (!window.RTCPeerConnection) {\n      window.RTCPeerConnection = function(pcConfig, pcConstraints) {\n        // Translate iceTransportPolicy to iceTransports,\n        // see https://code.google.com/p/webrtc/issues/detail?id=4869\n        // this was fixed in M56 along with unprefixing RTCPeerConnection.\n        logging('PeerConnection');\n        if (pcConfig && pcConfig.iceTransportPolicy) {\n          pcConfig.iceTransports = pcConfig.iceTransportPolicy;\n        }\n\n        return new window.webkitRTCPeerConnection(pcConfig, pcConstraints);\n      };\n      window.RTCPeerConnection.prototype =\n          window.webkitRTCPeerConnection.prototype;\n      // wrap static methods. Currently just generateCertificate.\n      if (window.webkitRTCPeerConnection.generateCertificate) {\n        Object.defineProperty(window.RTCPeerConnection, 'generateCertificate', {\n          get: function() {\n            return window.webkitRTCPeerConnection.generateCertificate;\n          }\n        });\n      }\n    } else {\n      // migrate from non-spec RTCIceServer.url to RTCIceServer.urls\n      var OrigPeerConnection = window.RTCPeerConnection;\n      window.RTCPeerConnection = function(pcConfig, pcConstraints) {\n        if (pcConfig && pcConfig.iceServers) {\n          var newIceServers = [];\n          for (var i = 0; i < pcConfig.iceServers.length; i++) {\n            var server = pcConfig.iceServers[i];\n            if (!server.hasOwnProperty('urls') &&\n                server.hasOwnProperty('url')) {\n              utils.deprecated('RTCIceServer.url', 'RTCIceServer.urls');\n              server = JSON.parse(JSON.stringify(server));\n              server.urls = server.url;\n              newIceServers.push(server);\n            } else {\n              newIceServers.push(pcConfig.iceServers[i]);\n            }\n          }\n          pcConfig.iceServers = newIceServers;\n        }\n        return new OrigPeerConnection(pcConfig, pcConstraints);\n      };\n      window.RTCPeerConnection.prototype = OrigPeerConnection.prototype;\n      // wrap static methods. Currently just generateCertificate.\n      Object.defineProperty(window.RTCPeerConnection, 'generateCertificate', {\n        get: function() {\n          return OrigPeerConnection.generateCertificate;\n        }\n      });\n    }\n\n    var origGetStats = window.RTCPeerConnection.prototype.getStats;\n    window.RTCPeerConnection.prototype.getStats = function(selector,\n        successCallback, errorCallback) {\n      var pc = this;\n      var args = arguments;\n\n      // If selector is a function then we are in the old style stats so just\n      // pass back the original getStats format to avoid breaking old users.\n      if (arguments.length > 0 && typeof selector === 'function') {\n        return origGetStats.apply(this, arguments);\n      }\n\n      // When spec-style getStats is supported, return those when called with\n      // either no arguments or the selector argument is null.\n      if (origGetStats.length === 0 && (arguments.length === 0 ||\n          typeof arguments[0] !== 'function')) {\n        return origGetStats.apply(this, []);\n      }\n\n      var fixChromeStats_ = function(response) {\n        var standardReport = {};\n        var reports = response.result();\n        reports.forEach(function(report) {\n          var standardStats = {\n            id: report.id,\n            timestamp: report.timestamp,\n            type: {\n              localcandidate: 'local-candidate',\n              remotecandidate: 'remote-candidate'\n            }[report.type] || report.type\n          };\n          report.names().forEach(function(name) {\n            standardStats[name] = report.stat(name);\n          });\n          standardReport[standardStats.id] = standardStats;\n        });\n\n        return standardReport;\n      };\n\n      // shim getStats with maplike support\n      var makeMapStats = function(stats) {\n        return new Map(Object.keys(stats).map(function(key) {\n          return [key, stats[key]];\n        }));\n      };\n\n      if (arguments.length >= 2) {\n        var successCallbackWrapper_ = function(response) {\n          args[1](makeMapStats(fixChromeStats_(response)));\n        };\n\n        return origGetStats.apply(this, [successCallbackWrapper_,\n          arguments[0]]);\n      }\n\n      // promise-support\n      return new Promise(function(resolve, reject) {\n        origGetStats.apply(pc, [\n          function(response) {\n            resolve(makeMapStats(fixChromeStats_(response)));\n          }, reject]);\n      }).then(successCallback, errorCallback);\n    };\n\n    // add promise support -- natively available in Chrome 51\n    if (browserDetails.version < 51) {\n      ['setLocalDescription', 'setRemoteDescription', 'addIceCandidate']\n          .forEach(function(method) {\n            var nativeMethod = window.RTCPeerConnection.prototype[method];\n            window.RTCPeerConnection.prototype[method] = function() {\n              var args = arguments;\n              var pc = this;\n              var promise = new Promise(function(resolve, reject) {\n                nativeMethod.apply(pc, [args[0], resolve, reject]);\n              });\n              if (args.length < 2) {\n                return promise;\n              }\n              return promise.then(function() {\n                args[1].apply(null, []);\n              },\n              function(err) {\n                if (args.length >= 3) {\n                  args[2].apply(null, [err]);\n                }\n              });\n            };\n          });\n    }\n\n    // promise support for createOffer and createAnswer. Available (without\n    // bugs) since M52: crbug/619289\n    if (browserDetails.version < 52) {\n      ['createOffer', 'createAnswer'].forEach(function(method) {\n        var nativeMethod = window.RTCPeerConnection.prototype[method];\n        window.RTCPeerConnection.prototype[method] = function() {\n          var pc = this;\n          if (arguments.length < 1 || (arguments.length === 1 &&\n              typeof arguments[0] === 'object')) {\n            var opts = arguments.length === 1 ? arguments[0] : undefined;\n            return new Promise(function(resolve, reject) {\n              nativeMethod.apply(pc, [resolve, reject, opts]);\n            });\n          }\n          return nativeMethod.apply(this, arguments);\n        };\n      });\n    }\n\n    // shim implicit creation of RTCSessionDescription/RTCIceCandidate\n    ['setLocalDescription', 'setRemoteDescription', 'addIceCandidate']\n        .forEach(function(method) {\n          var nativeMethod = window.RTCPeerConnection.prototype[method];\n          window.RTCPeerConnection.prototype[method] = function() {\n            arguments[0] = new ((method === 'addIceCandidate') ?\n                window.RTCIceCandidate :\n                window.RTCSessionDescription)(arguments[0]);\n            return nativeMethod.apply(this, arguments);\n          };\n        });\n\n    // support for addIceCandidate(null or undefined)\n    var nativeAddIceCandidate =\n        window.RTCPeerConnection.prototype.addIceCandidate;\n    window.RTCPeerConnection.prototype.addIceCandidate = function() {\n      if (!arguments[0]) {\n        if (arguments[1]) {\n          arguments[1].apply(null);\n        }\n        return Promise.resolve();\n      }\n      return nativeAddIceCandidate.apply(this, arguments);\n    };\n  }\n};\n\n},{\"../utils.js\":13,\"./getusermedia\":6}],6:[function(require,module,exports){\n/*\n *  Copyright (c) 2016 The WebRTC project authors. All Rights Reserved.\n *\n *  Use of this source code is governed by a BSD-style license\n *  that can be found in the LICENSE file in the root of the source\n *  tree.\n */\n /* eslint-env node */\n'use strict';\nvar utils = require('../utils.js');\nvar logging = utils.log;\n\n// Expose public methods.\nmodule.exports = function(window) {\n  var browserDetails = utils.detectBrowser(window);\n  var navigator = window && window.navigator;\n\n  var constraintsToChrome_ = function(c) {\n    if (typeof c !== 'object' || c.mandatory || c.optional) {\n      return c;\n    }\n    var cc = {};\n    Object.keys(c).forEach(function(key) {\n      if (key === 'require' || key === 'advanced' || key === 'mediaSource') {\n        return;\n      }\n      var r = (typeof c[key] === 'object') ? c[key] : {ideal: c[key]};\n      if (r.exact !== undefined && typeof r.exact === 'number') {\n        r.min = r.max = r.exact;\n      }\n      var oldname_ = function(prefix, name) {\n        if (prefix) {\n          return prefix + name.charAt(0).toUpperCase() + name.slice(1);\n        }\n        return (name === 'deviceId') ? 'sourceId' : name;\n      };\n      if (r.ideal !== undefined) {\n        cc.optional = cc.optional || [];\n        var oc = {};\n        if (typeof r.ideal === 'number') {\n          oc[oldname_('min', key)] = r.ideal;\n          cc.optional.push(oc);\n          oc = {};\n          oc[oldname_('max', key)] = r.ideal;\n          cc.optional.push(oc);\n        } else {\n          oc[oldname_('', key)] = r.ideal;\n          cc.optional.push(oc);\n        }\n      }\n      if (r.exact !== undefined && typeof r.exact !== 'number') {\n        cc.mandatory = cc.mandatory || {};\n        cc.mandatory[oldname_('', key)] = r.exact;\n      } else {\n        ['min', 'max'].forEach(function(mix) {\n          if (r[mix] !== undefined) {\n            cc.mandatory = cc.mandatory || {};\n            cc.mandatory[oldname_(mix, key)] = r[mix];\n          }\n        });\n      }\n    });\n    if (c.advanced) {\n      cc.optional = (cc.optional || []).concat(c.advanced);\n    }\n    return cc;\n  };\n\n  var shimConstraints_ = function(constraints, func) {\n    if (browserDetails.version >= 61) {\n      return func(constraints);\n    }\n    constraints = JSON.parse(JSON.stringify(constraints));\n    if (constraints && typeof constraints.audio === 'object') {\n      var remap = function(obj, a, b) {\n        if (a in obj && !(b in obj)) {\n          obj[b] = obj[a];\n          delete obj[a];\n        }\n      };\n      constraints = JSON.parse(JSON.stringify(constraints));\n      remap(constraints.audio, 'autoGainControl', 'googAutoGainControl');\n      remap(constraints.audio, 'noiseSuppression', 'googNoiseSuppression');\n      constraints.audio = constraintsToChrome_(constraints.audio);\n    }\n    if (constraints && typeof constraints.video === 'object') {\n      // Shim facingMode for mobile & surface pro.\n      var face = constraints.video.facingMode;\n      face = face && ((typeof face === 'object') ? face : {ideal: face});\n      var getSupportedFacingModeLies = browserDetails.version < 66;\n\n      if ((face && (face.exact === 'user' || face.exact === 'environment' ||\n                    face.ideal === 'user' || face.ideal === 'environment')) &&\n          !(navigator.mediaDevices.getSupportedConstraints &&\n            navigator.mediaDevices.getSupportedConstraints().facingMode &&\n            !getSupportedFacingModeLies)) {\n        delete constraints.video.facingMode;\n        var matches;\n        if (face.exact === 'environment' || face.ideal === 'environment') {\n          matches = ['back', 'rear'];\n        } else if (face.exact === 'user' || face.ideal === 'user') {\n          matches = ['front'];\n        }\n        if (matches) {\n          // Look for matches in label, or use last cam for back (typical).\n          return navigator.mediaDevices.enumerateDevices()\n          .then(function(devices) {\n            devices = devices.filter(function(d) {\n              return d.kind === 'videoinput';\n            });\n            var dev = devices.find(function(d) {\n              return matches.some(function(match) {\n                return d.label.toLowerCase().indexOf(match) !== -1;\n              });\n            });\n            if (!dev && devices.length && matches.indexOf('back') !== -1) {\n              dev = devices[devices.length - 1]; // more likely the back cam\n            }\n            if (dev) {\n              constraints.video.deviceId = face.exact ? {exact: dev.deviceId} :\n                                                        {ideal: dev.deviceId};\n            }\n            constraints.video = constraintsToChrome_(constraints.video);\n            logging('chrome: ' + JSON.stringify(constraints));\n            return func(constraints);\n          });\n        }\n      }\n      constraints.video = constraintsToChrome_(constraints.video);\n    }\n    logging('chrome: ' + JSON.stringify(constraints));\n    return func(constraints);\n  };\n\n  var shimError_ = function(e) {\n    return {\n      name: {\n        PermissionDeniedError: 'NotAllowedError',\n        InvalidStateError: 'NotReadableError',\n        DevicesNotFoundError: 'NotFoundError',\n        ConstraintNotSatisfiedError: 'OverconstrainedError',\n        TrackStartError: 'NotReadableError',\n        MediaDeviceFailedDueToShutdown: 'NotReadableError',\n        MediaDeviceKillSwitchOn: 'NotReadableError'\n      }[e.name] || e.name,\n      message: e.message,\n      constraint: e.constraintName,\n      toString: function() {\n        return this.name + (this.message && ': ') + this.message;\n      }\n    };\n  };\n\n  var getUserMedia_ = function(constraints, onSuccess, onError) {\n    shimConstraints_(constraints, function(c) {\n      navigator.webkitGetUserMedia(c, onSuccess, function(e) {\n        if (onError) {\n          onError(shimError_(e));\n        }\n      });\n    });\n  };\n\n  navigator.getUserMedia = getUserMedia_;\n\n  // Returns the result of getUserMedia as a Promise.\n  var getUserMediaPromise_ = function(constraints) {\n    return new Promise(function(resolve, reject) {\n      navigator.getUserMedia(constraints, resolve, reject);\n    });\n  };\n\n  if (!navigator.mediaDevices) {\n    navigator.mediaDevices = {\n      getUserMedia: getUserMediaPromise_,\n      enumerateDevices: function() {\n        return new Promise(function(resolve) {\n          var kinds = {audio: 'audioinput', video: 'videoinput'};\n          return window.MediaStreamTrack.getSources(function(devices) {\n            resolve(devices.map(function(device) {\n              return {label: device.label,\n                kind: kinds[device.kind],\n                deviceId: device.id,\n                groupId: ''};\n            }));\n          });\n        });\n      },\n      getSupportedConstraints: function() {\n        return {\n          deviceId: true, echoCancellation: true, facingMode: true,\n          frameRate: true, height: true, width: true\n        };\n      }\n    };\n  }\n\n  // A shim for getUserMedia method on the mediaDevices object.\n  // TODO(KaptenJansson) remove once implemented in Chrome stable.\n  if (!navigator.mediaDevices.getUserMedia) {\n    navigator.mediaDevices.getUserMedia = function(constraints) {\n      return getUserMediaPromise_(constraints);\n    };\n  } else {\n    // Even though Chrome 45 has navigator.mediaDevices and a getUserMedia\n    // function which returns a Promise, it does not accept spec-style\n    // constraints.\n    var origGetUserMedia = navigator.mediaDevices.getUserMedia.\n        bind(navigator.mediaDevices);\n    navigator.mediaDevices.getUserMedia = function(cs) {\n      return shimConstraints_(cs, function(c) {\n        return origGetUserMedia(c).then(function(stream) {\n          if (c.audio && !stream.getAudioTracks().length ||\n              c.video && !stream.getVideoTracks().length) {\n            stream.getTracks().forEach(function(track) {\n              track.stop();\n            });\n            throw new DOMException('', 'NotFoundError');\n          }\n          return stream;\n        }, function(e) {\n          return Promise.reject(shimError_(e));\n        });\n      });\n    };\n  }\n\n  // Dummy devicechange event methods.\n  // TODO(KaptenJansson) remove once implemented in Chrome stable.\n  if (typeof navigator.mediaDevices.addEventListener === 'undefined') {\n    navigator.mediaDevices.addEventListener = function() {\n      logging('Dummy mediaDevices.addEventListener called.');\n    };\n  }\n  if (typeof navigator.mediaDevices.removeEventListener === 'undefined') {\n    navigator.mediaDevices.removeEventListener = function() {\n      logging('Dummy mediaDevices.removeEventListener called.');\n    };\n  }\n};\n\n},{\"../utils.js\":13}],7:[function(require,module,exports){\n/*\n *  Copyright (c) 2017 The WebRTC project authors. All Rights Reserved.\n *\n *  Use of this source code is governed by a BSD-style license\n *  that can be found in the LICENSE file in the root of the source\n *  tree.\n */\n /* eslint-env node */\n'use strict';\n\nvar SDPUtils = require('sdp');\nvar utils = require('./utils');\n\n// Wraps the peerconnection event eventNameToWrap in a function\n// which returns the modified event object.\nfunction wrapPeerConnectionEvent(window, eventNameToWrap, wrapper) {\n  if (!window.RTCPeerConnection) {\n    return;\n  }\n  var proto = window.RTCPeerConnection.prototype;\n  var nativeAddEventListener = proto.addEventListener;\n  proto.addEventListener = function(nativeEventName, cb) {\n    if (nativeEventName !== eventNameToWrap) {\n      return nativeAddEventListener.apply(this, arguments);\n    }\n    var wrappedCallback = function(e) {\n      cb(wrapper(e));\n    };\n    this._eventMap = this._eventMap || {};\n    this._eventMap[cb] = wrappedCallback;\n    return nativeAddEventListener.apply(this, [nativeEventName,\n      wrappedCallback]);\n  };\n\n  var nativeRemoveEventListener = proto.removeEventListener;\n  proto.removeEventListener = function(nativeEventName, cb) {\n    if (nativeEventName !== eventNameToWrap || !this._eventMap\n        || !this._eventMap[cb]) {\n      return nativeRemoveEventListener.apply(this, arguments);\n    }\n    var unwrappedCb = this._eventMap[cb];\n    delete this._eventMap[cb];\n    return nativeRemoveEventListener.apply(this, [nativeEventName,\n      unwrappedCb]);\n  };\n\n  Object.defineProperty(proto, 'on' + eventNameToWrap, {\n    get: function() {\n      return this['_on' + eventNameToWrap];\n    },\n    set: function(cb) {\n      if (this['_on' + eventNameToWrap]) {\n        this.removeEventListener(eventNameToWrap,\n            this['_on' + eventNameToWrap]);\n        delete this['_on' + eventNameToWrap];\n      }\n      if (cb) {\n        this.addEventListener(eventNameToWrap,\n            this['_on' + eventNameToWrap] = cb);\n      }\n    }\n  });\n}\n\nmodule.exports = {\n  shimRTCIceCandidate: function(window) {\n    // foundation is arbitrarily chosen as an indicator for full support for\n    // https://w3c.github.io/webrtc-pc/#rtcicecandidate-interface\n    if (window.RTCIceCandidate && 'foundation' in\n        window.RTCIceCandidate.prototype) {\n      return;\n    }\n\n    var NativeRTCIceCandidate = window.RTCIceCandidate;\n    window.RTCIceCandidate = function(args) {\n      // Remove the a= which shouldn't be part of the candidate string.\n      if (typeof args === 'object' && args.candidate &&\n          args.candidate.indexOf('a=') === 0) {\n        args = JSON.parse(JSON.stringify(args));\n        args.candidate = args.candidate.substr(2);\n      }\n\n      // Augment the native candidate with the parsed fields.\n      var nativeCandidate = new NativeRTCIceCandidate(args);\n      var parsedCandidate = SDPUtils.parseCandidate(args.candidate);\n      var augmentedCandidate = Object.assign(nativeCandidate,\n          parsedCandidate);\n\n      // Add a serializer that does not serialize the extra attributes.\n      augmentedCandidate.toJSON = function() {\n        return {\n          candidate: augmentedCandidate.candidate,\n          sdpMid: augmentedCandidate.sdpMid,\n          sdpMLineIndex: augmentedCandidate.sdpMLineIndex,\n          usernameFragment: augmentedCandidate.usernameFragment,\n        };\n      };\n      return augmentedCandidate;\n    };\n\n    // Hook up the augmented candidate in onicecandidate and\n    // addEventListener('icecandidate', ...)\n    wrapPeerConnectionEvent(window, 'icecandidate', function(e) {\n      if (e.candidate) {\n        Object.defineProperty(e, 'candidate', {\n          value: new window.RTCIceCandidate(e.candidate),\n          writable: 'false'\n        });\n      }\n      return e;\n    });\n  },\n\n  // shimCreateObjectURL must be called before shimSourceObject to avoid loop.\n\n  shimCreateObjectURL: function(window) {\n    var URL = window && window.URL;\n\n    if (!(typeof window === 'object' && window.HTMLMediaElement &&\n          'srcObject' in window.HTMLMediaElement.prototype &&\n        URL.createObjectURL && URL.revokeObjectURL)) {\n      // Only shim CreateObjectURL using srcObject if srcObject exists.\n      return undefined;\n    }\n\n    var nativeCreateObjectURL = URL.createObjectURL.bind(URL);\n    var nativeRevokeObjectURL = URL.revokeObjectURL.bind(URL);\n    var streams = new Map(), newId = 0;\n\n    URL.createObjectURL = function(stream) {\n      if ('getTracks' in stream) {\n        var url = 'polyblob:' + (++newId);\n        streams.set(url, stream);\n        utils.deprecated('URL.createObjectURL(stream)',\n            'elem.srcObject = stream');\n        return url;\n      }\n      return nativeCreateObjectURL(stream);\n    };\n    URL.revokeObjectURL = function(url) {\n      nativeRevokeObjectURL(url);\n      streams.delete(url);\n    };\n\n    var dsc = Object.getOwnPropertyDescriptor(window.HTMLMediaElement.prototype,\n                                              'src');\n    Object.defineProperty(window.HTMLMediaElement.prototype, 'src', {\n      get: function() {\n        return dsc.get.apply(this);\n      },\n      set: function(url) {\n        this.srcObject = streams.get(url) || null;\n        return dsc.set.apply(this, [url]);\n      }\n    });\n\n    var nativeSetAttribute = window.HTMLMediaElement.prototype.setAttribute;\n    window.HTMLMediaElement.prototype.setAttribute = function() {\n      if (arguments.length === 2 &&\n          ('' + arguments[0]).toLowerCase() === 'src') {\n        this.srcObject = streams.get(arguments[1]) || null;\n      }\n      return nativeSetAttribute.apply(this, arguments);\n    };\n  }\n};\n\n},{\"./utils\":13,\"sdp\":2}],8:[function(require,module,exports){\n/*\n *  Copyright (c) 2016 The WebRTC project authors. All Rights Reserved.\n *\n *  Use of this source code is governed by a BSD-style license\n *  that can be found in the LICENSE file in the root of the source\n *  tree.\n */\n /* eslint-env node */\n'use strict';\n\nvar utils = require('../utils');\nvar shimRTCPeerConnection = require('rtcpeerconnection-shim');\n\nmodule.exports = {\n  shimGetUserMedia: require('./getusermedia'),\n  shimPeerConnection: function(window) {\n    var browserDetails = utils.detectBrowser(window);\n\n    if (window.RTCIceGatherer) {\n      // ORTC defines an RTCIceCandidate object but no constructor.\n      // Not implemented in Edge.\n      if (!window.RTCIceCandidate) {\n        window.RTCIceCandidate = function(args) {\n          return args;\n        };\n      }\n      // ORTC does not have a session description object but\n      // other browsers (i.e. Chrome) that will support both PC and ORTC\n      // in the future might have this defined already.\n      if (!window.RTCSessionDescription) {\n        window.RTCSessionDescription = function(args) {\n          return args;\n        };\n      }\n      // this adds an additional event listener to MediaStrackTrack that signals\n      // when a tracks enabled property was changed. Workaround for a bug in\n      // addStream, see below. No longer required in 15025+\n      if (browserDetails.version < 15025) {\n        var origMSTEnabled = Object.getOwnPropertyDescriptor(\n            window.MediaStreamTrack.prototype, 'enabled');\n        Object.defineProperty(window.MediaStreamTrack.prototype, 'enabled', {\n          set: function(value) {\n            origMSTEnabled.set.call(this, value);\n            var ev = new Event('enabled');\n            ev.enabled = value;\n            this.dispatchEvent(ev);\n          }\n        });\n      }\n    }\n\n    // ORTC defines the DTMF sender a bit different.\n    // https://github.com/w3c/ortc/issues/714\n    if (window.RTCRtpSender && !('dtmf' in window.RTCRtpSender.prototype)) {\n      Object.defineProperty(window.RTCRtpSender.prototype, 'dtmf', {\n        get: function() {\n          if (this._dtmf === undefined) {\n            if (this.track.kind === 'audio') {\n              this._dtmf = new window.RTCDtmfSender(this);\n            } else if (this.track.kind === 'video') {\n              this._dtmf = null;\n            }\n          }\n          return this._dtmf;\n        }\n      });\n    }\n\n    window.RTCPeerConnection =\n        shimRTCPeerConnection(window, browserDetails.version);\n  },\n  shimReplaceTrack: function(window) {\n    // ORTC has replaceTrack -- https://github.com/w3c/ortc/issues/614\n    if (window.RTCRtpSender &&\n        !('replaceTrack' in window.RTCRtpSender.prototype)) {\n      window.RTCRtpSender.prototype.replaceTrack =\n          window.RTCRtpSender.prototype.setTrack;\n    }\n  }\n};\n\n},{\"../utils\":13,\"./getusermedia\":9,\"rtcpeerconnection-shim\":1}],9:[function(require,module,exports){\n/*\n *  Copyright (c) 2016 The WebRTC project authors. All Rights Reserved.\n *\n *  Use of this source code is governed by a BSD-style license\n *  that can be found in the LICENSE file in the root of the source\n *  tree.\n */\n /* eslint-env node */\n'use strict';\n\n// Expose public methods.\nmodule.exports = function(window) {\n  var navigator = window && window.navigator;\n\n  var shimError_ = function(e) {\n    return {\n      name: {PermissionDeniedError: 'NotAllowedError'}[e.name] || e.name,\n      message: e.message,\n      constraint: e.constraint,\n      toString: function() {\n        return this.name;\n      }\n    };\n  };\n\n  // getUserMedia error shim.\n  var origGetUserMedia = navigator.mediaDevices.getUserMedia.\n      bind(navigator.mediaDevices);\n  navigator.mediaDevices.getUserMedia = function(c) {\n    return origGetUserMedia(c).catch(function(e) {\n      return Promise.reject(shimError_(e));\n    });\n  };\n};\n\n},{}],10:[function(require,module,exports){\n/*\n *  Copyright (c) 2016 The WebRTC project authors. All Rights Reserved.\n *\n *  Use of this source code is governed by a BSD-style license\n *  that can be found in the LICENSE file in the root of the source\n *  tree.\n */\n /* eslint-env node */\n'use strict';\n\nvar utils = require('../utils');\n\nmodule.exports = {\n  shimGetUserMedia: require('./getusermedia'),\n  shimOnTrack: function(window) {\n    if (typeof window === 'object' && window.RTCPeerConnection && !('ontrack' in\n        window.RTCPeerConnection.prototype)) {\n      Object.defineProperty(window.RTCPeerConnection.prototype, 'ontrack', {\n        get: function() {\n          return this._ontrack;\n        },\n        set: function(f) {\n          if (this._ontrack) {\n            this.removeEventListener('track', this._ontrack);\n            this.removeEventListener('addstream', this._ontrackpoly);\n          }\n          this.addEventListener('track', this._ontrack = f);\n          this.addEventListener('addstream', this._ontrackpoly = function(e) {\n            e.stream.getTracks().forEach(function(track) {\n              var event = new Event('track');\n              event.track = track;\n              event.receiver = {track: track};\n              event.transceiver = {receiver: event.receiver};\n              event.streams = [e.stream];\n              this.dispatchEvent(event);\n            }.bind(this));\n          }.bind(this));\n        }\n      });\n    }\n    if (typeof window === 'object' && window.RTCTrackEvent &&\n        ('receiver' in window.RTCTrackEvent.prototype) &&\n        !('transceiver' in window.RTCTrackEvent.prototype)) {\n      Object.defineProperty(window.RTCTrackEvent.prototype, 'transceiver', {\n        get: function() {\n          return {receiver: this.receiver};\n        }\n      });\n    }\n  },\n\n  shimSourceObject: function(window) {\n    // Firefox has supported mozSrcObject since FF22, unprefixed in 42.\n    if (typeof window === 'object') {\n      if (window.HTMLMediaElement &&\n        !('srcObject' in window.HTMLMediaElement.prototype)) {\n        // Shim the srcObject property, once, when HTMLMediaElement is found.\n        Object.defineProperty(window.HTMLMediaElement.prototype, 'srcObject', {\n          get: function() {\n            return this.mozSrcObject;\n          },\n          set: function(stream) {\n            this.mozSrcObject = stream;\n          }\n        });\n      }\n    }\n  },\n\n  shimPeerConnection: function(window) {\n    var browserDetails = utils.detectBrowser(window);\n\n    if (typeof window !== 'object' || !(window.RTCPeerConnection ||\n        window.mozRTCPeerConnection)) {\n      return; // probably media.peerconnection.enabled=false in about:config\n    }\n    // The RTCPeerConnection object.\n    if (!window.RTCPeerConnection) {\n      window.RTCPeerConnection = function(pcConfig, pcConstraints) {\n        if (browserDetails.version < 38) {\n          // .urls is not supported in FF < 38.\n          // create RTCIceServers with a single url.\n          if (pcConfig && pcConfig.iceServers) {\n            var newIceServers = [];\n            for (var i = 0; i < pcConfig.iceServers.length; i++) {\n              var server = pcConfig.iceServers[i];\n              if (server.hasOwnProperty('urls')) {\n                for (var j = 0; j < server.urls.length; j++) {\n                  var newServer = {\n                    url: server.urls[j]\n                  };\n                  if (server.urls[j].indexOf('turn') === 0) {\n                    newServer.username = server.username;\n                    newServer.credential = server.credential;\n                  }\n                  newIceServers.push(newServer);\n                }\n              } else {\n                newIceServers.push(pcConfig.iceServers[i]);\n              }\n            }\n            pcConfig.iceServers = newIceServers;\n          }\n        }\n        return new window.mozRTCPeerConnection(pcConfig, pcConstraints);\n      };\n      window.RTCPeerConnection.prototype =\n          window.mozRTCPeerConnection.prototype;\n\n      // wrap static methods. Currently just generateCertificate.\n      if (window.mozRTCPeerConnection.generateCertificate) {\n        Object.defineProperty(window.RTCPeerConnection, 'generateCertificate', {\n          get: function() {\n            return window.mozRTCPeerConnection.generateCertificate;\n          }\n        });\n      }\n\n      window.RTCSessionDescription = window.mozRTCSessionDescription;\n      window.RTCIceCandidate = window.mozRTCIceCandidate;\n    }\n\n    // shim away need for obsolete RTCIceCandidate/RTCSessionDescription.\n    ['setLocalDescription', 'setRemoteDescription', 'addIceCandidate']\n        .forEach(function(method) {\n          var nativeMethod = window.RTCPeerConnection.prototype[method];\n          window.RTCPeerConnection.prototype[method] = function() {\n            arguments[0] = new ((method === 'addIceCandidate') ?\n                window.RTCIceCandidate :\n                window.RTCSessionDescription)(arguments[0]);\n            return nativeMethod.apply(this, arguments);\n          };\n        });\n\n    // support for addIceCandidate(null or undefined)\n    var nativeAddIceCandidate =\n        window.RTCPeerConnection.prototype.addIceCandidate;\n    window.RTCPeerConnection.prototype.addIceCandidate = function() {\n      if (!arguments[0]) {\n        if (arguments[1]) {\n          arguments[1].apply(null);\n        }\n        return Promise.resolve();\n      }\n      return nativeAddIceCandidate.apply(this, arguments);\n    };\n\n    // shim getStats with maplike support\n    var makeMapStats = function(stats) {\n      var map = new Map();\n      Object.keys(stats).forEach(function(key) {\n        map.set(key, stats[key]);\n        map[key] = stats[key];\n      });\n      return map;\n    };\n\n    var modernStatsTypes = {\n      inboundrtp: 'inbound-rtp',\n      outboundrtp: 'outbound-rtp',\n      candidatepair: 'candidate-pair',\n      localcandidate: 'local-candidate',\n      remotecandidate: 'remote-candidate'\n    };\n\n    var nativeGetStats = window.RTCPeerConnection.prototype.getStats;\n    window.RTCPeerConnection.prototype.getStats = function(\n      selector,\n      onSucc,\n      onErr\n    ) {\n      return nativeGetStats.apply(this, [selector || null])\n        .then(function(stats) {\n          if (browserDetails.version < 48) {\n            stats = makeMapStats(stats);\n          }\n          if (browserDetails.version < 53 && !onSucc) {\n            // Shim only promise getStats with spec-hyphens in type names\n            // Leave callback version alone; misc old uses of forEach before Map\n            try {\n              stats.forEach(function(stat) {\n                stat.type = modernStatsTypes[stat.type] || stat.type;\n              });\n            } catch (e) {\n              if (e.name !== 'TypeError') {\n                throw e;\n              }\n              // Avoid TypeError: \"type\" is read-only, in old versions. 34-43ish\n              stats.forEach(function(stat, i) {\n                stats.set(i, Object.assign({}, stat, {\n                  type: modernStatsTypes[stat.type] || stat.type\n                }));\n              });\n            }\n          }\n          return stats;\n        })\n        .then(onSucc, onErr);\n    };\n  },\n\n  shimRemoveStream: function(window) {\n    if (!window.RTCPeerConnection ||\n        'removeStream' in window.RTCPeerConnection.prototype) {\n      return;\n    }\n    window.RTCPeerConnection.prototype.removeStream = function(stream) {\n      var pc = this;\n      utils.deprecated('removeStream', 'removeTrack');\n      this.getSenders().forEach(function(sender) {\n        if (sender.track && stream.getTracks().indexOf(sender.track) !== -1) {\n          pc.removeTrack(sender);\n        }\n      });\n    };\n  }\n};\n\n},{\"../utils\":13,\"./getusermedia\":11}],11:[function(require,module,exports){\n/*\n *  Copyright (c) 2016 The WebRTC project authors. All Rights Reserved.\n *\n *  Use of this source code is governed by a BSD-style license\n *  that can be found in the LICENSE file in the root of the source\n *  tree.\n */\n /* eslint-env node */\n'use strict';\n\nvar utils = require('../utils');\nvar logging = utils.log;\n\n// Expose public methods.\nmodule.exports = function(window) {\n  var browserDetails = utils.detectBrowser(window);\n  var navigator = window && window.navigator;\n  var MediaStreamTrack = window && window.MediaStreamTrack;\n\n  var shimError_ = function(e) {\n    return {\n      name: {\n        InternalError: 'NotReadableError',\n        NotSupportedError: 'TypeError',\n        PermissionDeniedError: 'NotAllowedError',\n        SecurityError: 'NotAllowedError'\n      }[e.name] || e.name,\n      message: {\n        'The operation is insecure.': 'The request is not allowed by the ' +\n        'user agent or the platform in the current context.'\n      }[e.message] || e.message,\n      constraint: e.constraint,\n      toString: function() {\n        return this.name + (this.message && ': ') + this.message;\n      }\n    };\n  };\n\n  // getUserMedia constraints shim.\n  var getUserMedia_ = function(constraints, onSuccess, onError) {\n    var constraintsToFF37_ = function(c) {\n      if (typeof c !== 'object' || c.require) {\n        return c;\n      }\n      var require = [];\n      Object.keys(c).forEach(function(key) {\n        if (key === 'require' || key === 'advanced' || key === 'mediaSource') {\n          return;\n        }\n        var r = c[key] = (typeof c[key] === 'object') ?\n            c[key] : {ideal: c[key]};\n        if (r.min !== undefined ||\n            r.max !== undefined || r.exact !== undefined) {\n          require.push(key);\n        }\n        if (r.exact !== undefined) {\n          if (typeof r.exact === 'number') {\n            r. min = r.max = r.exact;\n          } else {\n            c[key] = r.exact;\n          }\n          delete r.exact;\n        }\n        if (r.ideal !== undefined) {\n          c.advanced = c.advanced || [];\n          var oc = {};\n          if (typeof r.ideal === 'number') {\n            oc[key] = {min: r.ideal, max: r.ideal};\n          } else {\n            oc[key] = r.ideal;\n          }\n          c.advanced.push(oc);\n          delete r.ideal;\n          if (!Object.keys(r).length) {\n            delete c[key];\n          }\n        }\n      });\n      if (require.length) {\n        c.require = require;\n      }\n      return c;\n    };\n    constraints = JSON.parse(JSON.stringify(constraints));\n    if (browserDetails.version < 38) {\n      logging('spec: ' + JSON.stringify(constraints));\n      if (constraints.audio) {\n        constraints.audio = constraintsToFF37_(constraints.audio);\n      }\n      if (constraints.video) {\n        constraints.video = constraintsToFF37_(constraints.video);\n      }\n      logging('ff37: ' + JSON.stringify(constraints));\n    }\n    return navigator.mozGetUserMedia(constraints, onSuccess, function(e) {\n      onError(shimError_(e));\n    });\n  };\n\n  // Returns the result of getUserMedia as a Promise.\n  var getUserMediaPromise_ = function(constraints) {\n    return new Promise(function(resolve, reject) {\n      getUserMedia_(constraints, resolve, reject);\n    });\n  };\n\n  // Shim for mediaDevices on older versions.\n  if (!navigator.mediaDevices) {\n    navigator.mediaDevices = {getUserMedia: getUserMediaPromise_,\n      addEventListener: function() { },\n      removeEventListener: function() { }\n    };\n  }\n  navigator.mediaDevices.enumerateDevices =\n      navigator.mediaDevices.enumerateDevices || function() {\n        return new Promise(function(resolve) {\n          var infos = [\n            {kind: 'audioinput', deviceId: 'default', label: '', groupId: ''},\n            {kind: 'videoinput', deviceId: 'default', label: '', groupId: ''}\n          ];\n          resolve(infos);\n        });\n      };\n\n  if (browserDetails.version < 41) {\n    // Work around http://bugzil.la/1169665\n    var orgEnumerateDevices =\n        navigator.mediaDevices.enumerateDevices.bind(navigator.mediaDevices);\n    navigator.mediaDevices.enumerateDevices = function() {\n      return orgEnumerateDevices().then(undefined, function(e) {\n        if (e.name === 'NotFoundError') {\n          return [];\n        }\n        throw e;\n      });\n    };\n  }\n  if (browserDetails.version < 49) {\n    var origGetUserMedia = navigator.mediaDevices.getUserMedia.\n        bind(navigator.mediaDevices);\n    navigator.mediaDevices.getUserMedia = function(c) {\n      return origGetUserMedia(c).then(function(stream) {\n        // Work around https://bugzil.la/802326\n        if (c.audio && !stream.getAudioTracks().length ||\n            c.video && !stream.getVideoTracks().length) {\n          stream.getTracks().forEach(function(track) {\n            track.stop();\n          });\n          throw new DOMException('The object can not be found here.',\n                                 'NotFoundError');\n        }\n        return stream;\n      }, function(e) {\n        return Promise.reject(shimError_(e));\n      });\n    };\n  }\n  if (!(browserDetails.version > 55 &&\n      'autoGainControl' in navigator.mediaDevices.getSupportedConstraints())) {\n    var remap = function(obj, a, b) {\n      if (a in obj && !(b in obj)) {\n        obj[b] = obj[a];\n        delete obj[a];\n      }\n    };\n\n    var nativeGetUserMedia = navigator.mediaDevices.getUserMedia.\n        bind(navigator.mediaDevices);\n    navigator.mediaDevices.getUserMedia = function(c) {\n      if (typeof c === 'object' && typeof c.audio === 'object') {\n        c = JSON.parse(JSON.stringify(c));\n        remap(c.audio, 'autoGainControl', 'mozAutoGainControl');\n        remap(c.audio, 'noiseSuppression', 'mozNoiseSuppression');\n      }\n      return nativeGetUserMedia(c);\n    };\n\n    if (MediaStreamTrack && MediaStreamTrack.prototype.getSettings) {\n      var nativeGetSettings = MediaStreamTrack.prototype.getSettings;\n      MediaStreamTrack.prototype.getSettings = function() {\n        var obj = nativeGetSettings.apply(this, arguments);\n        remap(obj, 'mozAutoGainControl', 'autoGainControl');\n        remap(obj, 'mozNoiseSuppression', 'noiseSuppression');\n        return obj;\n      };\n    }\n\n    if (MediaStreamTrack && MediaStreamTrack.prototype.applyConstraints) {\n      var nativeApplyConstraints = MediaStreamTrack.prototype.applyConstraints;\n      MediaStreamTrack.prototype.applyConstraints = function(c) {\n        if (this.kind === 'audio' && typeof c === 'object') {\n          c = JSON.parse(JSON.stringify(c));\n          remap(c, 'autoGainControl', 'mozAutoGainControl');\n          remap(c, 'noiseSuppression', 'mozNoiseSuppression');\n        }\n        return nativeApplyConstraints.apply(this, [c]);\n      };\n    }\n  }\n  navigator.getUserMedia = function(constraints, onSuccess, onError) {\n    if (browserDetails.version < 44) {\n      return getUserMedia_(constraints, onSuccess, onError);\n    }\n    // Replace Firefox 44+'s deprecation warning with unprefixed version.\n    utils.deprecated('navigator.getUserMedia',\n        'navigator.mediaDevices.getUserMedia');\n    navigator.mediaDevices.getUserMedia(constraints).then(onSuccess, onError);\n  };\n};\n\n},{\"../utils\":13}],12:[function(require,module,exports){\n/*\n *  Copyright (c) 2016 The WebRTC project authors. All Rights Reserved.\n *\n *  Use of this source code is governed by a BSD-style license\n *  that can be found in the LICENSE file in the root of the source\n *  tree.\n */\n'use strict';\nvar utils = require('../utils');\n\nmodule.exports = {\n  shimLocalStreamsAPI: function(window) {\n    if (typeof window !== 'object' || !window.RTCPeerConnection) {\n      return;\n    }\n    if (!('getLocalStreams' in window.RTCPeerConnection.prototype)) {\n      window.RTCPeerConnection.prototype.getLocalStreams = function() {\n        if (!this._localStreams) {\n          this._localStreams = [];\n        }\n        return this._localStreams;\n      };\n    }\n    if (!('getStreamById' in window.RTCPeerConnection.prototype)) {\n      window.RTCPeerConnection.prototype.getStreamById = function(id) {\n        var result = null;\n        if (this._localStreams) {\n          this._localStreams.forEach(function(stream) {\n            if (stream.id === id) {\n              result = stream;\n            }\n          });\n        }\n        if (this._remoteStreams) {\n          this._remoteStreams.forEach(function(stream) {\n            if (stream.id === id) {\n              result = stream;\n            }\n          });\n        }\n        return result;\n      };\n    }\n    if (!('addStream' in window.RTCPeerConnection.prototype)) {\n      var _addTrack = window.RTCPeerConnection.prototype.addTrack;\n      window.RTCPeerConnection.prototype.addStream = function(stream) {\n        if (!this._localStreams) {\n          this._localStreams = [];\n        }\n        if (this._localStreams.indexOf(stream) === -1) {\n          this._localStreams.push(stream);\n        }\n        var pc = this;\n        stream.getTracks().forEach(function(track) {\n          _addTrack.call(pc, track, stream);\n        });\n      };\n\n      window.RTCPeerConnection.prototype.addTrack = function(track, stream) {\n        if (stream) {\n          if (!this._localStreams) {\n            this._localStreams = [stream];\n          } else if (this._localStreams.indexOf(stream) === -1) {\n            this._localStreams.push(stream);\n          }\n        }\n        return _addTrack.call(this, track, stream);\n      };\n    }\n    if (!('removeStream' in window.RTCPeerConnection.prototype)) {\n      window.RTCPeerConnection.prototype.removeStream = function(stream) {\n        if (!this._localStreams) {\n          this._localStreams = [];\n        }\n        var index = this._localStreams.indexOf(stream);\n        if (index === -1) {\n          return;\n        }\n        this._localStreams.splice(index, 1);\n        var pc = this;\n        var tracks = stream.getTracks();\n        this.getSenders().forEach(function(sender) {\n          if (tracks.indexOf(sender.track) !== -1) {\n            pc.removeTrack(sender);\n          }\n        });\n      };\n    }\n  },\n  shimRemoteStreamsAPI: function(window) {\n    if (typeof window !== 'object' || !window.RTCPeerConnection) {\n      return;\n    }\n    if (!('getRemoteStreams' in window.RTCPeerConnection.prototype)) {\n      window.RTCPeerConnection.prototype.getRemoteStreams = function() {\n        return this._remoteStreams ? this._remoteStreams : [];\n      };\n    }\n    if (!('onaddstream' in window.RTCPeerConnection.prototype)) {\n      Object.defineProperty(window.RTCPeerConnection.prototype, 'onaddstream', {\n        get: function() {\n          return this._onaddstream;\n        },\n        set: function(f) {\n          if (this._onaddstream) {\n            this.removeEventListener('addstream', this._onaddstream);\n            this.removeEventListener('track', this._onaddstreampoly);\n          }\n          this.addEventListener('addstream', this._onaddstream = f);\n          this.addEventListener('track', this._onaddstreampoly = function(e) {\n            var stream = e.streams[0];\n            if (!this._remoteStreams) {\n              this._remoteStreams = [];\n            }\n            if (this._remoteStreams.indexOf(stream) >= 0) {\n              return;\n            }\n            this._remoteStreams.push(stream);\n            var event = new Event('addstream');\n            event.stream = e.streams[0];\n            this.dispatchEvent(event);\n          }.bind(this));\n        }\n      });\n    }\n  },\n  shimCallbacksAPI: function(window) {\n    if (typeof window !== 'object' || !window.RTCPeerConnection) {\n      return;\n    }\n    var prototype = window.RTCPeerConnection.prototype;\n    var createOffer = prototype.createOffer;\n    var createAnswer = prototype.createAnswer;\n    var setLocalDescription = prototype.setLocalDescription;\n    var setRemoteDescription = prototype.setRemoteDescription;\n    var addIceCandidate = prototype.addIceCandidate;\n\n    prototype.createOffer = function(successCallback, failureCallback) {\n      var options = (arguments.length >= 2) ? arguments[2] : arguments[0];\n      var promise = createOffer.apply(this, [options]);\n      if (!failureCallback) {\n        return promise;\n      }\n      promise.then(successCallback, failureCallback);\n      return Promise.resolve();\n    };\n\n    prototype.createAnswer = function(successCallback, failureCallback) {\n      var options = (arguments.length >= 2) ? arguments[2] : arguments[0];\n      var promise = createAnswer.apply(this, [options]);\n      if (!failureCallback) {\n        return promise;\n      }\n      promise.then(successCallback, failureCallback);\n      return Promise.resolve();\n    };\n\n    var withCallback = function(description, successCallback, failureCallback) {\n      var promise = setLocalDescription.apply(this, [description]);\n      if (!failureCallback) {\n        return promise;\n      }\n      promise.then(successCallback, failureCallback);\n      return Promise.resolve();\n    };\n    prototype.setLocalDescription = withCallback;\n\n    withCallback = function(description, successCallback, failureCallback) {\n      var promise = setRemoteDescription.apply(this, [description]);\n      if (!failureCallback) {\n        return promise;\n      }\n      promise.then(successCallback, failureCallback);\n      return Promise.resolve();\n    };\n    prototype.setRemoteDescription = withCallback;\n\n    withCallback = function(candidate, successCallback, failureCallback) {\n      var promise = addIceCandidate.apply(this, [candidate]);\n      if (!failureCallback) {\n        return promise;\n      }\n      promise.then(successCallback, failureCallback);\n      return Promise.resolve();\n    };\n    prototype.addIceCandidate = withCallback;\n  },\n  shimGetUserMedia: function(window) {\n    var navigator = window && window.navigator;\n\n    if (!navigator.getUserMedia) {\n      if (navigator.webkitGetUserMedia) {\n        navigator.getUserMedia = navigator.webkitGetUserMedia.bind(navigator);\n      } else if (navigator.mediaDevices &&\n          navigator.mediaDevices.getUserMedia) {\n        navigator.getUserMedia = function(constraints, cb, errcb) {\n          navigator.mediaDevices.getUserMedia(constraints)\n          .then(cb, errcb);\n        }.bind(navigator);\n      }\n    }\n  },\n  shimRTCIceServerUrls: function(window) {\n    // migrate from non-spec RTCIceServer.url to RTCIceServer.urls\n    var OrigPeerConnection = window.RTCPeerConnection;\n    window.RTCPeerConnection = function(pcConfig, pcConstraints) {\n      if (pcConfig && pcConfig.iceServers) {\n        var newIceServers = [];\n        for (var i = 0; i < pcConfig.iceServers.length; i++) {\n          var server = pcConfig.iceServers[i];\n          if (!server.hasOwnProperty('urls') &&\n              server.hasOwnProperty('url')) {\n            utils.deprecated('RTCIceServer.url', 'RTCIceServer.urls');\n            server = JSON.parse(JSON.stringify(server));\n            server.urls = server.url;\n            delete server.url;\n            newIceServers.push(server);\n          } else {\n            newIceServers.push(pcConfig.iceServers[i]);\n          }\n        }\n        pcConfig.iceServers = newIceServers;\n      }\n      return new OrigPeerConnection(pcConfig, pcConstraints);\n    };\n    window.RTCPeerConnection.prototype = OrigPeerConnection.prototype;\n    // wrap static methods. Currently just generateCertificate.\n    if ('generateCertificate' in window.RTCPeerConnection) {\n      Object.defineProperty(window.RTCPeerConnection, 'generateCertificate', {\n        get: function() {\n          return OrigPeerConnection.generateCertificate;\n        }\n      });\n    }\n  },\n  shimTrackEventTransceiver: function(window) {\n    // Add event.transceiver member over deprecated event.receiver\n    if (typeof window === 'object' && window.RTCPeerConnection &&\n        ('receiver' in window.RTCTrackEvent.prototype) &&\n        // can't check 'transceiver' in window.RTCTrackEvent.prototype, as it is\n        // defined for some reason even when window.RTCTransceiver is not.\n        !window.RTCTransceiver) {\n      Object.defineProperty(window.RTCTrackEvent.prototype, 'transceiver', {\n        get: function() {\n          return {receiver: this.receiver};\n        }\n      });\n    }\n  },\n\n  shimCreateOfferLegacy: function(window) {\n    var origCreateOffer = window.RTCPeerConnection.prototype.createOffer;\n    window.RTCPeerConnection.prototype.createOffer = function(offerOptions) {\n      var pc = this;\n      if (offerOptions) {\n        var audioTransceiver = pc.getTransceivers().find(function(transceiver) {\n          return transceiver.sender.track &&\n              transceiver.sender.track.kind === 'audio';\n        });\n        if (offerOptions.offerToReceiveAudio === false && audioTransceiver) {\n          if (audioTransceiver.direction === 'sendrecv') {\n            audioTransceiver.setDirection('sendonly');\n          } else if (audioTransceiver.direction === 'recvonly') {\n            audioTransceiver.setDirection('inactive');\n          }\n        } else if (offerOptions.offerToReceiveAudio === true &&\n            !audioTransceiver) {\n          pc.addTransceiver('audio');\n        }\n\n        var videoTransceiver = pc.getTransceivers().find(function(transceiver) {\n          return transceiver.sender.track &&\n              transceiver.sender.track.kind === 'video';\n        });\n        if (offerOptions.offerToReceiveVideo === false && videoTransceiver) {\n          if (videoTransceiver.direction === 'sendrecv') {\n            videoTransceiver.setDirection('sendonly');\n          } else if (videoTransceiver.direction === 'recvonly') {\n            videoTransceiver.setDirection('inactive');\n          }\n        } else if (offerOptions.offerToReceiveVideo === true &&\n            !videoTransceiver) {\n          pc.addTransceiver('video');\n        }\n      }\n      return origCreateOffer.apply(pc, arguments);\n    };\n  }\n};\n\n},{\"../utils\":13}],13:[function(require,module,exports){\n/*\n *  Copyright (c) 2016 The WebRTC project authors. All Rights Reserved.\n *\n *  Use of this source code is governed by a BSD-style license\n *  that can be found in the LICENSE file in the root of the source\n *  tree.\n */\n /* eslint-env node */\n'use strict';\n\nvar logDisabled_ = true;\nvar deprecationWarnings_ = true;\n\n/**\n * Extract browser version out of the provided user agent string.\n *\n * @param {!string} uastring userAgent string.\n * @param {!string} expr Regular expression used as match criteria.\n * @param {!number} pos position in the version string to be returned.\n * @return {!number} browser version.\n */\nfunction extractVersion(uastring, expr, pos) {\n  var match = uastring.match(expr);\n  return match && match.length >= pos && parseInt(match[pos], 10);\n}\n\n// Utility methods.\nmodule.exports = {\n  extractVersion: extractVersion,\n  disableLog: function(bool) {\n    if (typeof bool !== 'boolean') {\n      return new Error('Argument type: ' + typeof bool +\n          '. Please use a boolean.');\n    }\n    logDisabled_ = bool;\n    return (bool) ? 'adapter.js logging disabled' :\n        'adapter.js logging enabled';\n  },\n\n  /**\n   * Disable or enable deprecation warnings\n   * @param {!boolean} bool set to true to disable warnings.\n   */\n  disableWarnings: function(bool) {\n    if (typeof bool !== 'boolean') {\n      return new Error('Argument type: ' + typeof bool +\n          '. Please use a boolean.');\n    }\n    deprecationWarnings_ = !bool;\n    return 'adapter.js deprecation warnings ' + (bool ? 'disabled' : 'enabled');\n  },\n\n  log: function() {\n    if (typeof window === 'object') {\n      if (logDisabled_) {\n        return;\n      }\n      if (typeof console !== 'undefined' && typeof console.log === 'function') {\n        console.log.apply(console, arguments);\n      }\n    }\n  },\n\n  /**\n   * Shows a deprecation warning suggesting the modern and spec-compatible API.\n   */\n  deprecated: function(oldMethod, newMethod) {\n    if (!deprecationWarnings_) {\n      return;\n    }\n    console.warn(oldMethod + ' is deprecated, please use ' + newMethod +\n        ' instead.');\n  },\n\n  /**\n   * Browser detector.\n   *\n   * @return {object} result containing browser and version\n   *     properties.\n   */\n  detectBrowser: function(window) {\n    var navigator = window && window.navigator;\n\n    // Returned result object.\n    var result = {};\n    result.browser = null;\n    result.version = null;\n\n    // Fail early if it's not a browser\n    if (typeof window === 'undefined' || !window.navigator) {\n      result.browser = 'Not a browser.';\n      return result;\n    }\n\n    // Firefox.\n    if (navigator.mozGetUserMedia) {\n      result.browser = 'firefox';\n      result.version = extractVersion(navigator.userAgent,\n          /Firefox\\/(\\d+)\\./, 1);\n    } else if (navigator.webkitGetUserMedia) {\n      // Chrome, Chromium, Webview, Opera, all use the chrome shim for now\n      if (window.webkitRTCPeerConnection) {\n        result.browser = 'chrome';\n        result.version = extractVersion(navigator.userAgent,\n          /Chrom(e|ium)\\/(\\d+)\\./, 2);\n      } else { // Safari (in an unpublished version) or unknown webkit-based.\n        if (navigator.userAgent.match(/Version\\/(\\d+).(\\d+)/)) {\n          result.browser = 'safari';\n          result.version = extractVersion(navigator.userAgent,\n            /AppleWebKit\\/(\\d+)\\./, 1);\n        } else { // unknown webkit-based browser.\n          result.browser = 'Unsupported webkit-based browser ' +\n              'with GUM support but no WebRTC support.';\n          return result;\n        }\n      }\n    } else if (navigator.mediaDevices &&\n        navigator.userAgent.match(/Edge\\/(\\d+).(\\d+)$/)) { // Edge.\n      result.browser = 'edge';\n      result.version = extractVersion(navigator.userAgent,\n          /Edge\\/(\\d+).(\\d+)$/, 2);\n    } else if (navigator.mediaDevices &&\n        navigator.userAgent.match(/AppleWebKit\\/(\\d+)\\./)) {\n        // Safari, with webkitGetUserMedia removed.\n      result.browser = 'safari';\n      result.version = extractVersion(navigator.userAgent,\n          /AppleWebKit\\/(\\d+)\\./, 1);\n    } else { // Default fallthrough: not supported.\n      result.browser = 'Not a supported browser.';\n      return result;\n    }\n\n    return result;\n  }\n};\n\n},{}]},{},[3])(3)\n});\n\n\n// WEBPACK FOOTER //\n// ./node_modules/webrtc-adapter/out/adapter.js","var g;\r\n\r\n// This works in non-strict mode\r\ng = (function() {\r\n\treturn this;\r\n})();\r\n\r\ntry {\r\n\t// This works if eval is allowed (see CSP)\r\n\tg = g || Function(\"return this\")() || (1,eval)(\"this\");\r\n} catch(e) {\r\n\t// This works if the window reference is available\r\n\tif(typeof window === \"object\")\r\n\t\tg = window;\r\n}\r\n\r\n// g can still be undefined, but nothing to do about it...\r\n// We return undefined, instead of nothing here, so it's\r\n// easier to handle this case. if(!global) { ...}\r\n\r\nmodule.exports = g;\r\n\n\n\n// WEBPACK FOOTER //\n// (webpack)/buildin/global.js","import Component from '../Component';\n\nconst Error = new Component('Error', {\n  message: ''\n})\n\nError.render(state => {\n  Error.dom.textContent = state.message;\n});\n\n\nexport default Error;\n\n\n\n\n\n// WEBPACK FOOTER //\n// ./src/components/Error.js","import Component from '../Component';\nimport CameraScreen from './CameraScreen';\n\nconst ButtonCameraPower = new Component('ButtonCameraPower');\n\nButtonCameraPower.on('click', function(evt) {\n  if (CameraScreen.getState().show) {\n    CameraScreen.setState({show: false});\n    ButtonCameraPower.dom.textContent = 'On';\n  } else {\n    CameraScreen.setState({show: true});\n    ButtonCameraPower.dom.textContent = 'Off';\n  }\n})\n\nexport default ButtonCameraPower;\n\n\n\n// WEBPACK FOOTER //\n// ./src/components/ButtonCameraPower.js","import Component from '../Component';\nimport CameraScreen from './CameraScreen';\n\nconst ButtonCameraFacing = new Component('ButtonCameraFacing');\n\nButtonCameraFacing.on('click', function(evt) {\n  console.log('clicked')\n  if (CameraScreen.getState().facingMode === 'user') {\n    CameraScreen.setState({facingMode: 'environment'});\n    ButtonCameraFacing.dom.textContent = 'Switch to Front';\n  } else {\n    CameraScreen.setState({facingMode: 'user'});\n    ButtonCameraFacing.dom.textContent = 'Switch to Rear';\n  }\n})\n\nexport default ButtonCameraFacing;\n\n\n\n// WEBPACK FOOTER //\n// ./src/components/ButtonCameraFacing.js","import Component from '../Component';\nimport CameraScreen from './CameraScreen';\n\nconst Canvas = new Component('Canvas');\n\n\n\nCanvas.clearPhoto = function clearPhoto() {\n  // application/octet-stream\n  const ctx = this.dom.getContext('2d');\n  ctx.fillStyle = '#fff';\n  ctx.fillRect(0, 0, this.dom.width, this.dom.height);\n}\n\nCanvas.takePicture = function takePicture(cameraScreen) {\n  const ctx = this.dom.getContext('2d');\n  this.dom.height = cameraScreen.offsetHeight;\n  this.dom.width = cameraScreen.offsetWidth;\n  ctx.drawImage(cameraScreen, 0, 0, this.dom.width, this.dom.height);\n\n  return new Promise(fulfillWith => {\n    Canvas.dom.toBlob(function(blob) {\n      fulfillWith(blob)\n    });\n  })\n\n}\n\nexport default Canvas;\n\n\n\n// WEBPACK FOOTER //\n// ./src/components/Canvas.js","import Component from '../Component';\nimport Canvas from './Canvas';\nimport CameraScreen from './CameraScreen';\n\nconst ButtonCameraCapture = new Component('ButtonCameraCapture');\n\nfunction sendImageForAnalysis(imageData) {\n  const headers = new Headers();\n  headers.append('Content-Type', 'application/json');\n  return fetch('https://young-mountain-88984.herokuapp.com/image-vision', {\n    method: 'POST',\n    headers: headers,\n    mode: 'cors',\n    cache: 'default',\n    body: JSON.stringify({ image: imageData }),\n  })\n  .then(res => res.json())\n  .then(data => data.labelAnnotations[0].description)\n  .catch(err => console.log('Error: ', err));\n}\n\nfunction speakResult(result) {\n  const utterance = new SpeechSynthesisUtterance(result)\n  window.speechSynthesis.speak(utterance)\n}\n\nconst fileReader = new FileReader();\n\nfileReader.addEventListener('loadend', function() {\n  sendImageForAnalysis(fileReader.result)\n  .then(result => speakResult(result));\n})\n\nButtonCameraCapture.on('click', function takePicture() {\n  Canvas.takePicture(CameraScreen.dom)\n  .then(imageBlob => {\n    fileReader.readAsDataURL(imageBlob);\n  });\n})\n\n\n\n// WEBPACK FOOTER //\n// ./src/components/ButtonCameraCapture.js"],"sourceRoot":""}