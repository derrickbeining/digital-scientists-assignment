{"version":3,"sources":["webpack:///webpack/bootstrap 683bc8a7d6f06926a04f","webpack:///./src/Component.js","webpack:///./src/components/CameraScreen.js","webpack:///./src/mediaDevice.js","webpack:///./src/index.js","webpack:///./node_modules/webrtc-adapter/out/adapter.js","webpack:///(webpack)/buildin/global.js","webpack:///./src/components/Error.js","webpack:///./src/components/ButtonCameraPower.js","webpack:///./src/components/ButtonCameraFacing.js"],"names":["merge","one","two","Object","assign","Component","id","defaultState","state","getState","setState","arg","renderer","dom","document","getElementById","noop","classname","classList","add","remove","toggle","event","eventHandler","addEventListener","fn","CameraScreen","show","facingMode","render","console","log","then","addClass","catch","message","err","name","removeClass","hasMediaDeviceAPI","startingCamera","stopCamera","Boolean","navigator","mediaDevices","getUserMedia","isMobileDevice","userAgent","search","generateConstraints","supportedConstraints","getSupportedConstraints","constraints","width","offsetWidth","aspectRatio","hasOwnProperty","video","srcObject","mediaStream","play","f","exports","module","define","g","window","global","self","adapter","e","t","n","r","s","o","u","a","require","i","Error","code","l","call","length","SDPUtils","writeMediaSection","transceiver","caps","type","stream","dtlsRole","sdp","writeRtpDescription","kind","writeIceParameters","iceGatherer","getLocalParameters","writeDtlsParameters","dtlsTransport","mid","rtpSender","rtpReceiver","msid","track","sendEncodingParameters","ssrc","rtx","localCName","filterIceServers","iceServers","edgeVersion","hasTurn","JSON","parse","stringify","filter","server","urls","url","warn","isString","validTurn","indexOf","getCommonCapabilities","localCapabilities","remoteCapabilities","commonCapabilities","codecs","headerExtensions","fecMechanisms","findCodecByPayloadType","pt","parseInt","payloadType","preferredPayloadType","rtxCapabilityMatches","lRtx","rRtx","lCodecs","rCodecs","lCodec","parameters","apt","rCodec","toLowerCase","forEach","clockRate","numChannels","Math","min","push","rtcpFeedback","fb","j","parameter","lHeaderExtension","rHeaderExtension","uri","isActionAllowedInSignalingState","action","signalingState","offer","setLocalDescription","setRemoteDescription","answer","maybeAddCandidate","iceTransport","candidate","alreadyAdded","getRemoteCandidates","find","remoteCandidate","foundation","ip","port","priority","protocol","addRemoteCandidate","addTrackToStreamAndFireEvent","addTrack","Event","dispatchEvent","removeTrackFromStreamAndFireEvent","removeTrack","fireAddTrack","pc","receiver","streams","trackEvent","setTimeout","_dispatchEvent","makeError","description","RTCPeerConnection","config","_eventTarget","createDocumentFragment","method","bind","canTrickleIceCandidates","needNegotiation","localStreams","remoteStreams","localDescription","remoteDescription","iceConnectionState","iceGatheringState","usingBundle","bundlePolicy","rtcpMuxPolicy","iceTransportPolicy","_iceGatherers","iceCandidatePoolSize","RTCIceGatherer","gatherPolicy","_config","transceivers","_sdpSessionId","generateSessionId","_sdpSessionVersion","_dtlsRole","undefined","_isClosed","prototype","onicecandidate","onaddstream","ontrack","onremovestream","onsignalingstatechange","oniceconnectionstatechange","onicegatheringstatechange","onnegotiationneeded","ondatachannel","_emitGatheringStateChange","getConfiguration","getLocalStreams","getRemoteStreams","_createTransceiver","hasBundleTransport","recvEncodingParameters","associatedRemoteMediaStreams","wantReceive","transports","_createIceAndDtlsTransports","alreadyExists","_maybeFireNegotiationNeeded","RTCRtpSender","addStream","getTracks","clonedStream","clone","idx","clonedTrack","enabled","sender","TypeError","stop","map","splice","removeStream","getSenders","getReceivers","_createIceGatherer","sdpMLineIndex","shift","defineProperty","value","writable","candidates","bufferCandidates","end","keys","_gather","onlocalcandidate","removeEventListener","evt","sdpMid","cand","component","writeCandidate","sections","splitSections","join","complete","every","RTCIceTransport","onicestatechange","_updateConnectionState","RTCDtlsTransport","ondtlsstatechange","onerror","_disposeIceAndDtlsTransports","_transceive","send","recv","params","encodings","rtcp","cname","compound","rtcpParameters","p","receive","Promise","reject","sessionpart","mediaSection","parseRtpParameters","isIceLite","matchPrefix","rejected","isRejected","isDatachannel","remoteIceParameters","getIceParameters","remoteDtlsParameters","getDtlsParameters","role","start","_updateSignalingState","resolve","receiverList","iceOptions","substr","split","lines","splitLines","getKind","direction","getDirection","remoteMsid","parseMsid","getMid","generateIdentifier","parseRtpEncodingParameters","parseRtcpParameters","isComplete","cands","parseCandidate","setTransport","setRemoteCandidates","RTCRtpReceiver","getCapabilities","codec","isNewTrack","MediaStream","get","default","nativeTrack","sid","item","close","newState","states","closed","connecting","checking","connected","completed","disconnected","failed","new","createOffer","numAudioTracks","numVideoTracks","offerOptions","arguments","mandatory","optional","offerToReceiveAudio","offerToReceiveVideo","writeSessionBoilerplate","getLocalCandidates","desc","RTCSessionDescription","createAnswer","mediaSectionsInOffer","localTrack","getAudioTracks","getVideoTracks","hasRtx","c","reducedSize","addIceCandidate","candidateString","trim","getStats","promises","fixStatsType","stat","inboundrtp","outboundrtp","candidatepair","localcandidate","remotecandidate","results","Map","all","res","result","set","methods","nativeMethod","args","apply","error","random","toString","blob","line","parts","part","index","prefix","substring","relatedAddress","relatedPort","tcpType","ufrag","usernameFragment","toUpperCase","parseIceOptions","parseRtpMap","parsed","writeRtpMap","parseExtmap","writeExtmap","headerExtension","preferredId","parseFmtp","kv","writeFmtp","param","parseRtcpFb","writeRtcpFb","parseSsrcMedia","sp","colon","attribute","parseFingerprint","algorithm","fingerprints","setupType","fp","concat","iceParameters","password","mline","rtpmapline","fmtps","maxptime","extension","encodingParameters","hasRed","hasUlpfec","ssrcs","primarySsrc","secondarySsrc","flows","encParam","codecPayloadType","fec","mechanism","bandwidth","maxBitrate","remoteSsrc","obj","rsize","mux","spec","planB","sessId","sessVer","sessionId","version","parseMLine","fmt","slice","adapterFactory","utils","dependencies","opts","options","shimChrome","shimFirefox","shimEdge","shimSafari","key","logging","browserDetails","detectBrowser","extractVersion","disableLog","disableWarnings","chromeShim","edgeShim","firefoxShim","safariShim","commonShim","browser","shimPeerConnection","browserShim","shimCreateObjectURL","shimGetUserMedia","shimMediaStream","shimSourceObject","shimOnTrack","shimAddTrackRemoveTrack","shimGetSendersWithDtmf","shimRTCIceCandidate","shimRemoveStream","shimReplaceTrack","shimRTCIceServerUrls","shimCallbacksAPI","shimLocalStreamsAPI","shimRemoteStreamsAPI","shimTrackEventTransceiver","shimCreateOfferLegacy","webkitMediaStream","_ontrack","origSetRemoteDescription","_ontrackpoly","te","shimSenderWithDtmf","dtmf","_dtmf","createDTMFSender","_pc","_senders","origAddTrack","origRemoveTrack","origAddStream","origRemoveStream","origGetSenders","senders","URL","HTMLMediaElement","_srcObject","src","revokeObjectURL","createObjectURL","shimAddTrackRemoveTrackWithNative","_shimmedLocalStreams","streamId","DOMException","existingSenders","newSenders","newSender","origGetLocalStreams","nativeStreams","_reverseStreams","_streams","newStream","oldStream","replaceInternalStreamId","internalId","externalStream","internalStream","replace","RegExp","replaceExternalStreamId","isLegacyCall","origSetLocalDescription","origLocalDescription","getOwnPropertyDescriptor","isLocal","streamid","hasTrack","pcConfig","pcConstraints","iceTransports","webkitRTCPeerConnection","generateCertificate","OrigPeerConnection","newIceServers","deprecated","origGetStats","selector","successCallback","errorCallback","fixChromeStats_","response","standardReport","reports","report","standardStats","timestamp","names","makeMapStats","stats","successCallbackWrapper_","promise","RTCIceCandidate","nativeAddIceCandidate","constraintsToChrome_","cc","ideal","exact","max","oldname_","charAt","oc","mix","advanced","shimConstraints_","func","audio","remap","b","face","getSupportedFacingModeLies","matches","enumerateDevices","devices","d","dev","some","match","label","deviceId","shimError_","PermissionDeniedError","InvalidStateError","DevicesNotFoundError","ConstraintNotSatisfiedError","TrackStartError","MediaDeviceFailedDueToShutdown","MediaDeviceKillSwitchOn","constraint","constraintName","getUserMedia_","onSuccess","onError","webkitGetUserMedia","getUserMediaPromise_","kinds","MediaStreamTrack","getSources","device","groupId","echoCancellation","frameRate","height","origGetUserMedia","cs","wrapPeerConnectionEvent","eventNameToWrap","wrapper","proto","nativeAddEventListener","nativeEventName","cb","wrappedCallback","_eventMap","nativeRemoveEventListener","unwrappedCb","NativeRTCIceCandidate","nativeCandidate","parsedCandidate","augmentedCandidate","toJSON","nativeCreateObjectURL","nativeRevokeObjectURL","newId","delete","dsc","nativeSetAttribute","setAttribute","shimRTCPeerConnection","origMSTEnabled","ev","RTCDtmfSender","replaceTrack","setTrack","RTCTrackEvent","mozSrcObject","mozRTCPeerConnection","newServer","username","credential","mozRTCSessionDescription","mozRTCIceCandidate","modernStatsTypes","nativeGetStats","onSucc","onErr","InternalError","NotSupportedError","SecurityError","constraintsToFF37_","mozGetUserMedia","infos","orgEnumerateDevices","nativeGetUserMedia","getSettings","nativeGetSettings","applyConstraints","nativeApplyConstraints","_localStreams","getStreamById","_remoteStreams","_addTrack","tracks","_onaddstream","_onaddstreampoly","failureCallback","withCallback","errcb","RTCTransceiver","origCreateOffer","audioTransceiver","getTransceivers","setDirection","addTransceiver","videoTransceiver","logDisabled_","deprecationWarnings_","uastring","expr","pos","bool","oldMethod","newMethod","Function","eval","textContent","ButtonCameraPower","on","ButtonCameraFacing"],"mappings":"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","file":"main.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, {\n \t\t\t\tconfigurable: false,\n \t\t\t\tenumerable: true,\n \t\t\t\tget: getter\n \t\t\t});\n \t\t}\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 3);\n\n\n\n// WEBPACK FOOTER //\n// webpack/bootstrap 683bc8a7d6f06926a04f","\nfunction merge(one, two) {\n  return Object.assign({}, one, two);\n}\n\nexport default class Component {\n\n  constructor(id, defaultState = {}) {\n\n    let state = defaultState;\n\n    const getState = () => state;\n\n    const setState = arg => {\n      if (typeof arg === 'function') {\n        setState(arg(getState()));\n      } else {\n        state = merge(state, arg);\n        this.renderer(getState())\n      }\n    }\n\n    this.dom = document.getElementById(id);\n    this.getState = getState;\n    this.setState = setState;\n    this.renderer = function noop() { };\n  }\n\n  addClass(classname) {\n    this.dom.classList.add(classname);\n  }\n\n  removeClass(classname) {\n    this.dom.classList.remove(classname);\n  }\n\n  toggleClass(classname) {\n    this.dom.classList.toggle(classname);\n  }\n\n  on(event, eventHandler) {\n    return this.dom.addEventListener(event, eventHandler);\n  }\n\n  render(fn) {\n    this.renderer = fn;\n    fn(this.getState());\n  }\n\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/Component.js","import Component from '../Component';\nimport Error from './Error';\nimport {hasMediaDeviceAPI, startingCamera, stopCamera} from '../mediaDevice';\n\nconst CameraScreen = new Component('CameraScreen', {\n  show: false,\n  facingMode: 'environment'\n})\n\nCameraScreen.render((state) => {\n  const {show, facingMode} = state;\n  console.log(facingMode);\n  if (show) {\n    if (hasMediaDeviceAPI()) {\n      startingCamera(CameraScreen.dom, facingMode)\n        .then(() => CameraScreen.addClass('camera__screen--show'))\n        .catch(err => Error.setState({message: `${err.name}: \\n${err.message}`}))\n    }\n\n  } else {\n    stopCamera(CameraScreen.dom);\n    CameraScreen.removeClass('camera__screen--show');\n  }\n})\n\nexport default CameraScreen;\n\n\n\n// WEBPACK FOOTER //\n// ./src/components/CameraScreen.js","import CameraScreen from './components/CameraScreen';\n\nexport function hasMediaDeviceAPI () {\n  return Boolean(navigator.mediaDevices)\n    && Boolean(navigator.mediaDevices.getUserMedia);\n}\n\nfunction isMobileDevice () {\n  return navigator.userAgent.search(/mobi/i) !== -1;\n}\n\nfunction generateConstraints(facingMode = 'environment') {\n  const supportedConstraints = navigator.mediaDevices.getSupportedConstraints();\n  const constraints = {\n    width: CameraScreen.dom.offsetWidth,\n    aspectRatio: 1\n  }\n\n  if (isMobileDevice() && supportedConstraints.hasOwnProperty('facingMode')) {\n    constraints.video = { facingMode: facingMode };\n  } else {\n    constraints.video = true;\n  }\n\n  return constraints;\n}\n\nexport function startingCamera (video, facingMode = 'environment') {\n  return navigator.mediaDevices\n    .getUserMedia(generateConstraints(facingMode))\n    .then(mediaStream => {\n      video.srcObject = mediaStream;\n      video.play();\n    })\n}\n\nexport function stopCamera (video) {\n  video.srcObject = null;\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/mediaDevice.js","import 'webrtc-adapter/out/adapter';\n\nimport initializeCamera from './mediaDevice';\nimport ButtonCameraPower from './components/ButtonCameraPower';\nimport ButtonCameraFacing from './components/ButtonCameraFacing';\n// initializeCamera();\n\n\n\n// WEBPACK FOOTER //\n// ./src/index.js","(function(f){if(typeof exports===\"object\"&&typeof module!==\"undefined\"){module.exports=f()}else if(typeof define===\"function\"&&define.amd){define([],f)}else{var g;if(typeof window!==\"undefined\"){g=window}else if(typeof global!==\"undefined\"){g=global}else if(typeof self!==\"undefined\"){g=self}else{g=this}g.adapter = f()}})(function(){var define,module,exports;return (function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require==\"function\"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error(\"Cannot find module '\"+o+\"'\");throw f.code=\"MODULE_NOT_FOUND\",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require==\"function\"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){\n/*\n *  Copyright (c) 2017 The WebRTC project authors. All Rights Reserved.\n *\n *  Use of this source code is governed by a BSD-style license\n *  that can be found in the LICENSE file in the root of the source\n *  tree.\n */\n /* eslint-env node */\n'use strict';\n\nvar SDPUtils = require('sdp');\n\nfunction writeMediaSection(transceiver, caps, type, stream, dtlsRole) {\n  var sdp = SDPUtils.writeRtpDescription(transceiver.kind, caps);\n\n  // Map ICE parameters (ufrag, pwd) to SDP.\n  sdp += SDPUtils.writeIceParameters(\n      transceiver.iceGatherer.getLocalParameters());\n\n  // Map DTLS parameters to SDP.\n  sdp += SDPUtils.writeDtlsParameters(\n      transceiver.dtlsTransport.getLocalParameters(),\n      type === 'offer' ? 'actpass' : dtlsRole || 'active');\n\n  sdp += 'a=mid:' + transceiver.mid + '\\r\\n';\n\n  if (transceiver.rtpSender && transceiver.rtpReceiver) {\n    sdp += 'a=sendrecv\\r\\n';\n  } else if (transceiver.rtpSender) {\n    sdp += 'a=sendonly\\r\\n';\n  } else if (transceiver.rtpReceiver) {\n    sdp += 'a=recvonly\\r\\n';\n  } else {\n    sdp += 'a=inactive\\r\\n';\n  }\n\n  if (transceiver.rtpSender) {\n    // spec.\n    var msid = 'msid:' + stream.id + ' ' +\n        transceiver.rtpSender.track.id + '\\r\\n';\n    sdp += 'a=' + msid;\n\n    // for Chrome.\n    sdp += 'a=ssrc:' + transceiver.sendEncodingParameters[0].ssrc +\n        ' ' + msid;\n    if (transceiver.sendEncodingParameters[0].rtx) {\n      sdp += 'a=ssrc:' + transceiver.sendEncodingParameters[0].rtx.ssrc +\n          ' ' + msid;\n      sdp += 'a=ssrc-group:FID ' +\n          transceiver.sendEncodingParameters[0].ssrc + ' ' +\n          transceiver.sendEncodingParameters[0].rtx.ssrc +\n          '\\r\\n';\n    }\n  }\n  // FIXME: this should be written by writeRtpDescription.\n  sdp += 'a=ssrc:' + transceiver.sendEncodingParameters[0].ssrc +\n      ' cname:' + SDPUtils.localCName + '\\r\\n';\n  if (transceiver.rtpSender && transceiver.sendEncodingParameters[0].rtx) {\n    sdp += 'a=ssrc:' + transceiver.sendEncodingParameters[0].rtx.ssrc +\n        ' cname:' + SDPUtils.localCName + '\\r\\n';\n  }\n  return sdp;\n}\n\n// Edge does not like\n// 1) stun: filtered after 14393 unless ?transport=udp is present\n// 2) turn: that does not have all of turn:host:port?transport=udp\n// 3) turn: with ipv6 addresses\n// 4) turn: occurring muliple times\nfunction filterIceServers(iceServers, edgeVersion) {\n  var hasTurn = false;\n  iceServers = JSON.parse(JSON.stringify(iceServers));\n  return iceServers.filter(function(server) {\n    if (server && (server.urls || server.url)) {\n      var urls = server.urls || server.url;\n      if (server.url && !server.urls) {\n        console.warn('RTCIceServer.url is deprecated! Use urls instead.');\n      }\n      var isString = typeof urls === 'string';\n      if (isString) {\n        urls = [urls];\n      }\n      urls = urls.filter(function(url) {\n        var validTurn = url.indexOf('turn:') === 0 &&\n            url.indexOf('transport=udp') !== -1 &&\n            url.indexOf('turn:[') === -1 &&\n            !hasTurn;\n\n        if (validTurn) {\n          hasTurn = true;\n          return true;\n        }\n        return url.indexOf('stun:') === 0 && edgeVersion >= 14393 &&\n            url.indexOf('?transport=udp') === -1;\n      });\n\n      delete server.url;\n      server.urls = isString ? urls[0] : urls;\n      return !!urls.length;\n    }\n  });\n}\n\n// Determines the intersection of local and remote capabilities.\nfunction getCommonCapabilities(localCapabilities, remoteCapabilities) {\n  var commonCapabilities = {\n    codecs: [],\n    headerExtensions: [],\n    fecMechanisms: []\n  };\n\n  var findCodecByPayloadType = function(pt, codecs) {\n    pt = parseInt(pt, 10);\n    for (var i = 0; i < codecs.length; i++) {\n      if (codecs[i].payloadType === pt ||\n          codecs[i].preferredPayloadType === pt) {\n        return codecs[i];\n      }\n    }\n  };\n\n  var rtxCapabilityMatches = function(lRtx, rRtx, lCodecs, rCodecs) {\n    var lCodec = findCodecByPayloadType(lRtx.parameters.apt, lCodecs);\n    var rCodec = findCodecByPayloadType(rRtx.parameters.apt, rCodecs);\n    return lCodec && rCodec &&\n        lCodec.name.toLowerCase() === rCodec.name.toLowerCase();\n  };\n\n  localCapabilities.codecs.forEach(function(lCodec) {\n    for (var i = 0; i < remoteCapabilities.codecs.length; i++) {\n      var rCodec = remoteCapabilities.codecs[i];\n      if (lCodec.name.toLowerCase() === rCodec.name.toLowerCase() &&\n          lCodec.clockRate === rCodec.clockRate) {\n        if (lCodec.name.toLowerCase() === 'rtx' &&\n            lCodec.parameters && rCodec.parameters.apt) {\n          // for RTX we need to find the local rtx that has a apt\n          // which points to the same local codec as the remote one.\n          if (!rtxCapabilityMatches(lCodec, rCodec,\n              localCapabilities.codecs, remoteCapabilities.codecs)) {\n            continue;\n          }\n        }\n        rCodec = JSON.parse(JSON.stringify(rCodec)); // deepcopy\n        // number of channels is the highest common number of channels\n        rCodec.numChannels = Math.min(lCodec.numChannels,\n            rCodec.numChannels);\n        // push rCodec so we reply with offerer payload type\n        commonCapabilities.codecs.push(rCodec);\n\n        // determine common feedback mechanisms\n        rCodec.rtcpFeedback = rCodec.rtcpFeedback.filter(function(fb) {\n          for (var j = 0; j < lCodec.rtcpFeedback.length; j++) {\n            if (lCodec.rtcpFeedback[j].type === fb.type &&\n                lCodec.rtcpFeedback[j].parameter === fb.parameter) {\n              return true;\n            }\n          }\n          return false;\n        });\n        // FIXME: also need to determine .parameters\n        //  see https://github.com/openpeer/ortc/issues/569\n        break;\n      }\n    }\n  });\n\n  localCapabilities.headerExtensions.forEach(function(lHeaderExtension) {\n    for (var i = 0; i < remoteCapabilities.headerExtensions.length;\n         i++) {\n      var rHeaderExtension = remoteCapabilities.headerExtensions[i];\n      if (lHeaderExtension.uri === rHeaderExtension.uri) {\n        commonCapabilities.headerExtensions.push(rHeaderExtension);\n        break;\n      }\n    }\n  });\n\n  // FIXME: fecMechanisms\n  return commonCapabilities;\n}\n\n// is action=setLocalDescription with type allowed in signalingState\nfunction isActionAllowedInSignalingState(action, type, signalingState) {\n  return {\n    offer: {\n      setLocalDescription: ['stable', 'have-local-offer'],\n      setRemoteDescription: ['stable', 'have-remote-offer']\n    },\n    answer: {\n      setLocalDescription: ['have-remote-offer', 'have-local-pranswer'],\n      setRemoteDescription: ['have-local-offer', 'have-remote-pranswer']\n    }\n  }[type][action].indexOf(signalingState) !== -1;\n}\n\nfunction maybeAddCandidate(iceTransport, candidate) {\n  // Edge's internal representation adds some fields therefore\n  // not all fieldѕ are taken into account.\n  var alreadyAdded = iceTransport.getRemoteCandidates()\n      .find(function(remoteCandidate) {\n        return candidate.foundation === remoteCandidate.foundation &&\n            candidate.ip === remoteCandidate.ip &&\n            candidate.port === remoteCandidate.port &&\n            candidate.priority === remoteCandidate.priority &&\n            candidate.protocol === remoteCandidate.protocol &&\n            candidate.type === remoteCandidate.type;\n      });\n  if (!alreadyAdded) {\n    iceTransport.addRemoteCandidate(candidate);\n  }\n  return !alreadyAdded;\n}\n\n\n// https://w3c.github.io/mediacapture-main/#mediastream\n// Helper function to add the track to the stream and\n// dispatch the event ourselves.\nfunction addTrackToStreamAndFireEvent(track, stream) {\n  stream.addTrack(track);\n  var e = new Event('addtrack'); // TODO: MediaStreamTrackEvent\n  e.track = track;\n  stream.dispatchEvent(e);\n}\n\nfunction removeTrackFromStreamAndFireEvent(track, stream) {\n  stream.removeTrack(track);\n  var e = new Event('removetrack'); // TODO: MediaStreamTrackEvent\n  e.track = track;\n  stream.dispatchEvent(e);\n}\n\nfunction fireAddTrack(pc, track, receiver, streams) {\n  var trackEvent = new Event('track');\n  trackEvent.track = track;\n  trackEvent.receiver = receiver;\n  trackEvent.transceiver = {receiver: receiver};\n  trackEvent.streams = streams;\n  window.setTimeout(function() {\n    pc._dispatchEvent('track', trackEvent);\n  });\n}\n\nfunction makeError(name, description) {\n  var e = new Error(description);\n  e.name = name;\n  return e;\n}\n\nmodule.exports = function(window, edgeVersion) {\n  var RTCPeerConnection = function(config) {\n    var pc = this;\n\n    var _eventTarget = document.createDocumentFragment();\n    ['addEventListener', 'removeEventListener', 'dispatchEvent']\n        .forEach(function(method) {\n          pc[method] = _eventTarget[method].bind(_eventTarget);\n        });\n\n    this.canTrickleIceCandidates = null;\n\n    this.needNegotiation = false;\n\n    this.localStreams = [];\n    this.remoteStreams = [];\n\n    this.localDescription = null;\n    this.remoteDescription = null;\n\n    this.signalingState = 'stable';\n    this.iceConnectionState = 'new';\n    this.iceGatheringState = 'new';\n\n    config = JSON.parse(JSON.stringify(config || {}));\n\n    this.usingBundle = config.bundlePolicy === 'max-bundle';\n    if (config.rtcpMuxPolicy === 'negotiate') {\n      throw(makeError('NotSupportedError',\n          'rtcpMuxPolicy \\'negotiate\\' is not supported'));\n    } else if (!config.rtcpMuxPolicy) {\n      config.rtcpMuxPolicy = 'require';\n    }\n\n    switch (config.iceTransportPolicy) {\n      case 'all':\n      case 'relay':\n        break;\n      default:\n        config.iceTransportPolicy = 'all';\n        break;\n    }\n\n    switch (config.bundlePolicy) {\n      case 'balanced':\n      case 'max-compat':\n      case 'max-bundle':\n        break;\n      default:\n        config.bundlePolicy = 'balanced';\n        break;\n    }\n\n    config.iceServers = filterIceServers(config.iceServers || [], edgeVersion);\n\n    this._iceGatherers = [];\n    if (config.iceCandidatePoolSize) {\n      for (var i = config.iceCandidatePoolSize; i > 0; i--) {\n        this._iceGatherers = new window.RTCIceGatherer({\n          iceServers: config.iceServers,\n          gatherPolicy: config.iceTransportPolicy\n        });\n      }\n    } else {\n      config.iceCandidatePoolSize = 0;\n    }\n\n    this._config = config;\n\n    // per-track iceGathers, iceTransports, dtlsTransports, rtpSenders, ...\n    // everything that is needed to describe a SDP m-line.\n    this.transceivers = [];\n\n    this._sdpSessionId = SDPUtils.generateSessionId();\n    this._sdpSessionVersion = 0;\n\n    this._dtlsRole = undefined; // role for a=setup to use in answers.\n\n    this._isClosed = false;\n  };\n\n  // set up event handlers on prototype\n  RTCPeerConnection.prototype.onicecandidate = null;\n  RTCPeerConnection.prototype.onaddstream = null;\n  RTCPeerConnection.prototype.ontrack = null;\n  RTCPeerConnection.prototype.onremovestream = null;\n  RTCPeerConnection.prototype.onsignalingstatechange = null;\n  RTCPeerConnection.prototype.oniceconnectionstatechange = null;\n  RTCPeerConnection.prototype.onicegatheringstatechange = null;\n  RTCPeerConnection.prototype.onnegotiationneeded = null;\n  RTCPeerConnection.prototype.ondatachannel = null;\n\n  RTCPeerConnection.prototype._dispatchEvent = function(name, event) {\n    if (this._isClosed) {\n      return;\n    }\n    this.dispatchEvent(event);\n    if (typeof this['on' + name] === 'function') {\n      this['on' + name](event);\n    }\n  };\n\n  RTCPeerConnection.prototype._emitGatheringStateChange = function() {\n    var event = new Event('icegatheringstatechange');\n    this._dispatchEvent('icegatheringstatechange', event);\n  };\n\n  RTCPeerConnection.prototype.getConfiguration = function() {\n    return this._config;\n  };\n\n  RTCPeerConnection.prototype.getLocalStreams = function() {\n    return this.localStreams;\n  };\n\n  RTCPeerConnection.prototype.getRemoteStreams = function() {\n    return this.remoteStreams;\n  };\n\n  // internal helper to create a transceiver object.\n  // (whih is not yet the same as the WebRTC 1.0 transceiver)\n  RTCPeerConnection.prototype._createTransceiver = function(kind) {\n    var hasBundleTransport = this.transceivers.length > 0;\n    var transceiver = {\n      track: null,\n      iceGatherer: null,\n      iceTransport: null,\n      dtlsTransport: null,\n      localCapabilities: null,\n      remoteCapabilities: null,\n      rtpSender: null,\n      rtpReceiver: null,\n      kind: kind,\n      mid: null,\n      sendEncodingParameters: null,\n      recvEncodingParameters: null,\n      stream: null,\n      associatedRemoteMediaStreams: [],\n      wantReceive: true\n    };\n    if (this.usingBundle && hasBundleTransport) {\n      transceiver.iceTransport = this.transceivers[0].iceTransport;\n      transceiver.dtlsTransport = this.transceivers[0].dtlsTransport;\n    } else {\n      var transports = this._createIceAndDtlsTransports();\n      transceiver.iceTransport = transports.iceTransport;\n      transceiver.dtlsTransport = transports.dtlsTransport;\n    }\n    this.transceivers.push(transceiver);\n    return transceiver;\n  };\n\n  RTCPeerConnection.prototype.addTrack = function(track, stream) {\n    var alreadyExists = this.transceivers.find(function(s) {\n      return s.track === track;\n    });\n\n    if (alreadyExists) {\n      throw makeError('InvalidAccessError', 'Track already exists.');\n    }\n\n    if (this.signalingState === 'closed') {\n      throw makeError('InvalidStateError',\n          'Attempted to call addTrack on a closed peerconnection.');\n    }\n\n    var transceiver;\n    for (var i = 0; i < this.transceivers.length; i++) {\n      if (!this.transceivers[i].track &&\n          this.transceivers[i].kind === track.kind) {\n        transceiver = this.transceivers[i];\n      }\n    }\n    if (!transceiver) {\n      transceiver = this._createTransceiver(track.kind);\n    }\n\n    this._maybeFireNegotiationNeeded();\n\n    if (this.localStreams.indexOf(stream) === -1) {\n      this.localStreams.push(stream);\n    }\n\n    transceiver.track = track;\n    transceiver.stream = stream;\n    transceiver.rtpSender = new window.RTCRtpSender(track,\n        transceiver.dtlsTransport);\n    return transceiver.rtpSender;\n  };\n\n  RTCPeerConnection.prototype.addStream = function(stream) {\n    var pc = this;\n    if (edgeVersion >= 15025) {\n      stream.getTracks().forEach(function(track) {\n        pc.addTrack(track, stream);\n      });\n    } else {\n      // Clone is necessary for local demos mostly, attaching directly\n      // to two different senders does not work (build 10547).\n      // Fixed in 15025 (or earlier)\n      var clonedStream = stream.clone();\n      stream.getTracks().forEach(function(track, idx) {\n        var clonedTrack = clonedStream.getTracks()[idx];\n        track.addEventListener('enabled', function(event) {\n          clonedTrack.enabled = event.enabled;\n        });\n      });\n      clonedStream.getTracks().forEach(function(track) {\n        pc.addTrack(track, clonedStream);\n      });\n    }\n  };\n\n  RTCPeerConnection.prototype.removeTrack = function(sender) {\n    if (!(sender instanceof window.RTCRtpSender)) {\n      throw new TypeError('Argument 1 of RTCPeerConnection.removeTrack ' +\n          'does not implement interface RTCRtpSender.');\n    }\n\n    var transceiver = this.transceivers.find(function(t) {\n      return t.rtpSender === sender;\n    });\n\n    if (!transceiver) {\n      throw makeError('InvalidAccessError',\n          'Sender was not created by this connection.');\n    }\n    var stream = transceiver.stream;\n\n    transceiver.rtpSender.stop();\n    transceiver.rtpSender = null;\n    transceiver.track = null;\n    transceiver.stream = null;\n\n    // remove the stream from the set of local streams\n    var localStreams = this.transceivers.map(function(t) {\n      return t.stream;\n    });\n    if (localStreams.indexOf(stream) === -1 &&\n        this.localStreams.indexOf(stream) > -1) {\n      this.localStreams.splice(this.localStreams.indexOf(stream), 1);\n    }\n\n    this._maybeFireNegotiationNeeded();\n  };\n\n  RTCPeerConnection.prototype.removeStream = function(stream) {\n    var pc = this;\n    stream.getTracks().forEach(function(track) {\n      var sender = pc.getSenders().find(function(s) {\n        return s.track === track;\n      });\n      if (sender) {\n        pc.removeTrack(sender);\n      }\n    });\n  };\n\n  RTCPeerConnection.prototype.getSenders = function() {\n    return this.transceivers.filter(function(transceiver) {\n      return !!transceiver.rtpSender;\n    })\n    .map(function(transceiver) {\n      return transceiver.rtpSender;\n    });\n  };\n\n  RTCPeerConnection.prototype.getReceivers = function() {\n    return this.transceivers.filter(function(transceiver) {\n      return !!transceiver.rtpReceiver;\n    })\n    .map(function(transceiver) {\n      return transceiver.rtpReceiver;\n    });\n  };\n\n\n  RTCPeerConnection.prototype._createIceGatherer = function(sdpMLineIndex,\n      usingBundle) {\n    var pc = this;\n    if (usingBundle && sdpMLineIndex > 0) {\n      return this.transceivers[0].iceGatherer;\n    } else if (this._iceGatherers.length) {\n      return this._iceGatherers.shift();\n    }\n    var iceGatherer = new window.RTCIceGatherer({\n      iceServers: this._config.iceServers,\n      gatherPolicy: this._config.iceTransportPolicy\n    });\n    Object.defineProperty(iceGatherer, 'state',\n        {value: 'new', writable: true}\n    );\n\n    this.transceivers[sdpMLineIndex].candidates = [];\n    this.transceivers[sdpMLineIndex].bufferCandidates = function(event) {\n      var end = !event.candidate || Object.keys(event.candidate).length === 0;\n      // polyfill since RTCIceGatherer.state is not implemented in\n      // Edge 10547 yet.\n      iceGatherer.state = end ? 'completed' : 'gathering';\n      if (pc.transceivers[sdpMLineIndex].candidates !== null) {\n        pc.transceivers[sdpMLineIndex].candidates.push(event.candidate);\n      }\n    };\n    iceGatherer.addEventListener('localcandidate',\n      this.transceivers[sdpMLineIndex].bufferCandidates);\n    return iceGatherer;\n  };\n\n  // start gathering from an RTCIceGatherer.\n  RTCPeerConnection.prototype._gather = function(mid, sdpMLineIndex) {\n    var pc = this;\n    var iceGatherer = this.transceivers[sdpMLineIndex].iceGatherer;\n    if (iceGatherer.onlocalcandidate) {\n      return;\n    }\n    var candidates = this.transceivers[sdpMLineIndex].candidates;\n    this.transceivers[sdpMLineIndex].candidates = null;\n    iceGatherer.removeEventListener('localcandidate',\n      this.transceivers[sdpMLineIndex].bufferCandidates);\n    iceGatherer.onlocalcandidate = function(evt) {\n      if (pc.usingBundle && sdpMLineIndex > 0) {\n        // if we know that we use bundle we can drop candidates with\n        // ѕdpMLineIndex > 0. If we don't do this then our state gets\n        // confused since we dispose the extra ice gatherer.\n        return;\n      }\n      var event = new Event('icecandidate');\n      event.candidate = {sdpMid: mid, sdpMLineIndex: sdpMLineIndex};\n\n      var cand = evt.candidate;\n      // Edge emits an empty object for RTCIceCandidateComplete‥\n      var end = !cand || Object.keys(cand).length === 0;\n      if (end) {\n        // polyfill since RTCIceGatherer.state is not implemented in\n        // Edge 10547 yet.\n        if (iceGatherer.state === 'new' || iceGatherer.state === 'gathering') {\n          iceGatherer.state = 'completed';\n        }\n      } else {\n        if (iceGatherer.state === 'new') {\n          iceGatherer.state = 'gathering';\n        }\n        // RTCIceCandidate doesn't have a component, needs to be added\n        cand.component = 1;\n        event.candidate.candidate = SDPUtils.writeCandidate(cand);\n      }\n\n      // update local description.\n      var sections = SDPUtils.splitSections(pc.localDescription.sdp);\n      if (!end) {\n        sections[event.candidate.sdpMLineIndex + 1] +=\n            'a=' + event.candidate.candidate + '\\r\\n';\n      } else {\n        sections[event.candidate.sdpMLineIndex + 1] +=\n            'a=end-of-candidates\\r\\n';\n      }\n      pc.localDescription.sdp = sections.join('');\n      var complete = pc.transceivers.every(function(transceiver) {\n        return transceiver.iceGatherer &&\n            transceiver.iceGatherer.state === 'completed';\n      });\n\n      if (pc.iceGatheringState !== 'gathering') {\n        pc.iceGatheringState = 'gathering';\n        pc._emitGatheringStateChange();\n      }\n\n      // Emit candidate. Also emit null candidate when all gatherers are\n      // complete.\n      if (!end) {\n        pc._dispatchEvent('icecandidate', event);\n      }\n      if (complete) {\n        pc._dispatchEvent('icecandidate', new Event('icecandidate'));\n        pc.iceGatheringState = 'complete';\n        pc._emitGatheringStateChange();\n      }\n    };\n\n    // emit already gathered candidates.\n    window.setTimeout(function() {\n      candidates.forEach(function(candidate) {\n        var e = new Event('RTCIceGatherEvent');\n        e.candidate = candidate;\n        iceGatherer.onlocalcandidate(e);\n      });\n    }, 0);\n  };\n\n  // Create ICE transport and DTLS transport.\n  RTCPeerConnection.prototype._createIceAndDtlsTransports = function() {\n    var pc = this;\n    var iceTransport = new window.RTCIceTransport(null);\n    iceTransport.onicestatechange = function() {\n      pc._updateConnectionState();\n    };\n\n    var dtlsTransport = new window.RTCDtlsTransport(iceTransport);\n    dtlsTransport.ondtlsstatechange = function() {\n      pc._updateConnectionState();\n    };\n    dtlsTransport.onerror = function() {\n      // onerror does not set state to failed by itpc.\n      Object.defineProperty(dtlsTransport, 'state',\n          {value: 'failed', writable: true});\n      pc._updateConnectionState();\n    };\n\n    return {\n      iceTransport: iceTransport,\n      dtlsTransport: dtlsTransport\n    };\n  };\n\n  // Destroy ICE gatherer, ICE transport and DTLS transport.\n  // Without triggering the callbacks.\n  RTCPeerConnection.prototype._disposeIceAndDtlsTransports = function(\n      sdpMLineIndex) {\n    var iceGatherer = this.transceivers[sdpMLineIndex].iceGatherer;\n    if (iceGatherer) {\n      delete iceGatherer.onlocalcandidate;\n      delete this.transceivers[sdpMLineIndex].iceGatherer;\n    }\n    var iceTransport = this.transceivers[sdpMLineIndex].iceTransport;\n    if (iceTransport) {\n      delete iceTransport.onicestatechange;\n      delete this.transceivers[sdpMLineIndex].iceTransport;\n    }\n    var dtlsTransport = this.transceivers[sdpMLineIndex].dtlsTransport;\n    if (dtlsTransport) {\n      delete dtlsTransport.ondtlsstatechange;\n      delete dtlsTransport.onerror;\n      delete this.transceivers[sdpMLineIndex].dtlsTransport;\n    }\n  };\n\n  // Start the RTP Sender and Receiver for a transceiver.\n  RTCPeerConnection.prototype._transceive = function(transceiver,\n      send, recv) {\n    var params = getCommonCapabilities(transceiver.localCapabilities,\n        transceiver.remoteCapabilities);\n    if (send && transceiver.rtpSender) {\n      params.encodings = transceiver.sendEncodingParameters;\n      params.rtcp = {\n        cname: SDPUtils.localCName,\n        compound: transceiver.rtcpParameters.compound\n      };\n      if (transceiver.recvEncodingParameters.length) {\n        params.rtcp.ssrc = transceiver.recvEncodingParameters[0].ssrc;\n      }\n      transceiver.rtpSender.send(params);\n    }\n    if (recv && transceiver.rtpReceiver && params.codecs.length > 0) {\n      // remove RTX field in Edge 14942\n      if (transceiver.kind === 'video'\n          && transceiver.recvEncodingParameters\n          && edgeVersion < 15019) {\n        transceiver.recvEncodingParameters.forEach(function(p) {\n          delete p.rtx;\n        });\n      }\n      if (transceiver.recvEncodingParameters.length) {\n        params.encodings = transceiver.recvEncodingParameters;\n      }\n      params.rtcp = {\n        compound: transceiver.rtcpParameters.compound\n      };\n      if (transceiver.rtcpParameters.cname) {\n        params.rtcp.cname = transceiver.rtcpParameters.cname;\n      }\n      if (transceiver.sendEncodingParameters.length) {\n        params.rtcp.ssrc = transceiver.sendEncodingParameters[0].ssrc;\n      }\n      transceiver.rtpReceiver.receive(params);\n    }\n  };\n\n  RTCPeerConnection.prototype.setLocalDescription = function(description) {\n    var pc = this;\n\n    if (!isActionAllowedInSignalingState('setLocalDescription',\n        description.type, this.signalingState) || this._isClosed) {\n      return Promise.reject(makeError('InvalidStateError',\n          'Can not set local ' + description.type +\n          ' in state ' + pc.signalingState));\n    }\n\n    var sections;\n    var sessionpart;\n    if (description.type === 'offer') {\n      // VERY limited support for SDP munging. Limited to:\n      // * changing the order of codecs\n      sections = SDPUtils.splitSections(description.sdp);\n      sessionpart = sections.shift();\n      sections.forEach(function(mediaSection, sdpMLineIndex) {\n        var caps = SDPUtils.parseRtpParameters(mediaSection);\n        pc.transceivers[sdpMLineIndex].localCapabilities = caps;\n      });\n\n      this.transceivers.forEach(function(transceiver, sdpMLineIndex) {\n        pc._gather(transceiver.mid, sdpMLineIndex);\n      });\n    } else if (description.type === 'answer') {\n      sections = SDPUtils.splitSections(pc.remoteDescription.sdp);\n      sessionpart = sections.shift();\n      var isIceLite = SDPUtils.matchPrefix(sessionpart,\n          'a=ice-lite').length > 0;\n      sections.forEach(function(mediaSection, sdpMLineIndex) {\n        var transceiver = pc.transceivers[sdpMLineIndex];\n        var iceGatherer = transceiver.iceGatherer;\n        var iceTransport = transceiver.iceTransport;\n        var dtlsTransport = transceiver.dtlsTransport;\n        var localCapabilities = transceiver.localCapabilities;\n        var remoteCapabilities = transceiver.remoteCapabilities;\n\n        // treat bundle-only as not-rejected.\n        var rejected = SDPUtils.isRejected(mediaSection) &&\n            SDPUtils.matchPrefix(mediaSection, 'a=bundle-only').length === 0;\n\n        if (!rejected && !transceiver.isDatachannel) {\n          var remoteIceParameters = SDPUtils.getIceParameters(\n              mediaSection, sessionpart);\n          var remoteDtlsParameters = SDPUtils.getDtlsParameters(\n              mediaSection, sessionpart);\n          if (isIceLite) {\n            remoteDtlsParameters.role = 'server';\n          }\n\n          if (!pc.usingBundle || sdpMLineIndex === 0) {\n            pc._gather(transceiver.mid, sdpMLineIndex);\n            if (iceTransport.state === 'new') {\n              iceTransport.start(iceGatherer, remoteIceParameters,\n                  isIceLite ? 'controlling' : 'controlled');\n            }\n            if (dtlsTransport.state === 'new') {\n              dtlsTransport.start(remoteDtlsParameters);\n            }\n          }\n\n          // Calculate intersection of capabilities.\n          var params = getCommonCapabilities(localCapabilities,\n              remoteCapabilities);\n\n          // Start the RTCRtpSender. The RTCRtpReceiver for this\n          // transceiver has already been started in setRemoteDescription.\n          pc._transceive(transceiver,\n              params.codecs.length > 0,\n              false);\n        }\n      });\n    }\n\n    this.localDescription = {\n      type: description.type,\n      sdp: description.sdp\n    };\n    switch (description.type) {\n      case 'offer':\n        this._updateSignalingState('have-local-offer');\n        break;\n      case 'answer':\n        this._updateSignalingState('stable');\n        break;\n      default:\n        throw new TypeError('unsupported type \"' + description.type +\n            '\"');\n    }\n\n    return Promise.resolve();\n  };\n\n  RTCPeerConnection.prototype.setRemoteDescription = function(description) {\n    var pc = this;\n\n    if (!isActionAllowedInSignalingState('setRemoteDescription',\n        description.type, this.signalingState) || this._isClosed) {\n      return Promise.reject(makeError('InvalidStateError',\n          'Can not set remote ' + description.type +\n          ' in state ' + pc.signalingState));\n    }\n\n    var streams = {};\n    this.remoteStreams.forEach(function(stream) {\n      streams[stream.id] = stream;\n    });\n    var receiverList = [];\n    var sections = SDPUtils.splitSections(description.sdp);\n    var sessionpart = sections.shift();\n    var isIceLite = SDPUtils.matchPrefix(sessionpart,\n        'a=ice-lite').length > 0;\n    var usingBundle = SDPUtils.matchPrefix(sessionpart,\n        'a=group:BUNDLE ').length > 0;\n    this.usingBundle = usingBundle;\n    var iceOptions = SDPUtils.matchPrefix(sessionpart,\n        'a=ice-options:')[0];\n    if (iceOptions) {\n      this.canTrickleIceCandidates = iceOptions.substr(14).split(' ')\n          .indexOf('trickle') >= 0;\n    } else {\n      this.canTrickleIceCandidates = false;\n    }\n\n    sections.forEach(function(mediaSection, sdpMLineIndex) {\n      var lines = SDPUtils.splitLines(mediaSection);\n      var kind = SDPUtils.getKind(mediaSection);\n      // treat bundle-only as not-rejected.\n      var rejected = SDPUtils.isRejected(mediaSection) &&\n          SDPUtils.matchPrefix(mediaSection, 'a=bundle-only').length === 0;\n      var protocol = lines[0].substr(2).split(' ')[2];\n\n      var direction = SDPUtils.getDirection(mediaSection, sessionpart);\n      var remoteMsid = SDPUtils.parseMsid(mediaSection);\n\n      var mid = SDPUtils.getMid(mediaSection) || SDPUtils.generateIdentifier();\n\n      // Reject datachannels which are not implemented yet.\n      if (kind === 'application' && protocol === 'DTLS/SCTP') {\n        pc.transceivers[sdpMLineIndex] = {\n          mid: mid,\n          isDatachannel: true\n        };\n        return;\n      }\n\n      var transceiver;\n      var iceGatherer;\n      var iceTransport;\n      var dtlsTransport;\n      var rtpReceiver;\n      var sendEncodingParameters;\n      var recvEncodingParameters;\n      var localCapabilities;\n\n      var track;\n      // FIXME: ensure the mediaSection has rtcp-mux set.\n      var remoteCapabilities = SDPUtils.parseRtpParameters(mediaSection);\n      var remoteIceParameters;\n      var remoteDtlsParameters;\n      if (!rejected) {\n        remoteIceParameters = SDPUtils.getIceParameters(mediaSection,\n            sessionpart);\n        remoteDtlsParameters = SDPUtils.getDtlsParameters(mediaSection,\n            sessionpart);\n        remoteDtlsParameters.role = 'client';\n      }\n      recvEncodingParameters =\n          SDPUtils.parseRtpEncodingParameters(mediaSection);\n\n      var rtcpParameters = SDPUtils.parseRtcpParameters(mediaSection);\n\n      var isComplete = SDPUtils.matchPrefix(mediaSection,\n          'a=end-of-candidates', sessionpart).length > 0;\n      var cands = SDPUtils.matchPrefix(mediaSection, 'a=candidate:')\n          .map(function(cand) {\n            return SDPUtils.parseCandidate(cand);\n          })\n          .filter(function(cand) {\n            return cand.component === 1;\n          });\n\n      // Check if we can use BUNDLE and dispose transports.\n      if ((description.type === 'offer' || description.type === 'answer') &&\n          !rejected && usingBundle && sdpMLineIndex > 0 &&\n          pc.transceivers[sdpMLineIndex]) {\n        pc._disposeIceAndDtlsTransports(sdpMLineIndex);\n        pc.transceivers[sdpMLineIndex].iceGatherer =\n            pc.transceivers[0].iceGatherer;\n        pc.transceivers[sdpMLineIndex].iceTransport =\n            pc.transceivers[0].iceTransport;\n        pc.transceivers[sdpMLineIndex].dtlsTransport =\n            pc.transceivers[0].dtlsTransport;\n        if (pc.transceivers[sdpMLineIndex].rtpSender) {\n          pc.transceivers[sdpMLineIndex].rtpSender.setTransport(\n              pc.transceivers[0].dtlsTransport);\n        }\n        if (pc.transceivers[sdpMLineIndex].rtpReceiver) {\n          pc.transceivers[sdpMLineIndex].rtpReceiver.setTransport(\n              pc.transceivers[0].dtlsTransport);\n        }\n      }\n      if (description.type === 'offer' && !rejected) {\n        transceiver = pc.transceivers[sdpMLineIndex] ||\n            pc._createTransceiver(kind);\n        transceiver.mid = mid;\n\n        if (!transceiver.iceGatherer) {\n          transceiver.iceGatherer = pc._createIceGatherer(sdpMLineIndex,\n              usingBundle);\n        }\n\n        if (cands.length && transceiver.iceTransport.state === 'new') {\n          if (isComplete && (!usingBundle || sdpMLineIndex === 0)) {\n            transceiver.iceTransport.setRemoteCandidates(cands);\n          } else {\n            cands.forEach(function(candidate) {\n              maybeAddCandidate(transceiver.iceTransport, candidate);\n            });\n          }\n        }\n\n        localCapabilities = window.RTCRtpReceiver.getCapabilities(kind);\n\n        // filter RTX until additional stuff needed for RTX is implemented\n        // in adapter.js\n        if (edgeVersion < 15019) {\n          localCapabilities.codecs = localCapabilities.codecs.filter(\n              function(codec) {\n                return codec.name !== 'rtx';\n              });\n        }\n\n        sendEncodingParameters = transceiver.sendEncodingParameters || [{\n          ssrc: (2 * sdpMLineIndex + 2) * 1001\n        }];\n\n        // TODO: rewrite to use http://w3c.github.io/webrtc-pc/#set-associated-remote-streams\n        var isNewTrack = false;\n        if (direction === 'sendrecv' || direction === 'sendonly') {\n          isNewTrack = !transceiver.rtpReceiver;\n          rtpReceiver = transceiver.rtpReceiver ||\n              new window.RTCRtpReceiver(transceiver.dtlsTransport, kind);\n\n          if (isNewTrack) {\n            var stream;\n            track = rtpReceiver.track;\n            // FIXME: does not work with Plan B.\n            if (remoteMsid && remoteMsid.stream === '-') {\n              // no-op. a stream id of '-' means: no associated stream.\n            } else if (remoteMsid) {\n              if (!streams[remoteMsid.stream]) {\n                streams[remoteMsid.stream] = new window.MediaStream();\n                Object.defineProperty(streams[remoteMsid.stream], 'id', {\n                  get: function() {\n                    return remoteMsid.stream;\n                  }\n                });\n              }\n              Object.defineProperty(track, 'id', {\n                get: function() {\n                  return remoteMsid.track;\n                }\n              });\n              stream = streams[remoteMsid.stream];\n            } else {\n              if (!streams.default) {\n                streams.default = new window.MediaStream();\n              }\n              stream = streams.default;\n            }\n            if (stream) {\n              addTrackToStreamAndFireEvent(track, stream);\n              transceiver.associatedRemoteMediaStreams.push(stream);\n            }\n            receiverList.push([track, rtpReceiver, stream]);\n          }\n        } else if (transceiver.rtpReceiver && transceiver.rtpReceiver.track) {\n          transceiver.associatedRemoteMediaStreams.forEach(function(s) {\n            var nativeTrack = s.getTracks().find(function(t) {\n              return t.id === transceiver.rtpReceiver.track.id;\n            });\n            if (nativeTrack) {\n              removeTrackFromStreamAndFireEvent(nativeTrack, s);\n            }\n          });\n          transceiver.associatedRemoteMediaStreams = [];\n        }\n\n        transceiver.localCapabilities = localCapabilities;\n        transceiver.remoteCapabilities = remoteCapabilities;\n        transceiver.rtpReceiver = rtpReceiver;\n        transceiver.rtcpParameters = rtcpParameters;\n        transceiver.sendEncodingParameters = sendEncodingParameters;\n        transceiver.recvEncodingParameters = recvEncodingParameters;\n\n        // Start the RTCRtpReceiver now. The RTPSender is started in\n        // setLocalDescription.\n        pc._transceive(pc.transceivers[sdpMLineIndex],\n            false,\n            isNewTrack);\n      } else if (description.type === 'answer' && !rejected) {\n        transceiver = pc.transceivers[sdpMLineIndex];\n        iceGatherer = transceiver.iceGatherer;\n        iceTransport = transceiver.iceTransport;\n        dtlsTransport = transceiver.dtlsTransport;\n        rtpReceiver = transceiver.rtpReceiver;\n        sendEncodingParameters = transceiver.sendEncodingParameters;\n        localCapabilities = transceiver.localCapabilities;\n\n        pc.transceivers[sdpMLineIndex].recvEncodingParameters =\n            recvEncodingParameters;\n        pc.transceivers[sdpMLineIndex].remoteCapabilities =\n            remoteCapabilities;\n        pc.transceivers[sdpMLineIndex].rtcpParameters = rtcpParameters;\n\n        if (cands.length && iceTransport.state === 'new') {\n          if ((isIceLite || isComplete) &&\n              (!usingBundle || sdpMLineIndex === 0)) {\n            iceTransport.setRemoteCandidates(cands);\n          } else {\n            cands.forEach(function(candidate) {\n              maybeAddCandidate(transceiver.iceTransport, candidate);\n            });\n          }\n        }\n\n        if (!usingBundle || sdpMLineIndex === 0) {\n          if (iceTransport.state === 'new') {\n            iceTransport.start(iceGatherer, remoteIceParameters,\n                'controlling');\n          }\n          if (dtlsTransport.state === 'new') {\n            dtlsTransport.start(remoteDtlsParameters);\n          }\n        }\n\n        pc._transceive(transceiver,\n            direction === 'sendrecv' || direction === 'recvonly',\n            direction === 'sendrecv' || direction === 'sendonly');\n\n        // TODO: rewrite to use http://w3c.github.io/webrtc-pc/#set-associated-remote-streams\n        if (rtpReceiver &&\n            (direction === 'sendrecv' || direction === 'sendonly')) {\n          track = rtpReceiver.track;\n          if (remoteMsid) {\n            if (!streams[remoteMsid.stream]) {\n              streams[remoteMsid.stream] = new window.MediaStream();\n            }\n            addTrackToStreamAndFireEvent(track, streams[remoteMsid.stream]);\n            receiverList.push([track, rtpReceiver, streams[remoteMsid.stream]]);\n          } else {\n            if (!streams.default) {\n              streams.default = new window.MediaStream();\n            }\n            addTrackToStreamAndFireEvent(track, streams.default);\n            receiverList.push([track, rtpReceiver, streams.default]);\n          }\n        } else {\n          // FIXME: actually the receiver should be created later.\n          delete transceiver.rtpReceiver;\n        }\n      }\n    });\n\n    if (this._dtlsRole === undefined) {\n      this._dtlsRole = description.type === 'offer' ? 'active' : 'passive';\n    }\n\n    this.remoteDescription = {\n      type: description.type,\n      sdp: description.sdp\n    };\n    switch (description.type) {\n      case 'offer':\n        this._updateSignalingState('have-remote-offer');\n        break;\n      case 'answer':\n        this._updateSignalingState('stable');\n        break;\n      default:\n        throw new TypeError('unsupported type \"' + description.type +\n            '\"');\n    }\n    Object.keys(streams).forEach(function(sid) {\n      var stream = streams[sid];\n      if (stream.getTracks().length) {\n        if (pc.remoteStreams.indexOf(stream) === -1) {\n          pc.remoteStreams.push(stream);\n          var event = new Event('addstream');\n          event.stream = stream;\n          window.setTimeout(function() {\n            pc._dispatchEvent('addstream', event);\n          });\n        }\n\n        receiverList.forEach(function(item) {\n          var track = item[0];\n          var receiver = item[1];\n          if (stream.id !== item[2].id) {\n            return;\n          }\n          fireAddTrack(pc, track, receiver, [stream]);\n        });\n      }\n    });\n    receiverList.forEach(function(item) {\n      if (item[2]) {\n        return;\n      }\n      fireAddTrack(pc, item[0], item[1], []);\n    });\n\n    // check whether addIceCandidate({}) was called within four seconds after\n    // setRemoteDescription.\n    window.setTimeout(function() {\n      if (!(pc && pc.transceivers)) {\n        return;\n      }\n      pc.transceivers.forEach(function(transceiver) {\n        if (transceiver.iceTransport &&\n            transceiver.iceTransport.state === 'new' &&\n            transceiver.iceTransport.getRemoteCandidates().length > 0) {\n          console.warn('Timeout for addRemoteCandidate. Consider sending ' +\n              'an end-of-candidates notification');\n          transceiver.iceTransport.addRemoteCandidate({});\n        }\n      });\n    }, 4000);\n\n    return Promise.resolve();\n  };\n\n  RTCPeerConnection.prototype.close = function() {\n    this.transceivers.forEach(function(transceiver) {\n      /* not yet\n      if (transceiver.iceGatherer) {\n        transceiver.iceGatherer.close();\n      }\n      */\n      if (transceiver.iceTransport) {\n        transceiver.iceTransport.stop();\n      }\n      if (transceiver.dtlsTransport) {\n        transceiver.dtlsTransport.stop();\n      }\n      if (transceiver.rtpSender) {\n        transceiver.rtpSender.stop();\n      }\n      if (transceiver.rtpReceiver) {\n        transceiver.rtpReceiver.stop();\n      }\n    });\n    // FIXME: clean up tracks, local streams, remote streams, etc\n    this._isClosed = true;\n    this._updateSignalingState('closed');\n  };\n\n  // Update the signaling state.\n  RTCPeerConnection.prototype._updateSignalingState = function(newState) {\n    this.signalingState = newState;\n    var event = new Event('signalingstatechange');\n    this._dispatchEvent('signalingstatechange', event);\n  };\n\n  // Determine whether to fire the negotiationneeded event.\n  RTCPeerConnection.prototype._maybeFireNegotiationNeeded = function() {\n    var pc = this;\n    if (this.signalingState !== 'stable' || this.needNegotiation === true) {\n      return;\n    }\n    this.needNegotiation = true;\n    window.setTimeout(function() {\n      if (pc.needNegotiation === false) {\n        return;\n      }\n      pc.needNegotiation = false;\n      var event = new Event('negotiationneeded');\n      pc._dispatchEvent('negotiationneeded', event);\n    }, 0);\n  };\n\n  // Update the connection state.\n  RTCPeerConnection.prototype._updateConnectionState = function() {\n    var newState;\n    var states = {\n      'new': 0,\n      closed: 0,\n      connecting: 0,\n      checking: 0,\n      connected: 0,\n      completed: 0,\n      disconnected: 0,\n      failed: 0\n    };\n    this.transceivers.forEach(function(transceiver) {\n      states[transceiver.iceTransport.state]++;\n      states[transceiver.dtlsTransport.state]++;\n    });\n    // ICETransport.completed and connected are the same for this purpose.\n    states.connected += states.completed;\n\n    newState = 'new';\n    if (states.failed > 0) {\n      newState = 'failed';\n    } else if (states.connecting > 0 || states.checking > 0) {\n      newState = 'connecting';\n    } else if (states.disconnected > 0) {\n      newState = 'disconnected';\n    } else if (states.new > 0) {\n      newState = 'new';\n    } else if (states.connected > 0 || states.completed > 0) {\n      newState = 'connected';\n    }\n\n    if (newState !== this.iceConnectionState) {\n      this.iceConnectionState = newState;\n      var event = new Event('iceconnectionstatechange');\n      this._dispatchEvent('iceconnectionstatechange', event);\n    }\n  };\n\n  RTCPeerConnection.prototype.createOffer = function() {\n    var pc = this;\n\n    if (this._isClosed) {\n      return Promise.reject(makeError('InvalidStateError',\n          'Can not call createOffer after close'));\n    }\n\n    var numAudioTracks = this.transceivers.filter(function(t) {\n      return t.kind === 'audio';\n    }).length;\n    var numVideoTracks = this.transceivers.filter(function(t) {\n      return t.kind === 'video';\n    }).length;\n\n    // Determine number of audio and video tracks we need to send/recv.\n    var offerOptions = arguments[0];\n    if (offerOptions) {\n      // Reject Chrome legacy constraints.\n      if (offerOptions.mandatory || offerOptions.optional) {\n        throw new TypeError(\n            'Legacy mandatory/optional constraints not supported.');\n      }\n      if (offerOptions.offerToReceiveAudio !== undefined) {\n        if (offerOptions.offerToReceiveAudio === true) {\n          numAudioTracks = 1;\n        } else if (offerOptions.offerToReceiveAudio === false) {\n          numAudioTracks = 0;\n        } else {\n          numAudioTracks = offerOptions.offerToReceiveAudio;\n        }\n      }\n      if (offerOptions.offerToReceiveVideo !== undefined) {\n        if (offerOptions.offerToReceiveVideo === true) {\n          numVideoTracks = 1;\n        } else if (offerOptions.offerToReceiveVideo === false) {\n          numVideoTracks = 0;\n        } else {\n          numVideoTracks = offerOptions.offerToReceiveVideo;\n        }\n      }\n    }\n\n    this.transceivers.forEach(function(transceiver) {\n      if (transceiver.kind === 'audio') {\n        numAudioTracks--;\n        if (numAudioTracks < 0) {\n          transceiver.wantReceive = false;\n        }\n      } else if (transceiver.kind === 'video') {\n        numVideoTracks--;\n        if (numVideoTracks < 0) {\n          transceiver.wantReceive = false;\n        }\n      }\n    });\n\n    // Create M-lines for recvonly streams.\n    while (numAudioTracks > 0 || numVideoTracks > 0) {\n      if (numAudioTracks > 0) {\n        this._createTransceiver('audio');\n        numAudioTracks--;\n      }\n      if (numVideoTracks > 0) {\n        this._createTransceiver('video');\n        numVideoTracks--;\n      }\n    }\n\n    var sdp = SDPUtils.writeSessionBoilerplate(this._sdpSessionId,\n        this._sdpSessionVersion++);\n    this.transceivers.forEach(function(transceiver, sdpMLineIndex) {\n      // For each track, create an ice gatherer, ice transport,\n      // dtls transport, potentially rtpsender and rtpreceiver.\n      var track = transceiver.track;\n      var kind = transceiver.kind;\n      var mid = SDPUtils.generateIdentifier();\n      transceiver.mid = mid;\n\n      if (!transceiver.iceGatherer) {\n        transceiver.iceGatherer = pc._createIceGatherer(sdpMLineIndex,\n            pc.usingBundle);\n      }\n\n      var localCapabilities = window.RTCRtpSender.getCapabilities(kind);\n      // filter RTX until additional stuff needed for RTX is implemented\n      // in adapter.js\n      if (edgeVersion < 15019) {\n        localCapabilities.codecs = localCapabilities.codecs.filter(\n            function(codec) {\n              return codec.name !== 'rtx';\n            });\n      }\n      localCapabilities.codecs.forEach(function(codec) {\n        // work around https://bugs.chromium.org/p/webrtc/issues/detail?id=6552\n        // by adding level-asymmetry-allowed=1\n        if (codec.name === 'H264' &&\n            codec.parameters['level-asymmetry-allowed'] === undefined) {\n          codec.parameters['level-asymmetry-allowed'] = '1';\n        }\n      });\n\n      // generate an ssrc now, to be used later in rtpSender.send\n      var sendEncodingParameters = transceiver.sendEncodingParameters || [{\n        ssrc: (2 * sdpMLineIndex + 1) * 1001\n      }];\n      if (track) {\n        // add RTX\n        if (edgeVersion >= 15019 && kind === 'video' &&\n            !sendEncodingParameters[0].rtx) {\n          sendEncodingParameters[0].rtx = {\n            ssrc: sendEncodingParameters[0].ssrc + 1\n          };\n        }\n      }\n\n      if (transceiver.wantReceive) {\n        transceiver.rtpReceiver = new window.RTCRtpReceiver(\n            transceiver.dtlsTransport, kind);\n      }\n\n      transceiver.localCapabilities = localCapabilities;\n      transceiver.sendEncodingParameters = sendEncodingParameters;\n    });\n\n    // always offer BUNDLE and dispose on return if not supported.\n    if (this._config.bundlePolicy !== 'max-compat') {\n      sdp += 'a=group:BUNDLE ' + this.transceivers.map(function(t) {\n        return t.mid;\n      }).join(' ') + '\\r\\n';\n    }\n    sdp += 'a=ice-options:trickle\\r\\n';\n\n    this.transceivers.forEach(function(transceiver, sdpMLineIndex) {\n      sdp += writeMediaSection(transceiver, transceiver.localCapabilities,\n          'offer', transceiver.stream, pc._dtlsRole);\n      sdp += 'a=rtcp-rsize\\r\\n';\n\n      if (transceiver.iceGatherer && pc.iceGatheringState !== 'new' &&\n          (sdpMLineIndex === 0 || !pc.usingBundle)) {\n        transceiver.iceGatherer.getLocalCandidates().forEach(function(cand) {\n          cand.component = 1;\n          sdp += 'a=' + SDPUtils.writeCandidate(cand) + '\\r\\n';\n        });\n\n        if (transceiver.iceGatherer.state === 'completed') {\n          sdp += 'a=end-of-candidates\\r\\n';\n        }\n      }\n    });\n\n    var desc = new window.RTCSessionDescription({\n      type: 'offer',\n      sdp: sdp\n    });\n    return Promise.resolve(desc);\n  };\n\n  RTCPeerConnection.prototype.createAnswer = function() {\n    var pc = this;\n\n    if (this._isClosed) {\n      return Promise.reject(makeError('InvalidStateError',\n          'Can not call createAnswer after close'));\n    }\n\n    var sdp = SDPUtils.writeSessionBoilerplate(this._sdpSessionId,\n        this._sdpSessionVersion++);\n    if (this.usingBundle) {\n      sdp += 'a=group:BUNDLE ' + this.transceivers.map(function(t) {\n        return t.mid;\n      }).join(' ') + '\\r\\n';\n    }\n    var mediaSectionsInOffer = SDPUtils.splitSections(\n        this.remoteDescription.sdp).length - 1;\n    this.transceivers.forEach(function(transceiver, sdpMLineIndex) {\n      if (sdpMLineIndex + 1 > mediaSectionsInOffer) {\n        return;\n      }\n      if (transceiver.isDatachannel) {\n        sdp += 'm=application 0 DTLS/SCTP 5000\\r\\n' +\n            'c=IN IP4 0.0.0.0\\r\\n' +\n            'a=mid:' + transceiver.mid + '\\r\\n';\n        return;\n      }\n\n      // FIXME: look at direction.\n      if (transceiver.stream) {\n        var localTrack;\n        if (transceiver.kind === 'audio') {\n          localTrack = transceiver.stream.getAudioTracks()[0];\n        } else if (transceiver.kind === 'video') {\n          localTrack = transceiver.stream.getVideoTracks()[0];\n        }\n        if (localTrack) {\n          // add RTX\n          if (edgeVersion >= 15019 && transceiver.kind === 'video' &&\n              !transceiver.sendEncodingParameters[0].rtx) {\n            transceiver.sendEncodingParameters[0].rtx = {\n              ssrc: transceiver.sendEncodingParameters[0].ssrc + 1\n            };\n          }\n        }\n      }\n\n      // Calculate intersection of capabilities.\n      var commonCapabilities = getCommonCapabilities(\n          transceiver.localCapabilities,\n          transceiver.remoteCapabilities);\n\n      var hasRtx = commonCapabilities.codecs.filter(function(c) {\n        return c.name.toLowerCase() === 'rtx';\n      }).length;\n      if (!hasRtx && transceiver.sendEncodingParameters[0].rtx) {\n        delete transceiver.sendEncodingParameters[0].rtx;\n      }\n\n      sdp += writeMediaSection(transceiver, commonCapabilities,\n          'answer', transceiver.stream, pc._dtlsRole);\n      if (transceiver.rtcpParameters &&\n          transceiver.rtcpParameters.reducedSize) {\n        sdp += 'a=rtcp-rsize\\r\\n';\n      }\n    });\n\n    var desc = new window.RTCSessionDescription({\n      type: 'answer',\n      sdp: sdp\n    });\n    return Promise.resolve(desc);\n  };\n\n  RTCPeerConnection.prototype.addIceCandidate = function(candidate) {\n    var sections;\n    if (!candidate || candidate.candidate === '') {\n      for (var j = 0; j < this.transceivers.length; j++) {\n        if (this.transceivers[j].isDatachannel) {\n          continue;\n        }\n        this.transceivers[j].iceTransport.addRemoteCandidate({});\n        sections = SDPUtils.splitSections(this.remoteDescription.sdp);\n        sections[j + 1] += 'a=end-of-candidates\\r\\n';\n        this.remoteDescription.sdp = sections.join('');\n        if (this.usingBundle) {\n          break;\n        }\n      }\n    } else if (!(candidate.sdpMLineIndex !== undefined || candidate.sdpMid)) {\n      throw new TypeError('sdpMLineIndex or sdpMid required');\n    } else if (!this.remoteDescription) {\n      return Promise.reject(makeError('InvalidStateError',\n          'Can not add ICE candidate without a remote description'));\n    } else {\n      var sdpMLineIndex = candidate.sdpMLineIndex;\n      if (candidate.sdpMid) {\n        for (var i = 0; i < this.transceivers.length; i++) {\n          if (this.transceivers[i].mid === candidate.sdpMid) {\n            sdpMLineIndex = i;\n            break;\n          }\n        }\n      }\n      var transceiver = this.transceivers[sdpMLineIndex];\n      if (transceiver) {\n        if (transceiver.isDatachannel) {\n          return Promise.resolve();\n        }\n        var cand = Object.keys(candidate.candidate).length > 0 ?\n            SDPUtils.parseCandidate(candidate.candidate) : {};\n        // Ignore Chrome's invalid candidates since Edge does not like them.\n        if (cand.protocol === 'tcp' && (cand.port === 0 || cand.port === 9)) {\n          return Promise.resolve();\n        }\n        // Ignore RTCP candidates, we assume RTCP-MUX.\n        if (cand.component && cand.component !== 1) {\n          return Promise.resolve();\n        }\n        // when using bundle, avoid adding candidates to the wrong\n        // ice transport. And avoid adding candidates added in the SDP.\n        if (sdpMLineIndex === 0 || (sdpMLineIndex > 0 &&\n            transceiver.iceTransport !== this.transceivers[0].iceTransport)) {\n          if (!maybeAddCandidate(transceiver.iceTransport, cand)) {\n            return Promise.reject(makeError('OperationError',\n                'Can not add ICE candidate'));\n          }\n        }\n\n        // update the remoteDescription.\n        var candidateString = candidate.candidate.trim();\n        if (candidateString.indexOf('a=') === 0) {\n          candidateString = candidateString.substr(2);\n        }\n        sections = SDPUtils.splitSections(this.remoteDescription.sdp);\n        sections[sdpMLineIndex + 1] += 'a=' +\n            (cand.type ? candidateString : 'end-of-candidates')\n            + '\\r\\n';\n        this.remoteDescription.sdp = sections.join('');\n      } else {\n        return Promise.reject(makeError('OperationError',\n            'Can not add ICE candidate'));\n      }\n    }\n    return Promise.resolve();\n  };\n\n  RTCPeerConnection.prototype.getStats = function() {\n    var promises = [];\n    this.transceivers.forEach(function(transceiver) {\n      ['rtpSender', 'rtpReceiver', 'iceGatherer', 'iceTransport',\n          'dtlsTransport'].forEach(function(method) {\n            if (transceiver[method]) {\n              promises.push(transceiver[method].getStats());\n            }\n          });\n    });\n    var fixStatsType = function(stat) {\n      return {\n        inboundrtp: 'inbound-rtp',\n        outboundrtp: 'outbound-rtp',\n        candidatepair: 'candidate-pair',\n        localcandidate: 'local-candidate',\n        remotecandidate: 'remote-candidate'\n      }[stat.type] || stat.type;\n    };\n    return new Promise(function(resolve) {\n      // shim getStats with maplike support\n      var results = new Map();\n      Promise.all(promises).then(function(res) {\n        res.forEach(function(result) {\n          Object.keys(result).forEach(function(id) {\n            result[id].type = fixStatsType(result[id]);\n            results.set(id, result[id]);\n          });\n        });\n        resolve(results);\n      });\n    });\n  };\n\n  // legacy callback shims. Should be moved to adapter.js some days.\n  var methods = ['createOffer', 'createAnswer'];\n  methods.forEach(function(method) {\n    var nativeMethod = RTCPeerConnection.prototype[method];\n    RTCPeerConnection.prototype[method] = function() {\n      var args = arguments;\n      if (typeof args[0] === 'function' ||\n          typeof args[1] === 'function') { // legacy\n        return nativeMethod.apply(this, [arguments[2]])\n        .then(function(description) {\n          if (typeof args[0] === 'function') {\n            args[0].apply(null, [description]);\n          }\n        }, function(error) {\n          if (typeof args[1] === 'function') {\n            args[1].apply(null, [error]);\n          }\n        });\n      }\n      return nativeMethod.apply(this, arguments);\n    };\n  });\n\n  methods = ['setLocalDescription', 'setRemoteDescription', 'addIceCandidate'];\n  methods.forEach(function(method) {\n    var nativeMethod = RTCPeerConnection.prototype[method];\n    RTCPeerConnection.prototype[method] = function() {\n      var args = arguments;\n      if (typeof args[1] === 'function' ||\n          typeof args[2] === 'function') { // legacy\n        return nativeMethod.apply(this, arguments)\n        .then(function() {\n          if (typeof args[1] === 'function') {\n            args[1].apply(null);\n          }\n        }, function(error) {\n          if (typeof args[2] === 'function') {\n            args[2].apply(null, [error]);\n          }\n        });\n      }\n      return nativeMethod.apply(this, arguments);\n    };\n  });\n\n  // getStats is special. It doesn't have a spec legacy method yet we support\n  // getStats(something, cb) without error callbacks.\n  ['getStats'].forEach(function(method) {\n    var nativeMethod = RTCPeerConnection.prototype[method];\n    RTCPeerConnection.prototype[method] = function() {\n      var args = arguments;\n      if (typeof args[1] === 'function') {\n        return nativeMethod.apply(this, arguments)\n        .then(function() {\n          if (typeof args[1] === 'function') {\n            args[1].apply(null);\n          }\n        });\n      }\n      return nativeMethod.apply(this, arguments);\n    };\n  });\n\n  return RTCPeerConnection;\n};\n\n},{\"sdp\":2}],2:[function(require,module,exports){\n /* eslint-env node */\n'use strict';\n\n// SDP helpers.\nvar SDPUtils = {};\n\n// Generate an alphanumeric identifier for cname or mids.\n// TODO: use UUIDs instead? https://gist.github.com/jed/982883\nSDPUtils.generateIdentifier = function() {\n  return Math.random().toString(36).substr(2, 10);\n};\n\n// The RTCP CNAME used by all peerconnections from the same JS.\nSDPUtils.localCName = SDPUtils.generateIdentifier();\n\n// Splits SDP into lines, dealing with both CRLF and LF.\nSDPUtils.splitLines = function(blob) {\n  return blob.trim().split('\\n').map(function(line) {\n    return line.trim();\n  });\n};\n// Splits SDP into sessionpart and mediasections. Ensures CRLF.\nSDPUtils.splitSections = function(blob) {\n  var parts = blob.split('\\nm=');\n  return parts.map(function(part, index) {\n    return (index > 0 ? 'm=' + part : part).trim() + '\\r\\n';\n  });\n};\n\n// Returns lines that start with a certain prefix.\nSDPUtils.matchPrefix = function(blob, prefix) {\n  return SDPUtils.splitLines(blob).filter(function(line) {\n    return line.indexOf(prefix) === 0;\n  });\n};\n\n// Parses an ICE candidate line. Sample input:\n// candidate:702786350 2 udp 41819902 8.8.8.8 60769 typ relay raddr 8.8.8.8\n// rport 55996\"\nSDPUtils.parseCandidate = function(line) {\n  var parts;\n  // Parse both variants.\n  if (line.indexOf('a=candidate:') === 0) {\n    parts = line.substring(12).split(' ');\n  } else {\n    parts = line.substring(10).split(' ');\n  }\n\n  var candidate = {\n    foundation: parts[0],\n    component: parseInt(parts[1], 10),\n    protocol: parts[2].toLowerCase(),\n    priority: parseInt(parts[3], 10),\n    ip: parts[4],\n    port: parseInt(parts[5], 10),\n    // skip parts[6] == 'typ'\n    type: parts[7]\n  };\n\n  for (var i = 8; i < parts.length; i += 2) {\n    switch (parts[i]) {\n      case 'raddr':\n        candidate.relatedAddress = parts[i + 1];\n        break;\n      case 'rport':\n        candidate.relatedPort = parseInt(parts[i + 1], 10);\n        break;\n      case 'tcptype':\n        candidate.tcpType = parts[i + 1];\n        break;\n      case 'ufrag':\n        candidate.ufrag = parts[i + 1]; // for backward compability.\n        candidate.usernameFragment = parts[i + 1];\n        break;\n      default: // extension handling, in particular ufrag\n        candidate[parts[i]] = parts[i + 1];\n        break;\n    }\n  }\n  return candidate;\n};\n\n// Translates a candidate object into SDP candidate attribute.\nSDPUtils.writeCandidate = function(candidate) {\n  var sdp = [];\n  sdp.push(candidate.foundation);\n  sdp.push(candidate.component);\n  sdp.push(candidate.protocol.toUpperCase());\n  sdp.push(candidate.priority);\n  sdp.push(candidate.ip);\n  sdp.push(candidate.port);\n\n  var type = candidate.type;\n  sdp.push('typ');\n  sdp.push(type);\n  if (type !== 'host' && candidate.relatedAddress &&\n      candidate.relatedPort) {\n    sdp.push('raddr');\n    sdp.push(candidate.relatedAddress); // was: relAddr\n    sdp.push('rport');\n    sdp.push(candidate.relatedPort); // was: relPort\n  }\n  if (candidate.tcpType && candidate.protocol.toLowerCase() === 'tcp') {\n    sdp.push('tcptype');\n    sdp.push(candidate.tcpType);\n  }\n  if (candidate.ufrag) {\n    sdp.push('ufrag');\n    sdp.push(candidate.ufrag);\n  }\n  return 'candidate:' + sdp.join(' ');\n};\n\n// Parses an ice-options line, returns an array of option tags.\n// a=ice-options:foo bar\nSDPUtils.parseIceOptions = function(line) {\n  return line.substr(14).split(' ');\n}\n\n// Parses an rtpmap line, returns RTCRtpCoddecParameters. Sample input:\n// a=rtpmap:111 opus/48000/2\nSDPUtils.parseRtpMap = function(line) {\n  var parts = line.substr(9).split(' ');\n  var parsed = {\n    payloadType: parseInt(parts.shift(), 10) // was: id\n  };\n\n  parts = parts[0].split('/');\n\n  parsed.name = parts[0];\n  parsed.clockRate = parseInt(parts[1], 10); // was: clockrate\n  // was: channels\n  parsed.numChannels = parts.length === 3 ? parseInt(parts[2], 10) : 1;\n  return parsed;\n};\n\n// Generate an a=rtpmap line from RTCRtpCodecCapability or\n// RTCRtpCodecParameters.\nSDPUtils.writeRtpMap = function(codec) {\n  var pt = codec.payloadType;\n  if (codec.preferredPayloadType !== undefined) {\n    pt = codec.preferredPayloadType;\n  }\n  return 'a=rtpmap:' + pt + ' ' + codec.name + '/' + codec.clockRate +\n      (codec.numChannels !== 1 ? '/' + codec.numChannels : '') + '\\r\\n';\n};\n\n// Parses an a=extmap line (headerextension from RFC 5285). Sample input:\n// a=extmap:2 urn:ietf:params:rtp-hdrext:toffset\n// a=extmap:2/sendonly urn:ietf:params:rtp-hdrext:toffset\nSDPUtils.parseExtmap = function(line) {\n  var parts = line.substr(9).split(' ');\n  return {\n    id: parseInt(parts[0], 10),\n    direction: parts[0].indexOf('/') > 0 ? parts[0].split('/')[1] : 'sendrecv',\n    uri: parts[1]\n  };\n};\n\n// Generates a=extmap line from RTCRtpHeaderExtensionParameters or\n// RTCRtpHeaderExtension.\nSDPUtils.writeExtmap = function(headerExtension) {\n  return 'a=extmap:' + (headerExtension.id || headerExtension.preferredId) +\n      (headerExtension.direction && headerExtension.direction !== 'sendrecv'\n          ? '/' + headerExtension.direction\n          : '') +\n      ' ' + headerExtension.uri + '\\r\\n';\n};\n\n// Parses an ftmp line, returns dictionary. Sample input:\n// a=fmtp:96 vbr=on;cng=on\n// Also deals with vbr=on; cng=on\nSDPUtils.parseFmtp = function(line) {\n  var parsed = {};\n  var kv;\n  var parts = line.substr(line.indexOf(' ') + 1).split(';');\n  for (var j = 0; j < parts.length; j++) {\n    kv = parts[j].trim().split('=');\n    parsed[kv[0].trim()] = kv[1];\n  }\n  return parsed;\n};\n\n// Generates an a=ftmp line from RTCRtpCodecCapability or RTCRtpCodecParameters.\nSDPUtils.writeFmtp = function(codec) {\n  var line = '';\n  var pt = codec.payloadType;\n  if (codec.preferredPayloadType !== undefined) {\n    pt = codec.preferredPayloadType;\n  }\n  if (codec.parameters && Object.keys(codec.parameters).length) {\n    var params = [];\n    Object.keys(codec.parameters).forEach(function(param) {\n      params.push(param + '=' + codec.parameters[param]);\n    });\n    line += 'a=fmtp:' + pt + ' ' + params.join(';') + '\\r\\n';\n  }\n  return line;\n};\n\n// Parses an rtcp-fb line, returns RTCPRtcpFeedback object. Sample input:\n// a=rtcp-fb:98 nack rpsi\nSDPUtils.parseRtcpFb = function(line) {\n  var parts = line.substr(line.indexOf(' ') + 1).split(' ');\n  return {\n    type: parts.shift(),\n    parameter: parts.join(' ')\n  };\n};\n// Generate a=rtcp-fb lines from RTCRtpCodecCapability or RTCRtpCodecParameters.\nSDPUtils.writeRtcpFb = function(codec) {\n  var lines = '';\n  var pt = codec.payloadType;\n  if (codec.preferredPayloadType !== undefined) {\n    pt = codec.preferredPayloadType;\n  }\n  if (codec.rtcpFeedback && codec.rtcpFeedback.length) {\n    // FIXME: special handling for trr-int?\n    codec.rtcpFeedback.forEach(function(fb) {\n      lines += 'a=rtcp-fb:' + pt + ' ' + fb.type +\n      (fb.parameter && fb.parameter.length ? ' ' + fb.parameter : '') +\n          '\\r\\n';\n    });\n  }\n  return lines;\n};\n\n// Parses an RFC 5576 ssrc media attribute. Sample input:\n// a=ssrc:3735928559 cname:something\nSDPUtils.parseSsrcMedia = function(line) {\n  var sp = line.indexOf(' ');\n  var parts = {\n    ssrc: parseInt(line.substr(7, sp - 7), 10)\n  };\n  var colon = line.indexOf(':', sp);\n  if (colon > -1) {\n    parts.attribute = line.substr(sp + 1, colon - sp - 1);\n    parts.value = line.substr(colon + 1);\n  } else {\n    parts.attribute = line.substr(sp + 1);\n  }\n  return parts;\n};\n\n// Extracts the MID (RFC 5888) from a media section.\n// returns the MID or undefined if no mid line was found.\nSDPUtils.getMid = function(mediaSection) {\n  var mid = SDPUtils.matchPrefix(mediaSection, 'a=mid:')[0];\n  if (mid) {\n    return mid.substr(6);\n  }\n}\n\nSDPUtils.parseFingerprint = function(line) {\n  var parts = line.substr(14).split(' ');\n  return {\n    algorithm: parts[0].toLowerCase(), // algorithm is case-sensitive in Edge.\n    value: parts[1]\n  };\n};\n\n// Extracts DTLS parameters from SDP media section or sessionpart.\n// FIXME: for consistency with other functions this should only\n//   get the fingerprint line as input. See also getIceParameters.\nSDPUtils.getDtlsParameters = function(mediaSection, sessionpart) {\n  var lines = SDPUtils.matchPrefix(mediaSection + sessionpart,\n      'a=fingerprint:');\n  // Note: a=setup line is ignored since we use the 'auto' role.\n  // Note2: 'algorithm' is not case sensitive except in Edge.\n  return {\n    role: 'auto',\n    fingerprints: lines.map(SDPUtils.parseFingerprint)\n  };\n};\n\n// Serializes DTLS parameters to SDP.\nSDPUtils.writeDtlsParameters = function(params, setupType) {\n  var sdp = 'a=setup:' + setupType + '\\r\\n';\n  params.fingerprints.forEach(function(fp) {\n    sdp += 'a=fingerprint:' + fp.algorithm + ' ' + fp.value + '\\r\\n';\n  });\n  return sdp;\n};\n// Parses ICE information from SDP media section or sessionpart.\n// FIXME: for consistency with other functions this should only\n//   get the ice-ufrag and ice-pwd lines as input.\nSDPUtils.getIceParameters = function(mediaSection, sessionpart) {\n  var lines = SDPUtils.splitLines(mediaSection);\n  // Search in session part, too.\n  lines = lines.concat(SDPUtils.splitLines(sessionpart));\n  var iceParameters = {\n    usernameFragment: lines.filter(function(line) {\n      return line.indexOf('a=ice-ufrag:') === 0;\n    })[0].substr(12),\n    password: lines.filter(function(line) {\n      return line.indexOf('a=ice-pwd:') === 0;\n    })[0].substr(10)\n  };\n  return iceParameters;\n};\n\n// Serializes ICE parameters to SDP.\nSDPUtils.writeIceParameters = function(params) {\n  return 'a=ice-ufrag:' + params.usernameFragment + '\\r\\n' +\n      'a=ice-pwd:' + params.password + '\\r\\n';\n};\n\n// Parses the SDP media section and returns RTCRtpParameters.\nSDPUtils.parseRtpParameters = function(mediaSection) {\n  var description = {\n    codecs: [],\n    headerExtensions: [],\n    fecMechanisms: [],\n    rtcp: []\n  };\n  var lines = SDPUtils.splitLines(mediaSection);\n  var mline = lines[0].split(' ');\n  for (var i = 3; i < mline.length; i++) { // find all codecs from mline[3..]\n    var pt = mline[i];\n    var rtpmapline = SDPUtils.matchPrefix(\n        mediaSection, 'a=rtpmap:' + pt + ' ')[0];\n    if (rtpmapline) {\n      var codec = SDPUtils.parseRtpMap(rtpmapline);\n      var fmtps = SDPUtils.matchPrefix(\n          mediaSection, 'a=fmtp:' + pt + ' ');\n      // Only the first a=fmtp:<pt> is considered.\n      codec.parameters = fmtps.length ? SDPUtils.parseFmtp(fmtps[0]) : {};\n      codec.rtcpFeedback = SDPUtils.matchPrefix(\n          mediaSection, 'a=rtcp-fb:' + pt + ' ')\n        .map(SDPUtils.parseRtcpFb);\n      description.codecs.push(codec);\n      // parse FEC mechanisms from rtpmap lines.\n      switch (codec.name.toUpperCase()) {\n        case 'RED':\n        case 'ULPFEC':\n          description.fecMechanisms.push(codec.name.toUpperCase());\n          break;\n        default: // only RED and ULPFEC are recognized as FEC mechanisms.\n          break;\n      }\n    }\n  }\n  SDPUtils.matchPrefix(mediaSection, 'a=extmap:').forEach(function(line) {\n    description.headerExtensions.push(SDPUtils.parseExtmap(line));\n  });\n  // FIXME: parse rtcp.\n  return description;\n};\n\n// Generates parts of the SDP media section describing the capabilities /\n// parameters.\nSDPUtils.writeRtpDescription = function(kind, caps) {\n  var sdp = '';\n\n  // Build the mline.\n  sdp += 'm=' + kind + ' ';\n  sdp += caps.codecs.length > 0 ? '9' : '0'; // reject if no codecs.\n  sdp += ' UDP/TLS/RTP/SAVPF ';\n  sdp += caps.codecs.map(function(codec) {\n    if (codec.preferredPayloadType !== undefined) {\n      return codec.preferredPayloadType;\n    }\n    return codec.payloadType;\n  }).join(' ') + '\\r\\n';\n\n  sdp += 'c=IN IP4 0.0.0.0\\r\\n';\n  sdp += 'a=rtcp:9 IN IP4 0.0.0.0\\r\\n';\n\n  // Add a=rtpmap lines for each codec. Also fmtp and rtcp-fb.\n  caps.codecs.forEach(function(codec) {\n    sdp += SDPUtils.writeRtpMap(codec);\n    sdp += SDPUtils.writeFmtp(codec);\n    sdp += SDPUtils.writeRtcpFb(codec);\n  });\n  var maxptime = 0;\n  caps.codecs.forEach(function(codec) {\n    if (codec.maxptime > maxptime) {\n      maxptime = codec.maxptime;\n    }\n  });\n  if (maxptime > 0) {\n    sdp += 'a=maxptime:' + maxptime + '\\r\\n';\n  }\n  sdp += 'a=rtcp-mux\\r\\n';\n\n  caps.headerExtensions.forEach(function(extension) {\n    sdp += SDPUtils.writeExtmap(extension);\n  });\n  // FIXME: write fecMechanisms.\n  return sdp;\n};\n\n// Parses the SDP media section and returns an array of\n// RTCRtpEncodingParameters.\nSDPUtils.parseRtpEncodingParameters = function(mediaSection) {\n  var encodingParameters = [];\n  var description = SDPUtils.parseRtpParameters(mediaSection);\n  var hasRed = description.fecMechanisms.indexOf('RED') !== -1;\n  var hasUlpfec = description.fecMechanisms.indexOf('ULPFEC') !== -1;\n\n  // filter a=ssrc:... cname:, ignore PlanB-msid\n  var ssrcs = SDPUtils.matchPrefix(mediaSection, 'a=ssrc:')\n  .map(function(line) {\n    return SDPUtils.parseSsrcMedia(line);\n  })\n  .filter(function(parts) {\n    return parts.attribute === 'cname';\n  });\n  var primarySsrc = ssrcs.length > 0 && ssrcs[0].ssrc;\n  var secondarySsrc;\n\n  var flows = SDPUtils.matchPrefix(mediaSection, 'a=ssrc-group:FID')\n  .map(function(line) {\n    var parts = line.split(' ');\n    parts.shift();\n    return parts.map(function(part) {\n      return parseInt(part, 10);\n    });\n  });\n  if (flows.length > 0 && flows[0].length > 1 && flows[0][0] === primarySsrc) {\n    secondarySsrc = flows[0][1];\n  }\n\n  description.codecs.forEach(function(codec) {\n    if (codec.name.toUpperCase() === 'RTX' && codec.parameters.apt) {\n      var encParam = {\n        ssrc: primarySsrc,\n        codecPayloadType: parseInt(codec.parameters.apt, 10),\n        rtx: {\n          ssrc: secondarySsrc\n        }\n      };\n      encodingParameters.push(encParam);\n      if (hasRed) {\n        encParam = JSON.parse(JSON.stringify(encParam));\n        encParam.fec = {\n          ssrc: secondarySsrc,\n          mechanism: hasUlpfec ? 'red+ulpfec' : 'red'\n        };\n        encodingParameters.push(encParam);\n      }\n    }\n  });\n  if (encodingParameters.length === 0 && primarySsrc) {\n    encodingParameters.push({\n      ssrc: primarySsrc\n    });\n  }\n\n  // we support both b=AS and b=TIAS but interpret AS as TIAS.\n  var bandwidth = SDPUtils.matchPrefix(mediaSection, 'b=');\n  if (bandwidth.length) {\n    if (bandwidth[0].indexOf('b=TIAS:') === 0) {\n      bandwidth = parseInt(bandwidth[0].substr(7), 10);\n    } else if (bandwidth[0].indexOf('b=AS:') === 0) {\n      // use formula from JSEP to convert b=AS to TIAS value.\n      bandwidth = parseInt(bandwidth[0].substr(5), 10) * 1000 * 0.95\n          - (50 * 40 * 8);\n    } else {\n      bandwidth = undefined;\n    }\n    encodingParameters.forEach(function(params) {\n      params.maxBitrate = bandwidth;\n    });\n  }\n  return encodingParameters;\n};\n\n// parses http://draft.ortc.org/#rtcrtcpparameters*\nSDPUtils.parseRtcpParameters = function(mediaSection) {\n  var rtcpParameters = {};\n\n  var cname;\n  // Gets the first SSRC. Note that with RTX there might be multiple\n  // SSRCs.\n  var remoteSsrc = SDPUtils.matchPrefix(mediaSection, 'a=ssrc:')\n      .map(function(line) {\n        return SDPUtils.parseSsrcMedia(line);\n      })\n      .filter(function(obj) {\n        return obj.attribute === 'cname';\n      })[0];\n  if (remoteSsrc) {\n    rtcpParameters.cname = remoteSsrc.value;\n    rtcpParameters.ssrc = remoteSsrc.ssrc;\n  }\n\n  // Edge uses the compound attribute instead of reducedSize\n  // compound is !reducedSize\n  var rsize = SDPUtils.matchPrefix(mediaSection, 'a=rtcp-rsize');\n  rtcpParameters.reducedSize = rsize.length > 0;\n  rtcpParameters.compound = rsize.length === 0;\n\n  // parses the rtcp-mux attrіbute.\n  // Note that Edge does not support unmuxed RTCP.\n  var mux = SDPUtils.matchPrefix(mediaSection, 'a=rtcp-mux');\n  rtcpParameters.mux = mux.length > 0;\n\n  return rtcpParameters;\n};\n\n// parses either a=msid: or a=ssrc:... msid lines and returns\n// the id of the MediaStream and MediaStreamTrack.\nSDPUtils.parseMsid = function(mediaSection) {\n  var parts;\n  var spec = SDPUtils.matchPrefix(mediaSection, 'a=msid:');\n  if (spec.length === 1) {\n    parts = spec[0].substr(7).split(' ');\n    return {stream: parts[0], track: parts[1]};\n  }\n  var planB = SDPUtils.matchPrefix(mediaSection, 'a=ssrc:')\n  .map(function(line) {\n    return SDPUtils.parseSsrcMedia(line);\n  })\n  .filter(function(parts) {\n    return parts.attribute === 'msid';\n  });\n  if (planB.length > 0) {\n    parts = planB[0].value.split(' ');\n    return {stream: parts[0], track: parts[1]};\n  }\n};\n\n// Generate a session ID for SDP.\n// https://tools.ietf.org/html/draft-ietf-rtcweb-jsep-20#section-5.2.1\n// recommends using a cryptographically random +ve 64-bit value\n// but right now this should be acceptable and within the right range\nSDPUtils.generateSessionId = function() {\n  return Math.random().toString().substr(2, 21);\n};\n\n// Write boilder plate for start of SDP\n// sessId argument is optional - if not supplied it will\n// be generated randomly\n// sessVersion is optional and defaults to 2\nSDPUtils.writeSessionBoilerplate = function(sessId, sessVer) {\n  var sessionId;\n  var version = sessVer !== undefined ? sessVer : 2;\n  if (sessId) {\n    sessionId = sessId;\n  } else {\n    sessionId = SDPUtils.generateSessionId();\n  }\n  // FIXME: sess-id should be an NTP timestamp.\n  return 'v=0\\r\\n' +\n      'o=thisisadapterortc ' + sessionId + ' ' + version + ' IN IP4 127.0.0.1\\r\\n' +\n      's=-\\r\\n' +\n      't=0 0\\r\\n';\n};\n\nSDPUtils.writeMediaSection = function(transceiver, caps, type, stream) {\n  var sdp = SDPUtils.writeRtpDescription(transceiver.kind, caps);\n\n  // Map ICE parameters (ufrag, pwd) to SDP.\n  sdp += SDPUtils.writeIceParameters(\n      transceiver.iceGatherer.getLocalParameters());\n\n  // Map DTLS parameters to SDP.\n  sdp += SDPUtils.writeDtlsParameters(\n      transceiver.dtlsTransport.getLocalParameters(),\n      type === 'offer' ? 'actpass' : 'active');\n\n  sdp += 'a=mid:' + transceiver.mid + '\\r\\n';\n\n  if (transceiver.direction) {\n    sdp += 'a=' + transceiver.direction + '\\r\\n';\n  } else if (transceiver.rtpSender && transceiver.rtpReceiver) {\n    sdp += 'a=sendrecv\\r\\n';\n  } else if (transceiver.rtpSender) {\n    sdp += 'a=sendonly\\r\\n';\n  } else if (transceiver.rtpReceiver) {\n    sdp += 'a=recvonly\\r\\n';\n  } else {\n    sdp += 'a=inactive\\r\\n';\n  }\n\n  if (transceiver.rtpSender) {\n    // spec.\n    var msid = 'msid:' + stream.id + ' ' +\n        transceiver.rtpSender.track.id + '\\r\\n';\n    sdp += 'a=' + msid;\n\n    // for Chrome.\n    sdp += 'a=ssrc:' + transceiver.sendEncodingParameters[0].ssrc +\n        ' ' + msid;\n    if (transceiver.sendEncodingParameters[0].rtx) {\n      sdp += 'a=ssrc:' + transceiver.sendEncodingParameters[0].rtx.ssrc +\n          ' ' + msid;\n      sdp += 'a=ssrc-group:FID ' +\n          transceiver.sendEncodingParameters[0].ssrc + ' ' +\n          transceiver.sendEncodingParameters[0].rtx.ssrc +\n          '\\r\\n';\n    }\n  }\n  // FIXME: this should be written by writeRtpDescription.\n  sdp += 'a=ssrc:' + transceiver.sendEncodingParameters[0].ssrc +\n      ' cname:' + SDPUtils.localCName + '\\r\\n';\n  if (transceiver.rtpSender && transceiver.sendEncodingParameters[0].rtx) {\n    sdp += 'a=ssrc:' + transceiver.sendEncodingParameters[0].rtx.ssrc +\n        ' cname:' + SDPUtils.localCName + '\\r\\n';\n  }\n  return sdp;\n};\n\n// Gets the direction from the mediaSection or the sessionpart.\nSDPUtils.getDirection = function(mediaSection, sessionpart) {\n  // Look for sendrecv, sendonly, recvonly, inactive, default to sendrecv.\n  var lines = SDPUtils.splitLines(mediaSection);\n  for (var i = 0; i < lines.length; i++) {\n    switch (lines[i]) {\n      case 'a=sendrecv':\n      case 'a=sendonly':\n      case 'a=recvonly':\n      case 'a=inactive':\n        return lines[i].substr(2);\n      default:\n        // FIXME: What should happen here?\n    }\n  }\n  if (sessionpart) {\n    return SDPUtils.getDirection(sessionpart);\n  }\n  return 'sendrecv';\n};\n\nSDPUtils.getKind = function(mediaSection) {\n  var lines = SDPUtils.splitLines(mediaSection);\n  var mline = lines[0].split(' ');\n  return mline[0].substr(2);\n};\n\nSDPUtils.isRejected = function(mediaSection) {\n  return mediaSection.split(' ', 2)[1] === '0';\n};\n\nSDPUtils.parseMLine = function(mediaSection) {\n  var lines = SDPUtils.splitLines(mediaSection);\n  var mline = lines[0].split(' ');\n  return {\n    kind: mline[0].substr(2),\n    port: parseInt(mline[1], 10),\n    protocol: mline[2],\n    fmt: mline.slice(3).join(' ')\n  };\n};\n\n// Expose public methods.\nif (typeof module === 'object') {\n  module.exports = SDPUtils;\n}\n\n},{}],3:[function(require,module,exports){\n(function (global){\n/*\n *  Copyright (c) 2016 The WebRTC project authors. All Rights Reserved.\n *\n *  Use of this source code is governed by a BSD-style license\n *  that can be found in the LICENSE file in the root of the source\n *  tree.\n */\n /* eslint-env node */\n\n'use strict';\n\nvar adapterFactory = require('./adapter_factory.js');\nmodule.exports = adapterFactory({window: global.window});\n\n}).call(this,typeof global !== \"undefined\" ? global : typeof self !== \"undefined\" ? self : typeof window !== \"undefined\" ? window : {})\n},{\"./adapter_factory.js\":4}],4:[function(require,module,exports){\n/*\n *  Copyright (c) 2016 The WebRTC project authors. All Rights Reserved.\n *\n *  Use of this source code is governed by a BSD-style license\n *  that can be found in the LICENSE file in the root of the source\n *  tree.\n */\n /* eslint-env node */\n\n'use strict';\n\nvar utils = require('./utils');\n// Shimming starts here.\nmodule.exports = function(dependencies, opts) {\n  var window = dependencies && dependencies.window;\n\n  var options = {\n    shimChrome: true,\n    shimFirefox: true,\n    shimEdge: true,\n    shimSafari: true,\n  };\n\n  for (var key in opts) {\n    if (hasOwnProperty.call(opts, key)) {\n      options[key] = opts[key];\n    }\n  }\n\n  // Utils.\n  var logging = utils.log;\n  var browserDetails = utils.detectBrowser(window);\n\n  // Export to the adapter global object visible in the browser.\n  var adapter = {\n    browserDetails: browserDetails,\n    extractVersion: utils.extractVersion,\n    disableLog: utils.disableLog,\n    disableWarnings: utils.disableWarnings\n  };\n\n  // Uncomment the line below if you want logging to occur, including logging\n  // for the switch statement below. Can also be turned on in the browser via\n  // adapter.disableLog(false), but then logging from the switch statement below\n  // will not appear.\n  // require('./utils').disableLog(false);\n\n  // Browser shims.\n  var chromeShim = require('./chrome/chrome_shim') || null;\n  var edgeShim = require('./edge/edge_shim') || null;\n  var firefoxShim = require('./firefox/firefox_shim') || null;\n  var safariShim = require('./safari/safari_shim') || null;\n  var commonShim = require('./common_shim') || null;\n\n  // Shim browser if found.\n  switch (browserDetails.browser) {\n    case 'chrome':\n      if (!chromeShim || !chromeShim.shimPeerConnection ||\n          !options.shimChrome) {\n        logging('Chrome shim is not included in this adapter release.');\n        return adapter;\n      }\n      logging('adapter.js shimming chrome.');\n      // Export to the adapter global object visible in the browser.\n      adapter.browserShim = chromeShim;\n      commonShim.shimCreateObjectURL(window);\n\n      chromeShim.shimGetUserMedia(window);\n      chromeShim.shimMediaStream(window);\n      chromeShim.shimSourceObject(window);\n      chromeShim.shimPeerConnection(window);\n      chromeShim.shimOnTrack(window);\n      chromeShim.shimAddTrackRemoveTrack(window);\n      chromeShim.shimGetSendersWithDtmf(window);\n\n      commonShim.shimRTCIceCandidate(window);\n      break;\n    case 'firefox':\n      if (!firefoxShim || !firefoxShim.shimPeerConnection ||\n          !options.shimFirefox) {\n        logging('Firefox shim is not included in this adapter release.');\n        return adapter;\n      }\n      logging('adapter.js shimming firefox.');\n      // Export to the adapter global object visible in the browser.\n      adapter.browserShim = firefoxShim;\n      commonShim.shimCreateObjectURL(window);\n\n      firefoxShim.shimGetUserMedia(window);\n      firefoxShim.shimSourceObject(window);\n      firefoxShim.shimPeerConnection(window);\n      firefoxShim.shimOnTrack(window);\n      firefoxShim.shimRemoveStream(window);\n\n      commonShim.shimRTCIceCandidate(window);\n      break;\n    case 'edge':\n      if (!edgeShim || !edgeShim.shimPeerConnection || !options.shimEdge) {\n        logging('MS edge shim is not included in this adapter release.');\n        return adapter;\n      }\n      logging('adapter.js shimming edge.');\n      // Export to the adapter global object visible in the browser.\n      adapter.browserShim = edgeShim;\n      commonShim.shimCreateObjectURL(window);\n\n      edgeShim.shimGetUserMedia(window);\n      edgeShim.shimPeerConnection(window);\n      edgeShim.shimReplaceTrack(window);\n\n      // the edge shim implements the full RTCIceCandidate object.\n      break;\n    case 'safari':\n      if (!safariShim || !options.shimSafari) {\n        logging('Safari shim is not included in this adapter release.');\n        return adapter;\n      }\n      logging('adapter.js shimming safari.');\n      // Export to the adapter global object visible in the browser.\n      adapter.browserShim = safariShim;\n      commonShim.shimCreateObjectURL(window);\n\n      safariShim.shimRTCIceServerUrls(window);\n      safariShim.shimCallbacksAPI(window);\n      safariShim.shimLocalStreamsAPI(window);\n      safariShim.shimRemoteStreamsAPI(window);\n      safariShim.shimTrackEventTransceiver(window);\n      safariShim.shimGetUserMedia(window);\n      safariShim.shimCreateOfferLegacy(window);\n\n      commonShim.shimRTCIceCandidate(window);\n      break;\n    default:\n      logging('Unsupported browser!');\n      break;\n  }\n\n  return adapter;\n};\n\n},{\"./chrome/chrome_shim\":5,\"./common_shim\":7,\"./edge/edge_shim\":8,\"./firefox/firefox_shim\":10,\"./safari/safari_shim\":12,\"./utils\":13}],5:[function(require,module,exports){\n\n/*\n *  Copyright (c) 2016 The WebRTC project authors. All Rights Reserved.\n *\n *  Use of this source code is governed by a BSD-style license\n *  that can be found in the LICENSE file in the root of the source\n *  tree.\n */\n /* eslint-env node */\n'use strict';\nvar utils = require('../utils.js');\nvar logging = utils.log;\n\nmodule.exports = {\n  shimGetUserMedia: require('./getusermedia'),\n  shimMediaStream: function(window) {\n    window.MediaStream = window.MediaStream || window.webkitMediaStream;\n  },\n\n  shimOnTrack: function(window) {\n    if (typeof window === 'object' && window.RTCPeerConnection && !('ontrack' in\n        window.RTCPeerConnection.prototype)) {\n      Object.defineProperty(window.RTCPeerConnection.prototype, 'ontrack', {\n        get: function() {\n          return this._ontrack;\n        },\n        set: function(f) {\n          if (this._ontrack) {\n            this.removeEventListener('track', this._ontrack);\n          }\n          this.addEventListener('track', this._ontrack = f);\n        }\n      });\n      var origSetRemoteDescription =\n          window.RTCPeerConnection.prototype.setRemoteDescription;\n      window.RTCPeerConnection.prototype.setRemoteDescription = function() {\n        var pc = this;\n        if (!pc._ontrackpoly) {\n          pc._ontrackpoly = function(e) {\n            // onaddstream does not fire when a track is added to an existing\n            // stream. But stream.onaddtrack is implemented so we use that.\n            e.stream.addEventListener('addtrack', function(te) {\n              var receiver;\n              if (window.RTCPeerConnection.prototype.getReceivers) {\n                receiver = pc.getReceivers().find(function(r) {\n                  return r.track && r.track.id === te.track.id;\n                });\n              } else {\n                receiver = {track: te.track};\n              }\n\n              var event = new Event('track');\n              event.track = te.track;\n              event.receiver = receiver;\n              event.transceiver = {receiver: receiver};\n              event.streams = [e.stream];\n              pc.dispatchEvent(event);\n            });\n            e.stream.getTracks().forEach(function(track) {\n              var receiver;\n              if (window.RTCPeerConnection.prototype.getReceivers) {\n                receiver = pc.getReceivers().find(function(r) {\n                  return r.track && r.track.id === track.id;\n                });\n              } else {\n                receiver = {track: track};\n              }\n              var event = new Event('track');\n              event.track = track;\n              event.receiver = receiver;\n              event.transceiver = {receiver: receiver};\n              event.streams = [e.stream];\n              pc.dispatchEvent(event);\n            });\n          };\n          pc.addEventListener('addstream', pc._ontrackpoly);\n        }\n        return origSetRemoteDescription.apply(pc, arguments);\n      };\n    }\n  },\n\n  shimGetSendersWithDtmf: function(window) {\n    // Overrides addTrack/removeTrack, depends on shimAddTrackRemoveTrack.\n    if (typeof window === 'object' && window.RTCPeerConnection &&\n        !('getSenders' in window.RTCPeerConnection.prototype) &&\n        'createDTMFSender' in window.RTCPeerConnection.prototype) {\n      var shimSenderWithDtmf = function(pc, track) {\n        return {\n          track: track,\n          get dtmf() {\n            if (this._dtmf === undefined) {\n              if (track.kind === 'audio') {\n                this._dtmf = pc.createDTMFSender(track);\n              } else {\n                this._dtmf = null;\n              }\n            }\n            return this._dtmf;\n          },\n          _pc: pc\n        };\n      };\n\n      // augment addTrack when getSenders is not available.\n      if (!window.RTCPeerConnection.prototype.getSenders) {\n        window.RTCPeerConnection.prototype.getSenders = function() {\n          this._senders = this._senders || [];\n          return this._senders.slice(); // return a copy of the internal state.\n        };\n        var origAddTrack = window.RTCPeerConnection.prototype.addTrack;\n        window.RTCPeerConnection.prototype.addTrack = function(track, stream) {\n          var pc = this;\n          var sender = origAddTrack.apply(pc, arguments);\n          if (!sender) {\n            sender = shimSenderWithDtmf(pc, track);\n            pc._senders.push(sender);\n          }\n          return sender;\n        };\n\n        var origRemoveTrack = window.RTCPeerConnection.prototype.removeTrack;\n        window.RTCPeerConnection.prototype.removeTrack = function(sender) {\n          var pc = this;\n          origRemoveTrack.apply(pc, arguments);\n          var idx = pc._senders.indexOf(sender);\n          if (idx !== -1) {\n            pc._senders.splice(idx, 1);\n          }\n        };\n      }\n      var origAddStream = window.RTCPeerConnection.prototype.addStream;\n      window.RTCPeerConnection.prototype.addStream = function(stream) {\n        var pc = this;\n        pc._senders = pc._senders || [];\n        origAddStream.apply(pc, [stream]);\n        stream.getTracks().forEach(function(track) {\n          pc._senders.push(shimSenderWithDtmf(pc, track));\n        });\n      };\n\n      var origRemoveStream = window.RTCPeerConnection.prototype.removeStream;\n      window.RTCPeerConnection.prototype.removeStream = function(stream) {\n        var pc = this;\n        pc._senders = pc._senders || [];\n        origRemoveStream.apply(pc, [stream]);\n\n        stream.getTracks().forEach(function(track) {\n          var sender = pc._senders.find(function(s) {\n            return s.track === track;\n          });\n          if (sender) {\n            pc._senders.splice(pc._senders.indexOf(sender), 1); // remove sender\n          }\n        });\n      };\n    } else if (typeof window === 'object' && window.RTCPeerConnection &&\n               'getSenders' in window.RTCPeerConnection.prototype &&\n               'createDTMFSender' in window.RTCPeerConnection.prototype &&\n               window.RTCRtpSender &&\n               !('dtmf' in window.RTCRtpSender.prototype)) {\n      var origGetSenders = window.RTCPeerConnection.prototype.getSenders;\n      window.RTCPeerConnection.prototype.getSenders = function() {\n        var pc = this;\n        var senders = origGetSenders.apply(pc, []);\n        senders.forEach(function(sender) {\n          sender._pc = pc;\n        });\n        return senders;\n      };\n\n      Object.defineProperty(window.RTCRtpSender.prototype, 'dtmf', {\n        get: function() {\n          if (this._dtmf === undefined) {\n            if (this.track.kind === 'audio') {\n              this._dtmf = this._pc.createDTMFSender(this.track);\n            } else {\n              this._dtmf = null;\n            }\n          }\n          return this._dtmf;\n        }\n      });\n    }\n  },\n\n  shimSourceObject: function(window) {\n    var URL = window && window.URL;\n\n    if (typeof window === 'object') {\n      if (window.HTMLMediaElement &&\n        !('srcObject' in window.HTMLMediaElement.prototype)) {\n        // Shim the srcObject property, once, when HTMLMediaElement is found.\n        Object.defineProperty(window.HTMLMediaElement.prototype, 'srcObject', {\n          get: function() {\n            return this._srcObject;\n          },\n          set: function(stream) {\n            var self = this;\n            // Use _srcObject as a private property for this shim\n            this._srcObject = stream;\n            if (this.src) {\n              URL.revokeObjectURL(this.src);\n            }\n\n            if (!stream) {\n              this.src = '';\n              return undefined;\n            }\n            this.src = URL.createObjectURL(stream);\n            // We need to recreate the blob url when a track is added or\n            // removed. Doing it manually since we want to avoid a recursion.\n            stream.addEventListener('addtrack', function() {\n              if (self.src) {\n                URL.revokeObjectURL(self.src);\n              }\n              self.src = URL.createObjectURL(stream);\n            });\n            stream.addEventListener('removetrack', function() {\n              if (self.src) {\n                URL.revokeObjectURL(self.src);\n              }\n              self.src = URL.createObjectURL(stream);\n            });\n          }\n        });\n      }\n    }\n  },\n\n  shimAddTrackRemoveTrackWithNative: function(window) {\n    // shim addTrack/removeTrack with native variants in order to make\n    // the interactions with legacy getLocalStreams behave as in other browsers.\n    // Keeps a mapping stream.id => [stream, rtpsenders...]\n    window.RTCPeerConnection.prototype.getLocalStreams = function() {\n      var pc = this;\n      this._shimmedLocalStreams = this._shimmedLocalStreams || {};\n      return Object.keys(this._shimmedLocalStreams).map(function(streamId) {\n        return pc._shimmedLocalStreams[streamId][0];\n      });\n    };\n\n    var origAddTrack = window.RTCPeerConnection.prototype.addTrack;\n    window.RTCPeerConnection.prototype.addTrack = function(track, stream) {\n      if (!stream) {\n        return origAddTrack.apply(this, arguments);\n      }\n      this._shimmedLocalStreams = this._shimmedLocalStreams || {};\n\n      var sender = origAddTrack.apply(this, arguments);\n      if (!this._shimmedLocalStreams[stream.id]) {\n        this._shimmedLocalStreams[stream.id] = [stream, sender];\n      } else if (this._shimmedLocalStreams[stream.id].indexOf(sender) === -1) {\n        this._shimmedLocalStreams[stream.id].push(sender);\n      }\n      return sender;\n    };\n\n    var origAddStream = window.RTCPeerConnection.prototype.addStream;\n    window.RTCPeerConnection.prototype.addStream = function(stream) {\n      var pc = this;\n      this._shimmedLocalStreams = this._shimmedLocalStreams || {};\n\n      stream.getTracks().forEach(function(track) {\n        var alreadyExists = pc.getSenders().find(function(s) {\n          return s.track === track;\n        });\n        if (alreadyExists) {\n          throw new DOMException('Track already exists.',\n              'InvalidAccessError');\n        }\n      });\n      var existingSenders = pc.getSenders();\n      origAddStream.apply(this, arguments);\n      var newSenders = pc.getSenders().filter(function(newSender) {\n        return existingSenders.indexOf(newSender) === -1;\n      });\n      this._shimmedLocalStreams[stream.id] = [stream].concat(newSenders);\n    };\n\n    var origRemoveStream = window.RTCPeerConnection.prototype.removeStream;\n    window.RTCPeerConnection.prototype.removeStream = function(stream) {\n      this._shimmedLocalStreams = this._shimmedLocalStreams || {};\n      delete this._shimmedLocalStreams[stream.id];\n      return origRemoveStream.apply(this, arguments);\n    };\n\n    var origRemoveTrack = window.RTCPeerConnection.prototype.removeTrack;\n    window.RTCPeerConnection.prototype.removeTrack = function(sender) {\n      var pc = this;\n      this._shimmedLocalStreams = this._shimmedLocalStreams || {};\n      if (sender) {\n        Object.keys(this._shimmedLocalStreams).forEach(function(streamId) {\n          var idx = pc._shimmedLocalStreams[streamId].indexOf(sender);\n          if (idx !== -1) {\n            pc._shimmedLocalStreams[streamId].splice(idx, 1);\n          }\n          if (pc._shimmedLocalStreams[streamId].length === 1) {\n            delete pc._shimmedLocalStreams[streamId];\n          }\n        });\n      }\n      return origRemoveTrack.apply(this, arguments);\n    };\n  },\n\n  shimAddTrackRemoveTrack: function(window) {\n    var browserDetails = utils.detectBrowser(window);\n    // shim addTrack and removeTrack.\n    if (window.RTCPeerConnection.prototype.addTrack &&\n        browserDetails.version >= 65) {\n      return this.shimAddTrackRemoveTrackWithNative(window);\n    }\n\n    // also shim pc.getLocalStreams when addTrack is shimmed\n    // to return the original streams.\n    var origGetLocalStreams = window.RTCPeerConnection.prototype\n        .getLocalStreams;\n    window.RTCPeerConnection.prototype.getLocalStreams = function() {\n      var pc = this;\n      var nativeStreams = origGetLocalStreams.apply(this);\n      pc._reverseStreams = pc._reverseStreams || {};\n      return nativeStreams.map(function(stream) {\n        return pc._reverseStreams[stream.id];\n      });\n    };\n\n    var origAddStream = window.RTCPeerConnection.prototype.addStream;\n    window.RTCPeerConnection.prototype.addStream = function(stream) {\n      var pc = this;\n      pc._streams = pc._streams || {};\n      pc._reverseStreams = pc._reverseStreams || {};\n\n      stream.getTracks().forEach(function(track) {\n        var alreadyExists = pc.getSenders().find(function(s) {\n          return s.track === track;\n        });\n        if (alreadyExists) {\n          throw new DOMException('Track already exists.',\n              'InvalidAccessError');\n        }\n      });\n      // Add identity mapping for consistency with addTrack.\n      // Unless this is being used with a stream from addTrack.\n      if (!pc._reverseStreams[stream.id]) {\n        var newStream = new window.MediaStream(stream.getTracks());\n        pc._streams[stream.id] = newStream;\n        pc._reverseStreams[newStream.id] = stream;\n        stream = newStream;\n      }\n      origAddStream.apply(pc, [stream]);\n    };\n\n    var origRemoveStream = window.RTCPeerConnection.prototype.removeStream;\n    window.RTCPeerConnection.prototype.removeStream = function(stream) {\n      var pc = this;\n      pc._streams = pc._streams || {};\n      pc._reverseStreams = pc._reverseStreams || {};\n\n      origRemoveStream.apply(pc, [(pc._streams[stream.id] || stream)]);\n      delete pc._reverseStreams[(pc._streams[stream.id] ?\n          pc._streams[stream.id].id : stream.id)];\n      delete pc._streams[stream.id];\n    };\n\n    window.RTCPeerConnection.prototype.addTrack = function(track, stream) {\n      var pc = this;\n      if (pc.signalingState === 'closed') {\n        throw new DOMException(\n          'The RTCPeerConnection\\'s signalingState is \\'closed\\'.',\n          'InvalidStateError');\n      }\n      var streams = [].slice.call(arguments, 1);\n      if (streams.length !== 1 ||\n          !streams[0].getTracks().find(function(t) {\n            return t === track;\n          })) {\n        // this is not fully correct but all we can manage without\n        // [[associated MediaStreams]] internal slot.\n        throw new DOMException(\n          'The adapter.js addTrack polyfill only supports a single ' +\n          ' stream which is associated with the specified track.',\n          'NotSupportedError');\n      }\n\n      var alreadyExists = pc.getSenders().find(function(s) {\n        return s.track === track;\n      });\n      if (alreadyExists) {\n        throw new DOMException('Track already exists.',\n            'InvalidAccessError');\n      }\n\n      pc._streams = pc._streams || {};\n      pc._reverseStreams = pc._reverseStreams || {};\n      var oldStream = pc._streams[stream.id];\n      if (oldStream) {\n        // this is using odd Chrome behaviour, use with caution:\n        // https://bugs.chromium.org/p/webrtc/issues/detail?id=7815\n        // Note: we rely on the high-level addTrack/dtmf shim to\n        // create the sender with a dtmf sender.\n        oldStream.addTrack(track);\n\n        // Trigger ONN async.\n        Promise.resolve().then(function() {\n          pc.dispatchEvent(new Event('negotiationneeded'));\n        });\n      } else {\n        var newStream = new window.MediaStream([track]);\n        pc._streams[stream.id] = newStream;\n        pc._reverseStreams[newStream.id] = stream;\n        pc.addStream(newStream);\n      }\n      return pc.getSenders().find(function(s) {\n        return s.track === track;\n      });\n    };\n\n    // replace the internal stream id with the external one and\n    // vice versa.\n    function replaceInternalStreamId(pc, description) {\n      var sdp = description.sdp;\n      Object.keys(pc._reverseStreams || []).forEach(function(internalId) {\n        var externalStream = pc._reverseStreams[internalId];\n        var internalStream = pc._streams[externalStream.id];\n        sdp = sdp.replace(new RegExp(internalStream.id, 'g'),\n            externalStream.id);\n      });\n      return new RTCSessionDescription({\n        type: description.type,\n        sdp: sdp\n      });\n    }\n    function replaceExternalStreamId(pc, description) {\n      var sdp = description.sdp;\n      Object.keys(pc._reverseStreams || []).forEach(function(internalId) {\n        var externalStream = pc._reverseStreams[internalId];\n        var internalStream = pc._streams[externalStream.id];\n        sdp = sdp.replace(new RegExp(externalStream.id, 'g'),\n            internalStream.id);\n      });\n      return new RTCSessionDescription({\n        type: description.type,\n        sdp: sdp\n      });\n    }\n    ['createOffer', 'createAnswer'].forEach(function(method) {\n      var nativeMethod = window.RTCPeerConnection.prototype[method];\n      window.RTCPeerConnection.prototype[method] = function() {\n        var pc = this;\n        var args = arguments;\n        var isLegacyCall = arguments.length &&\n            typeof arguments[0] === 'function';\n        if (isLegacyCall) {\n          return nativeMethod.apply(pc, [\n            function(description) {\n              var desc = replaceInternalStreamId(pc, description);\n              args[0].apply(null, [desc]);\n            },\n            function(err) {\n              if (args[1]) {\n                args[1].apply(null, err);\n              }\n            }, arguments[2]\n          ]);\n        }\n        return nativeMethod.apply(pc, arguments)\n        .then(function(description) {\n          return replaceInternalStreamId(pc, description);\n        });\n      };\n    });\n\n    var origSetLocalDescription =\n        window.RTCPeerConnection.prototype.setLocalDescription;\n    window.RTCPeerConnection.prototype.setLocalDescription = function() {\n      var pc = this;\n      if (!arguments.length || !arguments[0].type) {\n        return origSetLocalDescription.apply(pc, arguments);\n      }\n      arguments[0] = replaceExternalStreamId(pc, arguments[0]);\n      return origSetLocalDescription.apply(pc, arguments);\n    };\n\n    // TODO: mangle getStats: https://w3c.github.io/webrtc-stats/#dom-rtcmediastreamstats-streamidentifier\n\n    var origLocalDescription = Object.getOwnPropertyDescriptor(\n        window.RTCPeerConnection.prototype, 'localDescription');\n    Object.defineProperty(window.RTCPeerConnection.prototype,\n        'localDescription', {\n          get: function() {\n            var pc = this;\n            var description = origLocalDescription.get.apply(this);\n            if (description.type === '') {\n              return description;\n            }\n            return replaceInternalStreamId(pc, description);\n          }\n        });\n\n    window.RTCPeerConnection.prototype.removeTrack = function(sender) {\n      var pc = this;\n      if (pc.signalingState === 'closed') {\n        throw new DOMException(\n          'The RTCPeerConnection\\'s signalingState is \\'closed\\'.',\n          'InvalidStateError');\n      }\n      // We can not yet check for sender instanceof RTCRtpSender\n      // since we shim RTPSender. So we check if sender._pc is set.\n      if (!sender._pc) {\n        throw new DOMException('Argument 1 of RTCPeerConnection.removeTrack ' +\n            'does not implement interface RTCRtpSender.', 'TypeError');\n      }\n      var isLocal = sender._pc === pc;\n      if (!isLocal) {\n        throw new DOMException('Sender was not created by this connection.',\n            'InvalidAccessError');\n      }\n\n      // Search for the native stream the senders track belongs to.\n      pc._streams = pc._streams || {};\n      var stream;\n      Object.keys(pc._streams).forEach(function(streamid) {\n        var hasTrack = pc._streams[streamid].getTracks().find(function(track) {\n          return sender.track === track;\n        });\n        if (hasTrack) {\n          stream = pc._streams[streamid];\n        }\n      });\n\n      if (stream) {\n        if (stream.getTracks().length === 1) {\n          // if this is the last track of the stream, remove the stream. This\n          // takes care of any shimmed _senders.\n          pc.removeStream(pc._reverseStreams[stream.id]);\n        } else {\n          // relying on the same odd chrome behaviour as above.\n          stream.removeTrack(sender.track);\n        }\n        pc.dispatchEvent(new Event('negotiationneeded'));\n      }\n    };\n  },\n\n  shimPeerConnection: function(window) {\n    var browserDetails = utils.detectBrowser(window);\n\n    // The RTCPeerConnection object.\n    if (!window.RTCPeerConnection) {\n      window.RTCPeerConnection = function(pcConfig, pcConstraints) {\n        // Translate iceTransportPolicy to iceTransports,\n        // see https://code.google.com/p/webrtc/issues/detail?id=4869\n        // this was fixed in M56 along with unprefixing RTCPeerConnection.\n        logging('PeerConnection');\n        if (pcConfig && pcConfig.iceTransportPolicy) {\n          pcConfig.iceTransports = pcConfig.iceTransportPolicy;\n        }\n\n        return new window.webkitRTCPeerConnection(pcConfig, pcConstraints);\n      };\n      window.RTCPeerConnection.prototype =\n          window.webkitRTCPeerConnection.prototype;\n      // wrap static methods. Currently just generateCertificate.\n      if (window.webkitRTCPeerConnection.generateCertificate) {\n        Object.defineProperty(window.RTCPeerConnection, 'generateCertificate', {\n          get: function() {\n            return window.webkitRTCPeerConnection.generateCertificate;\n          }\n        });\n      }\n    } else {\n      // migrate from non-spec RTCIceServer.url to RTCIceServer.urls\n      var OrigPeerConnection = window.RTCPeerConnection;\n      window.RTCPeerConnection = function(pcConfig, pcConstraints) {\n        if (pcConfig && pcConfig.iceServers) {\n          var newIceServers = [];\n          for (var i = 0; i < pcConfig.iceServers.length; i++) {\n            var server = pcConfig.iceServers[i];\n            if (!server.hasOwnProperty('urls') &&\n                server.hasOwnProperty('url')) {\n              utils.deprecated('RTCIceServer.url', 'RTCIceServer.urls');\n              server = JSON.parse(JSON.stringify(server));\n              server.urls = server.url;\n              newIceServers.push(server);\n            } else {\n              newIceServers.push(pcConfig.iceServers[i]);\n            }\n          }\n          pcConfig.iceServers = newIceServers;\n        }\n        return new OrigPeerConnection(pcConfig, pcConstraints);\n      };\n      window.RTCPeerConnection.prototype = OrigPeerConnection.prototype;\n      // wrap static methods. Currently just generateCertificate.\n      Object.defineProperty(window.RTCPeerConnection, 'generateCertificate', {\n        get: function() {\n          return OrigPeerConnection.generateCertificate;\n        }\n      });\n    }\n\n    var origGetStats = window.RTCPeerConnection.prototype.getStats;\n    window.RTCPeerConnection.prototype.getStats = function(selector,\n        successCallback, errorCallback) {\n      var pc = this;\n      var args = arguments;\n\n      // If selector is a function then we are in the old style stats so just\n      // pass back the original getStats format to avoid breaking old users.\n      if (arguments.length > 0 && typeof selector === 'function') {\n        return origGetStats.apply(this, arguments);\n      }\n\n      // When spec-style getStats is supported, return those when called with\n      // either no arguments or the selector argument is null.\n      if (origGetStats.length === 0 && (arguments.length === 0 ||\n          typeof arguments[0] !== 'function')) {\n        return origGetStats.apply(this, []);\n      }\n\n      var fixChromeStats_ = function(response) {\n        var standardReport = {};\n        var reports = response.result();\n        reports.forEach(function(report) {\n          var standardStats = {\n            id: report.id,\n            timestamp: report.timestamp,\n            type: {\n              localcandidate: 'local-candidate',\n              remotecandidate: 'remote-candidate'\n            }[report.type] || report.type\n          };\n          report.names().forEach(function(name) {\n            standardStats[name] = report.stat(name);\n          });\n          standardReport[standardStats.id] = standardStats;\n        });\n\n        return standardReport;\n      };\n\n      // shim getStats with maplike support\n      var makeMapStats = function(stats) {\n        return new Map(Object.keys(stats).map(function(key) {\n          return [key, stats[key]];\n        }));\n      };\n\n      if (arguments.length >= 2) {\n        var successCallbackWrapper_ = function(response) {\n          args[1](makeMapStats(fixChromeStats_(response)));\n        };\n\n        return origGetStats.apply(this, [successCallbackWrapper_,\n          arguments[0]]);\n      }\n\n      // promise-support\n      return new Promise(function(resolve, reject) {\n        origGetStats.apply(pc, [\n          function(response) {\n            resolve(makeMapStats(fixChromeStats_(response)));\n          }, reject]);\n      }).then(successCallback, errorCallback);\n    };\n\n    // add promise support -- natively available in Chrome 51\n    if (browserDetails.version < 51) {\n      ['setLocalDescription', 'setRemoteDescription', 'addIceCandidate']\n          .forEach(function(method) {\n            var nativeMethod = window.RTCPeerConnection.prototype[method];\n            window.RTCPeerConnection.prototype[method] = function() {\n              var args = arguments;\n              var pc = this;\n              var promise = new Promise(function(resolve, reject) {\n                nativeMethod.apply(pc, [args[0], resolve, reject]);\n              });\n              if (args.length < 2) {\n                return promise;\n              }\n              return promise.then(function() {\n                args[1].apply(null, []);\n              },\n              function(err) {\n                if (args.length >= 3) {\n                  args[2].apply(null, [err]);\n                }\n              });\n            };\n          });\n    }\n\n    // promise support for createOffer and createAnswer. Available (without\n    // bugs) since M52: crbug/619289\n    if (browserDetails.version < 52) {\n      ['createOffer', 'createAnswer'].forEach(function(method) {\n        var nativeMethod = window.RTCPeerConnection.prototype[method];\n        window.RTCPeerConnection.prototype[method] = function() {\n          var pc = this;\n          if (arguments.length < 1 || (arguments.length === 1 &&\n              typeof arguments[0] === 'object')) {\n            var opts = arguments.length === 1 ? arguments[0] : undefined;\n            return new Promise(function(resolve, reject) {\n              nativeMethod.apply(pc, [resolve, reject, opts]);\n            });\n          }\n          return nativeMethod.apply(this, arguments);\n        };\n      });\n    }\n\n    // shim implicit creation of RTCSessionDescription/RTCIceCandidate\n    ['setLocalDescription', 'setRemoteDescription', 'addIceCandidate']\n        .forEach(function(method) {\n          var nativeMethod = window.RTCPeerConnection.prototype[method];\n          window.RTCPeerConnection.prototype[method] = function() {\n            arguments[0] = new ((method === 'addIceCandidate') ?\n                window.RTCIceCandidate :\n                window.RTCSessionDescription)(arguments[0]);\n            return nativeMethod.apply(this, arguments);\n          };\n        });\n\n    // support for addIceCandidate(null or undefined)\n    var nativeAddIceCandidate =\n        window.RTCPeerConnection.prototype.addIceCandidate;\n    window.RTCPeerConnection.prototype.addIceCandidate = function() {\n      if (!arguments[0]) {\n        if (arguments[1]) {\n          arguments[1].apply(null);\n        }\n        return Promise.resolve();\n      }\n      return nativeAddIceCandidate.apply(this, arguments);\n    };\n  }\n};\n\n},{\"../utils.js\":13,\"./getusermedia\":6}],6:[function(require,module,exports){\n/*\n *  Copyright (c) 2016 The WebRTC project authors. All Rights Reserved.\n *\n *  Use of this source code is governed by a BSD-style license\n *  that can be found in the LICENSE file in the root of the source\n *  tree.\n */\n /* eslint-env node */\n'use strict';\nvar utils = require('../utils.js');\nvar logging = utils.log;\n\n// Expose public methods.\nmodule.exports = function(window) {\n  var browserDetails = utils.detectBrowser(window);\n  var navigator = window && window.navigator;\n\n  var constraintsToChrome_ = function(c) {\n    if (typeof c !== 'object' || c.mandatory || c.optional) {\n      return c;\n    }\n    var cc = {};\n    Object.keys(c).forEach(function(key) {\n      if (key === 'require' || key === 'advanced' || key === 'mediaSource') {\n        return;\n      }\n      var r = (typeof c[key] === 'object') ? c[key] : {ideal: c[key]};\n      if (r.exact !== undefined && typeof r.exact === 'number') {\n        r.min = r.max = r.exact;\n      }\n      var oldname_ = function(prefix, name) {\n        if (prefix) {\n          return prefix + name.charAt(0).toUpperCase() + name.slice(1);\n        }\n        return (name === 'deviceId') ? 'sourceId' : name;\n      };\n      if (r.ideal !== undefined) {\n        cc.optional = cc.optional || [];\n        var oc = {};\n        if (typeof r.ideal === 'number') {\n          oc[oldname_('min', key)] = r.ideal;\n          cc.optional.push(oc);\n          oc = {};\n          oc[oldname_('max', key)] = r.ideal;\n          cc.optional.push(oc);\n        } else {\n          oc[oldname_('', key)] = r.ideal;\n          cc.optional.push(oc);\n        }\n      }\n      if (r.exact !== undefined && typeof r.exact !== 'number') {\n        cc.mandatory = cc.mandatory || {};\n        cc.mandatory[oldname_('', key)] = r.exact;\n      } else {\n        ['min', 'max'].forEach(function(mix) {\n          if (r[mix] !== undefined) {\n            cc.mandatory = cc.mandatory || {};\n            cc.mandatory[oldname_(mix, key)] = r[mix];\n          }\n        });\n      }\n    });\n    if (c.advanced) {\n      cc.optional = (cc.optional || []).concat(c.advanced);\n    }\n    return cc;\n  };\n\n  var shimConstraints_ = function(constraints, func) {\n    if (browserDetails.version >= 61) {\n      return func(constraints);\n    }\n    constraints = JSON.parse(JSON.stringify(constraints));\n    if (constraints && typeof constraints.audio === 'object') {\n      var remap = function(obj, a, b) {\n        if (a in obj && !(b in obj)) {\n          obj[b] = obj[a];\n          delete obj[a];\n        }\n      };\n      constraints = JSON.parse(JSON.stringify(constraints));\n      remap(constraints.audio, 'autoGainControl', 'googAutoGainControl');\n      remap(constraints.audio, 'noiseSuppression', 'googNoiseSuppression');\n      constraints.audio = constraintsToChrome_(constraints.audio);\n    }\n    if (constraints && typeof constraints.video === 'object') {\n      // Shim facingMode for mobile & surface pro.\n      var face = constraints.video.facingMode;\n      face = face && ((typeof face === 'object') ? face : {ideal: face});\n      var getSupportedFacingModeLies = browserDetails.version < 66;\n\n      if ((face && (face.exact === 'user' || face.exact === 'environment' ||\n                    face.ideal === 'user' || face.ideal === 'environment')) &&\n          !(navigator.mediaDevices.getSupportedConstraints &&\n            navigator.mediaDevices.getSupportedConstraints().facingMode &&\n            !getSupportedFacingModeLies)) {\n        delete constraints.video.facingMode;\n        var matches;\n        if (face.exact === 'environment' || face.ideal === 'environment') {\n          matches = ['back', 'rear'];\n        } else if (face.exact === 'user' || face.ideal === 'user') {\n          matches = ['front'];\n        }\n        if (matches) {\n          // Look for matches in label, or use last cam for back (typical).\n          return navigator.mediaDevices.enumerateDevices()\n          .then(function(devices) {\n            devices = devices.filter(function(d) {\n              return d.kind === 'videoinput';\n            });\n            var dev = devices.find(function(d) {\n              return matches.some(function(match) {\n                return d.label.toLowerCase().indexOf(match) !== -1;\n              });\n            });\n            if (!dev && devices.length && matches.indexOf('back') !== -1) {\n              dev = devices[devices.length - 1]; // more likely the back cam\n            }\n            if (dev) {\n              constraints.video.deviceId = face.exact ? {exact: dev.deviceId} :\n                                                        {ideal: dev.deviceId};\n            }\n            constraints.video = constraintsToChrome_(constraints.video);\n            logging('chrome: ' + JSON.stringify(constraints));\n            return func(constraints);\n          });\n        }\n      }\n      constraints.video = constraintsToChrome_(constraints.video);\n    }\n    logging('chrome: ' + JSON.stringify(constraints));\n    return func(constraints);\n  };\n\n  var shimError_ = function(e) {\n    return {\n      name: {\n        PermissionDeniedError: 'NotAllowedError',\n        InvalidStateError: 'NotReadableError',\n        DevicesNotFoundError: 'NotFoundError',\n        ConstraintNotSatisfiedError: 'OverconstrainedError',\n        TrackStartError: 'NotReadableError',\n        MediaDeviceFailedDueToShutdown: 'NotReadableError',\n        MediaDeviceKillSwitchOn: 'NotReadableError'\n      }[e.name] || e.name,\n      message: e.message,\n      constraint: e.constraintName,\n      toString: function() {\n        return this.name + (this.message && ': ') + this.message;\n      }\n    };\n  };\n\n  var getUserMedia_ = function(constraints, onSuccess, onError) {\n    shimConstraints_(constraints, function(c) {\n      navigator.webkitGetUserMedia(c, onSuccess, function(e) {\n        if (onError) {\n          onError(shimError_(e));\n        }\n      });\n    });\n  };\n\n  navigator.getUserMedia = getUserMedia_;\n\n  // Returns the result of getUserMedia as a Promise.\n  var getUserMediaPromise_ = function(constraints) {\n    return new Promise(function(resolve, reject) {\n      navigator.getUserMedia(constraints, resolve, reject);\n    });\n  };\n\n  if (!navigator.mediaDevices) {\n    navigator.mediaDevices = {\n      getUserMedia: getUserMediaPromise_,\n      enumerateDevices: function() {\n        return new Promise(function(resolve) {\n          var kinds = {audio: 'audioinput', video: 'videoinput'};\n          return window.MediaStreamTrack.getSources(function(devices) {\n            resolve(devices.map(function(device) {\n              return {label: device.label,\n                kind: kinds[device.kind],\n                deviceId: device.id,\n                groupId: ''};\n            }));\n          });\n        });\n      },\n      getSupportedConstraints: function() {\n        return {\n          deviceId: true, echoCancellation: true, facingMode: true,\n          frameRate: true, height: true, width: true\n        };\n      }\n    };\n  }\n\n  // A shim for getUserMedia method on the mediaDevices object.\n  // TODO(KaptenJansson) remove once implemented in Chrome stable.\n  if (!navigator.mediaDevices.getUserMedia) {\n    navigator.mediaDevices.getUserMedia = function(constraints) {\n      return getUserMediaPromise_(constraints);\n    };\n  } else {\n    // Even though Chrome 45 has navigator.mediaDevices and a getUserMedia\n    // function which returns a Promise, it does not accept spec-style\n    // constraints.\n    var origGetUserMedia = navigator.mediaDevices.getUserMedia.\n        bind(navigator.mediaDevices);\n    navigator.mediaDevices.getUserMedia = function(cs) {\n      return shimConstraints_(cs, function(c) {\n        return origGetUserMedia(c).then(function(stream) {\n          if (c.audio && !stream.getAudioTracks().length ||\n              c.video && !stream.getVideoTracks().length) {\n            stream.getTracks().forEach(function(track) {\n              track.stop();\n            });\n            throw new DOMException('', 'NotFoundError');\n          }\n          return stream;\n        }, function(e) {\n          return Promise.reject(shimError_(e));\n        });\n      });\n    };\n  }\n\n  // Dummy devicechange event methods.\n  // TODO(KaptenJansson) remove once implemented in Chrome stable.\n  if (typeof navigator.mediaDevices.addEventListener === 'undefined') {\n    navigator.mediaDevices.addEventListener = function() {\n      logging('Dummy mediaDevices.addEventListener called.');\n    };\n  }\n  if (typeof navigator.mediaDevices.removeEventListener === 'undefined') {\n    navigator.mediaDevices.removeEventListener = function() {\n      logging('Dummy mediaDevices.removeEventListener called.');\n    };\n  }\n};\n\n},{\"../utils.js\":13}],7:[function(require,module,exports){\n/*\n *  Copyright (c) 2017 The WebRTC project authors. All Rights Reserved.\n *\n *  Use of this source code is governed by a BSD-style license\n *  that can be found in the LICENSE file in the root of the source\n *  tree.\n */\n /* eslint-env node */\n'use strict';\n\nvar SDPUtils = require('sdp');\nvar utils = require('./utils');\n\n// Wraps the peerconnection event eventNameToWrap in a function\n// which returns the modified event object.\nfunction wrapPeerConnectionEvent(window, eventNameToWrap, wrapper) {\n  if (!window.RTCPeerConnection) {\n    return;\n  }\n  var proto = window.RTCPeerConnection.prototype;\n  var nativeAddEventListener = proto.addEventListener;\n  proto.addEventListener = function(nativeEventName, cb) {\n    if (nativeEventName !== eventNameToWrap) {\n      return nativeAddEventListener.apply(this, arguments);\n    }\n    var wrappedCallback = function(e) {\n      cb(wrapper(e));\n    };\n    this._eventMap = this._eventMap || {};\n    this._eventMap[cb] = wrappedCallback;\n    return nativeAddEventListener.apply(this, [nativeEventName,\n      wrappedCallback]);\n  };\n\n  var nativeRemoveEventListener = proto.removeEventListener;\n  proto.removeEventListener = function(nativeEventName, cb) {\n    if (nativeEventName !== eventNameToWrap || !this._eventMap\n        || !this._eventMap[cb]) {\n      return nativeRemoveEventListener.apply(this, arguments);\n    }\n    var unwrappedCb = this._eventMap[cb];\n    delete this._eventMap[cb];\n    return nativeRemoveEventListener.apply(this, [nativeEventName,\n      unwrappedCb]);\n  };\n\n  Object.defineProperty(proto, 'on' + eventNameToWrap, {\n    get: function() {\n      return this['_on' + eventNameToWrap];\n    },\n    set: function(cb) {\n      if (this['_on' + eventNameToWrap]) {\n        this.removeEventListener(eventNameToWrap,\n            this['_on' + eventNameToWrap]);\n        delete this['_on' + eventNameToWrap];\n      }\n      if (cb) {\n        this.addEventListener(eventNameToWrap,\n            this['_on' + eventNameToWrap] = cb);\n      }\n    }\n  });\n}\n\nmodule.exports = {\n  shimRTCIceCandidate: function(window) {\n    // foundation is arbitrarily chosen as an indicator for full support for\n    // https://w3c.github.io/webrtc-pc/#rtcicecandidate-interface\n    if (window.RTCIceCandidate && 'foundation' in\n        window.RTCIceCandidate.prototype) {\n      return;\n    }\n\n    var NativeRTCIceCandidate = window.RTCIceCandidate;\n    window.RTCIceCandidate = function(args) {\n      // Remove the a= which shouldn't be part of the candidate string.\n      if (typeof args === 'object' && args.candidate &&\n          args.candidate.indexOf('a=') === 0) {\n        args = JSON.parse(JSON.stringify(args));\n        args.candidate = args.candidate.substr(2);\n      }\n\n      // Augment the native candidate with the parsed fields.\n      var nativeCandidate = new NativeRTCIceCandidate(args);\n      var parsedCandidate = SDPUtils.parseCandidate(args.candidate);\n      var augmentedCandidate = Object.assign(nativeCandidate,\n          parsedCandidate);\n\n      // Add a serializer that does not serialize the extra attributes.\n      augmentedCandidate.toJSON = function() {\n        return {\n          candidate: augmentedCandidate.candidate,\n          sdpMid: augmentedCandidate.sdpMid,\n          sdpMLineIndex: augmentedCandidate.sdpMLineIndex,\n          usernameFragment: augmentedCandidate.usernameFragment,\n        };\n      };\n      return augmentedCandidate;\n    };\n\n    // Hook up the augmented candidate in onicecandidate and\n    // addEventListener('icecandidate', ...)\n    wrapPeerConnectionEvent(window, 'icecandidate', function(e) {\n      if (e.candidate) {\n        Object.defineProperty(e, 'candidate', {\n          value: new window.RTCIceCandidate(e.candidate),\n          writable: 'false'\n        });\n      }\n      return e;\n    });\n  },\n\n  // shimCreateObjectURL must be called before shimSourceObject to avoid loop.\n\n  shimCreateObjectURL: function(window) {\n    var URL = window && window.URL;\n\n    if (!(typeof window === 'object' && window.HTMLMediaElement &&\n          'srcObject' in window.HTMLMediaElement.prototype &&\n        URL.createObjectURL && URL.revokeObjectURL)) {\n      // Only shim CreateObjectURL using srcObject if srcObject exists.\n      return undefined;\n    }\n\n    var nativeCreateObjectURL = URL.createObjectURL.bind(URL);\n    var nativeRevokeObjectURL = URL.revokeObjectURL.bind(URL);\n    var streams = new Map(), newId = 0;\n\n    URL.createObjectURL = function(stream) {\n      if ('getTracks' in stream) {\n        var url = 'polyblob:' + (++newId);\n        streams.set(url, stream);\n        utils.deprecated('URL.createObjectURL(stream)',\n            'elem.srcObject = stream');\n        return url;\n      }\n      return nativeCreateObjectURL(stream);\n    };\n    URL.revokeObjectURL = function(url) {\n      nativeRevokeObjectURL(url);\n      streams.delete(url);\n    };\n\n    var dsc = Object.getOwnPropertyDescriptor(window.HTMLMediaElement.prototype,\n                                              'src');\n    Object.defineProperty(window.HTMLMediaElement.prototype, 'src', {\n      get: function() {\n        return dsc.get.apply(this);\n      },\n      set: function(url) {\n        this.srcObject = streams.get(url) || null;\n        return dsc.set.apply(this, [url]);\n      }\n    });\n\n    var nativeSetAttribute = window.HTMLMediaElement.prototype.setAttribute;\n    window.HTMLMediaElement.prototype.setAttribute = function() {\n      if (arguments.length === 2 &&\n          ('' + arguments[0]).toLowerCase() === 'src') {\n        this.srcObject = streams.get(arguments[1]) || null;\n      }\n      return nativeSetAttribute.apply(this, arguments);\n    };\n  }\n};\n\n},{\"./utils\":13,\"sdp\":2}],8:[function(require,module,exports){\n/*\n *  Copyright (c) 2016 The WebRTC project authors. All Rights Reserved.\n *\n *  Use of this source code is governed by a BSD-style license\n *  that can be found in the LICENSE file in the root of the source\n *  tree.\n */\n /* eslint-env node */\n'use strict';\n\nvar utils = require('../utils');\nvar shimRTCPeerConnection = require('rtcpeerconnection-shim');\n\nmodule.exports = {\n  shimGetUserMedia: require('./getusermedia'),\n  shimPeerConnection: function(window) {\n    var browserDetails = utils.detectBrowser(window);\n\n    if (window.RTCIceGatherer) {\n      // ORTC defines an RTCIceCandidate object but no constructor.\n      // Not implemented in Edge.\n      if (!window.RTCIceCandidate) {\n        window.RTCIceCandidate = function(args) {\n          return args;\n        };\n      }\n      // ORTC does not have a session description object but\n      // other browsers (i.e. Chrome) that will support both PC and ORTC\n      // in the future might have this defined already.\n      if (!window.RTCSessionDescription) {\n        window.RTCSessionDescription = function(args) {\n          return args;\n        };\n      }\n      // this adds an additional event listener to MediaStrackTrack that signals\n      // when a tracks enabled property was changed. Workaround for a bug in\n      // addStream, see below. No longer required in 15025+\n      if (browserDetails.version < 15025) {\n        var origMSTEnabled = Object.getOwnPropertyDescriptor(\n            window.MediaStreamTrack.prototype, 'enabled');\n        Object.defineProperty(window.MediaStreamTrack.prototype, 'enabled', {\n          set: function(value) {\n            origMSTEnabled.set.call(this, value);\n            var ev = new Event('enabled');\n            ev.enabled = value;\n            this.dispatchEvent(ev);\n          }\n        });\n      }\n    }\n\n    // ORTC defines the DTMF sender a bit different.\n    // https://github.com/w3c/ortc/issues/714\n    if (window.RTCRtpSender && !('dtmf' in window.RTCRtpSender.prototype)) {\n      Object.defineProperty(window.RTCRtpSender.prototype, 'dtmf', {\n        get: function() {\n          if (this._dtmf === undefined) {\n            if (this.track.kind === 'audio') {\n              this._dtmf = new window.RTCDtmfSender(this);\n            } else if (this.track.kind === 'video') {\n              this._dtmf = null;\n            }\n          }\n          return this._dtmf;\n        }\n      });\n    }\n\n    window.RTCPeerConnection =\n        shimRTCPeerConnection(window, browserDetails.version);\n  },\n  shimReplaceTrack: function(window) {\n    // ORTC has replaceTrack -- https://github.com/w3c/ortc/issues/614\n    if (window.RTCRtpSender &&\n        !('replaceTrack' in window.RTCRtpSender.prototype)) {\n      window.RTCRtpSender.prototype.replaceTrack =\n          window.RTCRtpSender.prototype.setTrack;\n    }\n  }\n};\n\n},{\"../utils\":13,\"./getusermedia\":9,\"rtcpeerconnection-shim\":1}],9:[function(require,module,exports){\n/*\n *  Copyright (c) 2016 The WebRTC project authors. All Rights Reserved.\n *\n *  Use of this source code is governed by a BSD-style license\n *  that can be found in the LICENSE file in the root of the source\n *  tree.\n */\n /* eslint-env node */\n'use strict';\n\n// Expose public methods.\nmodule.exports = function(window) {\n  var navigator = window && window.navigator;\n\n  var shimError_ = function(e) {\n    return {\n      name: {PermissionDeniedError: 'NotAllowedError'}[e.name] || e.name,\n      message: e.message,\n      constraint: e.constraint,\n      toString: function() {\n        return this.name;\n      }\n    };\n  };\n\n  // getUserMedia error shim.\n  var origGetUserMedia = navigator.mediaDevices.getUserMedia.\n      bind(navigator.mediaDevices);\n  navigator.mediaDevices.getUserMedia = function(c) {\n    return origGetUserMedia(c).catch(function(e) {\n      return Promise.reject(shimError_(e));\n    });\n  };\n};\n\n},{}],10:[function(require,module,exports){\n/*\n *  Copyright (c) 2016 The WebRTC project authors. All Rights Reserved.\n *\n *  Use of this source code is governed by a BSD-style license\n *  that can be found in the LICENSE file in the root of the source\n *  tree.\n */\n /* eslint-env node */\n'use strict';\n\nvar utils = require('../utils');\n\nmodule.exports = {\n  shimGetUserMedia: require('./getusermedia'),\n  shimOnTrack: function(window) {\n    if (typeof window === 'object' && window.RTCPeerConnection && !('ontrack' in\n        window.RTCPeerConnection.prototype)) {\n      Object.defineProperty(window.RTCPeerConnection.prototype, 'ontrack', {\n        get: function() {\n          return this._ontrack;\n        },\n        set: function(f) {\n          if (this._ontrack) {\n            this.removeEventListener('track', this._ontrack);\n            this.removeEventListener('addstream', this._ontrackpoly);\n          }\n          this.addEventListener('track', this._ontrack = f);\n          this.addEventListener('addstream', this._ontrackpoly = function(e) {\n            e.stream.getTracks().forEach(function(track) {\n              var event = new Event('track');\n              event.track = track;\n              event.receiver = {track: track};\n              event.transceiver = {receiver: event.receiver};\n              event.streams = [e.stream];\n              this.dispatchEvent(event);\n            }.bind(this));\n          }.bind(this));\n        }\n      });\n    }\n    if (typeof window === 'object' && window.RTCTrackEvent &&\n        ('receiver' in window.RTCTrackEvent.prototype) &&\n        !('transceiver' in window.RTCTrackEvent.prototype)) {\n      Object.defineProperty(window.RTCTrackEvent.prototype, 'transceiver', {\n        get: function() {\n          return {receiver: this.receiver};\n        }\n      });\n    }\n  },\n\n  shimSourceObject: function(window) {\n    // Firefox has supported mozSrcObject since FF22, unprefixed in 42.\n    if (typeof window === 'object') {\n      if (window.HTMLMediaElement &&\n        !('srcObject' in window.HTMLMediaElement.prototype)) {\n        // Shim the srcObject property, once, when HTMLMediaElement is found.\n        Object.defineProperty(window.HTMLMediaElement.prototype, 'srcObject', {\n          get: function() {\n            return this.mozSrcObject;\n          },\n          set: function(stream) {\n            this.mozSrcObject = stream;\n          }\n        });\n      }\n    }\n  },\n\n  shimPeerConnection: function(window) {\n    var browserDetails = utils.detectBrowser(window);\n\n    if (typeof window !== 'object' || !(window.RTCPeerConnection ||\n        window.mozRTCPeerConnection)) {\n      return; // probably media.peerconnection.enabled=false in about:config\n    }\n    // The RTCPeerConnection object.\n    if (!window.RTCPeerConnection) {\n      window.RTCPeerConnection = function(pcConfig, pcConstraints) {\n        if (browserDetails.version < 38) {\n          // .urls is not supported in FF < 38.\n          // create RTCIceServers with a single url.\n          if (pcConfig && pcConfig.iceServers) {\n            var newIceServers = [];\n            for (var i = 0; i < pcConfig.iceServers.length; i++) {\n              var server = pcConfig.iceServers[i];\n              if (server.hasOwnProperty('urls')) {\n                for (var j = 0; j < server.urls.length; j++) {\n                  var newServer = {\n                    url: server.urls[j]\n                  };\n                  if (server.urls[j].indexOf('turn') === 0) {\n                    newServer.username = server.username;\n                    newServer.credential = server.credential;\n                  }\n                  newIceServers.push(newServer);\n                }\n              } else {\n                newIceServers.push(pcConfig.iceServers[i]);\n              }\n            }\n            pcConfig.iceServers = newIceServers;\n          }\n        }\n        return new window.mozRTCPeerConnection(pcConfig, pcConstraints);\n      };\n      window.RTCPeerConnection.prototype =\n          window.mozRTCPeerConnection.prototype;\n\n      // wrap static methods. Currently just generateCertificate.\n      if (window.mozRTCPeerConnection.generateCertificate) {\n        Object.defineProperty(window.RTCPeerConnection, 'generateCertificate', {\n          get: function() {\n            return window.mozRTCPeerConnection.generateCertificate;\n          }\n        });\n      }\n\n      window.RTCSessionDescription = window.mozRTCSessionDescription;\n      window.RTCIceCandidate = window.mozRTCIceCandidate;\n    }\n\n    // shim away need for obsolete RTCIceCandidate/RTCSessionDescription.\n    ['setLocalDescription', 'setRemoteDescription', 'addIceCandidate']\n        .forEach(function(method) {\n          var nativeMethod = window.RTCPeerConnection.prototype[method];\n          window.RTCPeerConnection.prototype[method] = function() {\n            arguments[0] = new ((method === 'addIceCandidate') ?\n                window.RTCIceCandidate :\n                window.RTCSessionDescription)(arguments[0]);\n            return nativeMethod.apply(this, arguments);\n          };\n        });\n\n    // support for addIceCandidate(null or undefined)\n    var nativeAddIceCandidate =\n        window.RTCPeerConnection.prototype.addIceCandidate;\n    window.RTCPeerConnection.prototype.addIceCandidate = function() {\n      if (!arguments[0]) {\n        if (arguments[1]) {\n          arguments[1].apply(null);\n        }\n        return Promise.resolve();\n      }\n      return nativeAddIceCandidate.apply(this, arguments);\n    };\n\n    // shim getStats with maplike support\n    var makeMapStats = function(stats) {\n      var map = new Map();\n      Object.keys(stats).forEach(function(key) {\n        map.set(key, stats[key]);\n        map[key] = stats[key];\n      });\n      return map;\n    };\n\n    var modernStatsTypes = {\n      inboundrtp: 'inbound-rtp',\n      outboundrtp: 'outbound-rtp',\n      candidatepair: 'candidate-pair',\n      localcandidate: 'local-candidate',\n      remotecandidate: 'remote-candidate'\n    };\n\n    var nativeGetStats = window.RTCPeerConnection.prototype.getStats;\n    window.RTCPeerConnection.prototype.getStats = function(\n      selector,\n      onSucc,\n      onErr\n    ) {\n      return nativeGetStats.apply(this, [selector || null])\n        .then(function(stats) {\n          if (browserDetails.version < 48) {\n            stats = makeMapStats(stats);\n          }\n          if (browserDetails.version < 53 && !onSucc) {\n            // Shim only promise getStats with spec-hyphens in type names\n            // Leave callback version alone; misc old uses of forEach before Map\n            try {\n              stats.forEach(function(stat) {\n                stat.type = modernStatsTypes[stat.type] || stat.type;\n              });\n            } catch (e) {\n              if (e.name !== 'TypeError') {\n                throw e;\n              }\n              // Avoid TypeError: \"type\" is read-only, in old versions. 34-43ish\n              stats.forEach(function(stat, i) {\n                stats.set(i, Object.assign({}, stat, {\n                  type: modernStatsTypes[stat.type] || stat.type\n                }));\n              });\n            }\n          }\n          return stats;\n        })\n        .then(onSucc, onErr);\n    };\n  },\n\n  shimRemoveStream: function(window) {\n    if (!window.RTCPeerConnection ||\n        'removeStream' in window.RTCPeerConnection.prototype) {\n      return;\n    }\n    window.RTCPeerConnection.prototype.removeStream = function(stream) {\n      var pc = this;\n      utils.deprecated('removeStream', 'removeTrack');\n      this.getSenders().forEach(function(sender) {\n        if (sender.track && stream.getTracks().indexOf(sender.track) !== -1) {\n          pc.removeTrack(sender);\n        }\n      });\n    };\n  }\n};\n\n},{\"../utils\":13,\"./getusermedia\":11}],11:[function(require,module,exports){\n/*\n *  Copyright (c) 2016 The WebRTC project authors. All Rights Reserved.\n *\n *  Use of this source code is governed by a BSD-style license\n *  that can be found in the LICENSE file in the root of the source\n *  tree.\n */\n /* eslint-env node */\n'use strict';\n\nvar utils = require('../utils');\nvar logging = utils.log;\n\n// Expose public methods.\nmodule.exports = function(window) {\n  var browserDetails = utils.detectBrowser(window);\n  var navigator = window && window.navigator;\n  var MediaStreamTrack = window && window.MediaStreamTrack;\n\n  var shimError_ = function(e) {\n    return {\n      name: {\n        InternalError: 'NotReadableError',\n        NotSupportedError: 'TypeError',\n        PermissionDeniedError: 'NotAllowedError',\n        SecurityError: 'NotAllowedError'\n      }[e.name] || e.name,\n      message: {\n        'The operation is insecure.': 'The request is not allowed by the ' +\n        'user agent or the platform in the current context.'\n      }[e.message] || e.message,\n      constraint: e.constraint,\n      toString: function() {\n        return this.name + (this.message && ': ') + this.message;\n      }\n    };\n  };\n\n  // getUserMedia constraints shim.\n  var getUserMedia_ = function(constraints, onSuccess, onError) {\n    var constraintsToFF37_ = function(c) {\n      if (typeof c !== 'object' || c.require) {\n        return c;\n      }\n      var require = [];\n      Object.keys(c).forEach(function(key) {\n        if (key === 'require' || key === 'advanced' || key === 'mediaSource') {\n          return;\n        }\n        var r = c[key] = (typeof c[key] === 'object') ?\n            c[key] : {ideal: c[key]};\n        if (r.min !== undefined ||\n            r.max !== undefined || r.exact !== undefined) {\n          require.push(key);\n        }\n        if (r.exact !== undefined) {\n          if (typeof r.exact === 'number') {\n            r. min = r.max = r.exact;\n          } else {\n            c[key] = r.exact;\n          }\n          delete r.exact;\n        }\n        if (r.ideal !== undefined) {\n          c.advanced = c.advanced || [];\n          var oc = {};\n          if (typeof r.ideal === 'number') {\n            oc[key] = {min: r.ideal, max: r.ideal};\n          } else {\n            oc[key] = r.ideal;\n          }\n          c.advanced.push(oc);\n          delete r.ideal;\n          if (!Object.keys(r).length) {\n            delete c[key];\n          }\n        }\n      });\n      if (require.length) {\n        c.require = require;\n      }\n      return c;\n    };\n    constraints = JSON.parse(JSON.stringify(constraints));\n    if (browserDetails.version < 38) {\n      logging('spec: ' + JSON.stringify(constraints));\n      if (constraints.audio) {\n        constraints.audio = constraintsToFF37_(constraints.audio);\n      }\n      if (constraints.video) {\n        constraints.video = constraintsToFF37_(constraints.video);\n      }\n      logging('ff37: ' + JSON.stringify(constraints));\n    }\n    return navigator.mozGetUserMedia(constraints, onSuccess, function(e) {\n      onError(shimError_(e));\n    });\n  };\n\n  // Returns the result of getUserMedia as a Promise.\n  var getUserMediaPromise_ = function(constraints) {\n    return new Promise(function(resolve, reject) {\n      getUserMedia_(constraints, resolve, reject);\n    });\n  };\n\n  // Shim for mediaDevices on older versions.\n  if (!navigator.mediaDevices) {\n    navigator.mediaDevices = {getUserMedia: getUserMediaPromise_,\n      addEventListener: function() { },\n      removeEventListener: function() { }\n    };\n  }\n  navigator.mediaDevices.enumerateDevices =\n      navigator.mediaDevices.enumerateDevices || function() {\n        return new Promise(function(resolve) {\n          var infos = [\n            {kind: 'audioinput', deviceId: 'default', label: '', groupId: ''},\n            {kind: 'videoinput', deviceId: 'default', label: '', groupId: ''}\n          ];\n          resolve(infos);\n        });\n      };\n\n  if (browserDetails.version < 41) {\n    // Work around http://bugzil.la/1169665\n    var orgEnumerateDevices =\n        navigator.mediaDevices.enumerateDevices.bind(navigator.mediaDevices);\n    navigator.mediaDevices.enumerateDevices = function() {\n      return orgEnumerateDevices().then(undefined, function(e) {\n        if (e.name === 'NotFoundError') {\n          return [];\n        }\n        throw e;\n      });\n    };\n  }\n  if (browserDetails.version < 49) {\n    var origGetUserMedia = navigator.mediaDevices.getUserMedia.\n        bind(navigator.mediaDevices);\n    navigator.mediaDevices.getUserMedia = function(c) {\n      return origGetUserMedia(c).then(function(stream) {\n        // Work around https://bugzil.la/802326\n        if (c.audio && !stream.getAudioTracks().length ||\n            c.video && !stream.getVideoTracks().length) {\n          stream.getTracks().forEach(function(track) {\n            track.stop();\n          });\n          throw new DOMException('The object can not be found here.',\n                                 'NotFoundError');\n        }\n        return stream;\n      }, function(e) {\n        return Promise.reject(shimError_(e));\n      });\n    };\n  }\n  if (!(browserDetails.version > 55 &&\n      'autoGainControl' in navigator.mediaDevices.getSupportedConstraints())) {\n    var remap = function(obj, a, b) {\n      if (a in obj && !(b in obj)) {\n        obj[b] = obj[a];\n        delete obj[a];\n      }\n    };\n\n    var nativeGetUserMedia = navigator.mediaDevices.getUserMedia.\n        bind(navigator.mediaDevices);\n    navigator.mediaDevices.getUserMedia = function(c) {\n      if (typeof c === 'object' && typeof c.audio === 'object') {\n        c = JSON.parse(JSON.stringify(c));\n        remap(c.audio, 'autoGainControl', 'mozAutoGainControl');\n        remap(c.audio, 'noiseSuppression', 'mozNoiseSuppression');\n      }\n      return nativeGetUserMedia(c);\n    };\n\n    if (MediaStreamTrack && MediaStreamTrack.prototype.getSettings) {\n      var nativeGetSettings = MediaStreamTrack.prototype.getSettings;\n      MediaStreamTrack.prototype.getSettings = function() {\n        var obj = nativeGetSettings.apply(this, arguments);\n        remap(obj, 'mozAutoGainControl', 'autoGainControl');\n        remap(obj, 'mozNoiseSuppression', 'noiseSuppression');\n        return obj;\n      };\n    }\n\n    if (MediaStreamTrack && MediaStreamTrack.prototype.applyConstraints) {\n      var nativeApplyConstraints = MediaStreamTrack.prototype.applyConstraints;\n      MediaStreamTrack.prototype.applyConstraints = function(c) {\n        if (this.kind === 'audio' && typeof c === 'object') {\n          c = JSON.parse(JSON.stringify(c));\n          remap(c, 'autoGainControl', 'mozAutoGainControl');\n          remap(c, 'noiseSuppression', 'mozNoiseSuppression');\n        }\n        return nativeApplyConstraints.apply(this, [c]);\n      };\n    }\n  }\n  navigator.getUserMedia = function(constraints, onSuccess, onError) {\n    if (browserDetails.version < 44) {\n      return getUserMedia_(constraints, onSuccess, onError);\n    }\n    // Replace Firefox 44+'s deprecation warning with unprefixed version.\n    utils.deprecated('navigator.getUserMedia',\n        'navigator.mediaDevices.getUserMedia');\n    navigator.mediaDevices.getUserMedia(constraints).then(onSuccess, onError);\n  };\n};\n\n},{\"../utils\":13}],12:[function(require,module,exports){\n/*\n *  Copyright (c) 2016 The WebRTC project authors. All Rights Reserved.\n *\n *  Use of this source code is governed by a BSD-style license\n *  that can be found in the LICENSE file in the root of the source\n *  tree.\n */\n'use strict';\nvar utils = require('../utils');\n\nmodule.exports = {\n  shimLocalStreamsAPI: function(window) {\n    if (typeof window !== 'object' || !window.RTCPeerConnection) {\n      return;\n    }\n    if (!('getLocalStreams' in window.RTCPeerConnection.prototype)) {\n      window.RTCPeerConnection.prototype.getLocalStreams = function() {\n        if (!this._localStreams) {\n          this._localStreams = [];\n        }\n        return this._localStreams;\n      };\n    }\n    if (!('getStreamById' in window.RTCPeerConnection.prototype)) {\n      window.RTCPeerConnection.prototype.getStreamById = function(id) {\n        var result = null;\n        if (this._localStreams) {\n          this._localStreams.forEach(function(stream) {\n            if (stream.id === id) {\n              result = stream;\n            }\n          });\n        }\n        if (this._remoteStreams) {\n          this._remoteStreams.forEach(function(stream) {\n            if (stream.id === id) {\n              result = stream;\n            }\n          });\n        }\n        return result;\n      };\n    }\n    if (!('addStream' in window.RTCPeerConnection.prototype)) {\n      var _addTrack = window.RTCPeerConnection.prototype.addTrack;\n      window.RTCPeerConnection.prototype.addStream = function(stream) {\n        if (!this._localStreams) {\n          this._localStreams = [];\n        }\n        if (this._localStreams.indexOf(stream) === -1) {\n          this._localStreams.push(stream);\n        }\n        var pc = this;\n        stream.getTracks().forEach(function(track) {\n          _addTrack.call(pc, track, stream);\n        });\n      };\n\n      window.RTCPeerConnection.prototype.addTrack = function(track, stream) {\n        if (stream) {\n          if (!this._localStreams) {\n            this._localStreams = [stream];\n          } else if (this._localStreams.indexOf(stream) === -1) {\n            this._localStreams.push(stream);\n          }\n        }\n        return _addTrack.call(this, track, stream);\n      };\n    }\n    if (!('removeStream' in window.RTCPeerConnection.prototype)) {\n      window.RTCPeerConnection.prototype.removeStream = function(stream) {\n        if (!this._localStreams) {\n          this._localStreams = [];\n        }\n        var index = this._localStreams.indexOf(stream);\n        if (index === -1) {\n          return;\n        }\n        this._localStreams.splice(index, 1);\n        var pc = this;\n        var tracks = stream.getTracks();\n        this.getSenders().forEach(function(sender) {\n          if (tracks.indexOf(sender.track) !== -1) {\n            pc.removeTrack(sender);\n          }\n        });\n      };\n    }\n  },\n  shimRemoteStreamsAPI: function(window) {\n    if (typeof window !== 'object' || !window.RTCPeerConnection) {\n      return;\n    }\n    if (!('getRemoteStreams' in window.RTCPeerConnection.prototype)) {\n      window.RTCPeerConnection.prototype.getRemoteStreams = function() {\n        return this._remoteStreams ? this._remoteStreams : [];\n      };\n    }\n    if (!('onaddstream' in window.RTCPeerConnection.prototype)) {\n      Object.defineProperty(window.RTCPeerConnection.prototype, 'onaddstream', {\n        get: function() {\n          return this._onaddstream;\n        },\n        set: function(f) {\n          if (this._onaddstream) {\n            this.removeEventListener('addstream', this._onaddstream);\n            this.removeEventListener('track', this._onaddstreampoly);\n          }\n          this.addEventListener('addstream', this._onaddstream = f);\n          this.addEventListener('track', this._onaddstreampoly = function(e) {\n            var stream = e.streams[0];\n            if (!this._remoteStreams) {\n              this._remoteStreams = [];\n            }\n            if (this._remoteStreams.indexOf(stream) >= 0) {\n              return;\n            }\n            this._remoteStreams.push(stream);\n            var event = new Event('addstream');\n            event.stream = e.streams[0];\n            this.dispatchEvent(event);\n          }.bind(this));\n        }\n      });\n    }\n  },\n  shimCallbacksAPI: function(window) {\n    if (typeof window !== 'object' || !window.RTCPeerConnection) {\n      return;\n    }\n    var prototype = window.RTCPeerConnection.prototype;\n    var createOffer = prototype.createOffer;\n    var createAnswer = prototype.createAnswer;\n    var setLocalDescription = prototype.setLocalDescription;\n    var setRemoteDescription = prototype.setRemoteDescription;\n    var addIceCandidate = prototype.addIceCandidate;\n\n    prototype.createOffer = function(successCallback, failureCallback) {\n      var options = (arguments.length >= 2) ? arguments[2] : arguments[0];\n      var promise = createOffer.apply(this, [options]);\n      if (!failureCallback) {\n        return promise;\n      }\n      promise.then(successCallback, failureCallback);\n      return Promise.resolve();\n    };\n\n    prototype.createAnswer = function(successCallback, failureCallback) {\n      var options = (arguments.length >= 2) ? arguments[2] : arguments[0];\n      var promise = createAnswer.apply(this, [options]);\n      if (!failureCallback) {\n        return promise;\n      }\n      promise.then(successCallback, failureCallback);\n      return Promise.resolve();\n    };\n\n    var withCallback = function(description, successCallback, failureCallback) {\n      var promise = setLocalDescription.apply(this, [description]);\n      if (!failureCallback) {\n        return promise;\n      }\n      promise.then(successCallback, failureCallback);\n      return Promise.resolve();\n    };\n    prototype.setLocalDescription = withCallback;\n\n    withCallback = function(description, successCallback, failureCallback) {\n      var promise = setRemoteDescription.apply(this, [description]);\n      if (!failureCallback) {\n        return promise;\n      }\n      promise.then(successCallback, failureCallback);\n      return Promise.resolve();\n    };\n    prototype.setRemoteDescription = withCallback;\n\n    withCallback = function(candidate, successCallback, failureCallback) {\n      var promise = addIceCandidate.apply(this, [candidate]);\n      if (!failureCallback) {\n        return promise;\n      }\n      promise.then(successCallback, failureCallback);\n      return Promise.resolve();\n    };\n    prototype.addIceCandidate = withCallback;\n  },\n  shimGetUserMedia: function(window) {\n    var navigator = window && window.navigator;\n\n    if (!navigator.getUserMedia) {\n      if (navigator.webkitGetUserMedia) {\n        navigator.getUserMedia = navigator.webkitGetUserMedia.bind(navigator);\n      } else if (navigator.mediaDevices &&\n          navigator.mediaDevices.getUserMedia) {\n        navigator.getUserMedia = function(constraints, cb, errcb) {\n          navigator.mediaDevices.getUserMedia(constraints)\n          .then(cb, errcb);\n        }.bind(navigator);\n      }\n    }\n  },\n  shimRTCIceServerUrls: function(window) {\n    // migrate from non-spec RTCIceServer.url to RTCIceServer.urls\n    var OrigPeerConnection = window.RTCPeerConnection;\n    window.RTCPeerConnection = function(pcConfig, pcConstraints) {\n      if (pcConfig && pcConfig.iceServers) {\n        var newIceServers = [];\n        for (var i = 0; i < pcConfig.iceServers.length; i++) {\n          var server = pcConfig.iceServers[i];\n          if (!server.hasOwnProperty('urls') &&\n              server.hasOwnProperty('url')) {\n            utils.deprecated('RTCIceServer.url', 'RTCIceServer.urls');\n            server = JSON.parse(JSON.stringify(server));\n            server.urls = server.url;\n            delete server.url;\n            newIceServers.push(server);\n          } else {\n            newIceServers.push(pcConfig.iceServers[i]);\n          }\n        }\n        pcConfig.iceServers = newIceServers;\n      }\n      return new OrigPeerConnection(pcConfig, pcConstraints);\n    };\n    window.RTCPeerConnection.prototype = OrigPeerConnection.prototype;\n    // wrap static methods. Currently just generateCertificate.\n    if ('generateCertificate' in window.RTCPeerConnection) {\n      Object.defineProperty(window.RTCPeerConnection, 'generateCertificate', {\n        get: function() {\n          return OrigPeerConnection.generateCertificate;\n        }\n      });\n    }\n  },\n  shimTrackEventTransceiver: function(window) {\n    // Add event.transceiver member over deprecated event.receiver\n    if (typeof window === 'object' && window.RTCPeerConnection &&\n        ('receiver' in window.RTCTrackEvent.prototype) &&\n        // can't check 'transceiver' in window.RTCTrackEvent.prototype, as it is\n        // defined for some reason even when window.RTCTransceiver is not.\n        !window.RTCTransceiver) {\n      Object.defineProperty(window.RTCTrackEvent.prototype, 'transceiver', {\n        get: function() {\n          return {receiver: this.receiver};\n        }\n      });\n    }\n  },\n\n  shimCreateOfferLegacy: function(window) {\n    var origCreateOffer = window.RTCPeerConnection.prototype.createOffer;\n    window.RTCPeerConnection.prototype.createOffer = function(offerOptions) {\n      var pc = this;\n      if (offerOptions) {\n        var audioTransceiver = pc.getTransceivers().find(function(transceiver) {\n          return transceiver.sender.track &&\n              transceiver.sender.track.kind === 'audio';\n        });\n        if (offerOptions.offerToReceiveAudio === false && audioTransceiver) {\n          if (audioTransceiver.direction === 'sendrecv') {\n            audioTransceiver.setDirection('sendonly');\n          } else if (audioTransceiver.direction === 'recvonly') {\n            audioTransceiver.setDirection('inactive');\n          }\n        } else if (offerOptions.offerToReceiveAudio === true &&\n            !audioTransceiver) {\n          pc.addTransceiver('audio');\n        }\n\n        var videoTransceiver = pc.getTransceivers().find(function(transceiver) {\n          return transceiver.sender.track &&\n              transceiver.sender.track.kind === 'video';\n        });\n        if (offerOptions.offerToReceiveVideo === false && videoTransceiver) {\n          if (videoTransceiver.direction === 'sendrecv') {\n            videoTransceiver.setDirection('sendonly');\n          } else if (videoTransceiver.direction === 'recvonly') {\n            videoTransceiver.setDirection('inactive');\n          }\n        } else if (offerOptions.offerToReceiveVideo === true &&\n            !videoTransceiver) {\n          pc.addTransceiver('video');\n        }\n      }\n      return origCreateOffer.apply(pc, arguments);\n    };\n  }\n};\n\n},{\"../utils\":13}],13:[function(require,module,exports){\n/*\n *  Copyright (c) 2016 The WebRTC project authors. All Rights Reserved.\n *\n *  Use of this source code is governed by a BSD-style license\n *  that can be found in the LICENSE file in the root of the source\n *  tree.\n */\n /* eslint-env node */\n'use strict';\n\nvar logDisabled_ = true;\nvar deprecationWarnings_ = true;\n\n/**\n * Extract browser version out of the provided user agent string.\n *\n * @param {!string} uastring userAgent string.\n * @param {!string} expr Regular expression used as match criteria.\n * @param {!number} pos position in the version string to be returned.\n * @return {!number} browser version.\n */\nfunction extractVersion(uastring, expr, pos) {\n  var match = uastring.match(expr);\n  return match && match.length >= pos && parseInt(match[pos], 10);\n}\n\n// Utility methods.\nmodule.exports = {\n  extractVersion: extractVersion,\n  disableLog: function(bool) {\n    if (typeof bool !== 'boolean') {\n      return new Error('Argument type: ' + typeof bool +\n          '. Please use a boolean.');\n    }\n    logDisabled_ = bool;\n    return (bool) ? 'adapter.js logging disabled' :\n        'adapter.js logging enabled';\n  },\n\n  /**\n   * Disable or enable deprecation warnings\n   * @param {!boolean} bool set to true to disable warnings.\n   */\n  disableWarnings: function(bool) {\n    if (typeof bool !== 'boolean') {\n      return new Error('Argument type: ' + typeof bool +\n          '. Please use a boolean.');\n    }\n    deprecationWarnings_ = !bool;\n    return 'adapter.js deprecation warnings ' + (bool ? 'disabled' : 'enabled');\n  },\n\n  log: function() {\n    if (typeof window === 'object') {\n      if (logDisabled_) {\n        return;\n      }\n      if (typeof console !== 'undefined' && typeof console.log === 'function') {\n        console.log.apply(console, arguments);\n      }\n    }\n  },\n\n  /**\n   * Shows a deprecation warning suggesting the modern and spec-compatible API.\n   */\n  deprecated: function(oldMethod, newMethod) {\n    if (!deprecationWarnings_) {\n      return;\n    }\n    console.warn(oldMethod + ' is deprecated, please use ' + newMethod +\n        ' instead.');\n  },\n\n  /**\n   * Browser detector.\n   *\n   * @return {object} result containing browser and version\n   *     properties.\n   */\n  detectBrowser: function(window) {\n    var navigator = window && window.navigator;\n\n    // Returned result object.\n    var result = {};\n    result.browser = null;\n    result.version = null;\n\n    // Fail early if it's not a browser\n    if (typeof window === 'undefined' || !window.navigator) {\n      result.browser = 'Not a browser.';\n      return result;\n    }\n\n    // Firefox.\n    if (navigator.mozGetUserMedia) {\n      result.browser = 'firefox';\n      result.version = extractVersion(navigator.userAgent,\n          /Firefox\\/(\\d+)\\./, 1);\n    } else if (navigator.webkitGetUserMedia) {\n      // Chrome, Chromium, Webview, Opera, all use the chrome shim for now\n      if (window.webkitRTCPeerConnection) {\n        result.browser = 'chrome';\n        result.version = extractVersion(navigator.userAgent,\n          /Chrom(e|ium)\\/(\\d+)\\./, 2);\n      } else { // Safari (in an unpublished version) or unknown webkit-based.\n        if (navigator.userAgent.match(/Version\\/(\\d+).(\\d+)/)) {\n          result.browser = 'safari';\n          result.version = extractVersion(navigator.userAgent,\n            /AppleWebKit\\/(\\d+)\\./, 1);\n        } else { // unknown webkit-based browser.\n          result.browser = 'Unsupported webkit-based browser ' +\n              'with GUM support but no WebRTC support.';\n          return result;\n        }\n      }\n    } else if (navigator.mediaDevices &&\n        navigator.userAgent.match(/Edge\\/(\\d+).(\\d+)$/)) { // Edge.\n      result.browser = 'edge';\n      result.version = extractVersion(navigator.userAgent,\n          /Edge\\/(\\d+).(\\d+)$/, 2);\n    } else if (navigator.mediaDevices &&\n        navigator.userAgent.match(/AppleWebKit\\/(\\d+)\\./)) {\n        // Safari, with webkitGetUserMedia removed.\n      result.browser = 'safari';\n      result.version = extractVersion(navigator.userAgent,\n          /AppleWebKit\\/(\\d+)\\./, 1);\n    } else { // Default fallthrough: not supported.\n      result.browser = 'Not a supported browser.';\n      return result;\n    }\n\n    return result;\n  }\n};\n\n},{}]},{},[3])(3)\n});\n\n\n// WEBPACK FOOTER //\n// ./node_modules/webrtc-adapter/out/adapter.js","var g;\r\n\r\n// This works in non-strict mode\r\ng = (function() {\r\n\treturn this;\r\n})();\r\n\r\ntry {\r\n\t// This works if eval is allowed (see CSP)\r\n\tg = g || Function(\"return this\")() || (1,eval)(\"this\");\r\n} catch(e) {\r\n\t// This works if the window reference is available\r\n\tif(typeof window === \"object\")\r\n\t\tg = window;\r\n}\r\n\r\n// g can still be undefined, but nothing to do about it...\r\n// We return undefined, instead of nothing here, so it's\r\n// easier to handle this case. if(!global) { ...}\r\n\r\nmodule.exports = g;\r\n\n\n\n// WEBPACK FOOTER //\n// (webpack)/buildin/global.js","import Component from '../Component';\n\nconst Error = new Component('Error', {\n  message: ''\n})\n\nError.render(state => {\n  Error.dom.textContent = state.message;\n});\n\n\nexport default Error;\n\n\n\n\n\n// WEBPACK FOOTER //\n// ./src/components/Error.js","import Component from '../Component';\nimport CameraScreen from './CameraScreen';\n\nconst ButtonCameraPower = new Component('ButtonCameraPower');\n\nButtonCameraPower.on('click', function(evt) {\n  if (CameraScreen.getState().show) {\n    CameraScreen.setState({show: false});\n    ButtonCameraPower.dom.textContent = 'On';\n  } else {\n    CameraScreen.setState({show: true});\n    ButtonCameraPower.dom.textContent = 'Off';\n  }\n})\n\nexport default ButtonCameraPower;\n\n\n\n// WEBPACK FOOTER //\n// ./src/components/ButtonCameraPower.js","import Component from '../Component';\nimport CameraScreen from './CameraScreen';\n\nconst ButtonCameraFacing = new Component('ButtonCameraFacing');\n\nButtonCameraFacing.on('click', function(evt) {\n  console.log('clicked')\n  if (CameraScreen.getState().facingMode === 'user') {\n    CameraScreen.setState({facingMode: 'environment'});\n    ButtonCameraFacing.dom.textContent = 'Switch to Front';\n  } else {\n    CameraScreen.setState({facingMode: 'user'});\n    ButtonCameraFacing.dom.textContent = 'Switch to Rear';\n  }\n})\n\nexport default ButtonCameraFacing;\n\n\n\n// WEBPACK FOOTER //\n// ./src/components/ButtonCameraFacing.js"],"sourceRoot":""}