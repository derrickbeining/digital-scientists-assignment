{"version":3,"sources":["webpack:///webpack/bootstrap bfd5e40ef8aa22f4de7e","webpack:///./src/Component.js","webpack:///./src/components/CameraScreen.js","webpack:///./src/components/Canvas.js","webpack:///./src/index.js","webpack:///./node_modules/webrtc-adapter/out/adapter.js","webpack:///(webpack)/buildin/global.js","webpack:///./src/components/ButtonCameraPower.js","webpack:///./src/components/Error.js","webpack:///./src/mediaDevice.js","webpack:///./src/components/ButtonCameraFacing.js","webpack:///./src/components/ButtonCameraCapture.js","webpack:///./src/components/ButtonReadResult.js"],"names":["merge","one","two","Object","assign","Component","id","defaultState","state","getState","setState","arg","renderer","dom","document","getElementById","noop","classname","classList","add","remove","toggle","event","eventHandler","options","addEventListener","fn","CameraScreen","show","facingMode","render","then","addClass","catch","message","err","name","removeClass","Canvas","clearPhoto","ctx","getContext","fillStyle","fillRect","width","height","takePicture","cameraScreen","offsetHeight","offsetWidth","drawImage","Promise","toBlob","blob","fulfillWith","f","exports","module","define","g","window","global","self","adapter","e","t","n","r","s","o","u","a","require","i","Error","code","l","call","length","SDPUtils","writeMediaSection","transceiver","caps","type","stream","dtlsRole","sdp","writeRtpDescription","kind","writeIceParameters","iceGatherer","getLocalParameters","writeDtlsParameters","dtlsTransport","mid","rtpSender","rtpReceiver","msid","track","sendEncodingParameters","ssrc","rtx","localCName","filterIceServers","iceServers","edgeVersion","hasTurn","JSON","parse","stringify","filter","server","urls","url","console","warn","isString","validTurn","indexOf","getCommonCapabilities","localCapabilities","remoteCapabilities","commonCapabilities","codecs","headerExtensions","fecMechanisms","findCodecByPayloadType","pt","parseInt","payloadType","preferredPayloadType","rtxCapabilityMatches","lRtx","rRtx","lCodecs","rCodecs","lCodec","parameters","apt","rCodec","toLowerCase","forEach","clockRate","numChannels","Math","min","push","rtcpFeedback","fb","j","parameter","lHeaderExtension","rHeaderExtension","uri","isActionAllowedInSignalingState","action","signalingState","offer","setLocalDescription","setRemoteDescription","answer","maybeAddCandidate","iceTransport","candidate","alreadyAdded","getRemoteCandidates","find","remoteCandidate","foundation","ip","port","priority","protocol","addRemoteCandidate","addTrackToStreamAndFireEvent","addTrack","Event","dispatchEvent","removeTrackFromStreamAndFireEvent","removeTrack","fireAddTrack","pc","receiver","streams","trackEvent","setTimeout","_dispatchEvent","makeError","description","RTCPeerConnection","config","_eventTarget","createDocumentFragment","method","bind","canTrickleIceCandidates","needNegotiation","localStreams","remoteStreams","localDescription","remoteDescription","iceConnectionState","iceGatheringState","usingBundle","bundlePolicy","rtcpMuxPolicy","iceTransportPolicy","_iceGatherers","iceCandidatePoolSize","RTCIceGatherer","gatherPolicy","_config","transceivers","_sdpSessionId","generateSessionId","_sdpSessionVersion","_dtlsRole","undefined","_isClosed","prototype","onicecandidate","onaddstream","ontrack","onremovestream","onsignalingstatechange","oniceconnectionstatechange","onicegatheringstatechange","onnegotiationneeded","ondatachannel","_emitGatheringStateChange","getConfiguration","getLocalStreams","getRemoteStreams","_createTransceiver","hasBundleTransport","recvEncodingParameters","associatedRemoteMediaStreams","wantReceive","transports","_createIceAndDtlsTransports","alreadyExists","_maybeFireNegotiationNeeded","RTCRtpSender","addStream","getTracks","clonedStream","clone","idx","clonedTrack","enabled","sender","TypeError","stop","map","splice","removeStream","getSenders","getReceivers","_createIceGatherer","sdpMLineIndex","shift","defineProperty","value","writable","candidates","bufferCandidates","end","keys","_gather","onlocalcandidate","removeEventListener","evt","sdpMid","cand","component","writeCandidate","sections","splitSections","join","complete","every","RTCIceTransport","onicestatechange","_updateConnectionState","RTCDtlsTransport","ondtlsstatechange","onerror","_disposeIceAndDtlsTransports","_transceive","send","recv","params","encodings","rtcp","cname","compound","rtcpParameters","p","receive","reject","sessionpart","mediaSection","parseRtpParameters","isIceLite","matchPrefix","rejected","isRejected","isDatachannel","remoteIceParameters","getIceParameters","remoteDtlsParameters","getDtlsParameters","role","start","_updateSignalingState","resolve","receiverList","iceOptions","substr","split","lines","splitLines","getKind","direction","getDirection","remoteMsid","parseMsid","getMid","generateIdentifier","parseRtpEncodingParameters","parseRtcpParameters","isComplete","cands","parseCandidate","setTransport","setRemoteCandidates","RTCRtpReceiver","getCapabilities","codec","isNewTrack","MediaStream","get","default","nativeTrack","sid","item","close","newState","states","closed","connecting","checking","connected","completed","disconnected","failed","new","createOffer","numAudioTracks","numVideoTracks","offerOptions","arguments","mandatory","optional","offerToReceiveAudio","offerToReceiveVideo","writeSessionBoilerplate","getLocalCandidates","desc","RTCSessionDescription","createAnswer","mediaSectionsInOffer","localTrack","getAudioTracks","getVideoTracks","hasRtx","c","reducedSize","addIceCandidate","candidateString","trim","getStats","promises","fixStatsType","stat","inboundrtp","outboundrtp","candidatepair","localcandidate","remotecandidate","results","Map","all","res","result","set","methods","nativeMethod","args","apply","error","random","toString","line","parts","part","index","prefix","substring","relatedAddress","relatedPort","tcpType","ufrag","usernameFragment","toUpperCase","parseIceOptions","parseRtpMap","parsed","writeRtpMap","parseExtmap","writeExtmap","headerExtension","preferredId","parseFmtp","kv","writeFmtp","param","parseRtcpFb","writeRtcpFb","parseSsrcMedia","sp","colon","attribute","parseFingerprint","algorithm","fingerprints","setupType","fp","concat","iceParameters","password","mline","rtpmapline","fmtps","maxptime","extension","encodingParameters","hasRed","hasUlpfec","ssrcs","primarySsrc","secondarySsrc","flows","encParam","codecPayloadType","fec","mechanism","bandwidth","maxBitrate","remoteSsrc","obj","rsize","mux","spec","planB","sessId","sessVer","sessionId","version","parseMLine","fmt","slice","adapterFactory","utils","dependencies","opts","shimChrome","shimFirefox","shimEdge","shimSafari","key","hasOwnProperty","logging","log","browserDetails","detectBrowser","extractVersion","disableLog","disableWarnings","chromeShim","edgeShim","firefoxShim","safariShim","commonShim","browser","shimPeerConnection","browserShim","shimCreateObjectURL","shimGetUserMedia","shimMediaStream","shimSourceObject","shimOnTrack","shimAddTrackRemoveTrack","shimGetSendersWithDtmf","shimRTCIceCandidate","shimRemoveStream","shimReplaceTrack","shimRTCIceServerUrls","shimCallbacksAPI","shimLocalStreamsAPI","shimRemoteStreamsAPI","shimTrackEventTransceiver","shimCreateOfferLegacy","webkitMediaStream","_ontrack","origSetRemoteDescription","_ontrackpoly","te","shimSenderWithDtmf","dtmf","_dtmf","createDTMFSender","_pc","_senders","origAddTrack","origRemoveTrack","origAddStream","origRemoveStream","origGetSenders","senders","URL","HTMLMediaElement","_srcObject","src","revokeObjectURL","createObjectURL","shimAddTrackRemoveTrackWithNative","_shimmedLocalStreams","streamId","DOMException","existingSenders","newSenders","newSender","origGetLocalStreams","nativeStreams","_reverseStreams","_streams","newStream","oldStream","replaceInternalStreamId","internalId","externalStream","internalStream","replace","RegExp","replaceExternalStreamId","isLegacyCall","origSetLocalDescription","origLocalDescription","getOwnPropertyDescriptor","isLocal","streamid","hasTrack","pcConfig","pcConstraints","iceTransports","webkitRTCPeerConnection","generateCertificate","OrigPeerConnection","newIceServers","deprecated","origGetStats","selector","successCallback","errorCallback","fixChromeStats_","response","standardReport","reports","report","standardStats","timestamp","names","makeMapStats","stats","successCallbackWrapper_","promise","RTCIceCandidate","nativeAddIceCandidate","navigator","constraintsToChrome_","cc","ideal","exact","max","oldname_","charAt","oc","mix","advanced","shimConstraints_","constraints","func","audio","remap","b","video","face","getSupportedFacingModeLies","mediaDevices","getSupportedConstraints","matches","enumerateDevices","devices","d","dev","some","match","label","deviceId","shimError_","PermissionDeniedError","InvalidStateError","DevicesNotFoundError","ConstraintNotSatisfiedError","TrackStartError","MediaDeviceFailedDueToShutdown","MediaDeviceKillSwitchOn","constraint","constraintName","getUserMedia_","onSuccess","onError","webkitGetUserMedia","getUserMedia","getUserMediaPromise_","kinds","MediaStreamTrack","getSources","device","groupId","echoCancellation","frameRate","origGetUserMedia","cs","wrapPeerConnectionEvent","eventNameToWrap","wrapper","proto","nativeAddEventListener","nativeEventName","cb","wrappedCallback","_eventMap","nativeRemoveEventListener","unwrappedCb","NativeRTCIceCandidate","nativeCandidate","parsedCandidate","augmentedCandidate","toJSON","nativeCreateObjectURL","nativeRevokeObjectURL","newId","delete","dsc","srcObject","nativeSetAttribute","setAttribute","shimRTCPeerConnection","origMSTEnabled","ev","RTCDtmfSender","replaceTrack","setTrack","RTCTrackEvent","mozSrcObject","mozRTCPeerConnection","newServer","username","credential","mozRTCSessionDescription","mozRTCIceCandidate","modernStatsTypes","nativeGetStats","onSucc","onErr","InternalError","NotSupportedError","SecurityError","constraintsToFF37_","mozGetUserMedia","infos","orgEnumerateDevices","nativeGetUserMedia","getSettings","nativeGetSettings","applyConstraints","nativeApplyConstraints","_localStreams","getStreamById","_remoteStreams","_addTrack","tracks","_onaddstream","_onaddstreampoly","failureCallback","withCallback","errcb","RTCTransceiver","origCreateOffer","audioTransceiver","getTransceivers","setDirection","addTransceiver","videoTransceiver","logDisabled_","deprecationWarnings_","uastring","expr","pos","bool","oldMethod","newMethod","userAgent","Function","eval","ButtonCameraPower","on","textContent","hasMediaDeviceAPI","startingCamera","stopCamera","Boolean","isMobileDevice","search","generateConstraints","supportedConstraints","aspectRatio","mediaStream","play","ButtonCameraFacing","ButtonCameraCapture","sendImageForAnalysis","imageData","headers","Headers","append","fetch","mode","cache","body","image","json","data","labelAnnotations","fileReader","FileReader","readAsDataURL","imageBlob","ButtonReadResult","speakResult","utterance","SpeechSynthesisUtterance","speechSynthesis","speak"],"mappings":"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","file":"main.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, {\n \t\t\t\tconfigurable: false,\n \t\t\t\tenumerable: true,\n \t\t\t\tget: getter\n \t\t\t});\n \t\t}\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 3);\n\n\n\n// WEBPACK FOOTER //\n// webpack/bootstrap bfd5e40ef8aa22f4de7e","\nfunction merge(one, two) {\n  return Object.assign({}, one, two);\n}\n\nexport default class Component {\n\n  constructor(id, defaultState = {}) {\n\n    let state = defaultState;\n\n    const getState = () => state;\n\n    const setState = arg => {\n      if (typeof arg === 'function') {\n        setState(arg(getState()));\n      } else {\n        state = merge(state, arg);\n        this.renderer(getState())\n      }\n    }\n\n    this.dom = document.getElementById(id);\n    this.getState = getState;\n    this.setState = setState;\n    this.renderer = function noop() { };\n  }\n\n  addClass(classname) {\n    this.dom.classList.add(classname);\n  }\n\n  removeClass(classname) {\n    this.dom.classList.remove(classname);\n  }\n\n  toggleClass(classname) {\n    this.dom.classList.toggle(classname);\n  }\n\n  on(event, eventHandler, options = false) {\n    return this.dom.addEventListener(event, eventHandler, options);\n  }\n\n  render(fn) {\n    this.renderer = fn;\n    fn(this.getState());\n  }\n\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/Component.js","import Component from '../Component';\nimport Error from './Error';\nimport {hasMediaDeviceAPI, startingCamera, stopCamera} from '../mediaDevice';\n\nconst CameraScreen = new Component('CameraScreen', {\n  show: false,\n  facingMode: 'environment'\n})\n\nCameraScreen.render((state) => {\n  const {show, facingMode} = state;\n  if (hasMediaDeviceAPI()) {\n\n    if (show) {\n      startingCamera(CameraScreen.dom, facingMode)\n        .then(() => CameraScreen.addClass('camera__screen--show'))\n        .catch(err => Error.setState({message: `${err.name}: \\n${err.message}`}))\n    }\n\n    else {\n      stopCamera(CameraScreen.dom);\n      CameraScreen.removeClass('camera__screen--show');\n    }\n  }\n})\n\nexport default CameraScreen;\n\n\n\n// WEBPACK FOOTER //\n// ./src/components/CameraScreen.js","import Component from '../Component';\nimport CameraScreen from './CameraScreen';\n\nconst Canvas = new Component('Canvas');\n\n\n\nCanvas.clearPhoto = function clearPhoto() {\n  // application/octet-stream\n  const ctx = this.dom.getContext('2d');\n  ctx.fillStyle = '#fff';\n  ctx.fillRect(0, 0, this.dom.width, this.dom.height);\n}\n\nCanvas.takePicture = function takePicture(cameraScreen) {\n  const ctx = this.dom.getContext('2d');\n  this.dom.height = cameraScreen.offsetHeight;\n  this.dom.width = cameraScreen.offsetWidth;\n  ctx.drawImage(cameraScreen, 0, 0, this.dom.width, this.dom.height);\n\n  return new Promise(fulfillWith => {\n    Canvas.dom.toBlob(function(blob) {\n      fulfillWith(blob)\n    });\n  })\n\n}\n\nexport default Canvas;\n\n\n\n// WEBPACK FOOTER //\n// ./src/components/Canvas.js","import 'webrtc-adapter/out/adapter';\n\nimport ButtonCameraPower from './components/ButtonCameraPower';\nimport ButtonCameraFacing from './components/ButtonCameraFacing';\nimport ButtonCameraCapture from './components/ButtonCameraCapture';\nimport ButtonReadResult from './components/ButtonReadResult';\nimport Canvas from './components/Canvas';\n\n\n\n// WEBPACK FOOTER //\n// ./src/index.js","(function(f){if(typeof exports===\"object\"&&typeof module!==\"undefined\"){module.exports=f()}else if(typeof define===\"function\"&&define.amd){define([],f)}else{var g;if(typeof window!==\"undefined\"){g=window}else if(typeof global!==\"undefined\"){g=global}else if(typeof self!==\"undefined\"){g=self}else{g=this}g.adapter = f()}})(function(){var define,module,exports;return (function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require==\"function\"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error(\"Cannot find module '\"+o+\"'\");throw f.code=\"MODULE_NOT_FOUND\",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require==\"function\"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){\n/*\n *  Copyright (c) 2017 The WebRTC project authors. All Rights Reserved.\n *\n *  Use of this source code is governed by a BSD-style license\n *  that can be found in the LICENSE file in the root of the source\n *  tree.\n */\n /* eslint-env node */\n'use strict';\n\nvar SDPUtils = require('sdp');\n\nfunction writeMediaSection(transceiver, caps, type, stream, dtlsRole) {\n  var sdp = SDPUtils.writeRtpDescription(transceiver.kind, caps);\n\n  // Map ICE parameters (ufrag, pwd) to SDP.\n  sdp += SDPUtils.writeIceParameters(\n      transceiver.iceGatherer.getLocalParameters());\n\n  // Map DTLS parameters to SDP.\n  sdp += SDPUtils.writeDtlsParameters(\n      transceiver.dtlsTransport.getLocalParameters(),\n      type === 'offer' ? 'actpass' : dtlsRole || 'active');\n\n  sdp += 'a=mid:' + transceiver.mid + '\\r\\n';\n\n  if (transceiver.rtpSender && transceiver.rtpReceiver) {\n    sdp += 'a=sendrecv\\r\\n';\n  } else if (transceiver.rtpSender) {\n    sdp += 'a=sendonly\\r\\n';\n  } else if (transceiver.rtpReceiver) {\n    sdp += 'a=recvonly\\r\\n';\n  } else {\n    sdp += 'a=inactive\\r\\n';\n  }\n\n  if (transceiver.rtpSender) {\n    // spec.\n    var msid = 'msid:' + stream.id + ' ' +\n        transceiver.rtpSender.track.id + '\\r\\n';\n    sdp += 'a=' + msid;\n\n    // for Chrome.\n    sdp += 'a=ssrc:' + transceiver.sendEncodingParameters[0].ssrc +\n        ' ' + msid;\n    if (transceiver.sendEncodingParameters[0].rtx) {\n      sdp += 'a=ssrc:' + transceiver.sendEncodingParameters[0].rtx.ssrc +\n          ' ' + msid;\n      sdp += 'a=ssrc-group:FID ' +\n          transceiver.sendEncodingParameters[0].ssrc + ' ' +\n          transceiver.sendEncodingParameters[0].rtx.ssrc +\n          '\\r\\n';\n    }\n  }\n  // FIXME: this should be written by writeRtpDescription.\n  sdp += 'a=ssrc:' + transceiver.sendEncodingParameters[0].ssrc +\n      ' cname:' + SDPUtils.localCName + '\\r\\n';\n  if (transceiver.rtpSender && transceiver.sendEncodingParameters[0].rtx) {\n    sdp += 'a=ssrc:' + transceiver.sendEncodingParameters[0].rtx.ssrc +\n        ' cname:' + SDPUtils.localCName + '\\r\\n';\n  }\n  return sdp;\n}\n\n// Edge does not like\n// 1) stun: filtered after 14393 unless ?transport=udp is present\n// 2) turn: that does not have all of turn:host:port?transport=udp\n// 3) turn: with ipv6 addresses\n// 4) turn: occurring muliple times\nfunction filterIceServers(iceServers, edgeVersion) {\n  var hasTurn = false;\n  iceServers = JSON.parse(JSON.stringify(iceServers));\n  return iceServers.filter(function(server) {\n    if (server && (server.urls || server.url)) {\n      var urls = server.urls || server.url;\n      if (server.url && !server.urls) {\n        console.warn('RTCIceServer.url is deprecated! Use urls instead.');\n      }\n      var isString = typeof urls === 'string';\n      if (isString) {\n        urls = [urls];\n      }\n      urls = urls.filter(function(url) {\n        var validTurn = url.indexOf('turn:') === 0 &&\n            url.indexOf('transport=udp') !== -1 &&\n            url.indexOf('turn:[') === -1 &&\n            !hasTurn;\n\n        if (validTurn) {\n          hasTurn = true;\n          return true;\n        }\n        return url.indexOf('stun:') === 0 && edgeVersion >= 14393 &&\n            url.indexOf('?transport=udp') === -1;\n      });\n\n      delete server.url;\n      server.urls = isString ? urls[0] : urls;\n      return !!urls.length;\n    }\n  });\n}\n\n// Determines the intersection of local and remote capabilities.\nfunction getCommonCapabilities(localCapabilities, remoteCapabilities) {\n  var commonCapabilities = {\n    codecs: [],\n    headerExtensions: [],\n    fecMechanisms: []\n  };\n\n  var findCodecByPayloadType = function(pt, codecs) {\n    pt = parseInt(pt, 10);\n    for (var i = 0; i < codecs.length; i++) {\n      if (codecs[i].payloadType === pt ||\n          codecs[i].preferredPayloadType === pt) {\n        return codecs[i];\n      }\n    }\n  };\n\n  var rtxCapabilityMatches = function(lRtx, rRtx, lCodecs, rCodecs) {\n    var lCodec = findCodecByPayloadType(lRtx.parameters.apt, lCodecs);\n    var rCodec = findCodecByPayloadType(rRtx.parameters.apt, rCodecs);\n    return lCodec && rCodec &&\n        lCodec.name.toLowerCase() === rCodec.name.toLowerCase();\n  };\n\n  localCapabilities.codecs.forEach(function(lCodec) {\n    for (var i = 0; i < remoteCapabilities.codecs.length; i++) {\n      var rCodec = remoteCapabilities.codecs[i];\n      if (lCodec.name.toLowerCase() === rCodec.name.toLowerCase() &&\n          lCodec.clockRate === rCodec.clockRate) {\n        if (lCodec.name.toLowerCase() === 'rtx' &&\n            lCodec.parameters && rCodec.parameters.apt) {\n          // for RTX we need to find the local rtx that has a apt\n          // which points to the same local codec as the remote one.\n          if (!rtxCapabilityMatches(lCodec, rCodec,\n              localCapabilities.codecs, remoteCapabilities.codecs)) {\n            continue;\n          }\n        }\n        rCodec = JSON.parse(JSON.stringify(rCodec)); // deepcopy\n        // number of channels is the highest common number of channels\n        rCodec.numChannels = Math.min(lCodec.numChannels,\n            rCodec.numChannels);\n        // push rCodec so we reply with offerer payload type\n        commonCapabilities.codecs.push(rCodec);\n\n        // determine common feedback mechanisms\n        rCodec.rtcpFeedback = rCodec.rtcpFeedback.filter(function(fb) {\n          for (var j = 0; j < lCodec.rtcpFeedback.length; j++) {\n            if (lCodec.rtcpFeedback[j].type === fb.type &&\n                lCodec.rtcpFeedback[j].parameter === fb.parameter) {\n              return true;\n            }\n          }\n          return false;\n        });\n        // FIXME: also need to determine .parameters\n        //  see https://github.com/openpeer/ortc/issues/569\n        break;\n      }\n    }\n  });\n\n  localCapabilities.headerExtensions.forEach(function(lHeaderExtension) {\n    for (var i = 0; i < remoteCapabilities.headerExtensions.length;\n         i++) {\n      var rHeaderExtension = remoteCapabilities.headerExtensions[i];\n      if (lHeaderExtension.uri === rHeaderExtension.uri) {\n        commonCapabilities.headerExtensions.push(rHeaderExtension);\n        break;\n      }\n    }\n  });\n\n  // FIXME: fecMechanisms\n  return commonCapabilities;\n}\n\n// is action=setLocalDescription with type allowed in signalingState\nfunction isActionAllowedInSignalingState(action, type, signalingState) {\n  return {\n    offer: {\n      setLocalDescription: ['stable', 'have-local-offer'],\n      setRemoteDescription: ['stable', 'have-remote-offer']\n    },\n    answer: {\n      setLocalDescription: ['have-remote-offer', 'have-local-pranswer'],\n      setRemoteDescription: ['have-local-offer', 'have-remote-pranswer']\n    }\n  }[type][action].indexOf(signalingState) !== -1;\n}\n\nfunction maybeAddCandidate(iceTransport, candidate) {\n  // Edge's internal representation adds some fields therefore\n  // not all field are taken into account.\n  var alreadyAdded = iceTransport.getRemoteCandidates()\n      .find(function(remoteCandidate) {\n        return candidate.foundation === remoteCandidate.foundation &&\n            candidate.ip === remoteCandidate.ip &&\n            candidate.port === remoteCandidate.port &&\n            candidate.priority === remoteCandidate.priority &&\n            candidate.protocol === remoteCandidate.protocol &&\n            candidate.type === remoteCandidate.type;\n      });\n  if (!alreadyAdded) {\n    iceTransport.addRemoteCandidate(candidate);\n  }\n  return !alreadyAdded;\n}\n\n\n// https://w3c.github.io/mediacapture-main/#mediastream\n// Helper function to add the track to the stream and\n// dispatch the event ourselves.\nfunction addTrackToStreamAndFireEvent(track, stream) {\n  stream.addTrack(track);\n  var e = new Event('addtrack'); // TODO: MediaStreamTrackEvent\n  e.track = track;\n  stream.dispatchEvent(e);\n}\n\nfunction removeTrackFromStreamAndFireEvent(track, stream) {\n  stream.removeTrack(track);\n  var e = new Event('removetrack'); // TODO: MediaStreamTrackEvent\n  e.track = track;\n  stream.dispatchEvent(e);\n}\n\nfunction fireAddTrack(pc, track, receiver, streams) {\n  var trackEvent = new Event('track');\n  trackEvent.track = track;\n  trackEvent.receiver = receiver;\n  trackEvent.transceiver = {receiver: receiver};\n  trackEvent.streams = streams;\n  window.setTimeout(function() {\n    pc._dispatchEvent('track', trackEvent);\n  });\n}\n\nfunction makeError(name, description) {\n  var e = new Error(description);\n  e.name = name;\n  return e;\n}\n\nmodule.exports = function(window, edgeVersion) {\n  var RTCPeerConnection = function(config) {\n    var pc = this;\n\n    var _eventTarget = document.createDocumentFragment();\n    ['addEventListener', 'removeEventListener', 'dispatchEvent']\n        .forEach(function(method) {\n          pc[method] = _eventTarget[method].bind(_eventTarget);\n        });\n\n    this.canTrickleIceCandidates = null;\n\n    this.needNegotiation = false;\n\n    this.localStreams = [];\n    this.remoteStreams = [];\n\n    this.localDescription = null;\n    this.remoteDescription = null;\n\n    this.signalingState = 'stable';\n    this.iceConnectionState = 'new';\n    this.iceGatheringState = 'new';\n\n    config = JSON.parse(JSON.stringify(config || {}));\n\n    this.usingBundle = config.bundlePolicy === 'max-bundle';\n    if (config.rtcpMuxPolicy === 'negotiate') {\n      throw(makeError('NotSupportedError',\n          'rtcpMuxPolicy \\'negotiate\\' is not supported'));\n    } else if (!config.rtcpMuxPolicy) {\n      config.rtcpMuxPolicy = 'require';\n    }\n\n    switch (config.iceTransportPolicy) {\n      case 'all':\n      case 'relay':\n        break;\n      default:\n        config.iceTransportPolicy = 'all';\n        break;\n    }\n\n    switch (config.bundlePolicy) {\n      case 'balanced':\n      case 'max-compat':\n      case 'max-bundle':\n        break;\n      default:\n        config.bundlePolicy = 'balanced';\n        break;\n    }\n\n    config.iceServers = filterIceServers(config.iceServers || [], edgeVersion);\n\n    this._iceGatherers = [];\n    if (config.iceCandidatePoolSize) {\n      for (var i = config.iceCandidatePoolSize; i > 0; i--) {\n        this._iceGatherers = new window.RTCIceGatherer({\n          iceServers: config.iceServers,\n          gatherPolicy: config.iceTransportPolicy\n        });\n      }\n    } else {\n      config.iceCandidatePoolSize = 0;\n    }\n\n    this._config = config;\n\n    // per-track iceGathers, iceTransports, dtlsTransports, rtpSenders, ...\n    // everything that is needed to describe a SDP m-line.\n    this.transceivers = [];\n\n    this._sdpSessionId = SDPUtils.generateSessionId();\n    this._sdpSessionVersion = 0;\n\n    this._dtlsRole = undefined; // role for a=setup to use in answers.\n\n    this._isClosed = false;\n  };\n\n  // set up event handlers on prototype\n  RTCPeerConnection.prototype.onicecandidate = null;\n  RTCPeerConnection.prototype.onaddstream = null;\n  RTCPeerConnection.prototype.ontrack = null;\n  RTCPeerConnection.prototype.onremovestream = null;\n  RTCPeerConnection.prototype.onsignalingstatechange = null;\n  RTCPeerConnection.prototype.oniceconnectionstatechange = null;\n  RTCPeerConnection.prototype.onicegatheringstatechange = null;\n  RTCPeerConnection.prototype.onnegotiationneeded = null;\n  RTCPeerConnection.prototype.ondatachannel = null;\n\n  RTCPeerConnection.prototype._dispatchEvent = function(name, event) {\n    if (this._isClosed) {\n      return;\n    }\n    this.dispatchEvent(event);\n    if (typeof this['on' + name] === 'function') {\n      this['on' + name](event);\n    }\n  };\n\n  RTCPeerConnection.prototype._emitGatheringStateChange = function() {\n    var event = new Event('icegatheringstatechange');\n    this._dispatchEvent('icegatheringstatechange', event);\n  };\n\n  RTCPeerConnection.prototype.getConfiguration = function() {\n    return this._config;\n  };\n\n  RTCPeerConnection.prototype.getLocalStreams = function() {\n    return this.localStreams;\n  };\n\n  RTCPeerConnection.prototype.getRemoteStreams = function() {\n    return this.remoteStreams;\n  };\n\n  // internal helper to create a transceiver object.\n  // (whih is not yet the same as the WebRTC 1.0 transceiver)\n  RTCPeerConnection.prototype._createTransceiver = function(kind) {\n    var hasBundleTransport = this.transceivers.length > 0;\n    var transceiver = {\n      track: null,\n      iceGatherer: null,\n      iceTransport: null,\n      dtlsTransport: null,\n      localCapabilities: null,\n      remoteCapabilities: null,\n      rtpSender: null,\n      rtpReceiver: null,\n      kind: kind,\n      mid: null,\n      sendEncodingParameters: null,\n      recvEncodingParameters: null,\n      stream: null,\n      associatedRemoteMediaStreams: [],\n      wantReceive: true\n    };\n    if (this.usingBundle && hasBundleTransport) {\n      transceiver.iceTransport = this.transceivers[0].iceTransport;\n      transceiver.dtlsTransport = this.transceivers[0].dtlsTransport;\n    } else {\n      var transports = this._createIceAndDtlsTransports();\n      transceiver.iceTransport = transports.iceTransport;\n      transceiver.dtlsTransport = transports.dtlsTransport;\n    }\n    this.transceivers.push(transceiver);\n    return transceiver;\n  };\n\n  RTCPeerConnection.prototype.addTrack = function(track, stream) {\n    var alreadyExists = this.transceivers.find(function(s) {\n      return s.track === track;\n    });\n\n    if (alreadyExists) {\n      throw makeError('InvalidAccessError', 'Track already exists.');\n    }\n\n    if (this.signalingState === 'closed') {\n      throw makeError('InvalidStateError',\n          'Attempted to call addTrack on a closed peerconnection.');\n    }\n\n    var transceiver;\n    for (var i = 0; i < this.transceivers.length; i++) {\n      if (!this.transceivers[i].track &&\n          this.transceivers[i].kind === track.kind) {\n        transceiver = this.transceivers[i];\n      }\n    }\n    if (!transceiver) {\n      transceiver = this._createTransceiver(track.kind);\n    }\n\n    this._maybeFireNegotiationNeeded();\n\n    if (this.localStreams.indexOf(stream) === -1) {\n      this.localStreams.push(stream);\n    }\n\n    transceiver.track = track;\n    transceiver.stream = stream;\n    transceiver.rtpSender = new window.RTCRtpSender(track,\n        transceiver.dtlsTransport);\n    return transceiver.rtpSender;\n  };\n\n  RTCPeerConnection.prototype.addStream = function(stream) {\n    var pc = this;\n    if (edgeVersion >= 15025) {\n      stream.getTracks().forEach(function(track) {\n        pc.addTrack(track, stream);\n      });\n    } else {\n      // Clone is necessary for local demos mostly, attaching directly\n      // to two different senders does not work (build 10547).\n      // Fixed in 15025 (or earlier)\n      var clonedStream = stream.clone();\n      stream.getTracks().forEach(function(track, idx) {\n        var clonedTrack = clonedStream.getTracks()[idx];\n        track.addEventListener('enabled', function(event) {\n          clonedTrack.enabled = event.enabled;\n        });\n      });\n      clonedStream.getTracks().forEach(function(track) {\n        pc.addTrack(track, clonedStream);\n      });\n    }\n  };\n\n  RTCPeerConnection.prototype.removeTrack = function(sender) {\n    if (!(sender instanceof window.RTCRtpSender)) {\n      throw new TypeError('Argument 1 of RTCPeerConnection.removeTrack ' +\n          'does not implement interface RTCRtpSender.');\n    }\n\n    var transceiver = this.transceivers.find(function(t) {\n      return t.rtpSender === sender;\n    });\n\n    if (!transceiver) {\n      throw makeError('InvalidAccessError',\n          'Sender was not created by this connection.');\n    }\n    var stream = transceiver.stream;\n\n    transceiver.rtpSender.stop();\n    transceiver.rtpSender = null;\n    transceiver.track = null;\n    transceiver.stream = null;\n\n    // remove the stream from the set of local streams\n    var localStreams = this.transceivers.map(function(t) {\n      return t.stream;\n    });\n    if (localStreams.indexOf(stream) === -1 &&\n        this.localStreams.indexOf(stream) > -1) {\n      this.localStreams.splice(this.localStreams.indexOf(stream), 1);\n    }\n\n    this._maybeFireNegotiationNeeded();\n  };\n\n  RTCPeerConnection.prototype.removeStream = function(stream) {\n    var pc = this;\n    stream.getTracks().forEach(function(track) {\n      var sender = pc.getSenders().find(function(s) {\n        return s.track === track;\n      });\n      if (sender) {\n        pc.removeTrack(sender);\n      }\n    });\n  };\n\n  RTCPeerConnection.prototype.getSenders = function() {\n    return this.transceivers.filter(function(transceiver) {\n      return !!transceiver.rtpSender;\n    })\n    .map(function(transceiver) {\n      return transceiver.rtpSender;\n    });\n  };\n\n  RTCPeerConnection.prototype.getReceivers = function() {\n    return this.transceivers.filter(function(transceiver) {\n      return !!transceiver.rtpReceiver;\n    })\n    .map(function(transceiver) {\n      return transceiver.rtpReceiver;\n    });\n  };\n\n\n  RTCPeerConnection.prototype._createIceGatherer = function(sdpMLineIndex,\n      usingBundle) {\n    var pc = this;\n    if (usingBundle && sdpMLineIndex > 0) {\n      return this.transceivers[0].iceGatherer;\n    } else if (this._iceGatherers.length) {\n      return this._iceGatherers.shift();\n    }\n    var iceGatherer = new window.RTCIceGatherer({\n      iceServers: this._config.iceServers,\n      gatherPolicy: this._config.iceTransportPolicy\n    });\n    Object.defineProperty(iceGatherer, 'state',\n        {value: 'new', writable: true}\n    );\n\n    this.transceivers[sdpMLineIndex].candidates = [];\n    this.transceivers[sdpMLineIndex].bufferCandidates = function(event) {\n      var end = !event.candidate || Object.keys(event.candidate).length === 0;\n      // polyfill since RTCIceGatherer.state is not implemented in\n      // Edge 10547 yet.\n      iceGatherer.state = end ? 'completed' : 'gathering';\n      if (pc.transceivers[sdpMLineIndex].candidates !== null) {\n        pc.transceivers[sdpMLineIndex].candidates.push(event.candidate);\n      }\n    };\n    iceGatherer.addEventListener('localcandidate',\n      this.transceivers[sdpMLineIndex].bufferCandidates);\n    return iceGatherer;\n  };\n\n  // start gathering from an RTCIceGatherer.\n  RTCPeerConnection.prototype._gather = function(mid, sdpMLineIndex) {\n    var pc = this;\n    var iceGatherer = this.transceivers[sdpMLineIndex].iceGatherer;\n    if (iceGatherer.onlocalcandidate) {\n      return;\n    }\n    var candidates = this.transceivers[sdpMLineIndex].candidates;\n    this.transceivers[sdpMLineIndex].candidates = null;\n    iceGatherer.removeEventListener('localcandidate',\n      this.transceivers[sdpMLineIndex].bufferCandidates);\n    iceGatherer.onlocalcandidate = function(evt) {\n      if (pc.usingBundle && sdpMLineIndex > 0) {\n        // if we know that we use bundle we can drop candidates with\n        // dpMLineIndex > 0. If we don't do this then our state gets\n        // confused since we dispose the extra ice gatherer.\n        return;\n      }\n      var event = new Event('icecandidate');\n      event.candidate = {sdpMid: mid, sdpMLineIndex: sdpMLineIndex};\n\n      var cand = evt.candidate;\n      // Edge emits an empty object for RTCIceCandidateComplete\n      var end = !cand || Object.keys(cand).length === 0;\n      if (end) {\n        // polyfill since RTCIceGatherer.state is not implemented in\n        // Edge 10547 yet.\n        if (iceGatherer.state === 'new' || iceGatherer.state === 'gathering') {\n          iceGatherer.state = 'completed';\n        }\n      } else {\n        if (iceGatherer.state === 'new') {\n          iceGatherer.state = 'gathering';\n        }\n        // RTCIceCandidate doesn't have a component, needs to be added\n        cand.component = 1;\n        event.candidate.candidate = SDPUtils.writeCandidate(cand);\n      }\n\n      // update local description.\n      var sections = SDPUtils.splitSections(pc.localDescription.sdp);\n      if (!end) {\n        sections[event.candidate.sdpMLineIndex + 1] +=\n            'a=' + event.candidate.candidate + '\\r\\n';\n      } else {\n        sections[event.candidate.sdpMLineIndex + 1] +=\n            'a=end-of-candidates\\r\\n';\n      }\n      pc.localDescription.sdp = sections.join('');\n      var complete = pc.transceivers.every(function(transceiver) {\n        return transceiver.iceGatherer &&\n            transceiver.iceGatherer.state === 'completed';\n      });\n\n      if (pc.iceGatheringState !== 'gathering') {\n        pc.iceGatheringState = 'gathering';\n        pc._emitGatheringStateChange();\n      }\n\n      // Emit candidate. Also emit null candidate when all gatherers are\n      // complete.\n      if (!end) {\n        pc._dispatchEvent('icecandidate', event);\n      }\n      if (complete) {\n        pc._dispatchEvent('icecandidate', new Event('icecandidate'));\n        pc.iceGatheringState = 'complete';\n        pc._emitGatheringStateChange();\n      }\n    };\n\n    // emit already gathered candidates.\n    window.setTimeout(function() {\n      candidates.forEach(function(candidate) {\n        var e = new Event('RTCIceGatherEvent');\n        e.candidate = candidate;\n        iceGatherer.onlocalcandidate(e);\n      });\n    }, 0);\n  };\n\n  // Create ICE transport and DTLS transport.\n  RTCPeerConnection.prototype._createIceAndDtlsTransports = function() {\n    var pc = this;\n    var iceTransport = new window.RTCIceTransport(null);\n    iceTransport.onicestatechange = function() {\n      pc._updateConnectionState();\n    };\n\n    var dtlsTransport = new window.RTCDtlsTransport(iceTransport);\n    dtlsTransport.ondtlsstatechange = function() {\n      pc._updateConnectionState();\n    };\n    dtlsTransport.onerror = function() {\n      // onerror does not set state to failed by itpc.\n      Object.defineProperty(dtlsTransport, 'state',\n          {value: 'failed', writable: true});\n      pc._updateConnectionState();\n    };\n\n    return {\n      iceTransport: iceTransport,\n      dtlsTransport: dtlsTransport\n    };\n  };\n\n  // Destroy ICE gatherer, ICE transport and DTLS transport.\n  // Without triggering the callbacks.\n  RTCPeerConnection.prototype._disposeIceAndDtlsTransports = function(\n      sdpMLineIndex) {\n    var iceGatherer = this.transceivers[sdpMLineIndex].iceGatherer;\n    if (iceGatherer) {\n      delete iceGatherer.onlocalcandidate;\n      delete this.transceivers[sdpMLineIndex].iceGatherer;\n    }\n    var iceTransport = this.transceivers[sdpMLineIndex].iceTransport;\n    if (iceTransport) {\n      delete iceTransport.onicestatechange;\n      delete this.transceivers[sdpMLineIndex].iceTransport;\n    }\n    var dtlsTransport = this.transceivers[sdpMLineIndex].dtlsTransport;\n    if (dtlsTransport) {\n      delete dtlsTransport.ondtlsstatechange;\n      delete dtlsTransport.onerror;\n      delete this.transceivers[sdpMLineIndex].dtlsTransport;\n    }\n  };\n\n  // Start the RTP Sender and Receiver for a transceiver.\n  RTCPeerConnection.prototype._transceive = function(transceiver,\n      send, recv) {\n    var params = getCommonCapabilities(transceiver.localCapabilities,\n        transceiver.remoteCapabilities);\n    if (send && transceiver.rtpSender) {\n      params.encodings = transceiver.sendEncodingParameters;\n      params.rtcp = {\n        cname: SDPUtils.localCName,\n        compound: transceiver.rtcpParameters.compound\n      };\n      if (transceiver.recvEncodingParameters.length) {\n        params.rtcp.ssrc = transceiver.recvEncodingParameters[0].ssrc;\n      }\n      transceiver.rtpSender.send(params);\n    }\n    if (recv && transceiver.rtpReceiver && params.codecs.length > 0) {\n      // remove RTX field in Edge 14942\n      if (transceiver.kind === 'video'\n          && transceiver.recvEncodingParameters\n          && edgeVersion < 15019) {\n        transceiver.recvEncodingParameters.forEach(function(p) {\n          delete p.rtx;\n        });\n      }\n      if (transceiver.recvEncodingParameters.length) {\n        params.encodings = transceiver.recvEncodingParameters;\n      }\n      params.rtcp = {\n        compound: transceiver.rtcpParameters.compound\n      };\n      if (transceiver.rtcpParameters.cname) {\n        params.rtcp.cname = transceiver.rtcpParameters.cname;\n      }\n      if (transceiver.sendEncodingParameters.length) {\n        params.rtcp.ssrc = transceiver.sendEncodingParameters[0].ssrc;\n      }\n      transceiver.rtpReceiver.receive(params);\n    }\n  };\n\n  RTCPeerConnection.prototype.setLocalDescription = function(description) {\n    var pc = this;\n\n    if (!isActionAllowedInSignalingState('setLocalDescription',\n        description.type, this.signalingState) || this._isClosed) {\n      return Promise.reject(makeError('InvalidStateError',\n          'Can not set local ' + description.type +\n          ' in state ' + pc.signalingState));\n    }\n\n    var sections;\n    var sessionpart;\n    if (description.type === 'offer') {\n      // VERY limited support for SDP munging. Limited to:\n      // * changing the order of codecs\n      sections = SDPUtils.splitSections(description.sdp);\n      sessionpart = sections.shift();\n      sections.forEach(function(mediaSection, sdpMLineIndex) {\n        var caps = SDPUtils.parseRtpParameters(mediaSection);\n        pc.transceivers[sdpMLineIndex].localCapabilities = caps;\n      });\n\n      this.transceivers.forEach(function(transceiver, sdpMLineIndex) {\n        pc._gather(transceiver.mid, sdpMLineIndex);\n      });\n    } else if (description.type === 'answer') {\n      sections = SDPUtils.splitSections(pc.remoteDescription.sdp);\n      sessionpart = sections.shift();\n      var isIceLite = SDPUtils.matchPrefix(sessionpart,\n          'a=ice-lite').length > 0;\n      sections.forEach(function(mediaSection, sdpMLineIndex) {\n        var transceiver = pc.transceivers[sdpMLineIndex];\n        var iceGatherer = transceiver.iceGatherer;\n        var iceTransport = transceiver.iceTransport;\n        var dtlsTransport = transceiver.dtlsTransport;\n        var localCapabilities = transceiver.localCapabilities;\n        var remoteCapabilities = transceiver.remoteCapabilities;\n\n        // treat bundle-only as not-rejected.\n        var rejected = SDPUtils.isRejected(mediaSection) &&\n            SDPUtils.matchPrefix(mediaSection, 'a=bundle-only').length === 0;\n\n        if (!rejected && !transceiver.isDatachannel) {\n          var remoteIceParameters = SDPUtils.getIceParameters(\n              mediaSection, sessionpart);\n          var remoteDtlsParameters = SDPUtils.getDtlsParameters(\n              mediaSection, sessionpart);\n          if (isIceLite) {\n            remoteDtlsParameters.role = 'server';\n          }\n\n          if (!pc.usingBundle || sdpMLineIndex === 0) {\n            pc._gather(transceiver.mid, sdpMLineIndex);\n            if (iceTransport.state === 'new') {\n              iceTransport.start(iceGatherer, remoteIceParameters,\n                  isIceLite ? 'controlling' : 'controlled');\n            }\n            if (dtlsTransport.state === 'new') {\n              dtlsTransport.start(remoteDtlsParameters);\n            }\n          }\n\n          // Calculate intersection of capabilities.\n          var params = getCommonCapabilities(localCapabilities,\n              remoteCapabilities);\n\n          // Start the RTCRtpSender. The RTCRtpReceiver for this\n          // transceiver has already been started in setRemoteDescription.\n          pc._transceive(transceiver,\n              params.codecs.length > 0,\n              false);\n        }\n      });\n    }\n\n    this.localDescription = {\n      type: description.type,\n      sdp: description.sdp\n    };\n    switch (description.type) {\n      case 'offer':\n        this._updateSignalingState('have-local-offer');\n        break;\n      case 'answer':\n        this._updateSignalingState('stable');\n        break;\n      default:\n        throw new TypeError('unsupported type \"' + description.type +\n            '\"');\n    }\n\n    return Promise.resolve();\n  };\n\n  RTCPeerConnection.prototype.setRemoteDescription = function(description) {\n    var pc = this;\n\n    if (!isActionAllowedInSignalingState('setRemoteDescription',\n        description.type, this.signalingState) || this._isClosed) {\n      return Promise.reject(makeError('InvalidStateError',\n          'Can not set remote ' + description.type +\n          ' in state ' + pc.signalingState));\n    }\n\n    var streams = {};\n    this.remoteStreams.forEach(function(stream) {\n      streams[stream.id] = stream;\n    });\n    var receiverList = [];\n    var sections = SDPUtils.splitSections(description.sdp);\n    var sessionpart = sections.shift();\n    var isIceLite = SDPUtils.matchPrefix(sessionpart,\n        'a=ice-lite').length > 0;\n    var usingBundle = SDPUtils.matchPrefix(sessionpart,\n        'a=group:BUNDLE ').length > 0;\n    this.usingBundle = usingBundle;\n    var iceOptions = SDPUtils.matchPrefix(sessionpart,\n        'a=ice-options:')[0];\n    if (iceOptions) {\n      this.canTrickleIceCandidates = iceOptions.substr(14).split(' ')\n          .indexOf('trickle') >= 0;\n    } else {\n      this.canTrickleIceCandidates = false;\n    }\n\n    sections.forEach(function(mediaSection, sdpMLineIndex) {\n      var lines = SDPUtils.splitLines(mediaSection);\n      var kind = SDPUtils.getKind(mediaSection);\n      // treat bundle-only as not-rejected.\n      var rejected = SDPUtils.isRejected(mediaSection) &&\n          SDPUtils.matchPrefix(mediaSection, 'a=bundle-only').length === 0;\n      var protocol = lines[0].substr(2).split(' ')[2];\n\n      var direction = SDPUtils.getDirection(mediaSection, sessionpart);\n      var remoteMsid = SDPUtils.parseMsid(mediaSection);\n\n      var mid = SDPUtils.getMid(mediaSection) || SDPUtils.generateIdentifier();\n\n      // Reject datachannels which are not implemented yet.\n      if (kind === 'application' && protocol === 'DTLS/SCTP') {\n        pc.transceivers[sdpMLineIndex] = {\n          mid: mid,\n          isDatachannel: true\n        };\n        return;\n      }\n\n      var transceiver;\n      var iceGatherer;\n      var iceTransport;\n      var dtlsTransport;\n      var rtpReceiver;\n      var sendEncodingParameters;\n      var recvEncodingParameters;\n      var localCapabilities;\n\n      var track;\n      // FIXME: ensure the mediaSection has rtcp-mux set.\n      var remoteCapabilities = SDPUtils.parseRtpParameters(mediaSection);\n      var remoteIceParameters;\n      var remoteDtlsParameters;\n      if (!rejected) {\n        remoteIceParameters = SDPUtils.getIceParameters(mediaSection,\n            sessionpart);\n        remoteDtlsParameters = SDPUtils.getDtlsParameters(mediaSection,\n            sessionpart);\n        remoteDtlsParameters.role = 'client';\n      }\n      recvEncodingParameters =\n          SDPUtils.parseRtpEncodingParameters(mediaSection);\n\n      var rtcpParameters = SDPUtils.parseRtcpParameters(mediaSection);\n\n      var isComplete = SDPUtils.matchPrefix(mediaSection,\n          'a=end-of-candidates', sessionpart).length > 0;\n      var cands = SDPUtils.matchPrefix(mediaSection, 'a=candidate:')\n          .map(function(cand) {\n            return SDPUtils.parseCandidate(cand);\n          })\n          .filter(function(cand) {\n            return cand.component === 1;\n          });\n\n      // Check if we can use BUNDLE and dispose transports.\n      if ((description.type === 'offer' || description.type === 'answer') &&\n          !rejected && usingBundle && sdpMLineIndex > 0 &&\n          pc.transceivers[sdpMLineIndex]) {\n        pc._disposeIceAndDtlsTransports(sdpMLineIndex);\n        pc.transceivers[sdpMLineIndex].iceGatherer =\n            pc.transceivers[0].iceGatherer;\n        pc.transceivers[sdpMLineIndex].iceTransport =\n            pc.transceivers[0].iceTransport;\n        pc.transceivers[sdpMLineIndex].dtlsTransport =\n            pc.transceivers[0].dtlsTransport;\n        if (pc.transceivers[sdpMLineIndex].rtpSender) {\n          pc.transceivers[sdpMLineIndex].rtpSender.setTransport(\n              pc.transceivers[0].dtlsTransport);\n        }\n        if (pc.transceivers[sdpMLineIndex].rtpReceiver) {\n          pc.transceivers[sdpMLineIndex].rtpReceiver.setTransport(\n              pc.transceivers[0].dtlsTransport);\n        }\n      }\n      if (description.type === 'offer' && !rejected) {\n        transceiver = pc.transceivers[sdpMLineIndex] ||\n            pc._createTransceiver(kind);\n        transceiver.mid = mid;\n\n        if (!transceiver.iceGatherer) {\n          transceiver.iceGatherer = pc._createIceGatherer(sdpMLineIndex,\n              usingBundle);\n        }\n\n        if (cands.length && transceiver.iceTransport.state === 'new') {\n          if (isComplete && (!usingBundle || sdpMLineIndex === 0)) {\n            transceiver.iceTransport.setRemoteCandidates(cands);\n          } else {\n            cands.forEach(function(candidate) {\n              maybeAddCandidate(transceiver.iceTransport, candidate);\n            });\n          }\n        }\n\n        localCapabilities = window.RTCRtpReceiver.getCapabilities(kind);\n\n        // filter RTX until additional stuff needed for RTX is implemented\n        // in adapter.js\n        if (edgeVersion < 15019) {\n          localCapabilities.codecs = localCapabilities.codecs.filter(\n              function(codec) {\n                return codec.name !== 'rtx';\n              });\n        }\n\n        sendEncodingParameters = transceiver.sendEncodingParameters || [{\n          ssrc: (2 * sdpMLineIndex + 2) * 1001\n        }];\n\n        // TODO: rewrite to use http://w3c.github.io/webrtc-pc/#set-associated-remote-streams\n        var isNewTrack = false;\n        if (direction === 'sendrecv' || direction === 'sendonly') {\n          isNewTrack = !transceiver.rtpReceiver;\n          rtpReceiver = transceiver.rtpReceiver ||\n              new window.RTCRtpReceiver(transceiver.dtlsTransport, kind);\n\n          if (isNewTrack) {\n            var stream;\n            track = rtpReceiver.track;\n            // FIXME: does not work with Plan B.\n            if (remoteMsid && remoteMsid.stream === '-') {\n              // no-op. a stream id of '-' means: no associated stream.\n            } else if (remoteMsid) {\n              if (!streams[remoteMsid.stream]) {\n                streams[remoteMsid.stream] = new window.MediaStream();\n                Object.defineProperty(streams[remoteMsid.stream], 'id', {\n                  get: function() {\n                    return remoteMsid.stream;\n                  }\n                });\n              }\n              Object.defineProperty(track, 'id', {\n                get: function() {\n                  return remoteMsid.track;\n                }\n              });\n              stream = streams[remoteMsid.stream];\n            } else {\n              if (!streams.default) {\n                streams.default = new window.MediaStream();\n              }\n              stream = streams.default;\n            }\n            if (stream) {\n              addTrackToStreamAndFireEvent(track, stream);\n              transceiver.associatedRemoteMediaStreams.push(stream);\n            }\n            receiverList.push([track, rtpReceiver, stream]);\n          }\n        } else if (transceiver.rtpReceiver && transceiver.rtpReceiver.track) {\n          transceiver.associatedRemoteMediaStreams.forEach(function(s) {\n            var nativeTrack = s.getTracks().find(function(t) {\n              return t.id === transceiver.rtpReceiver.track.id;\n            });\n            if (nativeTrack) {\n              removeTrackFromStreamAndFireEvent(nativeTrack, s);\n            }\n          });\n          transceiver.associatedRemoteMediaStreams = [];\n        }\n\n        transceiver.localCapabilities = localCapabilities;\n        transceiver.remoteCapabilities = remoteCapabilities;\n        transceiver.rtpReceiver = rtpReceiver;\n        transceiver.rtcpParameters = rtcpParameters;\n        transceiver.sendEncodingParameters = sendEncodingParameters;\n        transceiver.recvEncodingParameters = recvEncodingParameters;\n\n        // Start the RTCRtpReceiver now. The RTPSender is started in\n        // setLocalDescription.\n        pc._transceive(pc.transceivers[sdpMLineIndex],\n            false,\n            isNewTrack);\n      } else if (description.type === 'answer' && !rejected) {\n        transceiver = pc.transceivers[sdpMLineIndex];\n        iceGatherer = transceiver.iceGatherer;\n        iceTransport = transceiver.iceTransport;\n        dtlsTransport = transceiver.dtlsTransport;\n        rtpReceiver = transceiver.rtpReceiver;\n        sendEncodingParameters = transceiver.sendEncodingParameters;\n        localCapabilities = transceiver.localCapabilities;\n\n        pc.transceivers[sdpMLineIndex].recvEncodingParameters =\n            recvEncodingParameters;\n        pc.transceivers[sdpMLineIndex].remoteCapabilities =\n            remoteCapabilities;\n        pc.transceivers[sdpMLineIndex].rtcpParameters = rtcpParameters;\n\n        if (cands.length && iceTransport.state === 'new') {\n          if ((isIceLite || isComplete) &&\n              (!usingBundle || sdpMLineIndex === 0)) {\n            iceTransport.setRemoteCandidates(cands);\n          } else {\n            cands.forEach(function(candidate) {\n              maybeAddCandidate(transceiver.iceTransport, candidate);\n            });\n          }\n        }\n\n        if (!usingBundle || sdpMLineIndex === 0) {\n          if (iceTransport.state === 'new') {\n            iceTransport.start(iceGatherer, remoteIceParameters,\n                'controlling');\n          }\n          if (dtlsTransport.state === 'new') {\n            dtlsTransport.start(remoteDtlsParameters);\n          }\n        }\n\n        pc._transceive(transceiver,\n            direction === 'sendrecv' || direction === 'recvonly',\n            direction === 'sendrecv' || direction === 'sendonly');\n\n        // TODO: rewrite to use http://w3c.github.io/webrtc-pc/#set-associated-remote-streams\n        if (rtpReceiver &&\n            (direction === 'sendrecv' || direction === 'sendonly')) {\n          track = rtpReceiver.track;\n          if (remoteMsid) {\n            if (!streams[remoteMsid.stream]) {\n              streams[remoteMsid.stream] = new window.MediaStream();\n            }\n            addTrackToStreamAndFireEvent(track, streams[remoteMsid.stream]);\n            receiverList.push([track, rtpReceiver, streams[remoteMsid.stream]]);\n          } else {\n            if (!streams.default) {\n              streams.default = new window.MediaStream();\n            }\n            addTrackToStreamAndFireEvent(track, streams.default);\n            receiverList.push([track, rtpReceiver, streams.default]);\n          }\n        } else {\n          // FIXME: actually the receiver should be created later.\n          delete transceiver.rtpReceiver;\n        }\n      }\n    });\n\n    if (this._dtlsRole === undefined) {\n      this._dtlsRole = description.type === 'offer' ? 'active' : 'passive';\n    }\n\n    this.remoteDescription = {\n      type: description.type,\n      sdp: description.sdp\n    };\n    switch (description.type) {\n      case 'offer':\n        this._updateSignalingState('have-remote-offer');\n        break;\n      case 'answer':\n        this._updateSignalingState('stable');\n        break;\n      default:\n        throw new TypeError('unsupported type \"' + description.type +\n            '\"');\n    }\n    Object.keys(streams).forEach(function(sid) {\n      var stream = streams[sid];\n      if (stream.getTracks().length) {\n        if (pc.remoteStreams.indexOf(stream) === -1) {\n          pc.remoteStreams.push(stream);\n          var event = new Event('addstream');\n          event.stream = stream;\n          window.setTimeout(function() {\n            pc._dispatchEvent('addstream', event);\n          });\n        }\n\n        receiverList.forEach(function(item) {\n          var track = item[0];\n          var receiver = item[1];\n          if (stream.id !== item[2].id) {\n            return;\n          }\n          fireAddTrack(pc, track, receiver, [stream]);\n        });\n      }\n    });\n    receiverList.forEach(function(item) {\n      if (item[2]) {\n        return;\n      }\n      fireAddTrack(pc, item[0], item[1], []);\n    });\n\n    // check whether addIceCandidate({}) was called within four seconds after\n    // setRemoteDescription.\n    window.setTimeout(function() {\n      if (!(pc && pc.transceivers)) {\n        return;\n      }\n      pc.transceivers.forEach(function(transceiver) {\n        if (transceiver.iceTransport &&\n            transceiver.iceTransport.state === 'new' &&\n            transceiver.iceTransport.getRemoteCandidates().length > 0) {\n          console.warn('Timeout for addRemoteCandidate. Consider sending ' +\n              'an end-of-candidates notification');\n          transceiver.iceTransport.addRemoteCandidate({});\n        }\n      });\n    }, 4000);\n\n    return Promise.resolve();\n  };\n\n  RTCPeerConnection.prototype.close = function() {\n    this.transceivers.forEach(function(transceiver) {\n      /* not yet\n      if (transceiver.iceGatherer) {\n        transceiver.iceGatherer.close();\n      }\n      */\n      if (transceiver.iceTransport) {\n        transceiver.iceTransport.stop();\n      }\n      if (transceiver.dtlsTransport) {\n        transceiver.dtlsTransport.stop();\n      }\n      if (transceiver.rtpSender) {\n        transceiver.rtpSender.stop();\n      }\n      if (transceiver.rtpReceiver) {\n        transceiver.rtpReceiver.stop();\n      }\n    });\n    // FIXME: clean up tracks, local streams, remote streams, etc\n    this._isClosed = true;\n    this._updateSignalingState('closed');\n  };\n\n  // Update the signaling state.\n  RTCPeerConnection.prototype._updateSignalingState = function(newState) {\n    this.signalingState = newState;\n    var event = new Event('signalingstatechange');\n    this._dispatchEvent('signalingstatechange', event);\n  };\n\n  // Determine whether to fire the negotiationneeded event.\n  RTCPeerConnection.prototype._maybeFireNegotiationNeeded = function() {\n    var pc = this;\n    if (this.signalingState !== 'stable' || this.needNegotiation === true) {\n      return;\n    }\n    this.needNegotiation = true;\n    window.setTimeout(function() {\n      if (pc.needNegotiation === false) {\n        return;\n      }\n      pc.needNegotiation = false;\n      var event = new Event('negotiationneeded');\n      pc._dispatchEvent('negotiationneeded', event);\n    }, 0);\n  };\n\n  // Update the connection state.\n  RTCPeerConnection.prototype._updateConnectionState = function() {\n    var newState;\n    var states = {\n      'new': 0,\n      closed: 0,\n      connecting: 0,\n      checking: 0,\n      connected: 0,\n      completed: 0,\n      disconnected: 0,\n      failed: 0\n    };\n    this.transceivers.forEach(function(transceiver) {\n      states[transceiver.iceTransport.state]++;\n      states[transceiver.dtlsTransport.state]++;\n    });\n    // ICETransport.completed and connected are the same for this purpose.\n    states.connected += states.completed;\n\n    newState = 'new';\n    if (states.failed > 0) {\n      newState = 'failed';\n    } else if (states.connecting > 0 || states.checking > 0) {\n      newState = 'connecting';\n    } else if (states.disconnected > 0) {\n      newState = 'disconnected';\n    } else if (states.new > 0) {\n      newState = 'new';\n    } else if (states.connected > 0 || states.completed > 0) {\n      newState = 'connected';\n    }\n\n    if (newState !== this.iceConnectionState) {\n      this.iceConnectionState = newState;\n      var event = new Event('iceconnectionstatechange');\n      this._dispatchEvent('iceconnectionstatechange', event);\n    }\n  };\n\n  RTCPeerConnection.prototype.createOffer = function() {\n    var pc = this;\n\n    if (this._isClosed) {\n      return Promise.reject(makeError('InvalidStateError',\n          'Can not call createOffer after close'));\n    }\n\n    var numAudioTracks = this.transceivers.filter(function(t) {\n      return t.kind === 'audio';\n    }).length;\n    var numVideoTracks = this.transceivers.filter(function(t) {\n      return t.kind === 'video';\n    }).length;\n\n    // Determine number of audio and video tracks we need to send/recv.\n    var offerOptions = arguments[0];\n    if (offerOptions) {\n      // Reject Chrome legacy constraints.\n      if (offerOptions.mandatory || offerOptions.optional) {\n        throw new TypeError(\n            'Legacy mandatory/optional constraints not supported.');\n      }\n      if (offerOptions.offerToReceiveAudio !== undefined) {\n        if (offerOptions.offerToReceiveAudio === true) {\n          numAudioTracks = 1;\n        } else if (offerOptions.offerToReceiveAudio === false) {\n          numAudioTracks = 0;\n        } else {\n          numAudioTracks = offerOptions.offerToReceiveAudio;\n        }\n      }\n      if (offerOptions.offerToReceiveVideo !== undefined) {\n        if (offerOptions.offerToReceiveVideo === true) {\n          numVideoTracks = 1;\n        } else if (offerOptions.offerToReceiveVideo === false) {\n          numVideoTracks = 0;\n        } else {\n          numVideoTracks = offerOptions.offerToReceiveVideo;\n        }\n      }\n    }\n\n    this.transceivers.forEach(function(transceiver) {\n      if (transceiver.kind === 'audio') {\n        numAudioTracks--;\n        if (numAudioTracks < 0) {\n          transceiver.wantReceive = false;\n        }\n      } else if (transceiver.kind === 'video') {\n        numVideoTracks--;\n        if (numVideoTracks < 0) {\n          transceiver.wantReceive = false;\n        }\n      }\n    });\n\n    // Create M-lines for recvonly streams.\n    while (numAudioTracks > 0 || numVideoTracks > 0) {\n      if (numAudioTracks > 0) {\n        this._createTransceiver('audio');\n        numAudioTracks--;\n      }\n      if (numVideoTracks > 0) {\n        this._createTransceiver('video');\n        numVideoTracks--;\n      }\n    }\n\n    var sdp = SDPUtils.writeSessionBoilerplate(this._sdpSessionId,\n        this._sdpSessionVersion++);\n    this.transceivers.forEach(function(transceiver, sdpMLineIndex) {\n      // For each track, create an ice gatherer, ice transport,\n      // dtls transport, potentially rtpsender and rtpreceiver.\n      var track = transceiver.track;\n      var kind = transceiver.kind;\n      var mid = SDPUtils.generateIdentifier();\n      transceiver.mid = mid;\n\n      if (!transceiver.iceGatherer) {\n        transceiver.iceGatherer = pc._createIceGatherer(sdpMLineIndex,\n            pc.usingBundle);\n      }\n\n      var localCapabilities = window.RTCRtpSender.getCapabilities(kind);\n      // filter RTX until additional stuff needed for RTX is implemented\n      // in adapter.js\n      if (edgeVersion < 15019) {\n        localCapabilities.codecs = localCapabilities.codecs.filter(\n            function(codec) {\n              return codec.name !== 'rtx';\n            });\n      }\n      localCapabilities.codecs.forEach(function(codec) {\n        // work around https://bugs.chromium.org/p/webrtc/issues/detail?id=6552\n        // by adding level-asymmetry-allowed=1\n        if (codec.name === 'H264' &&\n            codec.parameters['level-asymmetry-allowed'] === undefined) {\n          codec.parameters['level-asymmetry-allowed'] = '1';\n        }\n      });\n\n      // generate an ssrc now, to be used later in rtpSender.send\n      var sendEncodingParameters = transceiver.sendEncodingParameters || [{\n        ssrc: (2 * sdpMLineIndex + 1) * 1001\n      }];\n      if (track) {\n        // add RTX\n        if (edgeVersion >= 15019 && kind === 'video' &&\n            !sendEncodingParameters[0].rtx) {\n          sendEncodingParameters[0].rtx = {\n            ssrc: sendEncodingParameters[0].ssrc + 1\n          };\n        }\n      }\n\n      if (transceiver.wantReceive) {\n        transceiver.rtpReceiver = new window.RTCRtpReceiver(\n            transceiver.dtlsTransport, kind);\n      }\n\n      transceiver.localCapabilities = localCapabilities;\n      transceiver.sendEncodingParameters = sendEncodingParameters;\n    });\n\n    // always offer BUNDLE and dispose on return if not supported.\n    if (this._config.bundlePolicy !== 'max-compat') {\n      sdp += 'a=group:BUNDLE ' + this.transceivers.map(function(t) {\n        return t.mid;\n      }).join(' ') + '\\r\\n';\n    }\n    sdp += 'a=ice-options:trickle\\r\\n';\n\n    this.transceivers.forEach(function(transceiver, sdpMLineIndex) {\n      sdp += writeMediaSection(transceiver, transceiver.localCapabilities,\n          'offer', transceiver.stream, pc._dtlsRole);\n      sdp += 'a=rtcp-rsize\\r\\n';\n\n      if (transceiver.iceGatherer && pc.iceGatheringState !== 'new' &&\n          (sdpMLineIndex === 0 || !pc.usingBundle)) {\n        transceiver.iceGatherer.getLocalCandidates().forEach(function(cand) {\n          cand.component = 1;\n          sdp += 'a=' + SDPUtils.writeCandidate(cand) + '\\r\\n';\n        });\n\n        if (transceiver.iceGatherer.state === 'completed') {\n          sdp += 'a=end-of-candidates\\r\\n';\n        }\n      }\n    });\n\n    var desc = new window.RTCSessionDescription({\n      type: 'offer',\n      sdp: sdp\n    });\n    return Promise.resolve(desc);\n  };\n\n  RTCPeerConnection.prototype.createAnswer = function() {\n    var pc = this;\n\n    if (this._isClosed) {\n      return Promise.reject(makeError('InvalidStateError',\n          'Can not call createAnswer after close'));\n    }\n\n    var sdp = SDPUtils.writeSessionBoilerplate(this._sdpSessionId,\n        this._sdpSessionVersion++);\n    if (this.usingBundle) {\n      sdp += 'a=group:BUNDLE ' + this.transceivers.map(function(t) {\n        return t.mid;\n      }).join(' ') + '\\r\\n';\n    }\n    var mediaSectionsInOffer = SDPUtils.splitSections(\n        this.remoteDescription.sdp).length - 1;\n    this.transceivers.forEach(function(transceiver, sdpMLineIndex) {\n      if (sdpMLineIndex + 1 > mediaSectionsInOffer) {\n        return;\n      }\n      if (transceiver.isDatachannel) {\n        sdp += 'm=application 0 DTLS/SCTP 5000\\r\\n' +\n            'c=IN IP4 0.0.0.0\\r\\n' +\n            'a=mid:' + transceiver.mid + '\\r\\n';\n        return;\n      }\n\n      // FIXME: look at direction.\n      if (transceiver.stream) {\n        var localTrack;\n        if (transceiver.kind === 'audio') {\n          localTrack = transceiver.stream.getAudioTracks()[0];\n        } else if (transceiver.kind === 'video') {\n          localTrack = transceiver.stream.getVideoTracks()[0];\n        }\n        if (localTrack) {\n          // add RTX\n          if (edgeVersion >= 15019 && transceiver.kind === 'video' &&\n              !transceiver.sendEncodingParameters[0].rtx) {\n            transceiver.sendEncodingParameters[0].rtx = {\n              ssrc: transceiver.sendEncodingParameters[0].ssrc + 1\n            };\n          }\n        }\n      }\n\n      // Calculate intersection of capabilities.\n      var commonCapabilities = getCommonCapabilities(\n          transceiver.localCapabilities,\n          transceiver.remoteCapabilities);\n\n      var hasRtx = commonCapabilities.codecs.filter(function(c) {\n        return c.name.toLowerCase() === 'rtx';\n      }).length;\n      if (!hasRtx && transceiver.sendEncodingParameters[0].rtx) {\n        delete transceiver.sendEncodingParameters[0].rtx;\n      }\n\n      sdp += writeMediaSection(transceiver, commonCapabilities,\n          'answer', transceiver.stream, pc._dtlsRole);\n      if (transceiver.rtcpParameters &&\n          transceiver.rtcpParameters.reducedSize) {\n        sdp += 'a=rtcp-rsize\\r\\n';\n      }\n    });\n\n    var desc = new window.RTCSessionDescription({\n      type: 'answer',\n      sdp: sdp\n    });\n    return Promise.resolve(desc);\n  };\n\n  RTCPeerConnection.prototype.addIceCandidate = function(candidate) {\n    var sections;\n    if (!candidate || candidate.candidate === '') {\n      for (var j = 0; j < this.transceivers.length; j++) {\n        if (this.transceivers[j].isDatachannel) {\n          continue;\n        }\n        this.transceivers[j].iceTransport.addRemoteCandidate({});\n        sections = SDPUtils.splitSections(this.remoteDescription.sdp);\n        sections[j + 1] += 'a=end-of-candidates\\r\\n';\n        this.remoteDescription.sdp = sections.join('');\n        if (this.usingBundle) {\n          break;\n        }\n      }\n    } else if (!(candidate.sdpMLineIndex !== undefined || candidate.sdpMid)) {\n      throw new TypeError('sdpMLineIndex or sdpMid required');\n    } else if (!this.remoteDescription) {\n      return Promise.reject(makeError('InvalidStateError',\n          'Can not add ICE candidate without a remote description'));\n    } else {\n      var sdpMLineIndex = candidate.sdpMLineIndex;\n      if (candidate.sdpMid) {\n        for (var i = 0; i < this.transceivers.length; i++) {\n          if (this.transceivers[i].mid === candidate.sdpMid) {\n            sdpMLineIndex = i;\n            break;\n          }\n        }\n      }\n      var transceiver = this.transceivers[sdpMLineIndex];\n      if (transceiver) {\n        if (transceiver.isDatachannel) {\n          return Promise.resolve();\n        }\n        var cand = Object.keys(candidate.candidate).length > 0 ?\n            SDPUtils.parseCandidate(candidate.candidate) : {};\n        // Ignore Chrome's invalid candidates since Edge does not like them.\n        if (cand.protocol === 'tcp' && (cand.port === 0 || cand.port === 9)) {\n          return Promise.resolve();\n        }\n        // Ignore RTCP candidates, we assume RTCP-MUX.\n        if (cand.component && cand.component !== 1) {\n          return Promise.resolve();\n        }\n        // when using bundle, avoid adding candidates to the wrong\n        // ice transport. And avoid adding candidates added in the SDP.\n        if (sdpMLineIndex === 0 || (sdpMLineIndex > 0 &&\n            transceiver.iceTransport !== this.transceivers[0].iceTransport)) {\n          if (!maybeAddCandidate(transceiver.iceTransport, cand)) {\n            return Promise.reject(makeError('OperationError',\n                'Can not add ICE candidate'));\n          }\n        }\n\n        // update the remoteDescription.\n        var candidateString = candidate.candidate.trim();\n        if (candidateString.indexOf('a=') === 0) {\n          candidateString = candidateString.substr(2);\n        }\n        sections = SDPUtils.splitSections(this.remoteDescription.sdp);\n        sections[sdpMLineIndex + 1] += 'a=' +\n            (cand.type ? candidateString : 'end-of-candidates')\n            + '\\r\\n';\n        this.remoteDescription.sdp = sections.join('');\n      } else {\n        return Promise.reject(makeError('OperationError',\n            'Can not add ICE candidate'));\n      }\n    }\n    return Promise.resolve();\n  };\n\n  RTCPeerConnection.prototype.getStats = function() {\n    var promises = [];\n    this.transceivers.forEach(function(transceiver) {\n      ['rtpSender', 'rtpReceiver', 'iceGatherer', 'iceTransport',\n          'dtlsTransport'].forEach(function(method) {\n            if (transceiver[method]) {\n              promises.push(transceiver[method].getStats());\n            }\n          });\n    });\n    var fixStatsType = function(stat) {\n      return {\n        inboundrtp: 'inbound-rtp',\n        outboundrtp: 'outbound-rtp',\n        candidatepair: 'candidate-pair',\n        localcandidate: 'local-candidate',\n        remotecandidate: 'remote-candidate'\n      }[stat.type] || stat.type;\n    };\n    return new Promise(function(resolve) {\n      // shim getStats with maplike support\n      var results = new Map();\n      Promise.all(promises).then(function(res) {\n        res.forEach(function(result) {\n          Object.keys(result).forEach(function(id) {\n            result[id].type = fixStatsType(result[id]);\n            results.set(id, result[id]);\n          });\n        });\n        resolve(results);\n      });\n    });\n  };\n\n  // legacy callback shims. Should be moved to adapter.js some days.\n  var methods = ['createOffer', 'createAnswer'];\n  methods.forEach(function(method) {\n    var nativeMethod = RTCPeerConnection.prototype[method];\n    RTCPeerConnection.prototype[method] = function() {\n      var args = arguments;\n      if (typeof args[0] === 'function' ||\n          typeof args[1] === 'function') { // legacy\n        return nativeMethod.apply(this, [arguments[2]])\n        .then(function(description) {\n          if (typeof args[0] === 'function') {\n            args[0].apply(null, [description]);\n          }\n        }, function(error) {\n          if (typeof args[1] === 'function') {\n            args[1].apply(null, [error]);\n          }\n        });\n      }\n      return nativeMethod.apply(this, arguments);\n    };\n  });\n\n  methods = ['setLocalDescription', 'setRemoteDescription', 'addIceCandidate'];\n  methods.forEach(function(method) {\n    var nativeMethod = RTCPeerConnection.prototype[method];\n    RTCPeerConnection.prototype[method] = function() {\n      var args = arguments;\n      if (typeof args[1] === 'function' ||\n          typeof args[2] === 'function') { // legacy\n        return nativeMethod.apply(this, arguments)\n        .then(function() {\n          if (typeof args[1] === 'function') {\n            args[1].apply(null);\n          }\n        }, function(error) {\n          if (typeof args[2] === 'function') {\n            args[2].apply(null, [error]);\n          }\n        });\n      }\n      return nativeMethod.apply(this, arguments);\n    };\n  });\n\n  // getStats is special. It doesn't have a spec legacy method yet we support\n  // getStats(something, cb) without error callbacks.\n  ['getStats'].forEach(function(method) {\n    var nativeMethod = RTCPeerConnection.prototype[method];\n    RTCPeerConnection.prototype[method] = function() {\n      var args = arguments;\n      if (typeof args[1] === 'function') {\n        return nativeMethod.apply(this, arguments)\n        .then(function() {\n          if (typeof args[1] === 'function') {\n            args[1].apply(null);\n          }\n        });\n      }\n      return nativeMethod.apply(this, arguments);\n    };\n  });\n\n  return RTCPeerConnection;\n};\n\n},{\"sdp\":2}],2:[function(require,module,exports){\n /* eslint-env node */\n'use strict';\n\n// SDP helpers.\nvar SDPUtils = {};\n\n// Generate an alphanumeric identifier for cname or mids.\n// TODO: use UUIDs instead? https://gist.github.com/jed/982883\nSDPUtils.generateIdentifier = function() {\n  return Math.random().toString(36).substr(2, 10);\n};\n\n// The RTCP CNAME used by all peerconnections from the same JS.\nSDPUtils.localCName = SDPUtils.generateIdentifier();\n\n// Splits SDP into lines, dealing with both CRLF and LF.\nSDPUtils.splitLines = function(blob) {\n  return blob.trim().split('\\n').map(function(line) {\n    return line.trim();\n  });\n};\n// Splits SDP into sessionpart and mediasections. Ensures CRLF.\nSDPUtils.splitSections = function(blob) {\n  var parts = blob.split('\\nm=');\n  return parts.map(function(part, index) {\n    return (index > 0 ? 'm=' + part : part).trim() + '\\r\\n';\n  });\n};\n\n// Returns lines that start with a certain prefix.\nSDPUtils.matchPrefix = function(blob, prefix) {\n  return SDPUtils.splitLines(blob).filter(function(line) {\n    return line.indexOf(prefix) === 0;\n  });\n};\n\n// Parses an ICE candidate line. Sample input:\n// candidate:702786350 2 udp 41819902 8.8.8.8 60769 typ relay raddr 8.8.8.8\n// rport 55996\"\nSDPUtils.parseCandidate = function(line) {\n  var parts;\n  // Parse both variants.\n  if (line.indexOf('a=candidate:') === 0) {\n    parts = line.substring(12).split(' ');\n  } else {\n    parts = line.substring(10).split(' ');\n  }\n\n  var candidate = {\n    foundation: parts[0],\n    component: parseInt(parts[1], 10),\n    protocol: parts[2].toLowerCase(),\n    priority: parseInt(parts[3], 10),\n    ip: parts[4],\n    port: parseInt(parts[5], 10),\n    // skip parts[6] == 'typ'\n    type: parts[7]\n  };\n\n  for (var i = 8; i < parts.length; i += 2) {\n    switch (parts[i]) {\n      case 'raddr':\n        candidate.relatedAddress = parts[i + 1];\n        break;\n      case 'rport':\n        candidate.relatedPort = parseInt(parts[i + 1], 10);\n        break;\n      case 'tcptype':\n        candidate.tcpType = parts[i + 1];\n        break;\n      case 'ufrag':\n        candidate.ufrag = parts[i + 1]; // for backward compability.\n        candidate.usernameFragment = parts[i + 1];\n        break;\n      default: // extension handling, in particular ufrag\n        candidate[parts[i]] = parts[i + 1];\n        break;\n    }\n  }\n  return candidate;\n};\n\n// Translates a candidate object into SDP candidate attribute.\nSDPUtils.writeCandidate = function(candidate) {\n  var sdp = [];\n  sdp.push(candidate.foundation);\n  sdp.push(candidate.component);\n  sdp.push(candidate.protocol.toUpperCase());\n  sdp.push(candidate.priority);\n  sdp.push(candidate.ip);\n  sdp.push(candidate.port);\n\n  var type = candidate.type;\n  sdp.push('typ');\n  sdp.push(type);\n  if (type !== 'host' && candidate.relatedAddress &&\n      candidate.relatedPort) {\n    sdp.push('raddr');\n    sdp.push(candidate.relatedAddress); // was: relAddr\n    sdp.push('rport');\n    sdp.push(candidate.relatedPort); // was: relPort\n  }\n  if (candidate.tcpType && candidate.protocol.toLowerCase() === 'tcp') {\n    sdp.push('tcptype');\n    sdp.push(candidate.tcpType);\n  }\n  if (candidate.ufrag) {\n    sdp.push('ufrag');\n    sdp.push(candidate.ufrag);\n  }\n  return 'candidate:' + sdp.join(' ');\n};\n\n// Parses an ice-options line, returns an array of option tags.\n// a=ice-options:foo bar\nSDPUtils.parseIceOptions = function(line) {\n  return line.substr(14).split(' ');\n}\n\n// Parses an rtpmap line, returns RTCRtpCoddecParameters. Sample input:\n// a=rtpmap:111 opus/48000/2\nSDPUtils.parseRtpMap = function(line) {\n  var parts = line.substr(9).split(' ');\n  var parsed = {\n    payloadType: parseInt(parts.shift(), 10) // was: id\n  };\n\n  parts = parts[0].split('/');\n\n  parsed.name = parts[0];\n  parsed.clockRate = parseInt(parts[1], 10); // was: clockrate\n  // was: channels\n  parsed.numChannels = parts.length === 3 ? parseInt(parts[2], 10) : 1;\n  return parsed;\n};\n\n// Generate an a=rtpmap line from RTCRtpCodecCapability or\n// RTCRtpCodecParameters.\nSDPUtils.writeRtpMap = function(codec) {\n  var pt = codec.payloadType;\n  if (codec.preferredPayloadType !== undefined) {\n    pt = codec.preferredPayloadType;\n  }\n  return 'a=rtpmap:' + pt + ' ' + codec.name + '/' + codec.clockRate +\n      (codec.numChannels !== 1 ? '/' + codec.numChannels : '') + '\\r\\n';\n};\n\n// Parses an a=extmap line (headerextension from RFC 5285). Sample input:\n// a=extmap:2 urn:ietf:params:rtp-hdrext:toffset\n// a=extmap:2/sendonly urn:ietf:params:rtp-hdrext:toffset\nSDPUtils.parseExtmap = function(line) {\n  var parts = line.substr(9).split(' ');\n  return {\n    id: parseInt(parts[0], 10),\n    direction: parts[0].indexOf('/') > 0 ? parts[0].split('/')[1] : 'sendrecv',\n    uri: parts[1]\n  };\n};\n\n// Generates a=extmap line from RTCRtpHeaderExtensionParameters or\n// RTCRtpHeaderExtension.\nSDPUtils.writeExtmap = function(headerExtension) {\n  return 'a=extmap:' + (headerExtension.id || headerExtension.preferredId) +\n      (headerExtension.direction && headerExtension.direction !== 'sendrecv'\n          ? '/' + headerExtension.direction\n          : '') +\n      ' ' + headerExtension.uri + '\\r\\n';\n};\n\n// Parses an ftmp line, returns dictionary. Sample input:\n// a=fmtp:96 vbr=on;cng=on\n// Also deals with vbr=on; cng=on\nSDPUtils.parseFmtp = function(line) {\n  var parsed = {};\n  var kv;\n  var parts = line.substr(line.indexOf(' ') + 1).split(';');\n  for (var j = 0; j < parts.length; j++) {\n    kv = parts[j].trim().split('=');\n    parsed[kv[0].trim()] = kv[1];\n  }\n  return parsed;\n};\n\n// Generates an a=ftmp line from RTCRtpCodecCapability or RTCRtpCodecParameters.\nSDPUtils.writeFmtp = function(codec) {\n  var line = '';\n  var pt = codec.payloadType;\n  if (codec.preferredPayloadType !== undefined) {\n    pt = codec.preferredPayloadType;\n  }\n  if (codec.parameters && Object.keys(codec.parameters).length) {\n    var params = [];\n    Object.keys(codec.parameters).forEach(function(param) {\n      params.push(param + '=' + codec.parameters[param]);\n    });\n    line += 'a=fmtp:' + pt + ' ' + params.join(';') + '\\r\\n';\n  }\n  return line;\n};\n\n// Parses an rtcp-fb line, returns RTCPRtcpFeedback object. Sample input:\n// a=rtcp-fb:98 nack rpsi\nSDPUtils.parseRtcpFb = function(line) {\n  var parts = line.substr(line.indexOf(' ') + 1).split(' ');\n  return {\n    type: parts.shift(),\n    parameter: parts.join(' ')\n  };\n};\n// Generate a=rtcp-fb lines from RTCRtpCodecCapability or RTCRtpCodecParameters.\nSDPUtils.writeRtcpFb = function(codec) {\n  var lines = '';\n  var pt = codec.payloadType;\n  if (codec.preferredPayloadType !== undefined) {\n    pt = codec.preferredPayloadType;\n  }\n  if (codec.rtcpFeedback && codec.rtcpFeedback.length) {\n    // FIXME: special handling for trr-int?\n    codec.rtcpFeedback.forEach(function(fb) {\n      lines += 'a=rtcp-fb:' + pt + ' ' + fb.type +\n      (fb.parameter && fb.parameter.length ? ' ' + fb.parameter : '') +\n          '\\r\\n';\n    });\n  }\n  return lines;\n};\n\n// Parses an RFC 5576 ssrc media attribute. Sample input:\n// a=ssrc:3735928559 cname:something\nSDPUtils.parseSsrcMedia = function(line) {\n  var sp = line.indexOf(' ');\n  var parts = {\n    ssrc: parseInt(line.substr(7, sp - 7), 10)\n  };\n  var colon = line.indexOf(':', sp);\n  if (colon > -1) {\n    parts.attribute = line.substr(sp + 1, colon - sp - 1);\n    parts.value = line.substr(colon + 1);\n  } else {\n    parts.attribute = line.substr(sp + 1);\n  }\n  return parts;\n};\n\n// Extracts the MID (RFC 5888) from a media section.\n// returns the MID or undefined if no mid line was found.\nSDPUtils.getMid = function(mediaSection) {\n  var mid = SDPUtils.matchPrefix(mediaSection, 'a=mid:')[0];\n  if (mid) {\n    return mid.substr(6);\n  }\n}\n\nSDPUtils.parseFingerprint = function(line) {\n  var parts = line.substr(14).split(' ');\n  return {\n    algorithm: parts[0].toLowerCase(), // algorithm is case-sensitive in Edge.\n    value: parts[1]\n  };\n};\n\n// Extracts DTLS parameters from SDP media section or sessionpart.\n// FIXME: for consistency with other functions this should only\n//   get the fingerprint line as input. See also getIceParameters.\nSDPUtils.getDtlsParameters = function(mediaSection, sessionpart) {\n  var lines = SDPUtils.matchPrefix(mediaSection + sessionpart,\n      'a=fingerprint:');\n  // Note: a=setup line is ignored since we use the 'auto' role.\n  // Note2: 'algorithm' is not case sensitive except in Edge.\n  return {\n    role: 'auto',\n    fingerprints: lines.map(SDPUtils.parseFingerprint)\n  };\n};\n\n// Serializes DTLS parameters to SDP.\nSDPUtils.writeDtlsParameters = function(params, setupType) {\n  var sdp = 'a=setup:' + setupType + '\\r\\n';\n  params.fingerprints.forEach(function(fp) {\n    sdp += 'a=fingerprint:' + fp.algorithm + ' ' + fp.value + '\\r\\n';\n  });\n  return sdp;\n};\n// Parses ICE information from SDP media section or sessionpart.\n// FIXME: for consistency with other functions this should only\n//   get the ice-ufrag and ice-pwd lines as input.\nSDPUtils.getIceParameters = function(mediaSection, sessionpart) {\n  var lines = SDPUtils.splitLines(mediaSection);\n  // Search in session part, too.\n  lines = lines.concat(SDPUtils.splitLines(sessionpart));\n  var iceParameters = {\n    usernameFragment: lines.filter(function(line) {\n      return line.indexOf('a=ice-ufrag:') === 0;\n    })[0].substr(12),\n    password: lines.filter(function(line) {\n      return line.indexOf('a=ice-pwd:') === 0;\n    })[0].substr(10)\n  };\n  return iceParameters;\n};\n\n// Serializes ICE parameters to SDP.\nSDPUtils.writeIceParameters = function(params) {\n  return 'a=ice-ufrag:' + params.usernameFragment + '\\r\\n' +\n      'a=ice-pwd:' + params.password + '\\r\\n';\n};\n\n// Parses the SDP media section and returns RTCRtpParameters.\nSDPUtils.parseRtpParameters = function(mediaSection) {\n  var description = {\n    codecs: [],\n    headerExtensions: [],\n    fecMechanisms: [],\n    rtcp: []\n  };\n  var lines = SDPUtils.splitLines(mediaSection);\n  var mline = lines[0].split(' ');\n  for (var i = 3; i < mline.length; i++) { // find all codecs from mline[3..]\n    var pt = mline[i];\n    var rtpmapline = SDPUtils.matchPrefix(\n        mediaSection, 'a=rtpmap:' + pt + ' ')[0];\n    if (rtpmapline) {\n      var codec = SDPUtils.parseRtpMap(rtpmapline);\n      var fmtps = SDPUtils.matchPrefix(\n          mediaSection, 'a=fmtp:' + pt + ' ');\n      // Only the first a=fmtp:<pt> is considered.\n      codec.parameters = fmtps.length ? SDPUtils.parseFmtp(fmtps[0]) : {};\n      codec.rtcpFeedback = SDPUtils.matchPrefix(\n          mediaSection, 'a=rtcp-fb:' + pt + ' ')\n        .map(SDPUtils.parseRtcpFb);\n      description.codecs.push(codec);\n      // parse FEC mechanisms from rtpmap lines.\n      switch (codec.name.toUpperCase()) {\n        case 'RED':\n        case 'ULPFEC':\n          description.fecMechanisms.push(codec.name.toUpperCase());\n          break;\n        default: // only RED and ULPFEC are recognized as FEC mechanisms.\n          break;\n      }\n    }\n  }\n  SDPUtils.matchPrefix(mediaSection, 'a=extmap:').forEach(function(line) {\n    description.headerExtensions.push(SDPUtils.parseExtmap(line));\n  });\n  // FIXME: parse rtcp.\n  return description;\n};\n\n// Generates parts of the SDP media section describing the capabilities /\n// parameters.\nSDPUtils.writeRtpDescription = function(kind, caps) {\n  var sdp = '';\n\n  // Build the mline.\n  sdp += 'm=' + kind + ' ';\n  sdp += caps.codecs.length > 0 ? '9' : '0'; // reject if no codecs.\n  sdp += ' UDP/TLS/RTP/SAVPF ';\n  sdp += caps.codecs.map(function(codec) {\n    if (codec.preferredPayloadType !== undefined) {\n      return codec.preferredPayloadType;\n    }\n    return codec.payloadType;\n  }).join(' ') + '\\r\\n';\n\n  sdp += 'c=IN IP4 0.0.0.0\\r\\n';\n  sdp += 'a=rtcp:9 IN IP4 0.0.0.0\\r\\n';\n\n  // Add a=rtpmap lines for each codec. Also fmtp and rtcp-fb.\n  caps.codecs.forEach(function(codec) {\n    sdp += SDPUtils.writeRtpMap(codec);\n    sdp += SDPUtils.writeFmtp(codec);\n    sdp += SDPUtils.writeRtcpFb(codec);\n  });\n  var maxptime = 0;\n  caps.codecs.forEach(function(codec) {\n    if (codec.maxptime > maxptime) {\n      maxptime = codec.maxptime;\n    }\n  });\n  if (maxptime > 0) {\n    sdp += 'a=maxptime:' + maxptime + '\\r\\n';\n  }\n  sdp += 'a=rtcp-mux\\r\\n';\n\n  caps.headerExtensions.forEach(function(extension) {\n    sdp += SDPUtils.writeExtmap(extension);\n  });\n  // FIXME: write fecMechanisms.\n  return sdp;\n};\n\n// Parses the SDP media section and returns an array of\n// RTCRtpEncodingParameters.\nSDPUtils.parseRtpEncodingParameters = function(mediaSection) {\n  var encodingParameters = [];\n  var description = SDPUtils.parseRtpParameters(mediaSection);\n  var hasRed = description.fecMechanisms.indexOf('RED') !== -1;\n  var hasUlpfec = description.fecMechanisms.indexOf('ULPFEC') !== -1;\n\n  // filter a=ssrc:... cname:, ignore PlanB-msid\n  var ssrcs = SDPUtils.matchPrefix(mediaSection, 'a=ssrc:')\n  .map(function(line) {\n    return SDPUtils.parseSsrcMedia(line);\n  })\n  .filter(function(parts) {\n    return parts.attribute === 'cname';\n  });\n  var primarySsrc = ssrcs.length > 0 && ssrcs[0].ssrc;\n  var secondarySsrc;\n\n  var flows = SDPUtils.matchPrefix(mediaSection, 'a=ssrc-group:FID')\n  .map(function(line) {\n    var parts = line.split(' ');\n    parts.shift();\n    return parts.map(function(part) {\n      return parseInt(part, 10);\n    });\n  });\n  if (flows.length > 0 && flows[0].length > 1 && flows[0][0] === primarySsrc) {\n    secondarySsrc = flows[0][1];\n  }\n\n  description.codecs.forEach(function(codec) {\n    if (codec.name.toUpperCase() === 'RTX' && codec.parameters.apt) {\n      var encParam = {\n        ssrc: primarySsrc,\n        codecPayloadType: parseInt(codec.parameters.apt, 10),\n        rtx: {\n          ssrc: secondarySsrc\n        }\n      };\n      encodingParameters.push(encParam);\n      if (hasRed) {\n        encParam = JSON.parse(JSON.stringify(encParam));\n        encParam.fec = {\n          ssrc: secondarySsrc,\n          mechanism: hasUlpfec ? 'red+ulpfec' : 'red'\n        };\n        encodingParameters.push(encParam);\n      }\n    }\n  });\n  if (encodingParameters.length === 0 && primarySsrc) {\n    encodingParameters.push({\n      ssrc: primarySsrc\n    });\n  }\n\n  // we support both b=AS and b=TIAS but interpret AS as TIAS.\n  var bandwidth = SDPUtils.matchPrefix(mediaSection, 'b=');\n  if (bandwidth.length) {\n    if (bandwidth[0].indexOf('b=TIAS:') === 0) {\n      bandwidth = parseInt(bandwidth[0].substr(7), 10);\n    } else if (bandwidth[0].indexOf('b=AS:') === 0) {\n      // use formula from JSEP to convert b=AS to TIAS value.\n      bandwidth = parseInt(bandwidth[0].substr(5), 10) * 1000 * 0.95\n          - (50 * 40 * 8);\n    } else {\n      bandwidth = undefined;\n    }\n    encodingParameters.forEach(function(params) {\n      params.maxBitrate = bandwidth;\n    });\n  }\n  return encodingParameters;\n};\n\n// parses http://draft.ortc.org/#rtcrtcpparameters*\nSDPUtils.parseRtcpParameters = function(mediaSection) {\n  var rtcpParameters = {};\n\n  var cname;\n  // Gets the first SSRC. Note that with RTX there might be multiple\n  // SSRCs.\n  var remoteSsrc = SDPUtils.matchPrefix(mediaSection, 'a=ssrc:')\n      .map(function(line) {\n        return SDPUtils.parseSsrcMedia(line);\n      })\n      .filter(function(obj) {\n        return obj.attribute === 'cname';\n      })[0];\n  if (remoteSsrc) {\n    rtcpParameters.cname = remoteSsrc.value;\n    rtcpParameters.ssrc = remoteSsrc.ssrc;\n  }\n\n  // Edge uses the compound attribute instead of reducedSize\n  // compound is !reducedSize\n  var rsize = SDPUtils.matchPrefix(mediaSection, 'a=rtcp-rsize');\n  rtcpParameters.reducedSize = rsize.length > 0;\n  rtcpParameters.compound = rsize.length === 0;\n\n  // parses the rtcp-mux attrbute.\n  // Note that Edge does not support unmuxed RTCP.\n  var mux = SDPUtils.matchPrefix(mediaSection, 'a=rtcp-mux');\n  rtcpParameters.mux = mux.length > 0;\n\n  return rtcpParameters;\n};\n\n// parses either a=msid: or a=ssrc:... msid lines and returns\n// the id of the MediaStream and MediaStreamTrack.\nSDPUtils.parseMsid = function(mediaSection) {\n  var parts;\n  var spec = SDPUtils.matchPrefix(mediaSection, 'a=msid:');\n  if (spec.length === 1) {\n    parts = spec[0].substr(7).split(' ');\n    return {stream: parts[0], track: parts[1]};\n  }\n  var planB = SDPUtils.matchPrefix(mediaSection, 'a=ssrc:')\n  .map(function(line) {\n    return SDPUtils.parseSsrcMedia(line);\n  })\n  .filter(function(parts) {\n    return parts.attribute === 'msid';\n  });\n  if (planB.length > 0) {\n    parts = planB[0].value.split(' ');\n    return {stream: parts[0], track: parts[1]};\n  }\n};\n\n// Generate a session ID for SDP.\n// https://tools.ietf.org/html/draft-ietf-rtcweb-jsep-20#section-5.2.1\n// recommends using a cryptographically random +ve 64-bit value\n// but right now this should be acceptable and within the right range\nSDPUtils.generateSessionId = function() {\n  return Math.random().toString().substr(2, 21);\n};\n\n// Write boilder plate for start of SDP\n// sessId argument is optional - if not supplied it will\n// be generated randomly\n// sessVersion is optional and defaults to 2\nSDPUtils.writeSessionBoilerplate = function(sessId, sessVer) {\n  var sessionId;\n  var version = sessVer !== undefined ? sessVer : 2;\n  if (sessId) {\n    sessionId = sessId;\n  } else {\n    sessionId = SDPUtils.generateSessionId();\n  }\n  // FIXME: sess-id should be an NTP timestamp.\n  return 'v=0\\r\\n' +\n      'o=thisisadapterortc ' + sessionId + ' ' + version + ' IN IP4 127.0.0.1\\r\\n' +\n      's=-\\r\\n' +\n      't=0 0\\r\\n';\n};\n\nSDPUtils.writeMediaSection = function(transceiver, caps, type, stream) {\n  var sdp = SDPUtils.writeRtpDescription(transceiver.kind, caps);\n\n  // Map ICE parameters (ufrag, pwd) to SDP.\n  sdp += SDPUtils.writeIceParameters(\n      transceiver.iceGatherer.getLocalParameters());\n\n  // Map DTLS parameters to SDP.\n  sdp += SDPUtils.writeDtlsParameters(\n      transceiver.dtlsTransport.getLocalParameters(),\n      type === 'offer' ? 'actpass' : 'active');\n\n  sdp += 'a=mid:' + transceiver.mid + '\\r\\n';\n\n  if (transceiver.direction) {\n    sdp += 'a=' + transceiver.direction + '\\r\\n';\n  } else if (transceiver.rtpSender && transceiver.rtpReceiver) {\n    sdp += 'a=sendrecv\\r\\n';\n  } else if (transceiver.rtpSender) {\n    sdp += 'a=sendonly\\r\\n';\n  } else if (transceiver.rtpReceiver) {\n    sdp += 'a=recvonly\\r\\n';\n  } else {\n    sdp += 'a=inactive\\r\\n';\n  }\n\n  if (transceiver.rtpSender) {\n    // spec.\n    var msid = 'msid:' + stream.id + ' ' +\n        transceiver.rtpSender.track.id + '\\r\\n';\n    sdp += 'a=' + msid;\n\n    // for Chrome.\n    sdp += 'a=ssrc:' + transceiver.sendEncodingParameters[0].ssrc +\n        ' ' + msid;\n    if (transceiver.sendEncodingParameters[0].rtx) {\n      sdp += 'a=ssrc:' + transceiver.sendEncodingParameters[0].rtx.ssrc +\n          ' ' + msid;\n      sdp += 'a=ssrc-group:FID ' +\n          transceiver.sendEncodingParameters[0].ssrc + ' ' +\n          transceiver.sendEncodingParameters[0].rtx.ssrc +\n          '\\r\\n';\n    }\n  }\n  // FIXME: this should be written by writeRtpDescription.\n  sdp += 'a=ssrc:' + transceiver.sendEncodingParameters[0].ssrc +\n      ' cname:' + SDPUtils.localCName + '\\r\\n';\n  if (transceiver.rtpSender && transceiver.sendEncodingParameters[0].rtx) {\n    sdp += 'a=ssrc:' + transceiver.sendEncodingParameters[0].rtx.ssrc +\n        ' cname:' + SDPUtils.localCName + '\\r\\n';\n  }\n  return sdp;\n};\n\n// Gets the direction from the mediaSection or the sessionpart.\nSDPUtils.getDirection = function(mediaSection, sessionpart) {\n  // Look for sendrecv, sendonly, recvonly, inactive, default to sendrecv.\n  var lines = SDPUtils.splitLines(mediaSection);\n  for (var i = 0; i < lines.length; i++) {\n    switch (lines[i]) {\n      case 'a=sendrecv':\n      case 'a=sendonly':\n      case 'a=recvonly':\n      case 'a=inactive':\n        return lines[i].substr(2);\n      default:\n        // FIXME: What should happen here?\n    }\n  }\n  if (sessionpart) {\n    return SDPUtils.getDirection(sessionpart);\n  }\n  return 'sendrecv';\n};\n\nSDPUtils.getKind = function(mediaSection) {\n  var lines = SDPUtils.splitLines(mediaSection);\n  var mline = lines[0].split(' ');\n  return mline[0].substr(2);\n};\n\nSDPUtils.isRejected = function(mediaSection) {\n  return mediaSection.split(' ', 2)[1] === '0';\n};\n\nSDPUtils.parseMLine = function(mediaSection) {\n  var lines = SDPUtils.splitLines(mediaSection);\n  var mline = lines[0].split(' ');\n  return {\n    kind: mline[0].substr(2),\n    port: parseInt(mline[1], 10),\n    protocol: mline[2],\n    fmt: mline.slice(3).join(' ')\n  };\n};\n\n// Expose public methods.\nif (typeof module === 'object') {\n  module.exports = SDPUtils;\n}\n\n},{}],3:[function(require,module,exports){\n(function (global){\n/*\n *  Copyright (c) 2016 The WebRTC project authors. All Rights Reserved.\n *\n *  Use of this source code is governed by a BSD-style license\n *  that can be found in the LICENSE file in the root of the source\n *  tree.\n */\n /* eslint-env node */\n\n'use strict';\n\nvar adapterFactory = require('./adapter_factory.js');\nmodule.exports = adapterFactory({window: global.window});\n\n}).call(this,typeof global !== \"undefined\" ? global : typeof self !== \"undefined\" ? self : typeof window !== \"undefined\" ? window : {})\n},{\"./adapter_factory.js\":4}],4:[function(require,module,exports){\n/*\n *  Copyright (c) 2016 The WebRTC project authors. All Rights Reserved.\n *\n *  Use of this source code is governed by a BSD-style license\n *  that can be found in the LICENSE file in the root of the source\n *  tree.\n */\n /* eslint-env node */\n\n'use strict';\n\nvar utils = require('./utils');\n// Shimming starts here.\nmodule.exports = function(dependencies, opts) {\n  var window = dependencies && dependencies.window;\n\n  var options = {\n    shimChrome: true,\n    shimFirefox: true,\n    shimEdge: true,\n    shimSafari: true,\n  };\n\n  for (var key in opts) {\n    if (hasOwnProperty.call(opts, key)) {\n      options[key] = opts[key];\n    }\n  }\n\n  // Utils.\n  var logging = utils.log;\n  var browserDetails = utils.detectBrowser(window);\n\n  // Export to the adapter global object visible in the browser.\n  var adapter = {\n    browserDetails: browserDetails,\n    extractVersion: utils.extractVersion,\n    disableLog: utils.disableLog,\n    disableWarnings: utils.disableWarnings\n  };\n\n  // Uncomment the line below if you want logging to occur, including logging\n  // for the switch statement below. Can also be turned on in the browser via\n  // adapter.disableLog(false), but then logging from the switch statement below\n  // will not appear.\n  // require('./utils').disableLog(false);\n\n  // Browser shims.\n  var chromeShim = require('./chrome/chrome_shim') || null;\n  var edgeShim = require('./edge/edge_shim') || null;\n  var firefoxShim = require('./firefox/firefox_shim') || null;\n  var safariShim = require('./safari/safari_shim') || null;\n  var commonShim = require('./common_shim') || null;\n\n  // Shim browser if found.\n  switch (browserDetails.browser) {\n    case 'chrome':\n      if (!chromeShim || !chromeShim.shimPeerConnection ||\n          !options.shimChrome) {\n        logging('Chrome shim is not included in this adapter release.');\n        return adapter;\n      }\n      logging('adapter.js shimming chrome.');\n      // Export to the adapter global object visible in the browser.\n      adapter.browserShim = chromeShim;\n      commonShim.shimCreateObjectURL(window);\n\n      chromeShim.shimGetUserMedia(window);\n      chromeShim.shimMediaStream(window);\n      chromeShim.shimSourceObject(window);\n      chromeShim.shimPeerConnection(window);\n      chromeShim.shimOnTrack(window);\n      chromeShim.shimAddTrackRemoveTrack(window);\n      chromeShim.shimGetSendersWithDtmf(window);\n\n      commonShim.shimRTCIceCandidate(window);\n      break;\n    case 'firefox':\n      if (!firefoxShim || !firefoxShim.shimPeerConnection ||\n          !options.shimFirefox) {\n        logging('Firefox shim is not included in this adapter release.');\n        return adapter;\n      }\n      logging('adapter.js shimming firefox.');\n      // Export to the adapter global object visible in the browser.\n      adapter.browserShim = firefoxShim;\n      commonShim.shimCreateObjectURL(window);\n\n      firefoxShim.shimGetUserMedia(window);\n      firefoxShim.shimSourceObject(window);\n      firefoxShim.shimPeerConnection(window);\n      firefoxShim.shimOnTrack(window);\n      firefoxShim.shimRemoveStream(window);\n\n      commonShim.shimRTCIceCandidate(window);\n      break;\n    case 'edge':\n      if (!edgeShim || !edgeShim.shimPeerConnection || !options.shimEdge) {\n        logging('MS edge shim is not included in this adapter release.');\n        return adapter;\n      }\n      logging('adapter.js shimming edge.');\n      // Export to the adapter global object visible in the browser.\n      adapter.browserShim = edgeShim;\n      commonShim.shimCreateObjectURL(window);\n\n      edgeShim.shimGetUserMedia(window);\n      edgeShim.shimPeerConnection(window);\n      edgeShim.shimReplaceTrack(window);\n\n      // the edge shim implements the full RTCIceCandidate object.\n      break;\n    case 'safari':\n      if (!safariShim || !options.shimSafari) {\n        logging('Safari shim is not included in this adapter release.');\n        return adapter;\n      }\n      logging('adapter.js shimming safari.');\n      // Export to the adapter global object visible in the browser.\n      adapter.browserShim = safariShim;\n      commonShim.shimCreateObjectURL(window);\n\n      safariShim.shimRTCIceServerUrls(window);\n      safariShim.shimCallbacksAPI(window);\n      safariShim.shimLocalStreamsAPI(window);\n      safariShim.shimRemoteStreamsAPI(window);\n      safariShim.shimTrackEventTransceiver(window);\n      safariShim.shimGetUserMedia(window);\n      safariShim.shimCreateOfferLegacy(window);\n\n      commonShim.shimRTCIceCandidate(window);\n      break;\n    default:\n      logging('Unsupported browser!');\n      break;\n  }\n\n  return adapter;\n};\n\n},{\"./chrome/chrome_shim\":5,\"./common_shim\":7,\"./edge/edge_shim\":8,\"./firefox/firefox_shim\":10,\"./safari/safari_shim\":12,\"./utils\":13}],5:[function(require,module,exports){\n\n/*\n *  Copyright (c) 2016 The WebRTC project authors. All Rights Reserved.\n *\n *  Use of this source code is governed by a BSD-style license\n *  that can be found in the LICENSE file in the root of the source\n *  tree.\n */\n /* eslint-env node */\n'use strict';\nvar utils = require('../utils.js');\nvar logging = utils.log;\n\nmodule.exports = {\n  shimGetUserMedia: require('./getusermedia'),\n  shimMediaStream: function(window) {\n    window.MediaStream = window.MediaStream || window.webkitMediaStream;\n  },\n\n  shimOnTrack: function(window) {\n    if (typeof window === 'object' && window.RTCPeerConnection && !('ontrack' in\n        window.RTCPeerConnection.prototype)) {\n      Object.defineProperty(window.RTCPeerConnection.prototype, 'ontrack', {\n        get: function() {\n          return this._ontrack;\n        },\n        set: function(f) {\n          if (this._ontrack) {\n            this.removeEventListener('track', this._ontrack);\n          }\n          this.addEventListener('track', this._ontrack = f);\n        }\n      });\n      var origSetRemoteDescription =\n          window.RTCPeerConnection.prototype.setRemoteDescription;\n      window.RTCPeerConnection.prototype.setRemoteDescription = function() {\n        var pc = this;\n        if (!pc._ontrackpoly) {\n          pc._ontrackpoly = function(e) {\n            // onaddstream does not fire when a track is added to an existing\n            // stream. But stream.onaddtrack is implemented so we use that.\n            e.stream.addEventListener('addtrack', function(te) {\n              var receiver;\n              if (window.RTCPeerConnection.prototype.getReceivers) {\n                receiver = pc.getReceivers().find(function(r) {\n                  return r.track && r.track.id === te.track.id;\n                });\n              } else {\n                receiver = {track: te.track};\n              }\n\n              var event = new Event('track');\n              event.track = te.track;\n              event.receiver = receiver;\n              event.transceiver = {receiver: receiver};\n              event.streams = [e.stream];\n              pc.dispatchEvent(event);\n            });\n            e.stream.getTracks().forEach(function(track) {\n              var receiver;\n              if (window.RTCPeerConnection.prototype.getReceivers) {\n                receiver = pc.getReceivers().find(function(r) {\n                  return r.track && r.track.id === track.id;\n                });\n              } else {\n                receiver = {track: track};\n              }\n              var event = new Event('track');\n              event.track = track;\n              event.receiver = receiver;\n              event.transceiver = {receiver: receiver};\n              event.streams = [e.stream];\n              pc.dispatchEvent(event);\n            });\n          };\n          pc.addEventListener('addstream', pc._ontrackpoly);\n        }\n        return origSetRemoteDescription.apply(pc, arguments);\n      };\n    }\n  },\n\n  shimGetSendersWithDtmf: function(window) {\n    // Overrides addTrack/removeTrack, depends on shimAddTrackRemoveTrack.\n    if (typeof window === 'object' && window.RTCPeerConnection &&\n        !('getSenders' in window.RTCPeerConnection.prototype) &&\n        'createDTMFSender' in window.RTCPeerConnection.prototype) {\n      var shimSenderWithDtmf = function(pc, track) {\n        return {\n          track: track,\n          get dtmf() {\n            if (this._dtmf === undefined) {\n              if (track.kind === 'audio') {\n                this._dtmf = pc.createDTMFSender(track);\n              } else {\n                this._dtmf = null;\n              }\n            }\n            return this._dtmf;\n          },\n          _pc: pc\n        };\n      };\n\n      // augment addTrack when getSenders is not available.\n      if (!window.RTCPeerConnection.prototype.getSenders) {\n        window.RTCPeerConnection.prototype.getSenders = function() {\n          this._senders = this._senders || [];\n          return this._senders.slice(); // return a copy of the internal state.\n        };\n        var origAddTrack = window.RTCPeerConnection.prototype.addTrack;\n        window.RTCPeerConnection.prototype.addTrack = function(track, stream) {\n          var pc = this;\n          var sender = origAddTrack.apply(pc, arguments);\n          if (!sender) {\n            sender = shimSenderWithDtmf(pc, track);\n            pc._senders.push(sender);\n          }\n          return sender;\n        };\n\n        var origRemoveTrack = window.RTCPeerConnection.prototype.removeTrack;\n        window.RTCPeerConnection.prototype.removeTrack = function(sender) {\n          var pc = this;\n          origRemoveTrack.apply(pc, arguments);\n          var idx = pc._senders.indexOf(sender);\n          if (idx !== -1) {\n            pc._senders.splice(idx, 1);\n          }\n        };\n      }\n      var origAddStream = window.RTCPeerConnection.prototype.addStream;\n      window.RTCPeerConnection.prototype.addStream = function(stream) {\n        var pc = this;\n        pc._senders = pc._senders || [];\n        origAddStream.apply(pc, [stream]);\n        stream.getTracks().forEach(function(track) {\n          pc._senders.push(shimSenderWithDtmf(pc, track));\n        });\n      };\n\n      var origRemoveStream = window.RTCPeerConnection.prototype.removeStream;\n      window.RTCPeerConnection.prototype.removeStream = function(stream) {\n        var pc = this;\n        pc._senders = pc._senders || [];\n        origRemoveStream.apply(pc, [stream]);\n\n        stream.getTracks().forEach(function(track) {\n          var sender = pc._senders.find(function(s) {\n            return s.track === track;\n          });\n          if (sender) {\n            pc._senders.splice(pc._senders.indexOf(sender), 1); // remove sender\n          }\n        });\n      };\n    } else if (typeof window === 'object' && window.RTCPeerConnection &&\n               'getSenders' in window.RTCPeerConnection.prototype &&\n               'createDTMFSender' in window.RTCPeerConnection.prototype &&\n               window.RTCRtpSender &&\n               !('dtmf' in window.RTCRtpSender.prototype)) {\n      var origGetSenders = window.RTCPeerConnection.prototype.getSenders;\n      window.RTCPeerConnection.prototype.getSenders = function() {\n        var pc = this;\n        var senders = origGetSenders.apply(pc, []);\n        senders.forEach(function(sender) {\n          sender._pc = pc;\n        });\n        return senders;\n      };\n\n      Object.defineProperty(window.RTCRtpSender.prototype, 'dtmf', {\n        get: function() {\n          if (this._dtmf === undefined) {\n            if (this.track.kind === 'audio') {\n              this._dtmf = this._pc.createDTMFSender(this.track);\n            } else {\n              this._dtmf = null;\n            }\n          }\n          return this._dtmf;\n        }\n      });\n    }\n  },\n\n  shimSourceObject: function(window) {\n    var URL = window && window.URL;\n\n    if (typeof window === 'object') {\n      if (window.HTMLMediaElement &&\n        !('srcObject' in window.HTMLMediaElement.prototype)) {\n        // Shim the srcObject property, once, when HTMLMediaElement is found.\n        Object.defineProperty(window.HTMLMediaElement.prototype, 'srcObject', {\n          get: function() {\n            return this._srcObject;\n          },\n          set: function(stream) {\n            var self = this;\n            // Use _srcObject as a private property for this shim\n            this._srcObject = stream;\n            if (this.src) {\n              URL.revokeObjectURL(this.src);\n            }\n\n            if (!stream) {\n              this.src = '';\n              return undefined;\n            }\n            this.src = URL.createObjectURL(stream);\n            // We need to recreate the blob url when a track is added or\n            // removed. Doing it manually since we want to avoid a recursion.\n            stream.addEventListener('addtrack', function() {\n              if (self.src) {\n                URL.revokeObjectURL(self.src);\n              }\n              self.src = URL.createObjectURL(stream);\n            });\n            stream.addEventListener('removetrack', function() {\n              if (self.src) {\n                URL.revokeObjectURL(self.src);\n              }\n              self.src = URL.createObjectURL(stream);\n            });\n          }\n        });\n      }\n    }\n  },\n\n  shimAddTrackRemoveTrackWithNative: function(window) {\n    // shim addTrack/removeTrack with native variants in order to make\n    // the interactions with legacy getLocalStreams behave as in other browsers.\n    // Keeps a mapping stream.id => [stream, rtpsenders...]\n    window.RTCPeerConnection.prototype.getLocalStreams = function() {\n      var pc = this;\n      this._shimmedLocalStreams = this._shimmedLocalStreams || {};\n      return Object.keys(this._shimmedLocalStreams).map(function(streamId) {\n        return pc._shimmedLocalStreams[streamId][0];\n      });\n    };\n\n    var origAddTrack = window.RTCPeerConnection.prototype.addTrack;\n    window.RTCPeerConnection.prototype.addTrack = function(track, stream) {\n      if (!stream) {\n        return origAddTrack.apply(this, arguments);\n      }\n      this._shimmedLocalStreams = this._shimmedLocalStreams || {};\n\n      var sender = origAddTrack.apply(this, arguments);\n      if (!this._shimmedLocalStreams[stream.id]) {\n        this._shimmedLocalStreams[stream.id] = [stream, sender];\n      } else if (this._shimmedLocalStreams[stream.id].indexOf(sender) === -1) {\n        this._shimmedLocalStreams[stream.id].push(sender);\n      }\n      return sender;\n    };\n\n    var origAddStream = window.RTCPeerConnection.prototype.addStream;\n    window.RTCPeerConnection.prototype.addStream = function(stream) {\n      var pc = this;\n      this._shimmedLocalStreams = this._shimmedLocalStreams || {};\n\n      stream.getTracks().forEach(function(track) {\n        var alreadyExists = pc.getSenders().find(function(s) {\n          return s.track === track;\n        });\n        if (alreadyExists) {\n          throw new DOMException('Track already exists.',\n              'InvalidAccessError');\n        }\n      });\n      var existingSenders = pc.getSenders();\n      origAddStream.apply(this, arguments);\n      var newSenders = pc.getSenders().filter(function(newSender) {\n        return existingSenders.indexOf(newSender) === -1;\n      });\n      this._shimmedLocalStreams[stream.id] = [stream].concat(newSenders);\n    };\n\n    var origRemoveStream = window.RTCPeerConnection.prototype.removeStream;\n    window.RTCPeerConnection.prototype.removeStream = function(stream) {\n      this._shimmedLocalStreams = this._shimmedLocalStreams || {};\n      delete this._shimmedLocalStreams[stream.id];\n      return origRemoveStream.apply(this, arguments);\n    };\n\n    var origRemoveTrack = window.RTCPeerConnection.prototype.removeTrack;\n    window.RTCPeerConnection.prototype.removeTrack = function(sender) {\n      var pc = this;\n      this._shimmedLocalStreams = this._shimmedLocalStreams || {};\n      if (sender) {\n        Object.keys(this._shimmedLocalStreams).forEach(function(streamId) {\n          var idx = pc._shimmedLocalStreams[streamId].indexOf(sender);\n          if (idx !== -1) {\n            pc._shimmedLocalStreams[streamId].splice(idx, 1);\n          }\n          if (pc._shimmedLocalStreams[streamId].length === 1) {\n            delete pc._shimmedLocalStreams[streamId];\n          }\n        });\n      }\n      return origRemoveTrack.apply(this, arguments);\n    };\n  },\n\n  shimAddTrackRemoveTrack: function(window) {\n    var browserDetails = utils.detectBrowser(window);\n    // shim addTrack and removeTrack.\n    if (window.RTCPeerConnection.prototype.addTrack &&\n        browserDetails.version >= 65) {\n      return this.shimAddTrackRemoveTrackWithNative(window);\n    }\n\n    // also shim pc.getLocalStreams when addTrack is shimmed\n    // to return the original streams.\n    var origGetLocalStreams = window.RTCPeerConnection.prototype\n        .getLocalStreams;\n    window.RTCPeerConnection.prototype.getLocalStreams = function() {\n      var pc = this;\n      var nativeStreams = origGetLocalStreams.apply(this);\n      pc._reverseStreams = pc._reverseStreams || {};\n      return nativeStreams.map(function(stream) {\n        return pc._reverseStreams[stream.id];\n      });\n    };\n\n    var origAddStream = window.RTCPeerConnection.prototype.addStream;\n    window.RTCPeerConnection.prototype.addStream = function(stream) {\n      var pc = this;\n      pc._streams = pc._streams || {};\n      pc._reverseStreams = pc._reverseStreams || {};\n\n      stream.getTracks().forEach(function(track) {\n        var alreadyExists = pc.getSenders().find(function(s) {\n          return s.track === track;\n        });\n        if (alreadyExists) {\n          throw new DOMException('Track already exists.',\n              'InvalidAccessError');\n        }\n      });\n      // Add identity mapping for consistency with addTrack.\n      // Unless this is being used with a stream from addTrack.\n      if (!pc._reverseStreams[stream.id]) {\n        var newStream = new window.MediaStream(stream.getTracks());\n        pc._streams[stream.id] = newStream;\n        pc._reverseStreams[newStream.id] = stream;\n        stream = newStream;\n      }\n      origAddStream.apply(pc, [stream]);\n    };\n\n    var origRemoveStream = window.RTCPeerConnection.prototype.removeStream;\n    window.RTCPeerConnection.prototype.removeStream = function(stream) {\n      var pc = this;\n      pc._streams = pc._streams || {};\n      pc._reverseStreams = pc._reverseStreams || {};\n\n      origRemoveStream.apply(pc, [(pc._streams[stream.id] || stream)]);\n      delete pc._reverseStreams[(pc._streams[stream.id] ?\n          pc._streams[stream.id].id : stream.id)];\n      delete pc._streams[stream.id];\n    };\n\n    window.RTCPeerConnection.prototype.addTrack = function(track, stream) {\n      var pc = this;\n      if (pc.signalingState === 'closed') {\n        throw new DOMException(\n          'The RTCPeerConnection\\'s signalingState is \\'closed\\'.',\n          'InvalidStateError');\n      }\n      var streams = [].slice.call(arguments, 1);\n      if (streams.length !== 1 ||\n          !streams[0].getTracks().find(function(t) {\n            return t === track;\n          })) {\n        // this is not fully correct but all we can manage without\n        // [[associated MediaStreams]] internal slot.\n        throw new DOMException(\n          'The adapter.js addTrack polyfill only supports a single ' +\n          ' stream which is associated with the specified track.',\n          'NotSupportedError');\n      }\n\n      var alreadyExists = pc.getSenders().find(function(s) {\n        return s.track === track;\n      });\n      if (alreadyExists) {\n        throw new DOMException('Track already exists.',\n            'InvalidAccessError');\n      }\n\n      pc._streams = pc._streams || {};\n      pc._reverseStreams = pc._reverseStreams || {};\n      var oldStream = pc._streams[stream.id];\n      if (oldStream) {\n        // this is using odd Chrome behaviour, use with caution:\n        // https://bugs.chromium.org/p/webrtc/issues/detail?id=7815\n        // Note: we rely on the high-level addTrack/dtmf shim to\n        // create the sender with a dtmf sender.\n        oldStream.addTrack(track);\n\n        // Trigger ONN async.\n        Promise.resolve().then(function() {\n          pc.dispatchEvent(new Event('negotiationneeded'));\n        });\n      } else {\n        var newStream = new window.MediaStream([track]);\n        pc._streams[stream.id] = newStream;\n        pc._reverseStreams[newStream.id] = stream;\n        pc.addStream(newStream);\n      }\n      return pc.getSenders().find(function(s) {\n        return s.track === track;\n      });\n    };\n\n    // replace the internal stream id with the external one and\n    // vice versa.\n    function replaceInternalStreamId(pc, description) {\n      var sdp = description.sdp;\n      Object.keys(pc._reverseStreams || []).forEach(function(internalId) {\n        var externalStream = pc._reverseStreams[internalId];\n        var internalStream = pc._streams[externalStream.id];\n        sdp = sdp.replace(new RegExp(internalStream.id, 'g'),\n            externalStream.id);\n      });\n      return new RTCSessionDescription({\n        type: description.type,\n        sdp: sdp\n      });\n    }\n    function replaceExternalStreamId(pc, description) {\n      var sdp = description.sdp;\n      Object.keys(pc._reverseStreams || []).forEach(function(internalId) {\n        var externalStream = pc._reverseStreams[internalId];\n        var internalStream = pc._streams[externalStream.id];\n        sdp = sdp.replace(new RegExp(externalStream.id, 'g'),\n            internalStream.id);\n      });\n      return new RTCSessionDescription({\n        type: description.type,\n        sdp: sdp\n      });\n    }\n    ['createOffer', 'createAnswer'].forEach(function(method) {\n      var nativeMethod = window.RTCPeerConnection.prototype[method];\n      window.RTCPeerConnection.prototype[method] = function() {\n        var pc = this;\n        var args = arguments;\n        var isLegacyCall = arguments.length &&\n            typeof arguments[0] === 'function';\n        if (isLegacyCall) {\n          return nativeMethod.apply(pc, [\n            function(description) {\n              var desc = replaceInternalStreamId(pc, description);\n              args[0].apply(null, [desc]);\n            },\n            function(err) {\n              if (args[1]) {\n                args[1].apply(null, err);\n              }\n            }, arguments[2]\n          ]);\n        }\n        return nativeMethod.apply(pc, arguments)\n        .then(function(description) {\n          return replaceInternalStreamId(pc, description);\n        });\n      };\n    });\n\n    var origSetLocalDescription =\n        window.RTCPeerConnection.prototype.setLocalDescription;\n    window.RTCPeerConnection.prototype.setLocalDescription = function() {\n      var pc = this;\n      if (!arguments.length || !arguments[0].type) {\n        return origSetLocalDescription.apply(pc, arguments);\n      }\n      arguments[0] = replaceExternalStreamId(pc, arguments[0]);\n      return origSetLocalDescription.apply(pc, arguments);\n    };\n\n    // TODO: mangle getStats: https://w3c.github.io/webrtc-stats/#dom-rtcmediastreamstats-streamidentifier\n\n    var origLocalDescription = Object.getOwnPropertyDescriptor(\n        window.RTCPeerConnection.prototype, 'localDescription');\n    Object.defineProperty(window.RTCPeerConnection.prototype,\n        'localDescription', {\n          get: function() {\n            var pc = this;\n            var description = origLocalDescription.get.apply(this);\n            if (description.type === '') {\n              return description;\n            }\n            return replaceInternalStreamId(pc, description);\n          }\n        });\n\n    window.RTCPeerConnection.prototype.removeTrack = function(sender) {\n      var pc = this;\n      if (pc.signalingState === 'closed') {\n        throw new DOMException(\n          'The RTCPeerConnection\\'s signalingState is \\'closed\\'.',\n          'InvalidStateError');\n      }\n      // We can not yet check for sender instanceof RTCRtpSender\n      // since we shim RTPSender. So we check if sender._pc is set.\n      if (!sender._pc) {\n        throw new DOMException('Argument 1 of RTCPeerConnection.removeTrack ' +\n            'does not implement interface RTCRtpSender.', 'TypeError');\n      }\n      var isLocal = sender._pc === pc;\n      if (!isLocal) {\n        throw new DOMException('Sender was not created by this connection.',\n            'InvalidAccessError');\n      }\n\n      // Search for the native stream the senders track belongs to.\n      pc._streams = pc._streams || {};\n      var stream;\n      Object.keys(pc._streams).forEach(function(streamid) {\n        var hasTrack = pc._streams[streamid].getTracks().find(function(track) {\n          return sender.track === track;\n        });\n        if (hasTrack) {\n          stream = pc._streams[streamid];\n        }\n      });\n\n      if (stream) {\n        if (stream.getTracks().length === 1) {\n          // if this is the last track of the stream, remove the stream. This\n          // takes care of any shimmed _senders.\n          pc.removeStream(pc._reverseStreams[stream.id]);\n        } else {\n          // relying on the same odd chrome behaviour as above.\n          stream.removeTrack(sender.track);\n        }\n        pc.dispatchEvent(new Event('negotiationneeded'));\n      }\n    };\n  },\n\n  shimPeerConnection: function(window) {\n    var browserDetails = utils.detectBrowser(window);\n\n    // The RTCPeerConnection object.\n    if (!window.RTCPeerConnection) {\n      window.RTCPeerConnection = function(pcConfig, pcConstraints) {\n        // Translate iceTransportPolicy to iceTransports,\n        // see https://code.google.com/p/webrtc/issues/detail?id=4869\n        // this was fixed in M56 along with unprefixing RTCPeerConnection.\n        logging('PeerConnection');\n        if (pcConfig && pcConfig.iceTransportPolicy) {\n          pcConfig.iceTransports = pcConfig.iceTransportPolicy;\n        }\n\n        return new window.webkitRTCPeerConnection(pcConfig, pcConstraints);\n      };\n      window.RTCPeerConnection.prototype =\n          window.webkitRTCPeerConnection.prototype;\n      // wrap static methods. Currently just generateCertificate.\n      if (window.webkitRTCPeerConnection.generateCertificate) {\n        Object.defineProperty(window.RTCPeerConnection, 'generateCertificate', {\n          get: function() {\n            return window.webkitRTCPeerConnection.generateCertificate;\n          }\n        });\n      }\n    } else {\n      // migrate from non-spec RTCIceServer.url to RTCIceServer.urls\n      var OrigPeerConnection = window.RTCPeerConnection;\n      window.RTCPeerConnection = function(pcConfig, pcConstraints) {\n        if (pcConfig && pcConfig.iceServers) {\n          var newIceServers = [];\n          for (var i = 0; i < pcConfig.iceServers.length; i++) {\n            var server = pcConfig.iceServers[i];\n            if (!server.hasOwnProperty('urls') &&\n                server.hasOwnProperty('url')) {\n              utils.deprecated('RTCIceServer.url', 'RTCIceServer.urls');\n              server = JSON.parse(JSON.stringify(server));\n              server.urls = server.url;\n              newIceServers.push(server);\n            } else {\n              newIceServers.push(pcConfig.iceServers[i]);\n            }\n          }\n          pcConfig.iceServers = newIceServers;\n        }\n        return new OrigPeerConnection(pcConfig, pcConstraints);\n      };\n      window.RTCPeerConnection.prototype = OrigPeerConnection.prototype;\n      // wrap static methods. Currently just generateCertificate.\n      Object.defineProperty(window.RTCPeerConnection, 'generateCertificate', {\n        get: function() {\n          return OrigPeerConnection.generateCertificate;\n        }\n      });\n    }\n\n    var origGetStats = window.RTCPeerConnection.prototype.getStats;\n    window.RTCPeerConnection.prototype.getStats = function(selector,\n        successCallback, errorCallback) {\n      var pc = this;\n      var args = arguments;\n\n      // If selector is a function then we are in the old style stats so just\n      // pass back the original getStats format to avoid breaking old users.\n      if (arguments.length > 0 && typeof selector === 'function') {\n        return origGetStats.apply(this, arguments);\n      }\n\n      // When spec-style getStats is supported, return those when called with\n      // either no arguments or the selector argument is null.\n      if (origGetStats.length === 0 && (arguments.length === 0 ||\n          typeof arguments[0] !== 'function')) {\n        return origGetStats.apply(this, []);\n      }\n\n      var fixChromeStats_ = function(response) {\n        var standardReport = {};\n        var reports = response.result();\n        reports.forEach(function(report) {\n          var standardStats = {\n            id: report.id,\n            timestamp: report.timestamp,\n            type: {\n              localcandidate: 'local-candidate',\n              remotecandidate: 'remote-candidate'\n            }[report.type] || report.type\n          };\n          report.names().forEach(function(name) {\n            standardStats[name] = report.stat(name);\n          });\n          standardReport[standardStats.id] = standardStats;\n        });\n\n        return standardReport;\n      };\n\n      // shim getStats with maplike support\n      var makeMapStats = function(stats) {\n        return new Map(Object.keys(stats).map(function(key) {\n          return [key, stats[key]];\n        }));\n      };\n\n      if (arguments.length >= 2) {\n        var successCallbackWrapper_ = function(response) {\n          args[1](makeMapStats(fixChromeStats_(response)));\n        };\n\n        return origGetStats.apply(this, [successCallbackWrapper_,\n          arguments[0]]);\n      }\n\n      // promise-support\n      return new Promise(function(resolve, reject) {\n        origGetStats.apply(pc, [\n          function(response) {\n            resolve(makeMapStats(fixChromeStats_(response)));\n          }, reject]);\n      }).then(successCallback, errorCallback);\n    };\n\n    // add promise support -- natively available in Chrome 51\n    if (browserDetails.version < 51) {\n      ['setLocalDescription', 'setRemoteDescription', 'addIceCandidate']\n          .forEach(function(method) {\n            var nativeMethod = window.RTCPeerConnection.prototype[method];\n            window.RTCPeerConnection.prototype[method] = function() {\n              var args = arguments;\n              var pc = this;\n              var promise = new Promise(function(resolve, reject) {\n                nativeMethod.apply(pc, [args[0], resolve, reject]);\n              });\n              if (args.length < 2) {\n                return promise;\n              }\n              return promise.then(function() {\n                args[1].apply(null, []);\n              },\n              function(err) {\n                if (args.length >= 3) {\n                  args[2].apply(null, [err]);\n                }\n              });\n            };\n          });\n    }\n\n    // promise support for createOffer and createAnswer. Available (without\n    // bugs) since M52: crbug/619289\n    if (browserDetails.version < 52) {\n      ['createOffer', 'createAnswer'].forEach(function(method) {\n        var nativeMethod = window.RTCPeerConnection.prototype[method];\n        window.RTCPeerConnection.prototype[method] = function() {\n          var pc = this;\n          if (arguments.length < 1 || (arguments.length === 1 &&\n              typeof arguments[0] === 'object')) {\n            var opts = arguments.length === 1 ? arguments[0] : undefined;\n            return new Promise(function(resolve, reject) {\n              nativeMethod.apply(pc, [resolve, reject, opts]);\n            });\n          }\n          return nativeMethod.apply(this, arguments);\n        };\n      });\n    }\n\n    // shim implicit creation of RTCSessionDescription/RTCIceCandidate\n    ['setLocalDescription', 'setRemoteDescription', 'addIceCandidate']\n        .forEach(function(method) {\n          var nativeMethod = window.RTCPeerConnection.prototype[method];\n          window.RTCPeerConnection.prototype[method] = function() {\n            arguments[0] = new ((method === 'addIceCandidate') ?\n                window.RTCIceCandidate :\n                window.RTCSessionDescription)(arguments[0]);\n            return nativeMethod.apply(this, arguments);\n          };\n        });\n\n    // support for addIceCandidate(null or undefined)\n    var nativeAddIceCandidate =\n        window.RTCPeerConnection.prototype.addIceCandidate;\n    window.RTCPeerConnection.prototype.addIceCandidate = function() {\n      if (!arguments[0]) {\n        if (arguments[1]) {\n          arguments[1].apply(null);\n        }\n        return Promise.resolve();\n      }\n      return nativeAddIceCandidate.apply(this, arguments);\n    };\n  }\n};\n\n},{\"../utils.js\":13,\"./getusermedia\":6}],6:[function(require,module,exports){\n/*\n *  Copyright (c) 2016 The WebRTC project authors. All Rights Reserved.\n *\n *  Use of this source code is governed by a BSD-style license\n *  that can be found in the LICENSE file in the root of the source\n *  tree.\n */\n /* eslint-env node */\n'use strict';\nvar utils = require('../utils.js');\nvar logging = utils.log;\n\n// Expose public methods.\nmodule.exports = function(window) {\n  var browserDetails = utils.detectBrowser(window);\n  var navigator = window && window.navigator;\n\n  var constraintsToChrome_ = function(c) {\n    if (typeof c !== 'object' || c.mandatory || c.optional) {\n      return c;\n    }\n    var cc = {};\n    Object.keys(c).forEach(function(key) {\n      if (key === 'require' || key === 'advanced' || key === 'mediaSource') {\n        return;\n      }\n      var r = (typeof c[key] === 'object') ? c[key] : {ideal: c[key]};\n      if (r.exact !== undefined && typeof r.exact === 'number') {\n        r.min = r.max = r.exact;\n      }\n      var oldname_ = function(prefix, name) {\n        if (prefix) {\n          return prefix + name.charAt(0).toUpperCase() + name.slice(1);\n        }\n        return (name === 'deviceId') ? 'sourceId' : name;\n      };\n      if (r.ideal !== undefined) {\n        cc.optional = cc.optional || [];\n        var oc = {};\n        if (typeof r.ideal === 'number') {\n          oc[oldname_('min', key)] = r.ideal;\n          cc.optional.push(oc);\n          oc = {};\n          oc[oldname_('max', key)] = r.ideal;\n          cc.optional.push(oc);\n        } else {\n          oc[oldname_('', key)] = r.ideal;\n          cc.optional.push(oc);\n        }\n      }\n      if (r.exact !== undefined && typeof r.exact !== 'number') {\n        cc.mandatory = cc.mandatory || {};\n        cc.mandatory[oldname_('', key)] = r.exact;\n      } else {\n        ['min', 'max'].forEach(function(mix) {\n          if (r[mix] !== undefined) {\n            cc.mandatory = cc.mandatory || {};\n            cc.mandatory[oldname_(mix, key)] = r[mix];\n          }\n        });\n      }\n    });\n    if (c.advanced) {\n      cc.optional = (cc.optional || []).concat(c.advanced);\n    }\n    return cc;\n  };\n\n  var shimConstraints_ = function(constraints, func) {\n    if (browserDetails.version >= 61) {\n      return func(constraints);\n    }\n    constraints = JSON.parse(JSON.stringify(constraints));\n    if (constraints && typeof constraints.audio === 'object') {\n      var remap = function(obj, a, b) {\n        if (a in obj && !(b in obj)) {\n          obj[b] = obj[a];\n          delete obj[a];\n        }\n      };\n      constraints = JSON.parse(JSON.stringify(constraints));\n      remap(constraints.audio, 'autoGainControl', 'googAutoGainControl');\n      remap(constraints.audio, 'noiseSuppression', 'googNoiseSuppression');\n      constraints.audio = constraintsToChrome_(constraints.audio);\n    }\n    if (constraints && typeof constraints.video === 'object') {\n      // Shim facingMode for mobile & surface pro.\n      var face = constraints.video.facingMode;\n      face = face && ((typeof face === 'object') ? face : {ideal: face});\n      var getSupportedFacingModeLies = browserDetails.version < 66;\n\n      if ((face && (face.exact === 'user' || face.exact === 'environment' ||\n                    face.ideal === 'user' || face.ideal === 'environment')) &&\n          !(navigator.mediaDevices.getSupportedConstraints &&\n            navigator.mediaDevices.getSupportedConstraints().facingMode &&\n            !getSupportedFacingModeLies)) {\n        delete constraints.video.facingMode;\n        var matches;\n        if (face.exact === 'environment' || face.ideal === 'environment') {\n          matches = ['back', 'rear'];\n        } else if (face.exact === 'user' || face.ideal === 'user') {\n          matches = ['front'];\n        }\n        if (matches) {\n          // Look for matches in label, or use last cam for back (typical).\n          return navigator.mediaDevices.enumerateDevices()\n          .then(function(devices) {\n            devices = devices.filter(function(d) {\n              return d.kind === 'videoinput';\n            });\n            var dev = devices.find(function(d) {\n              return matches.some(function(match) {\n                return d.label.toLowerCase().indexOf(match) !== -1;\n              });\n            });\n            if (!dev && devices.length && matches.indexOf('back') !== -1) {\n              dev = devices[devices.length - 1]; // more likely the back cam\n            }\n            if (dev) {\n              constraints.video.deviceId = face.exact ? {exact: dev.deviceId} :\n                                                        {ideal: dev.deviceId};\n            }\n            constraints.video = constraintsToChrome_(constraints.video);\n            logging('chrome: ' + JSON.stringify(constraints));\n            return func(constraints);\n          });\n        }\n      }\n      constraints.video = constraintsToChrome_(constraints.video);\n    }\n    logging('chrome: ' + JSON.stringify(constraints));\n    return func(constraints);\n  };\n\n  var shimError_ = function(e) {\n    return {\n      name: {\n        PermissionDeniedError: 'NotAllowedError',\n        InvalidStateError: 'NotReadableError',\n        DevicesNotFoundError: 'NotFoundError',\n        ConstraintNotSatisfiedError: 'OverconstrainedError',\n        TrackStartError: 'NotReadableError',\n        MediaDeviceFailedDueToShutdown: 'NotReadableError',\n        MediaDeviceKillSwitchOn: 'NotReadableError'\n      }[e.name] || e.name,\n      message: e.message,\n      constraint: e.constraintName,\n      toString: function() {\n        return this.name + (this.message && ': ') + this.message;\n      }\n    };\n  };\n\n  var getUserMedia_ = function(constraints, onSuccess, onError) {\n    shimConstraints_(constraints, function(c) {\n      navigator.webkitGetUserMedia(c, onSuccess, function(e) {\n        if (onError) {\n          onError(shimError_(e));\n        }\n      });\n    });\n  };\n\n  navigator.getUserMedia = getUserMedia_;\n\n  // Returns the result of getUserMedia as a Promise.\n  var getUserMediaPromise_ = function(constraints) {\n    return new Promise(function(resolve, reject) {\n      navigator.getUserMedia(constraints, resolve, reject);\n    });\n  };\n\n  if (!navigator.mediaDevices) {\n    navigator.mediaDevices = {\n      getUserMedia: getUserMediaPromise_,\n      enumerateDevices: function() {\n        return new Promise(function(resolve) {\n          var kinds = {audio: 'audioinput', video: 'videoinput'};\n          return window.MediaStreamTrack.getSources(function(devices) {\n            resolve(devices.map(function(device) {\n              return {label: device.label,\n                kind: kinds[device.kind],\n                deviceId: device.id,\n                groupId: ''};\n            }));\n          });\n        });\n      },\n      getSupportedConstraints: function() {\n        return {\n          deviceId: true, echoCancellation: true, facingMode: true,\n          frameRate: true, height: true, width: true\n        };\n      }\n    };\n  }\n\n  // A shim for getUserMedia method on the mediaDevices object.\n  // TODO(KaptenJansson) remove once implemented in Chrome stable.\n  if (!navigator.mediaDevices.getUserMedia) {\n    navigator.mediaDevices.getUserMedia = function(constraints) {\n      return getUserMediaPromise_(constraints);\n    };\n  } else {\n    // Even though Chrome 45 has navigator.mediaDevices and a getUserMedia\n    // function which returns a Promise, it does not accept spec-style\n    // constraints.\n    var origGetUserMedia = navigator.mediaDevices.getUserMedia.\n        bind(navigator.mediaDevices);\n    navigator.mediaDevices.getUserMedia = function(cs) {\n      return shimConstraints_(cs, function(c) {\n        return origGetUserMedia(c).then(function(stream) {\n          if (c.audio && !stream.getAudioTracks().length ||\n              c.video && !stream.getVideoTracks().length) {\n            stream.getTracks().forEach(function(track) {\n              track.stop();\n            });\n            throw new DOMException('', 'NotFoundError');\n          }\n          return stream;\n        }, function(e) {\n          return Promise.reject(shimError_(e));\n        });\n      });\n    };\n  }\n\n  // Dummy devicechange event methods.\n  // TODO(KaptenJansson) remove once implemented in Chrome stable.\n  if (typeof navigator.mediaDevices.addEventListener === 'undefined') {\n    navigator.mediaDevices.addEventListener = function() {\n      logging('Dummy mediaDevices.addEventListener called.');\n    };\n  }\n  if (typeof navigator.mediaDevices.removeEventListener === 'undefined') {\n    navigator.mediaDevices.removeEventListener = function() {\n      logging('Dummy mediaDevices.removeEventListener called.');\n    };\n  }\n};\n\n},{\"../utils.js\":13}],7:[function(require,module,exports){\n/*\n *  Copyright (c) 2017 The WebRTC project authors. All Rights Reserved.\n *\n *  Use of this source code is governed by a BSD-style license\n *  that can be found in the LICENSE file in the root of the source\n *  tree.\n */\n /* eslint-env node */\n'use strict';\n\nvar SDPUtils = require('sdp');\nvar utils = require('./utils');\n\n// Wraps the peerconnection event eventNameToWrap in a function\n// which returns the modified event object.\nfunction wrapPeerConnectionEvent(window, eventNameToWrap, wrapper) {\n  if (!window.RTCPeerConnection) {\n    return;\n  }\n  var proto = window.RTCPeerConnection.prototype;\n  var nativeAddEventListener = proto.addEventListener;\n  proto.addEventListener = function(nativeEventName, cb) {\n    if (nativeEventName !== eventNameToWrap) {\n      return nativeAddEventListener.apply(this, arguments);\n    }\n    var wrappedCallback = function(e) {\n      cb(wrapper(e));\n    };\n    this._eventMap = this._eventMap || {};\n    this._eventMap[cb] = wrappedCallback;\n    return nativeAddEventListener.apply(this, [nativeEventName,\n      wrappedCallback]);\n  };\n\n  var nativeRemoveEventListener = proto.removeEventListener;\n  proto.removeEventListener = function(nativeEventName, cb) {\n    if (nativeEventName !== eventNameToWrap || !this._eventMap\n        || !this._eventMap[cb]) {\n      return nativeRemoveEventListener.apply(this, arguments);\n    }\n    var unwrappedCb = this._eventMap[cb];\n    delete this._eventMap[cb];\n    return nativeRemoveEventListener.apply(this, [nativeEventName,\n      unwrappedCb]);\n  };\n\n  Object.defineProperty(proto, 'on' + eventNameToWrap, {\n    get: function() {\n      return this['_on' + eventNameToWrap];\n    },\n    set: function(cb) {\n      if (this['_on' + eventNameToWrap]) {\n        this.removeEventListener(eventNameToWrap,\n            this['_on' + eventNameToWrap]);\n        delete this['_on' + eventNameToWrap];\n      }\n      if (cb) {\n        this.addEventListener(eventNameToWrap,\n            this['_on' + eventNameToWrap] = cb);\n      }\n    }\n  });\n}\n\nmodule.exports = {\n  shimRTCIceCandidate: function(window) {\n    // foundation is arbitrarily chosen as an indicator for full support for\n    // https://w3c.github.io/webrtc-pc/#rtcicecandidate-interface\n    if (window.RTCIceCandidate && 'foundation' in\n        window.RTCIceCandidate.prototype) {\n      return;\n    }\n\n    var NativeRTCIceCandidate = window.RTCIceCandidate;\n    window.RTCIceCandidate = function(args) {\n      // Remove the a= which shouldn't be part of the candidate string.\n      if (typeof args === 'object' && args.candidate &&\n          args.candidate.indexOf('a=') === 0) {\n        args = JSON.parse(JSON.stringify(args));\n        args.candidate = args.candidate.substr(2);\n      }\n\n      // Augment the native candidate with the parsed fields.\n      var nativeCandidate = new NativeRTCIceCandidate(args);\n      var parsedCandidate = SDPUtils.parseCandidate(args.candidate);\n      var augmentedCandidate = Object.assign(nativeCandidate,\n          parsedCandidate);\n\n      // Add a serializer that does not serialize the extra attributes.\n      augmentedCandidate.toJSON = function() {\n        return {\n          candidate: augmentedCandidate.candidate,\n          sdpMid: augmentedCandidate.sdpMid,\n          sdpMLineIndex: augmentedCandidate.sdpMLineIndex,\n          usernameFragment: augmentedCandidate.usernameFragment,\n        };\n      };\n      return augmentedCandidate;\n    };\n\n    // Hook up the augmented candidate in onicecandidate and\n    // addEventListener('icecandidate', ...)\n    wrapPeerConnectionEvent(window, 'icecandidate', function(e) {\n      if (e.candidate) {\n        Object.defineProperty(e, 'candidate', {\n          value: new window.RTCIceCandidate(e.candidate),\n          writable: 'false'\n        });\n      }\n      return e;\n    });\n  },\n\n  // shimCreateObjectURL must be called before shimSourceObject to avoid loop.\n\n  shimCreateObjectURL: function(window) {\n    var URL = window && window.URL;\n\n    if (!(typeof window === 'object' && window.HTMLMediaElement &&\n          'srcObject' in window.HTMLMediaElement.prototype &&\n        URL.createObjectURL && URL.revokeObjectURL)) {\n      // Only shim CreateObjectURL using srcObject if srcObject exists.\n      return undefined;\n    }\n\n    var nativeCreateObjectURL = URL.createObjectURL.bind(URL);\n    var nativeRevokeObjectURL = URL.revokeObjectURL.bind(URL);\n    var streams = new Map(), newId = 0;\n\n    URL.createObjectURL = function(stream) {\n      if ('getTracks' in stream) {\n        var url = 'polyblob:' + (++newId);\n        streams.set(url, stream);\n        utils.deprecated('URL.createObjectURL(stream)',\n            'elem.srcObject = stream');\n        return url;\n      }\n      return nativeCreateObjectURL(stream);\n    };\n    URL.revokeObjectURL = function(url) {\n      nativeRevokeObjectURL(url);\n      streams.delete(url);\n    };\n\n    var dsc = Object.getOwnPropertyDescriptor(window.HTMLMediaElement.prototype,\n                                              'src');\n    Object.defineProperty(window.HTMLMediaElement.prototype, 'src', {\n      get: function() {\n        return dsc.get.apply(this);\n      },\n      set: function(url) {\n        this.srcObject = streams.get(url) || null;\n        return dsc.set.apply(this, [url]);\n      }\n    });\n\n    var nativeSetAttribute = window.HTMLMediaElement.prototype.setAttribute;\n    window.HTMLMediaElement.prototype.setAttribute = function() {\n      if (arguments.length === 2 &&\n          ('' + arguments[0]).toLowerCase() === 'src') {\n        this.srcObject = streams.get(arguments[1]) || null;\n      }\n      return nativeSetAttribute.apply(this, arguments);\n    };\n  }\n};\n\n},{\"./utils\":13,\"sdp\":2}],8:[function(require,module,exports){\n/*\n *  Copyright (c) 2016 The WebRTC project authors. All Rights Reserved.\n *\n *  Use of this source code is governed by a BSD-style license\n *  that can be found in the LICENSE file in the root of the source\n *  tree.\n */\n /* eslint-env node */\n'use strict';\n\nvar utils = require('../utils');\nvar shimRTCPeerConnection = require('rtcpeerconnection-shim');\n\nmodule.exports = {\n  shimGetUserMedia: require('./getusermedia'),\n  shimPeerConnection: function(window) {\n    var browserDetails = utils.detectBrowser(window);\n\n    if (window.RTCIceGatherer) {\n      // ORTC defines an RTCIceCandidate object but no constructor.\n      // Not implemented in Edge.\n      if (!window.RTCIceCandidate) {\n        window.RTCIceCandidate = function(args) {\n          return args;\n        };\n      }\n      // ORTC does not have a session description object but\n      // other browsers (i.e. Chrome) that will support both PC and ORTC\n      // in the future might have this defined already.\n      if (!window.RTCSessionDescription) {\n        window.RTCSessionDescription = function(args) {\n          return args;\n        };\n      }\n      // this adds an additional event listener to MediaStrackTrack that signals\n      // when a tracks enabled property was changed. Workaround for a bug in\n      // addStream, see below. No longer required in 15025+\n      if (browserDetails.version < 15025) {\n        var origMSTEnabled = Object.getOwnPropertyDescriptor(\n            window.MediaStreamTrack.prototype, 'enabled');\n        Object.defineProperty(window.MediaStreamTrack.prototype, 'enabled', {\n          set: function(value) {\n            origMSTEnabled.set.call(this, value);\n            var ev = new Event('enabled');\n            ev.enabled = value;\n            this.dispatchEvent(ev);\n          }\n        });\n      }\n    }\n\n    // ORTC defines the DTMF sender a bit different.\n    // https://github.com/w3c/ortc/issues/714\n    if (window.RTCRtpSender && !('dtmf' in window.RTCRtpSender.prototype)) {\n      Object.defineProperty(window.RTCRtpSender.prototype, 'dtmf', {\n        get: function() {\n          if (this._dtmf === undefined) {\n            if (this.track.kind === 'audio') {\n              this._dtmf = new window.RTCDtmfSender(this);\n            } else if (this.track.kind === 'video') {\n              this._dtmf = null;\n            }\n          }\n          return this._dtmf;\n        }\n      });\n    }\n\n    window.RTCPeerConnection =\n        shimRTCPeerConnection(window, browserDetails.version);\n  },\n  shimReplaceTrack: function(window) {\n    // ORTC has replaceTrack -- https://github.com/w3c/ortc/issues/614\n    if (window.RTCRtpSender &&\n        !('replaceTrack' in window.RTCRtpSender.prototype)) {\n      window.RTCRtpSender.prototype.replaceTrack =\n          window.RTCRtpSender.prototype.setTrack;\n    }\n  }\n};\n\n},{\"../utils\":13,\"./getusermedia\":9,\"rtcpeerconnection-shim\":1}],9:[function(require,module,exports){\n/*\n *  Copyright (c) 2016 The WebRTC project authors. All Rights Reserved.\n *\n *  Use of this source code is governed by a BSD-style license\n *  that can be found in the LICENSE file in the root of the source\n *  tree.\n */\n /* eslint-env node */\n'use strict';\n\n// Expose public methods.\nmodule.exports = function(window) {\n  var navigator = window && window.navigator;\n\n  var shimError_ = function(e) {\n    return {\n      name: {PermissionDeniedError: 'NotAllowedError'}[e.name] || e.name,\n      message: e.message,\n      constraint: e.constraint,\n      toString: function() {\n        return this.name;\n      }\n    };\n  };\n\n  // getUserMedia error shim.\n  var origGetUserMedia = navigator.mediaDevices.getUserMedia.\n      bind(navigator.mediaDevices);\n  navigator.mediaDevices.getUserMedia = function(c) {\n    return origGetUserMedia(c).catch(function(e) {\n      return Promise.reject(shimError_(e));\n    });\n  };\n};\n\n},{}],10:[function(require,module,exports){\n/*\n *  Copyright (c) 2016 The WebRTC project authors. All Rights Reserved.\n *\n *  Use of this source code is governed by a BSD-style license\n *  that can be found in the LICENSE file in the root of the source\n *  tree.\n */\n /* eslint-env node */\n'use strict';\n\nvar utils = require('../utils');\n\nmodule.exports = {\n  shimGetUserMedia: require('./getusermedia'),\n  shimOnTrack: function(window) {\n    if (typeof window === 'object' && window.RTCPeerConnection && !('ontrack' in\n        window.RTCPeerConnection.prototype)) {\n      Object.defineProperty(window.RTCPeerConnection.prototype, 'ontrack', {\n        get: function() {\n          return this._ontrack;\n        },\n        set: function(f) {\n          if (this._ontrack) {\n            this.removeEventListener('track', this._ontrack);\n            this.removeEventListener('addstream', this._ontrackpoly);\n          }\n          this.addEventListener('track', this._ontrack = f);\n          this.addEventListener('addstream', this._ontrackpoly = function(e) {\n            e.stream.getTracks().forEach(function(track) {\n              var event = new Event('track');\n              event.track = track;\n              event.receiver = {track: track};\n              event.transceiver = {receiver: event.receiver};\n              event.streams = [e.stream];\n              this.dispatchEvent(event);\n            }.bind(this));\n          }.bind(this));\n        }\n      });\n    }\n    if (typeof window === 'object' && window.RTCTrackEvent &&\n        ('receiver' in window.RTCTrackEvent.prototype) &&\n        !('transceiver' in window.RTCTrackEvent.prototype)) {\n      Object.defineProperty(window.RTCTrackEvent.prototype, 'transceiver', {\n        get: function() {\n          return {receiver: this.receiver};\n        }\n      });\n    }\n  },\n\n  shimSourceObject: function(window) {\n    // Firefox has supported mozSrcObject since FF22, unprefixed in 42.\n    if (typeof window === 'object') {\n      if (window.HTMLMediaElement &&\n        !('srcObject' in window.HTMLMediaElement.prototype)) {\n        // Shim the srcObject property, once, when HTMLMediaElement is found.\n        Object.defineProperty(window.HTMLMediaElement.prototype, 'srcObject', {\n          get: function() {\n            return this.mozSrcObject;\n          },\n          set: function(stream) {\n            this.mozSrcObject = stream;\n          }\n        });\n      }\n    }\n  },\n\n  shimPeerConnection: function(window) {\n    var browserDetails = utils.detectBrowser(window);\n\n    if (typeof window !== 'object' || !(window.RTCPeerConnection ||\n        window.mozRTCPeerConnection)) {\n      return; // probably media.peerconnection.enabled=false in about:config\n    }\n    // The RTCPeerConnection object.\n    if (!window.RTCPeerConnection) {\n      window.RTCPeerConnection = function(pcConfig, pcConstraints) {\n        if (browserDetails.version < 38) {\n          // .urls is not supported in FF < 38.\n          // create RTCIceServers with a single url.\n          if (pcConfig && pcConfig.iceServers) {\n            var newIceServers = [];\n            for (var i = 0; i < pcConfig.iceServers.length; i++) {\n              var server = pcConfig.iceServers[i];\n              if (server.hasOwnProperty('urls')) {\n                for (var j = 0; j < server.urls.length; j++) {\n                  var newServer = {\n                    url: server.urls[j]\n                  };\n                  if (server.urls[j].indexOf('turn') === 0) {\n                    newServer.username = server.username;\n                    newServer.credential = server.credential;\n                  }\n                  newIceServers.push(newServer);\n                }\n              } else {\n                newIceServers.push(pcConfig.iceServers[i]);\n              }\n            }\n            pcConfig.iceServers = newIceServers;\n          }\n        }\n        return new window.mozRTCPeerConnection(pcConfig, pcConstraints);\n      };\n      window.RTCPeerConnection.prototype =\n          window.mozRTCPeerConnection.prototype;\n\n      // wrap static methods. Currently just generateCertificate.\n      if (window.mozRTCPeerConnection.generateCertificate) {\n        Object.defineProperty(window.RTCPeerConnection, 'generateCertificate', {\n          get: function() {\n            return window.mozRTCPeerConnection.generateCertificate;\n          }\n        });\n      }\n\n      window.RTCSessionDescription = window.mozRTCSessionDescription;\n      window.RTCIceCandidate = window.mozRTCIceCandidate;\n    }\n\n    // shim away need for obsolete RTCIceCandidate/RTCSessionDescription.\n    ['setLocalDescription', 'setRemoteDescription', 'addIceCandidate']\n        .forEach(function(method) {\n          var nativeMethod = window.RTCPeerConnection.prototype[method];\n          window.RTCPeerConnection.prototype[method] = function() {\n            arguments[0] = new ((method === 'addIceCandidate') ?\n                window.RTCIceCandidate :\n                window.RTCSessionDescription)(arguments[0]);\n            return nativeMethod.apply(this, arguments);\n          };\n        });\n\n    // support for addIceCandidate(null or undefined)\n    var nativeAddIceCandidate =\n        window.RTCPeerConnection.prototype.addIceCandidate;\n    window.RTCPeerConnection.prototype.addIceCandidate = function() {\n      if (!arguments[0]) {\n        if (arguments[1]) {\n          arguments[1].apply(null);\n        }\n        return Promise.resolve();\n      }\n      return nativeAddIceCandidate.apply(this, arguments);\n    };\n\n    // shim getStats with maplike support\n    var makeMapStats = function(stats) {\n      var map = new Map();\n      Object.keys(stats).forEach(function(key) {\n        map.set(key, stats[key]);\n        map[key] = stats[key];\n      });\n      return map;\n    };\n\n    var modernStatsTypes = {\n      inboundrtp: 'inbound-rtp',\n      outboundrtp: 'outbound-rtp',\n      candidatepair: 'candidate-pair',\n      localcandidate: 'local-candidate',\n      remotecandidate: 'remote-candidate'\n    };\n\n    var nativeGetStats = window.RTCPeerConnection.prototype.getStats;\n    window.RTCPeerConnection.prototype.getStats = function(\n      selector,\n      onSucc,\n      onErr\n    ) {\n      return nativeGetStats.apply(this, [selector || null])\n        .then(function(stats) {\n          if (browserDetails.version < 48) {\n            stats = makeMapStats(stats);\n          }\n          if (browserDetails.version < 53 && !onSucc) {\n            // Shim only promise getStats with spec-hyphens in type names\n            // Leave callback version alone; misc old uses of forEach before Map\n            try {\n              stats.forEach(function(stat) {\n                stat.type = modernStatsTypes[stat.type] || stat.type;\n              });\n            } catch (e) {\n              if (e.name !== 'TypeError') {\n                throw e;\n              }\n              // Avoid TypeError: \"type\" is read-only, in old versions. 34-43ish\n              stats.forEach(function(stat, i) {\n                stats.set(i, Object.assign({}, stat, {\n                  type: modernStatsTypes[stat.type] || stat.type\n                }));\n              });\n            }\n          }\n          return stats;\n        })\n        .then(onSucc, onErr);\n    };\n  },\n\n  shimRemoveStream: function(window) {\n    if (!window.RTCPeerConnection ||\n        'removeStream' in window.RTCPeerConnection.prototype) {\n      return;\n    }\n    window.RTCPeerConnection.prototype.removeStream = function(stream) {\n      var pc = this;\n      utils.deprecated('removeStream', 'removeTrack');\n      this.getSenders().forEach(function(sender) {\n        if (sender.track && stream.getTracks().indexOf(sender.track) !== -1) {\n          pc.removeTrack(sender);\n        }\n      });\n    };\n  }\n};\n\n},{\"../utils\":13,\"./getusermedia\":11}],11:[function(require,module,exports){\n/*\n *  Copyright (c) 2016 The WebRTC project authors. All Rights Reserved.\n *\n *  Use of this source code is governed by a BSD-style license\n *  that can be found in the LICENSE file in the root of the source\n *  tree.\n */\n /* eslint-env node */\n'use strict';\n\nvar utils = require('../utils');\nvar logging = utils.log;\n\n// Expose public methods.\nmodule.exports = function(window) {\n  var browserDetails = utils.detectBrowser(window);\n  var navigator = window && window.navigator;\n  var MediaStreamTrack = window && window.MediaStreamTrack;\n\n  var shimError_ = function(e) {\n    return {\n      name: {\n        InternalError: 'NotReadableError',\n        NotSupportedError: 'TypeError',\n        PermissionDeniedError: 'NotAllowedError',\n        SecurityError: 'NotAllowedError'\n      }[e.name] || e.name,\n      message: {\n        'The operation is insecure.': 'The request is not allowed by the ' +\n        'user agent or the platform in the current context.'\n      }[e.message] || e.message,\n      constraint: e.constraint,\n      toString: function() {\n        return this.name + (this.message && ': ') + this.message;\n      }\n    };\n  };\n\n  // getUserMedia constraints shim.\n  var getUserMedia_ = function(constraints, onSuccess, onError) {\n    var constraintsToFF37_ = function(c) {\n      if (typeof c !== 'object' || c.require) {\n        return c;\n      }\n      var require = [];\n      Object.keys(c).forEach(function(key) {\n        if (key === 'require' || key === 'advanced' || key === 'mediaSource') {\n          return;\n        }\n        var r = c[key] = (typeof c[key] === 'object') ?\n            c[key] : {ideal: c[key]};\n        if (r.min !== undefined ||\n            r.max !== undefined || r.exact !== undefined) {\n          require.push(key);\n        }\n        if (r.exact !== undefined) {\n          if (typeof r.exact === 'number') {\n            r. min = r.max = r.exact;\n          } else {\n            c[key] = r.exact;\n          }\n          delete r.exact;\n        }\n        if (r.ideal !== undefined) {\n          c.advanced = c.advanced || [];\n          var oc = {};\n          if (typeof r.ideal === 'number') {\n            oc[key] = {min: r.ideal, max: r.ideal};\n          } else {\n            oc[key] = r.ideal;\n          }\n          c.advanced.push(oc);\n          delete r.ideal;\n          if (!Object.keys(r).length) {\n            delete c[key];\n          }\n        }\n      });\n      if (require.length) {\n        c.require = require;\n      }\n      return c;\n    };\n    constraints = JSON.parse(JSON.stringify(constraints));\n    if (browserDetails.version < 38) {\n      logging('spec: ' + JSON.stringify(constraints));\n      if (constraints.audio) {\n        constraints.audio = constraintsToFF37_(constraints.audio);\n      }\n      if (constraints.video) {\n        constraints.video = constraintsToFF37_(constraints.video);\n      }\n      logging('ff37: ' + JSON.stringify(constraints));\n    }\n    return navigator.mozGetUserMedia(constraints, onSuccess, function(e) {\n      onError(shimError_(e));\n    });\n  };\n\n  // Returns the result of getUserMedia as a Promise.\n  var getUserMediaPromise_ = function(constraints) {\n    return new Promise(function(resolve, reject) {\n      getUserMedia_(constraints, resolve, reject);\n    });\n  };\n\n  // Shim for mediaDevices on older versions.\n  if (!navigator.mediaDevices) {\n    navigator.mediaDevices = {getUserMedia: getUserMediaPromise_,\n      addEventListener: function() { },\n      removeEventListener: function() { }\n    };\n  }\n  navigator.mediaDevices.enumerateDevices =\n      navigator.mediaDevices.enumerateDevices || function() {\n        return new Promise(function(resolve) {\n          var infos = [\n            {kind: 'audioinput', deviceId: 'default', label: '', groupId: ''},\n            {kind: 'videoinput', deviceId: 'default', label: '', groupId: ''}\n          ];\n          resolve(infos);\n        });\n      };\n\n  if (browserDetails.version < 41) {\n    // Work around http://bugzil.la/1169665\n    var orgEnumerateDevices =\n        navigator.mediaDevices.enumerateDevices.bind(navigator.mediaDevices);\n    navigator.mediaDevices.enumerateDevices = function() {\n      return orgEnumerateDevices().then(undefined, function(e) {\n        if (e.name === 'NotFoundError') {\n          return [];\n        }\n        throw e;\n      });\n    };\n  }\n  if (browserDetails.version < 49) {\n    var origGetUserMedia = navigator.mediaDevices.getUserMedia.\n        bind(navigator.mediaDevices);\n    navigator.mediaDevices.getUserMedia = function(c) {\n      return origGetUserMedia(c).then(function(stream) {\n        // Work around https://bugzil.la/802326\n        if (c.audio && !stream.getAudioTracks().length ||\n            c.video && !stream.getVideoTracks().length) {\n          stream.getTracks().forEach(function(track) {\n            track.stop();\n          });\n          throw new DOMException('The object can not be found here.',\n                                 'NotFoundError');\n        }\n        return stream;\n      }, function(e) {\n        return Promise.reject(shimError_(e));\n      });\n    };\n  }\n  if (!(browserDetails.version > 55 &&\n      'autoGainControl' in navigator.mediaDevices.getSupportedConstraints())) {\n    var remap = function(obj, a, b) {\n      if (a in obj && !(b in obj)) {\n        obj[b] = obj[a];\n        delete obj[a];\n      }\n    };\n\n    var nativeGetUserMedia = navigator.mediaDevices.getUserMedia.\n        bind(navigator.mediaDevices);\n    navigator.mediaDevices.getUserMedia = function(c) {\n      if (typeof c === 'object' && typeof c.audio === 'object') {\n        c = JSON.parse(JSON.stringify(c));\n        remap(c.audio, 'autoGainControl', 'mozAutoGainControl');\n        remap(c.audio, 'noiseSuppression', 'mozNoiseSuppression');\n      }\n      return nativeGetUserMedia(c);\n    };\n\n    if (MediaStreamTrack && MediaStreamTrack.prototype.getSettings) {\n      var nativeGetSettings = MediaStreamTrack.prototype.getSettings;\n      MediaStreamTrack.prototype.getSettings = function() {\n        var obj = nativeGetSettings.apply(this, arguments);\n        remap(obj, 'mozAutoGainControl', 'autoGainControl');\n        remap(obj, 'mozNoiseSuppression', 'noiseSuppression');\n        return obj;\n      };\n    }\n\n    if (MediaStreamTrack && MediaStreamTrack.prototype.applyConstraints) {\n      var nativeApplyConstraints = MediaStreamTrack.prototype.applyConstraints;\n      MediaStreamTrack.prototype.applyConstraints = function(c) {\n        if (this.kind === 'audio' && typeof c === 'object') {\n          c = JSON.parse(JSON.stringify(c));\n          remap(c, 'autoGainControl', 'mozAutoGainControl');\n          remap(c, 'noiseSuppression', 'mozNoiseSuppression');\n        }\n        return nativeApplyConstraints.apply(this, [c]);\n      };\n    }\n  }\n  navigator.getUserMedia = function(constraints, onSuccess, onError) {\n    if (browserDetails.version < 44) {\n      return getUserMedia_(constraints, onSuccess, onError);\n    }\n    // Replace Firefox 44+'s deprecation warning with unprefixed version.\n    utils.deprecated('navigator.getUserMedia',\n        'navigator.mediaDevices.getUserMedia');\n    navigator.mediaDevices.getUserMedia(constraints).then(onSuccess, onError);\n  };\n};\n\n},{\"../utils\":13}],12:[function(require,module,exports){\n/*\n *  Copyright (c) 2016 The WebRTC project authors. All Rights Reserved.\n *\n *  Use of this source code is governed by a BSD-style license\n *  that can be found in the LICENSE file in the root of the source\n *  tree.\n */\n'use strict';\nvar utils = require('../utils');\n\nmodule.exports = {\n  shimLocalStreamsAPI: function(window) {\n    if (typeof window !== 'object' || !window.RTCPeerConnection) {\n      return;\n    }\n    if (!('getLocalStreams' in window.RTCPeerConnection.prototype)) {\n      window.RTCPeerConnection.prototype.getLocalStreams = function() {\n        if (!this._localStreams) {\n          this._localStreams = [];\n        }\n        return this._localStreams;\n      };\n    }\n    if (!('getStreamById' in window.RTCPeerConnection.prototype)) {\n      window.RTCPeerConnection.prototype.getStreamById = function(id) {\n        var result = null;\n        if (this._localStreams) {\n          this._localStreams.forEach(function(stream) {\n            if (stream.id === id) {\n              result = stream;\n            }\n          });\n        }\n        if (this._remoteStreams) {\n          this._remoteStreams.forEach(function(stream) {\n            if (stream.id === id) {\n              result = stream;\n            }\n          });\n        }\n        return result;\n      };\n    }\n    if (!('addStream' in window.RTCPeerConnection.prototype)) {\n      var _addTrack = window.RTCPeerConnection.prototype.addTrack;\n      window.RTCPeerConnection.prototype.addStream = function(stream) {\n        if (!this._localStreams) {\n          this._localStreams = [];\n        }\n        if (this._localStreams.indexOf(stream) === -1) {\n          this._localStreams.push(stream);\n        }\n        var pc = this;\n        stream.getTracks().forEach(function(track) {\n          _addTrack.call(pc, track, stream);\n        });\n      };\n\n      window.RTCPeerConnection.prototype.addTrack = function(track, stream) {\n        if (stream) {\n          if (!this._localStreams) {\n            this._localStreams = [stream];\n          } else if (this._localStreams.indexOf(stream) === -1) {\n            this._localStreams.push(stream);\n          }\n        }\n        return _addTrack.call(this, track, stream);\n      };\n    }\n    if (!('removeStream' in window.RTCPeerConnection.prototype)) {\n      window.RTCPeerConnection.prototype.removeStream = function(stream) {\n        if (!this._localStreams) {\n          this._localStreams = [];\n        }\n        var index = this._localStreams.indexOf(stream);\n        if (index === -1) {\n          return;\n        }\n        this._localStreams.splice(index, 1);\n        var pc = this;\n        var tracks = stream.getTracks();\n        this.getSenders().forEach(function(sender) {\n          if (tracks.indexOf(sender.track) !== -1) {\n            pc.removeTrack(sender);\n          }\n        });\n      };\n    }\n  },\n  shimRemoteStreamsAPI: function(window) {\n    if (typeof window !== 'object' || !window.RTCPeerConnection) {\n      return;\n    }\n    if (!('getRemoteStreams' in window.RTCPeerConnection.prototype)) {\n      window.RTCPeerConnection.prototype.getRemoteStreams = function() {\n        return this._remoteStreams ? this._remoteStreams : [];\n      };\n    }\n    if (!('onaddstream' in window.RTCPeerConnection.prototype)) {\n      Object.defineProperty(window.RTCPeerConnection.prototype, 'onaddstream', {\n        get: function() {\n          return this._onaddstream;\n        },\n        set: function(f) {\n          if (this._onaddstream) {\n            this.removeEventListener('addstream', this._onaddstream);\n            this.removeEventListener('track', this._onaddstreampoly);\n          }\n          this.addEventListener('addstream', this._onaddstream = f);\n          this.addEventListener('track', this._onaddstreampoly = function(e) {\n            var stream = e.streams[0];\n            if (!this._remoteStreams) {\n              this._remoteStreams = [];\n            }\n            if (this._remoteStreams.indexOf(stream) >= 0) {\n              return;\n            }\n            this._remoteStreams.push(stream);\n            var event = new Event('addstream');\n            event.stream = e.streams[0];\n            this.dispatchEvent(event);\n          }.bind(this));\n        }\n      });\n    }\n  },\n  shimCallbacksAPI: function(window) {\n    if (typeof window !== 'object' || !window.RTCPeerConnection) {\n      return;\n    }\n    var prototype = window.RTCPeerConnection.prototype;\n    var createOffer = prototype.createOffer;\n    var createAnswer = prototype.createAnswer;\n    var setLocalDescription = prototype.setLocalDescription;\n    var setRemoteDescription = prototype.setRemoteDescription;\n    var addIceCandidate = prototype.addIceCandidate;\n\n    prototype.createOffer = function(successCallback, failureCallback) {\n      var options = (arguments.length >= 2) ? arguments[2] : arguments[0];\n      var promise = createOffer.apply(this, [options]);\n      if (!failureCallback) {\n        return promise;\n      }\n      promise.then(successCallback, failureCallback);\n      return Promise.resolve();\n    };\n\n    prototype.createAnswer = function(successCallback, failureCallback) {\n      var options = (arguments.length >= 2) ? arguments[2] : arguments[0];\n      var promise = createAnswer.apply(this, [options]);\n      if (!failureCallback) {\n        return promise;\n      }\n      promise.then(successCallback, failureCallback);\n      return Promise.resolve();\n    };\n\n    var withCallback = function(description, successCallback, failureCallback) {\n      var promise = setLocalDescription.apply(this, [description]);\n      if (!failureCallback) {\n        return promise;\n      }\n      promise.then(successCallback, failureCallback);\n      return Promise.resolve();\n    };\n    prototype.setLocalDescription = withCallback;\n\n    withCallback = function(description, successCallback, failureCallback) {\n      var promise = setRemoteDescription.apply(this, [description]);\n      if (!failureCallback) {\n        return promise;\n      }\n      promise.then(successCallback, failureCallback);\n      return Promise.resolve();\n    };\n    prototype.setRemoteDescription = withCallback;\n\n    withCallback = function(candidate, successCallback, failureCallback) {\n      var promise = addIceCandidate.apply(this, [candidate]);\n      if (!failureCallback) {\n        return promise;\n      }\n      promise.then(successCallback, failureCallback);\n      return Promise.resolve();\n    };\n    prototype.addIceCandidate = withCallback;\n  },\n  shimGetUserMedia: function(window) {\n    var navigator = window && window.navigator;\n\n    if (!navigator.getUserMedia) {\n      if (navigator.webkitGetUserMedia) {\n        navigator.getUserMedia = navigator.webkitGetUserMedia.bind(navigator);\n      } else if (navigator.mediaDevices &&\n          navigator.mediaDevices.getUserMedia) {\n        navigator.getUserMedia = function(constraints, cb, errcb) {\n          navigator.mediaDevices.getUserMedia(constraints)\n          .then(cb, errcb);\n        }.bind(navigator);\n      }\n    }\n  },\n  shimRTCIceServerUrls: function(window) {\n    // migrate from non-spec RTCIceServer.url to RTCIceServer.urls\n    var OrigPeerConnection = window.RTCPeerConnection;\n    window.RTCPeerConnection = function(pcConfig, pcConstraints) {\n      if (pcConfig && pcConfig.iceServers) {\n        var newIceServers = [];\n        for (var i = 0; i < pcConfig.iceServers.length; i++) {\n          var server = pcConfig.iceServers[i];\n          if (!server.hasOwnProperty('urls') &&\n              server.hasOwnProperty('url')) {\n            utils.deprecated('RTCIceServer.url', 'RTCIceServer.urls');\n            server = JSON.parse(JSON.stringify(server));\n            server.urls = server.url;\n            delete server.url;\n            newIceServers.push(server);\n          } else {\n            newIceServers.push(pcConfig.iceServers[i]);\n          }\n        }\n        pcConfig.iceServers = newIceServers;\n      }\n      return new OrigPeerConnection(pcConfig, pcConstraints);\n    };\n    window.RTCPeerConnection.prototype = OrigPeerConnection.prototype;\n    // wrap static methods. Currently just generateCertificate.\n    if ('generateCertificate' in window.RTCPeerConnection) {\n      Object.defineProperty(window.RTCPeerConnection, 'generateCertificate', {\n        get: function() {\n          return OrigPeerConnection.generateCertificate;\n        }\n      });\n    }\n  },\n  shimTrackEventTransceiver: function(window) {\n    // Add event.transceiver member over deprecated event.receiver\n    if (typeof window === 'object' && window.RTCPeerConnection &&\n        ('receiver' in window.RTCTrackEvent.prototype) &&\n        // can't check 'transceiver' in window.RTCTrackEvent.prototype, as it is\n        // defined for some reason even when window.RTCTransceiver is not.\n        !window.RTCTransceiver) {\n      Object.defineProperty(window.RTCTrackEvent.prototype, 'transceiver', {\n        get: function() {\n          return {receiver: this.receiver};\n        }\n      });\n    }\n  },\n\n  shimCreateOfferLegacy: function(window) {\n    var origCreateOffer = window.RTCPeerConnection.prototype.createOffer;\n    window.RTCPeerConnection.prototype.createOffer = function(offerOptions) {\n      var pc = this;\n      if (offerOptions) {\n        var audioTransceiver = pc.getTransceivers().find(function(transceiver) {\n          return transceiver.sender.track &&\n              transceiver.sender.track.kind === 'audio';\n        });\n        if (offerOptions.offerToReceiveAudio === false && audioTransceiver) {\n          if (audioTransceiver.direction === 'sendrecv') {\n            audioTransceiver.setDirection('sendonly');\n          } else if (audioTransceiver.direction === 'recvonly') {\n            audioTransceiver.setDirection('inactive');\n          }\n        } else if (offerOptions.offerToReceiveAudio === true &&\n            !audioTransceiver) {\n          pc.addTransceiver('audio');\n        }\n\n        var videoTransceiver = pc.getTransceivers().find(function(transceiver) {\n          return transceiver.sender.track &&\n              transceiver.sender.track.kind === 'video';\n        });\n        if (offerOptions.offerToReceiveVideo === false && videoTransceiver) {\n          if (videoTransceiver.direction === 'sendrecv') {\n            videoTransceiver.setDirection('sendonly');\n          } else if (videoTransceiver.direction === 'recvonly') {\n            videoTransceiver.setDirection('inactive');\n          }\n        } else if (offerOptions.offerToReceiveVideo === true &&\n            !videoTransceiver) {\n          pc.addTransceiver('video');\n        }\n      }\n      return origCreateOffer.apply(pc, arguments);\n    };\n  }\n};\n\n},{\"../utils\":13}],13:[function(require,module,exports){\n/*\n *  Copyright (c) 2016 The WebRTC project authors. All Rights Reserved.\n *\n *  Use of this source code is governed by a BSD-style license\n *  that can be found in the LICENSE file in the root of the source\n *  tree.\n */\n /* eslint-env node */\n'use strict';\n\nvar logDisabled_ = true;\nvar deprecationWarnings_ = true;\n\n/**\n * Extract browser version out of the provided user agent string.\n *\n * @param {!string} uastring userAgent string.\n * @param {!string} expr Regular expression used as match criteria.\n * @param {!number} pos position in the version string to be returned.\n * @return {!number} browser version.\n */\nfunction extractVersion(uastring, expr, pos) {\n  var match = uastring.match(expr);\n  return match && match.length >= pos && parseInt(match[pos], 10);\n}\n\n// Utility methods.\nmodule.exports = {\n  extractVersion: extractVersion,\n  disableLog: function(bool) {\n    if (typeof bool !== 'boolean') {\n      return new Error('Argument type: ' + typeof bool +\n          '. Please use a boolean.');\n    }\n    logDisabled_ = bool;\n    return (bool) ? 'adapter.js logging disabled' :\n        'adapter.js logging enabled';\n  },\n\n  /**\n   * Disable or enable deprecation warnings\n   * @param {!boolean} bool set to true to disable warnings.\n   */\n  disableWarnings: function(bool) {\n    if (typeof bool !== 'boolean') {\n      return new Error('Argument type: ' + typeof bool +\n          '. Please use a boolean.');\n    }\n    deprecationWarnings_ = !bool;\n    return 'adapter.js deprecation warnings ' + (bool ? 'disabled' : 'enabled');\n  },\n\n  log: function() {\n    if (typeof window === 'object') {\n      if (logDisabled_) {\n        return;\n      }\n      if (typeof console !== 'undefined' && typeof console.log === 'function') {\n        console.log.apply(console, arguments);\n      }\n    }\n  },\n\n  /**\n   * Shows a deprecation warning suggesting the modern and spec-compatible API.\n   */\n  deprecated: function(oldMethod, newMethod) {\n    if (!deprecationWarnings_) {\n      return;\n    }\n    console.warn(oldMethod + ' is deprecated, please use ' + newMethod +\n        ' instead.');\n  },\n\n  /**\n   * Browser detector.\n   *\n   * @return {object} result containing browser and version\n   *     properties.\n   */\n  detectBrowser: function(window) {\n    var navigator = window && window.navigator;\n\n    // Returned result object.\n    var result = {};\n    result.browser = null;\n    result.version = null;\n\n    // Fail early if it's not a browser\n    if (typeof window === 'undefined' || !window.navigator) {\n      result.browser = 'Not a browser.';\n      return result;\n    }\n\n    // Firefox.\n    if (navigator.mozGetUserMedia) {\n      result.browser = 'firefox';\n      result.version = extractVersion(navigator.userAgent,\n          /Firefox\\/(\\d+)\\./, 1);\n    } else if (navigator.webkitGetUserMedia) {\n      // Chrome, Chromium, Webview, Opera, all use the chrome shim for now\n      if (window.webkitRTCPeerConnection) {\n        result.browser = 'chrome';\n        result.version = extractVersion(navigator.userAgent,\n          /Chrom(e|ium)\\/(\\d+)\\./, 2);\n      } else { // Safari (in an unpublished version) or unknown webkit-based.\n        if (navigator.userAgent.match(/Version\\/(\\d+).(\\d+)/)) {\n          result.browser = 'safari';\n          result.version = extractVersion(navigator.userAgent,\n            /AppleWebKit\\/(\\d+)\\./, 1);\n        } else { // unknown webkit-based browser.\n          result.browser = 'Unsupported webkit-based browser ' +\n              'with GUM support but no WebRTC support.';\n          return result;\n        }\n      }\n    } else if (navigator.mediaDevices &&\n        navigator.userAgent.match(/Edge\\/(\\d+).(\\d+)$/)) { // Edge.\n      result.browser = 'edge';\n      result.version = extractVersion(navigator.userAgent,\n          /Edge\\/(\\d+).(\\d+)$/, 2);\n    } else if (navigator.mediaDevices &&\n        navigator.userAgent.match(/AppleWebKit\\/(\\d+)\\./)) {\n        // Safari, with webkitGetUserMedia removed.\n      result.browser = 'safari';\n      result.version = extractVersion(navigator.userAgent,\n          /AppleWebKit\\/(\\d+)\\./, 1);\n    } else { // Default fallthrough: not supported.\n      result.browser = 'Not a supported browser.';\n      return result;\n    }\n\n    return result;\n  }\n};\n\n},{}]},{},[3])(3)\n});\n\n\n// WEBPACK FOOTER //\n// ./node_modules/webrtc-adapter/out/adapter.js","var g;\r\n\r\n// This works in non-strict mode\r\ng = (function() {\r\n\treturn this;\r\n})();\r\n\r\ntry {\r\n\t// This works if eval is allowed (see CSP)\r\n\tg = g || Function(\"return this\")() || (1,eval)(\"this\");\r\n} catch(e) {\r\n\t// This works if the window reference is available\r\n\tif(typeof window === \"object\")\r\n\t\tg = window;\r\n}\r\n\r\n// g can still be undefined, but nothing to do about it...\r\n// We return undefined, instead of nothing here, so it's\r\n// easier to handle this case. if(!global) { ...}\r\n\r\nmodule.exports = g;\r\n\n\n\n// WEBPACK FOOTER //\n// (webpack)/buildin/global.js","import Component from '../Component';\nimport CameraScreen from './CameraScreen';\n\nconst ButtonCameraPower = new Component('ButtonCameraPower');\n\nButtonCameraPower.on('click', function(evt) {\n  if (CameraScreen.getState().show) {\n    CameraScreen.setState({show: false});\n    ButtonCameraPower.dom.textContent = 'On';\n  } else {\n    CameraScreen.setState({show: true});\n    ButtonCameraPower.dom.textContent = 'Off';\n  }\n})\n\nexport default ButtonCameraPower;\n\n\n\n// WEBPACK FOOTER //\n// ./src/components/ButtonCameraPower.js","import Component from '../Component';\n\nconst Error = new Component('Error', {\n  message: ''\n})\n\nError.render(state => {\n  Error.dom.textContent = state.message;\n});\n\n\nexport default Error;\n\n\n\n\n\n// WEBPACK FOOTER //\n// ./src/components/Error.js","import CameraScreen from './components/CameraScreen';\n\nexport function hasMediaDeviceAPI () {\n  return Boolean(navigator.mediaDevices)\n    && Boolean(navigator.mediaDevices.getUserMedia);\n}\n\nfunction isMobileDevice () {\n  return navigator.userAgent.search(/mobi/i) !== -1;\n}\n\nfunction generateConstraints(facingMode = 'environment') {\n  const supportedConstraints = navigator.mediaDevices.getSupportedConstraints();\n  const constraints = {\n    width: CameraScreen.dom.offsetWidth,\n    height: CameraScreen.dom.offsetWidth,\n    aspectRatio: 1\n  }\n\n  if (isMobileDevice() && supportedConstraints.hasOwnProperty('facingMode')) {\n    constraints.video = { facingMode: facingMode };\n  } else {\n    constraints.video = true;\n  }\n\n  return constraints;\n}\n\nexport function startingCamera (video, facingMode = 'environment') {\n  return navigator.mediaDevices\n    .getUserMedia(generateConstraints(facingMode))\n    .then(mediaStream => {\n      video.srcObject = mediaStream;\n      video.play();\n    })\n}\n\nexport function stopCamera (video) {\n  video.srcObject = null;\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/mediaDevice.js","import Component from '../Component';\nimport CameraScreen from './CameraScreen';\n\nconst ButtonCameraFacing = new Component('ButtonCameraFacing');\n\nButtonCameraFacing.on('click', function(evt) {\n  console.log('clicked')\n  if (CameraScreen.getState().facingMode === 'user') {\n    CameraScreen.setState({facingMode: 'environment'});\n    ButtonCameraFacing.dom.textContent = 'Switch to Front';\n  } else {\n    CameraScreen.setState({facingMode: 'user'});\n    ButtonCameraFacing.dom.textContent = 'Switch to Rear';\n  }\n})\n\nexport default ButtonCameraFacing;\n\n\n\n// WEBPACK FOOTER //\n// ./src/components/ButtonCameraFacing.js","import Component from '../Component';\nimport Canvas from './Canvas';\nimport CameraScreen from './CameraScreen';\nimport ButtonReadResult from './ButtonReadResult';\n\nconst ButtonCameraCapture = new Component('ButtonCameraCapture');\n\nfunction sendImageForAnalysis(imageData) {\n  const headers = new Headers();\n  headers.append('Content-Type', 'application/json');\n  return fetch('https://young-mountain-88984.herokuapp.com/image-vision', {\n    method: 'POST',\n    headers: headers,\n    mode: 'cors',\n    cache: 'default',\n    body: JSON.stringify({ image: imageData }),\n  })\n  .then(res => res.json())\n  .then(data => data.labelAnnotations[0].description)\n  .catch(err => console.log('Error: ', err));\n}\n\nconst fileReader = new FileReader();\n\nfileReader.addEventListener('loadend', function() {\n  sendImageForAnalysis(fileReader.result)\n  .then(result => ButtonReadResult.setState({result}));\n})\n\nButtonCameraCapture.on('click', function takePicture() {\n  Canvas.takePicture(CameraScreen.dom)\n  .then(imageBlob => {\n    fileReader.readAsDataURL(imageBlob);\n  });\n})\n\n\n\n// WEBPACK FOOTER //\n// ./src/components/ButtonCameraCapture.js","import Component from '../Component';\nimport CameraScreen from './CameraScreen';\n\nconst ButtonReadResult = new Component('ButtonReadResult', {\n  result: 'You must take a picture first.'\n});\n\nfunction speakResult(result) {\n  const utterance = new SpeechSynthesisUtterance(result)\n  window.speechSynthesis.speak(utterance)\n}\n\nButtonReadResult.on('click', function(evt) {\n  speakResult(ButtonReadResult.getState().result);\n})\n\nexport default ButtonReadResult;\n\n\n\n// WEBPACK FOOTER //\n// ./src/components/ButtonReadResult.js"],"sourceRoot":""}