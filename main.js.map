{"version":3,"sources":["webpack:///webpack/bootstrap 5bdc5d104f80fea504a8","webpack:///./src/Component.js","webpack:///./src/mediaDevice.js","webpack:///./node_modules/webrtc-adapter/out/adapter_no_global.js","webpack:///(webpack)/buildin/global.js","webpack:///./src/index.js","webpack:///./src/components/ButtonCameraPermission.js","webpack:///./src/components/CameraScreen.js","webpack:///./src/components/Error.js"],"names":["merge","one","two","Object","assign","Component","id","defaultState","state","getState","setState","arg","renderer","dom","document","getElementById","noop","classname","classList","add","remove","toggle","event","eventHandler","addEventListener","fn","hasMediaDeviceAPI","startingCamera","Boolean","navigator","mediaDevices","getUserMedia","generateConstraints","supportedConstraints","getSupportedConstraints","hasOwnProperty","video","facingMode","then","srcObject","mediaStream","onloadedmetadata","e","play","t","n","r","s","o","u","a","require","i","f","Error","code","l","exports","call","length","module","SDPUtils","writeMediaSection","transceiver","caps","type","stream","dtlsRole","sdp","writeRtpDescription","kind","writeIceParameters","iceGatherer","getLocalParameters","writeDtlsParameters","dtlsTransport","mid","rtpSender","rtpReceiver","msid","track","sendEncodingParameters","ssrc","rtx","localCName","filterIceServers","iceServers","edgeVersion","hasTurn","JSON","parse","stringify","filter","server","urls","url","console","warn","isString","validTurn","indexOf","getCommonCapabilities","localCapabilities","remoteCapabilities","commonCapabilities","codecs","headerExtensions","fecMechanisms","findCodecByPayloadType","pt","parseInt","payloadType","preferredPayloadType","rtxCapabilityMatches","lRtx","rRtx","lCodecs","rCodecs","lCodec","parameters","apt","rCodec","name","toLowerCase","forEach","clockRate","numChannels","Math","min","push","rtcpFeedback","fb","j","parameter","lHeaderExtension","rHeaderExtension","uri","isActionAllowedInSignalingState","action","signalingState","offer","setLocalDescription","setRemoteDescription","answer","maybeAddCandidate","iceTransport","candidate","alreadyAdded","getRemoteCandidates","find","remoteCandidate","foundation","ip","port","priority","protocol","addRemoteCandidate","addTrackToStreamAndFireEvent","addTrack","Event","dispatchEvent","removeTrackFromStreamAndFireEvent","removeTrack","fireAddTrack","pc","receiver","streams","trackEvent","window","setTimeout","_dispatchEvent","makeError","description","RTCPeerConnection","config","_eventTarget","createDocumentFragment","method","bind","canTrickleIceCandidates","needNegotiation","localStreams","remoteStreams","localDescription","remoteDescription","iceConnectionState","iceGatheringState","usingBundle","bundlePolicy","rtcpMuxPolicy","iceTransportPolicy","_iceGatherers","iceCandidatePoolSize","RTCIceGatherer","gatherPolicy","_config","transceivers","_sdpSessionId","generateSessionId","_sdpSessionVersion","_dtlsRole","undefined","_isClosed","prototype","onicecandidate","onaddstream","ontrack","onremovestream","onsignalingstatechange","oniceconnectionstatechange","onicegatheringstatechange","onnegotiationneeded","ondatachannel","_emitGatheringStateChange","getConfiguration","getLocalStreams","getRemoteStreams","_createTransceiver","hasBundleTransport","recvEncodingParameters","associatedRemoteMediaStreams","wantReceive","transports","_createIceAndDtlsTransports","alreadyExists","_maybeFireNegotiationNeeded","RTCRtpSender","addStream","getTracks","clonedStream","clone","idx","clonedTrack","enabled","sender","TypeError","stop","map","splice","removeStream","getSenders","getReceivers","_createIceGatherer","sdpMLineIndex","shift","defineProperty","value","writable","candidates","bufferCandidates","end","keys","_gather","onlocalcandidate","removeEventListener","evt","sdpMid","cand","component","writeCandidate","sections","splitSections","join","complete","every","RTCIceTransport","onicestatechange","_updateConnectionState","RTCDtlsTransport","ondtlsstatechange","onerror","_disposeIceAndDtlsTransports","_transceive","send","recv","params","encodings","rtcp","cname","compound","rtcpParameters","p","receive","Promise","reject","sessionpart","mediaSection","parseRtpParameters","isIceLite","matchPrefix","rejected","isRejected","isDatachannel","remoteIceParameters","getIceParameters","remoteDtlsParameters","getDtlsParameters","role","start","_updateSignalingState","resolve","receiverList","iceOptions","substr","split","lines","splitLines","getKind","direction","getDirection","remoteMsid","parseMsid","getMid","generateIdentifier","parseRtpEncodingParameters","parseRtcpParameters","isComplete","cands","parseCandidate","setTransport","setRemoteCandidates","RTCRtpReceiver","getCapabilities","codec","isNewTrack","MediaStream","get","default","nativeTrack","sid","item","close","newState","states","closed","connecting","checking","connected","completed","disconnected","failed","new","createOffer","numAudioTracks","numVideoTracks","offerOptions","arguments","mandatory","optional","offerToReceiveAudio","offerToReceiveVideo","writeSessionBoilerplate","getLocalCandidates","desc","RTCSessionDescription","createAnswer","mediaSectionsInOffer","localTrack","getAudioTracks","getVideoTracks","hasRtx","c","reducedSize","addIceCandidate","candidateString","trim","getStats","promises","fixStatsType","stat","inboundrtp","outboundrtp","candidatepair","localcandidate","remotecandidate","results","Map","all","res","result","set","methods","nativeMethod","args","apply","error","random","toString","blob","line","parts","part","index","prefix","substring","relatedAddress","relatedPort","tcpType","ufrag","usernameFragment","toUpperCase","parseIceOptions","parseRtpMap","parsed","writeRtpMap","parseExtmap","writeExtmap","headerExtension","preferredId","parseFmtp","kv","writeFmtp","param","parseRtcpFb","writeRtcpFb","parseSsrcMedia","sp","colon","attribute","parseFingerprint","algorithm","fingerprints","setupType","fp","concat","iceParameters","password","mline","rtpmapline","fmtps","maxptime","extension","encodingParameters","hasRed","hasUlpfec","ssrcs","primarySsrc","secondarySsrc","flows","encParam","codecPayloadType","fec","mechanism","bandwidth","maxBitrate","remoteSsrc","obj","rsize","mux","spec","planB","sessId","sessVer","sessionId","version","parseMLine","fmt","slice","global","adapterFactory","self","utils","dependencies","opts","options","shimChrome","shimFirefox","shimEdge","shimSafari","key","logging","log","browserDetails","detectBrowser","adapter","extractVersion","disableLog","disableWarnings","chromeShim","edgeShim","firefoxShim","safariShim","commonShim","browser","shimPeerConnection","browserShim","shimCreateObjectURL","shimGetUserMedia","shimMediaStream","shimSourceObject","shimOnTrack","shimAddTrackRemoveTrack","shimGetSendersWithDtmf","shimRTCIceCandidate","shimRemoveStream","shimReplaceTrack","shimRTCIceServerUrls","shimCallbacksAPI","shimLocalStreamsAPI","shimRemoteStreamsAPI","shimTrackEventTransceiver","shimCreateOfferLegacy","webkitMediaStream","_ontrack","origSetRemoteDescription","_ontrackpoly","te","shimSenderWithDtmf","dtmf","_dtmf","createDTMFSender","_pc","_senders","origAddTrack","origRemoveTrack","origAddStream","origRemoveStream","origGetSenders","senders","URL","HTMLMediaElement","_srcObject","src","revokeObjectURL","createObjectURL","shimAddTrackRemoveTrackWithNative","_shimmedLocalStreams","streamId","DOMException","existingSenders","newSenders","newSender","origGetLocalStreams","nativeStreams","_reverseStreams","_streams","newStream","oldStream","replaceInternalStreamId","internalId","externalStream","internalStream","replace","RegExp","replaceExternalStreamId","isLegacyCall","err","origSetLocalDescription","origLocalDescription","getOwnPropertyDescriptor","isLocal","streamid","hasTrack","pcConfig","pcConstraints","iceTransports","webkitRTCPeerConnection","generateCertificate","OrigPeerConnection","newIceServers","deprecated","origGetStats","selector","successCallback","errorCallback","fixChromeStats_","response","standardReport","reports","report","standardStats","timestamp","names","makeMapStats","stats","successCallbackWrapper_","promise","RTCIceCandidate","nativeAddIceCandidate","constraintsToChrome_","cc","ideal","exact","max","oldname_","charAt","oc","mix","advanced","shimConstraints_","constraints","func","audio","remap","b","face","getSupportedFacingModeLies","matches","enumerateDevices","devices","d","dev","some","match","label","deviceId","shimError_","PermissionDeniedError","InvalidStateError","DevicesNotFoundError","ConstraintNotSatisfiedError","TrackStartError","MediaDeviceFailedDueToShutdown","MediaDeviceKillSwitchOn","message","constraint","constraintName","getUserMedia_","onSuccess","onError","webkitGetUserMedia","getUserMediaPromise_","kinds","MediaStreamTrack","getSources","device","groupId","echoCancellation","frameRate","height","width","origGetUserMedia","cs","wrapPeerConnectionEvent","eventNameToWrap","wrapper","proto","nativeAddEventListener","nativeEventName","cb","wrappedCallback","_eventMap","nativeRemoveEventListener","unwrappedCb","NativeRTCIceCandidate","nativeCandidate","parsedCandidate","augmentedCandidate","toJSON","nativeCreateObjectURL","nativeRevokeObjectURL","newId","delete","dsc","nativeSetAttribute","setAttribute","shimRTCPeerConnection","origMSTEnabled","ev","RTCDtmfSender","replaceTrack","setTrack","catch","RTCTrackEvent","mozSrcObject","mozRTCPeerConnection","newServer","username","credential","mozRTCSessionDescription","mozRTCIceCandidate","modernStatsTypes","nativeGetStats","onSucc","onErr","InternalError","NotSupportedError","SecurityError","constraintsToFF37_","mozGetUserMedia","infos","orgEnumerateDevices","nativeGetUserMedia","getSettings","nativeGetSettings","applyConstraints","nativeApplyConstraints","_localStreams","getStreamById","_remoteStreams","_addTrack","tracks","_onaddstream","_onaddstreampoly","failureCallback","withCallback","errcb","RTCTransceiver","origCreateOffer","audioTransceiver","getTransceivers","setDirection","addTransceiver","videoTransceiver","logDisabled_","deprecationWarnings_","uastring","expr","pos","bool","oldMethod","newMethod","userAgent","g","Function","eval","ButtonCameraPermission","permitted","on","show","render","CameraScreen","addClass","removeClass","textContent"],"mappings":"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","file":"main.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, {\n \t\t\t\tconfigurable: false,\n \t\t\t\tenumerable: true,\n \t\t\t\tget: getter\n \t\t\t});\n \t\t}\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 2);\n\n\n\n// WEBPACK FOOTER //\n// webpack/bootstrap 5bdc5d104f80fea504a8","\nfunction merge(one, two) {\n  return Object.assign({}, one, two);\n}\n\nexport default class Component {\n\n  constructor(id, defaultState = {}) {\n\n    let state = defaultState;\n\n    const getState = () => state;\n\n    const setState = arg => {\n      if (typeof arg === 'function') {\n        setState(arg(getState()));\n      } else {\n        state = merge(state, arg);\n        this.renderer(getState())\n      }\n    }\n\n    this.dom = document.getElementById(id);\n    this.getState = getState;\n    this.setState = setState;\n    this.renderer = function noop() { };\n  }\n\n  addClass(classname) {\n    this.dom.classList.add(classname);\n  }\n\n  removeClass(classname) {\n    this.dom.classList.remove(classname);\n  }\n\n  toggleClass(classname) {\n    this.dom.classList.toggle(classname);\n  }\n\n  on(event, eventHandler) {\n    return this.dom.addEventListener(event, eventHandler);\n  }\n\n  render(fn) {\n    this.renderer = fn;\n    fn(this.getState());\n  }\n\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/Component.js","export function hasMediaDeviceAPI () {\n  return Boolean(navigator.mediaDevices)\n    && Boolean(navigator.mediaDevices.getUserMedia);\n}\n\nfunction generateConstraints() {\n  const supportedConstraints = navigator.mediaDevices.getSupportedConstraints();\n  if (supportedConstraints.hasOwnProperty('facingMode')) {\n    return {video: { facingMode: 'environment' }};\n  } else {\n    return { video: true };\n  }\n}\n\nexport function startingCamera (video) {\n  return navigator.mediaDevices\n    .getUserMedia(generateConstraints())\n    .then(mediaStream => {\n      video.srcObject = mediaStream;\n      video.onloadedmetadata = function(e) {\n        video.play();\n      };\n    })\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/mediaDevice.js","(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require==\"function\"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error(\"Cannot find module '\"+o+\"'\");throw f.code=\"MODULE_NOT_FOUND\",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require==\"function\"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){\n/*\n *  Copyright (c) 2017 The WebRTC project authors. All Rights Reserved.\n *\n *  Use of this source code is governed by a BSD-style license\n *  that can be found in the LICENSE file in the root of the source\n *  tree.\n */\n /* eslint-env node */\n'use strict';\n\nvar SDPUtils = require('sdp');\n\nfunction writeMediaSection(transceiver, caps, type, stream, dtlsRole) {\n  var sdp = SDPUtils.writeRtpDescription(transceiver.kind, caps);\n\n  // Map ICE parameters (ufrag, pwd) to SDP.\n  sdp += SDPUtils.writeIceParameters(\n      transceiver.iceGatherer.getLocalParameters());\n\n  // Map DTLS parameters to SDP.\n  sdp += SDPUtils.writeDtlsParameters(\n      transceiver.dtlsTransport.getLocalParameters(),\n      type === 'offer' ? 'actpass' : dtlsRole || 'active');\n\n  sdp += 'a=mid:' + transceiver.mid + '\\r\\n';\n\n  if (transceiver.rtpSender && transceiver.rtpReceiver) {\n    sdp += 'a=sendrecv\\r\\n';\n  } else if (transceiver.rtpSender) {\n    sdp += 'a=sendonly\\r\\n';\n  } else if (transceiver.rtpReceiver) {\n    sdp += 'a=recvonly\\r\\n';\n  } else {\n    sdp += 'a=inactive\\r\\n';\n  }\n\n  if (transceiver.rtpSender) {\n    // spec.\n    var msid = 'msid:' + stream.id + ' ' +\n        transceiver.rtpSender.track.id + '\\r\\n';\n    sdp += 'a=' + msid;\n\n    // for Chrome.\n    sdp += 'a=ssrc:' + transceiver.sendEncodingParameters[0].ssrc +\n        ' ' + msid;\n    if (transceiver.sendEncodingParameters[0].rtx) {\n      sdp += 'a=ssrc:' + transceiver.sendEncodingParameters[0].rtx.ssrc +\n          ' ' + msid;\n      sdp += 'a=ssrc-group:FID ' +\n          transceiver.sendEncodingParameters[0].ssrc + ' ' +\n          transceiver.sendEncodingParameters[0].rtx.ssrc +\n          '\\r\\n';\n    }\n  }\n  // FIXME: this should be written by writeRtpDescription.\n  sdp += 'a=ssrc:' + transceiver.sendEncodingParameters[0].ssrc +\n      ' cname:' + SDPUtils.localCName + '\\r\\n';\n  if (transceiver.rtpSender && transceiver.sendEncodingParameters[0].rtx) {\n    sdp += 'a=ssrc:' + transceiver.sendEncodingParameters[0].rtx.ssrc +\n        ' cname:' + SDPUtils.localCName + '\\r\\n';\n  }\n  return sdp;\n}\n\n// Edge does not like\n// 1) stun: filtered after 14393 unless ?transport=udp is present\n// 2) turn: that does not have all of turn:host:port?transport=udp\n// 3) turn: with ipv6 addresses\n// 4) turn: occurring muliple times\nfunction filterIceServers(iceServers, edgeVersion) {\n  var hasTurn = false;\n  iceServers = JSON.parse(JSON.stringify(iceServers));\n  return iceServers.filter(function(server) {\n    if (server && (server.urls || server.url)) {\n      var urls = server.urls || server.url;\n      if (server.url && !server.urls) {\n        console.warn('RTCIceServer.url is deprecated! Use urls instead.');\n      }\n      var isString = typeof urls === 'string';\n      if (isString) {\n        urls = [urls];\n      }\n      urls = urls.filter(function(url) {\n        var validTurn = url.indexOf('turn:') === 0 &&\n            url.indexOf('transport=udp') !== -1 &&\n            url.indexOf('turn:[') === -1 &&\n            !hasTurn;\n\n        if (validTurn) {\n          hasTurn = true;\n          return true;\n        }\n        return url.indexOf('stun:') === 0 && edgeVersion >= 14393 &&\n            url.indexOf('?transport=udp') === -1;\n      });\n\n      delete server.url;\n      server.urls = isString ? urls[0] : urls;\n      return !!urls.length;\n    }\n  });\n}\n\n// Determines the intersection of local and remote capabilities.\nfunction getCommonCapabilities(localCapabilities, remoteCapabilities) {\n  var commonCapabilities = {\n    codecs: [],\n    headerExtensions: [],\n    fecMechanisms: []\n  };\n\n  var findCodecByPayloadType = function(pt, codecs) {\n    pt = parseInt(pt, 10);\n    for (var i = 0; i < codecs.length; i++) {\n      if (codecs[i].payloadType === pt ||\n          codecs[i].preferredPayloadType === pt) {\n        return codecs[i];\n      }\n    }\n  };\n\n  var rtxCapabilityMatches = function(lRtx, rRtx, lCodecs, rCodecs) {\n    var lCodec = findCodecByPayloadType(lRtx.parameters.apt, lCodecs);\n    var rCodec = findCodecByPayloadType(rRtx.parameters.apt, rCodecs);\n    return lCodec && rCodec &&\n        lCodec.name.toLowerCase() === rCodec.name.toLowerCase();\n  };\n\n  localCapabilities.codecs.forEach(function(lCodec) {\n    for (var i = 0; i < remoteCapabilities.codecs.length; i++) {\n      var rCodec = remoteCapabilities.codecs[i];\n      if (lCodec.name.toLowerCase() === rCodec.name.toLowerCase() &&\n          lCodec.clockRate === rCodec.clockRate) {\n        if (lCodec.name.toLowerCase() === 'rtx' &&\n            lCodec.parameters && rCodec.parameters.apt) {\n          // for RTX we need to find the local rtx that has a apt\n          // which points to the same local codec as the remote one.\n          if (!rtxCapabilityMatches(lCodec, rCodec,\n              localCapabilities.codecs, remoteCapabilities.codecs)) {\n            continue;\n          }\n        }\n        rCodec = JSON.parse(JSON.stringify(rCodec)); // deepcopy\n        // number of channels is the highest common number of channels\n        rCodec.numChannels = Math.min(lCodec.numChannels,\n            rCodec.numChannels);\n        // push rCodec so we reply with offerer payload type\n        commonCapabilities.codecs.push(rCodec);\n\n        // determine common feedback mechanisms\n        rCodec.rtcpFeedback = rCodec.rtcpFeedback.filter(function(fb) {\n          for (var j = 0; j < lCodec.rtcpFeedback.length; j++) {\n            if (lCodec.rtcpFeedback[j].type === fb.type &&\n                lCodec.rtcpFeedback[j].parameter === fb.parameter) {\n              return true;\n            }\n          }\n          return false;\n        });\n        // FIXME: also need to determine .parameters\n        //  see https://github.com/openpeer/ortc/issues/569\n        break;\n      }\n    }\n  });\n\n  localCapabilities.headerExtensions.forEach(function(lHeaderExtension) {\n    for (var i = 0; i < remoteCapabilities.headerExtensions.length;\n         i++) {\n      var rHeaderExtension = remoteCapabilities.headerExtensions[i];\n      if (lHeaderExtension.uri === rHeaderExtension.uri) {\n        commonCapabilities.headerExtensions.push(rHeaderExtension);\n        break;\n      }\n    }\n  });\n\n  // FIXME: fecMechanisms\n  return commonCapabilities;\n}\n\n// is action=setLocalDescription with type allowed in signalingState\nfunction isActionAllowedInSignalingState(action, type, signalingState) {\n  return {\n    offer: {\n      setLocalDescription: ['stable', 'have-local-offer'],\n      setRemoteDescription: ['stable', 'have-remote-offer']\n    },\n    answer: {\n      setLocalDescription: ['have-remote-offer', 'have-local-pranswer'],\n      setRemoteDescription: ['have-local-offer', 'have-remote-pranswer']\n    }\n  }[type][action].indexOf(signalingState) !== -1;\n}\n\nfunction maybeAddCandidate(iceTransport, candidate) {\n  // Edge's internal representation adds some fields therefore\n  // not all field are taken into account.\n  var alreadyAdded = iceTransport.getRemoteCandidates()\n      .find(function(remoteCandidate) {\n        return candidate.foundation === remoteCandidate.foundation &&\n            candidate.ip === remoteCandidate.ip &&\n            candidate.port === remoteCandidate.port &&\n            candidate.priority === remoteCandidate.priority &&\n            candidate.protocol === remoteCandidate.protocol &&\n            candidate.type === remoteCandidate.type;\n      });\n  if (!alreadyAdded) {\n    iceTransport.addRemoteCandidate(candidate);\n  }\n  return !alreadyAdded;\n}\n\n\n// https://w3c.github.io/mediacapture-main/#mediastream\n// Helper function to add the track to the stream and\n// dispatch the event ourselves.\nfunction addTrackToStreamAndFireEvent(track, stream) {\n  stream.addTrack(track);\n  var e = new Event('addtrack'); // TODO: MediaStreamTrackEvent\n  e.track = track;\n  stream.dispatchEvent(e);\n}\n\nfunction removeTrackFromStreamAndFireEvent(track, stream) {\n  stream.removeTrack(track);\n  var e = new Event('removetrack'); // TODO: MediaStreamTrackEvent\n  e.track = track;\n  stream.dispatchEvent(e);\n}\n\nfunction fireAddTrack(pc, track, receiver, streams) {\n  var trackEvent = new Event('track');\n  trackEvent.track = track;\n  trackEvent.receiver = receiver;\n  trackEvent.transceiver = {receiver: receiver};\n  trackEvent.streams = streams;\n  window.setTimeout(function() {\n    pc._dispatchEvent('track', trackEvent);\n  });\n}\n\nfunction makeError(name, description) {\n  var e = new Error(description);\n  e.name = name;\n  return e;\n}\n\nmodule.exports = function(window, edgeVersion) {\n  var RTCPeerConnection = function(config) {\n    var pc = this;\n\n    var _eventTarget = document.createDocumentFragment();\n    ['addEventListener', 'removeEventListener', 'dispatchEvent']\n        .forEach(function(method) {\n          pc[method] = _eventTarget[method].bind(_eventTarget);\n        });\n\n    this.canTrickleIceCandidates = null;\n\n    this.needNegotiation = false;\n\n    this.localStreams = [];\n    this.remoteStreams = [];\n\n    this.localDescription = null;\n    this.remoteDescription = null;\n\n    this.signalingState = 'stable';\n    this.iceConnectionState = 'new';\n    this.iceGatheringState = 'new';\n\n    config = JSON.parse(JSON.stringify(config || {}));\n\n    this.usingBundle = config.bundlePolicy === 'max-bundle';\n    if (config.rtcpMuxPolicy === 'negotiate') {\n      throw(makeError('NotSupportedError',\n          'rtcpMuxPolicy \\'negotiate\\' is not supported'));\n    } else if (!config.rtcpMuxPolicy) {\n      config.rtcpMuxPolicy = 'require';\n    }\n\n    switch (config.iceTransportPolicy) {\n      case 'all':\n      case 'relay':\n        break;\n      default:\n        config.iceTransportPolicy = 'all';\n        break;\n    }\n\n    switch (config.bundlePolicy) {\n      case 'balanced':\n      case 'max-compat':\n      case 'max-bundle':\n        break;\n      default:\n        config.bundlePolicy = 'balanced';\n        break;\n    }\n\n    config.iceServers = filterIceServers(config.iceServers || [], edgeVersion);\n\n    this._iceGatherers = [];\n    if (config.iceCandidatePoolSize) {\n      for (var i = config.iceCandidatePoolSize; i > 0; i--) {\n        this._iceGatherers = new window.RTCIceGatherer({\n          iceServers: config.iceServers,\n          gatherPolicy: config.iceTransportPolicy\n        });\n      }\n    } else {\n      config.iceCandidatePoolSize = 0;\n    }\n\n    this._config = config;\n\n    // per-track iceGathers, iceTransports, dtlsTransports, rtpSenders, ...\n    // everything that is needed to describe a SDP m-line.\n    this.transceivers = [];\n\n    this._sdpSessionId = SDPUtils.generateSessionId();\n    this._sdpSessionVersion = 0;\n\n    this._dtlsRole = undefined; // role for a=setup to use in answers.\n\n    this._isClosed = false;\n  };\n\n  // set up event handlers on prototype\n  RTCPeerConnection.prototype.onicecandidate = null;\n  RTCPeerConnection.prototype.onaddstream = null;\n  RTCPeerConnection.prototype.ontrack = null;\n  RTCPeerConnection.prototype.onremovestream = null;\n  RTCPeerConnection.prototype.onsignalingstatechange = null;\n  RTCPeerConnection.prototype.oniceconnectionstatechange = null;\n  RTCPeerConnection.prototype.onicegatheringstatechange = null;\n  RTCPeerConnection.prototype.onnegotiationneeded = null;\n  RTCPeerConnection.prototype.ondatachannel = null;\n\n  RTCPeerConnection.prototype._dispatchEvent = function(name, event) {\n    if (this._isClosed) {\n      return;\n    }\n    this.dispatchEvent(event);\n    if (typeof this['on' + name] === 'function') {\n      this['on' + name](event);\n    }\n  };\n\n  RTCPeerConnection.prototype._emitGatheringStateChange = function() {\n    var event = new Event('icegatheringstatechange');\n    this._dispatchEvent('icegatheringstatechange', event);\n  };\n\n  RTCPeerConnection.prototype.getConfiguration = function() {\n    return this._config;\n  };\n\n  RTCPeerConnection.prototype.getLocalStreams = function() {\n    return this.localStreams;\n  };\n\n  RTCPeerConnection.prototype.getRemoteStreams = function() {\n    return this.remoteStreams;\n  };\n\n  // internal helper to create a transceiver object.\n  // (whih is not yet the same as the WebRTC 1.0 transceiver)\n  RTCPeerConnection.prototype._createTransceiver = function(kind) {\n    var hasBundleTransport = this.transceivers.length > 0;\n    var transceiver = {\n      track: null,\n      iceGatherer: null,\n      iceTransport: null,\n      dtlsTransport: null,\n      localCapabilities: null,\n      remoteCapabilities: null,\n      rtpSender: null,\n      rtpReceiver: null,\n      kind: kind,\n      mid: null,\n      sendEncodingParameters: null,\n      recvEncodingParameters: null,\n      stream: null,\n      associatedRemoteMediaStreams: [],\n      wantReceive: true\n    };\n    if (this.usingBundle && hasBundleTransport) {\n      transceiver.iceTransport = this.transceivers[0].iceTransport;\n      transceiver.dtlsTransport = this.transceivers[0].dtlsTransport;\n    } else {\n      var transports = this._createIceAndDtlsTransports();\n      transceiver.iceTransport = transports.iceTransport;\n      transceiver.dtlsTransport = transports.dtlsTransport;\n    }\n    this.transceivers.push(transceiver);\n    return transceiver;\n  };\n\n  RTCPeerConnection.prototype.addTrack = function(track, stream) {\n    var alreadyExists = this.transceivers.find(function(s) {\n      return s.track === track;\n    });\n\n    if (alreadyExists) {\n      throw makeError('InvalidAccessError', 'Track already exists.');\n    }\n\n    if (this.signalingState === 'closed') {\n      throw makeError('InvalidStateError',\n          'Attempted to call addTrack on a closed peerconnection.');\n    }\n\n    var transceiver;\n    for (var i = 0; i < this.transceivers.length; i++) {\n      if (!this.transceivers[i].track &&\n          this.transceivers[i].kind === track.kind) {\n        transceiver = this.transceivers[i];\n      }\n    }\n    if (!transceiver) {\n      transceiver = this._createTransceiver(track.kind);\n    }\n\n    this._maybeFireNegotiationNeeded();\n\n    if (this.localStreams.indexOf(stream) === -1) {\n      this.localStreams.push(stream);\n    }\n\n    transceiver.track = track;\n    transceiver.stream = stream;\n    transceiver.rtpSender = new window.RTCRtpSender(track,\n        transceiver.dtlsTransport);\n    return transceiver.rtpSender;\n  };\n\n  RTCPeerConnection.prototype.addStream = function(stream) {\n    var pc = this;\n    if (edgeVersion >= 15025) {\n      stream.getTracks().forEach(function(track) {\n        pc.addTrack(track, stream);\n      });\n    } else {\n      // Clone is necessary for local demos mostly, attaching directly\n      // to two different senders does not work (build 10547).\n      // Fixed in 15025 (or earlier)\n      var clonedStream = stream.clone();\n      stream.getTracks().forEach(function(track, idx) {\n        var clonedTrack = clonedStream.getTracks()[idx];\n        track.addEventListener('enabled', function(event) {\n          clonedTrack.enabled = event.enabled;\n        });\n      });\n      clonedStream.getTracks().forEach(function(track) {\n        pc.addTrack(track, clonedStream);\n      });\n    }\n  };\n\n  RTCPeerConnection.prototype.removeTrack = function(sender) {\n    if (!(sender instanceof window.RTCRtpSender)) {\n      throw new TypeError('Argument 1 of RTCPeerConnection.removeTrack ' +\n          'does not implement interface RTCRtpSender.');\n    }\n\n    var transceiver = this.transceivers.find(function(t) {\n      return t.rtpSender === sender;\n    });\n\n    if (!transceiver) {\n      throw makeError('InvalidAccessError',\n          'Sender was not created by this connection.');\n    }\n    var stream = transceiver.stream;\n\n    transceiver.rtpSender.stop();\n    transceiver.rtpSender = null;\n    transceiver.track = null;\n    transceiver.stream = null;\n\n    // remove the stream from the set of local streams\n    var localStreams = this.transceivers.map(function(t) {\n      return t.stream;\n    });\n    if (localStreams.indexOf(stream) === -1 &&\n        this.localStreams.indexOf(stream) > -1) {\n      this.localStreams.splice(this.localStreams.indexOf(stream), 1);\n    }\n\n    this._maybeFireNegotiationNeeded();\n  };\n\n  RTCPeerConnection.prototype.removeStream = function(stream) {\n    var pc = this;\n    stream.getTracks().forEach(function(track) {\n      var sender = pc.getSenders().find(function(s) {\n        return s.track === track;\n      });\n      if (sender) {\n        pc.removeTrack(sender);\n      }\n    });\n  };\n\n  RTCPeerConnection.prototype.getSenders = function() {\n    return this.transceivers.filter(function(transceiver) {\n      return !!transceiver.rtpSender;\n    })\n    .map(function(transceiver) {\n      return transceiver.rtpSender;\n    });\n  };\n\n  RTCPeerConnection.prototype.getReceivers = function() {\n    return this.transceivers.filter(function(transceiver) {\n      return !!transceiver.rtpReceiver;\n    })\n    .map(function(transceiver) {\n      return transceiver.rtpReceiver;\n    });\n  };\n\n\n  RTCPeerConnection.prototype._createIceGatherer = function(sdpMLineIndex,\n      usingBundle) {\n    var pc = this;\n    if (usingBundle && sdpMLineIndex > 0) {\n      return this.transceivers[0].iceGatherer;\n    } else if (this._iceGatherers.length) {\n      return this._iceGatherers.shift();\n    }\n    var iceGatherer = new window.RTCIceGatherer({\n      iceServers: this._config.iceServers,\n      gatherPolicy: this._config.iceTransportPolicy\n    });\n    Object.defineProperty(iceGatherer, 'state',\n        {value: 'new', writable: true}\n    );\n\n    this.transceivers[sdpMLineIndex].candidates = [];\n    this.transceivers[sdpMLineIndex].bufferCandidates = function(event) {\n      var end = !event.candidate || Object.keys(event.candidate).length === 0;\n      // polyfill since RTCIceGatherer.state is not implemented in\n      // Edge 10547 yet.\n      iceGatherer.state = end ? 'completed' : 'gathering';\n      if (pc.transceivers[sdpMLineIndex].candidates !== null) {\n        pc.transceivers[sdpMLineIndex].candidates.push(event.candidate);\n      }\n    };\n    iceGatherer.addEventListener('localcandidate',\n      this.transceivers[sdpMLineIndex].bufferCandidates);\n    return iceGatherer;\n  };\n\n  // start gathering from an RTCIceGatherer.\n  RTCPeerConnection.prototype._gather = function(mid, sdpMLineIndex) {\n    var pc = this;\n    var iceGatherer = this.transceivers[sdpMLineIndex].iceGatherer;\n    if (iceGatherer.onlocalcandidate) {\n      return;\n    }\n    var candidates = this.transceivers[sdpMLineIndex].candidates;\n    this.transceivers[sdpMLineIndex].candidates = null;\n    iceGatherer.removeEventListener('localcandidate',\n      this.transceivers[sdpMLineIndex].bufferCandidates);\n    iceGatherer.onlocalcandidate = function(evt) {\n      if (pc.usingBundle && sdpMLineIndex > 0) {\n        // if we know that we use bundle we can drop candidates with\n        // dpMLineIndex > 0. If we don't do this then our state gets\n        // confused since we dispose the extra ice gatherer.\n        return;\n      }\n      var event = new Event('icecandidate');\n      event.candidate = {sdpMid: mid, sdpMLineIndex: sdpMLineIndex};\n\n      var cand = evt.candidate;\n      // Edge emits an empty object for RTCIceCandidateComplete\n      var end = !cand || Object.keys(cand).length === 0;\n      if (end) {\n        // polyfill since RTCIceGatherer.state is not implemented in\n        // Edge 10547 yet.\n        if (iceGatherer.state === 'new' || iceGatherer.state === 'gathering') {\n          iceGatherer.state = 'completed';\n        }\n      } else {\n        if (iceGatherer.state === 'new') {\n          iceGatherer.state = 'gathering';\n        }\n        // RTCIceCandidate doesn't have a component, needs to be added\n        cand.component = 1;\n        event.candidate.candidate = SDPUtils.writeCandidate(cand);\n      }\n\n      // update local description.\n      var sections = SDPUtils.splitSections(pc.localDescription.sdp);\n      if (!end) {\n        sections[event.candidate.sdpMLineIndex + 1] +=\n            'a=' + event.candidate.candidate + '\\r\\n';\n      } else {\n        sections[event.candidate.sdpMLineIndex + 1] +=\n            'a=end-of-candidates\\r\\n';\n      }\n      pc.localDescription.sdp = sections.join('');\n      var complete = pc.transceivers.every(function(transceiver) {\n        return transceiver.iceGatherer &&\n            transceiver.iceGatherer.state === 'completed';\n      });\n\n      if (pc.iceGatheringState !== 'gathering') {\n        pc.iceGatheringState = 'gathering';\n        pc._emitGatheringStateChange();\n      }\n\n      // Emit candidate. Also emit null candidate when all gatherers are\n      // complete.\n      if (!end) {\n        pc._dispatchEvent('icecandidate', event);\n      }\n      if (complete) {\n        pc._dispatchEvent('icecandidate', new Event('icecandidate'));\n        pc.iceGatheringState = 'complete';\n        pc._emitGatheringStateChange();\n      }\n    };\n\n    // emit already gathered candidates.\n    window.setTimeout(function() {\n      candidates.forEach(function(candidate) {\n        var e = new Event('RTCIceGatherEvent');\n        e.candidate = candidate;\n        iceGatherer.onlocalcandidate(e);\n      });\n    }, 0);\n  };\n\n  // Create ICE transport and DTLS transport.\n  RTCPeerConnection.prototype._createIceAndDtlsTransports = function() {\n    var pc = this;\n    var iceTransport = new window.RTCIceTransport(null);\n    iceTransport.onicestatechange = function() {\n      pc._updateConnectionState();\n    };\n\n    var dtlsTransport = new window.RTCDtlsTransport(iceTransport);\n    dtlsTransport.ondtlsstatechange = function() {\n      pc._updateConnectionState();\n    };\n    dtlsTransport.onerror = function() {\n      // onerror does not set state to failed by itpc.\n      Object.defineProperty(dtlsTransport, 'state',\n          {value: 'failed', writable: true});\n      pc._updateConnectionState();\n    };\n\n    return {\n      iceTransport: iceTransport,\n      dtlsTransport: dtlsTransport\n    };\n  };\n\n  // Destroy ICE gatherer, ICE transport and DTLS transport.\n  // Without triggering the callbacks.\n  RTCPeerConnection.prototype._disposeIceAndDtlsTransports = function(\n      sdpMLineIndex) {\n    var iceGatherer = this.transceivers[sdpMLineIndex].iceGatherer;\n    if (iceGatherer) {\n      delete iceGatherer.onlocalcandidate;\n      delete this.transceivers[sdpMLineIndex].iceGatherer;\n    }\n    var iceTransport = this.transceivers[sdpMLineIndex].iceTransport;\n    if (iceTransport) {\n      delete iceTransport.onicestatechange;\n      delete this.transceivers[sdpMLineIndex].iceTransport;\n    }\n    var dtlsTransport = this.transceivers[sdpMLineIndex].dtlsTransport;\n    if (dtlsTransport) {\n      delete dtlsTransport.ondtlsstatechange;\n      delete dtlsTransport.onerror;\n      delete this.transceivers[sdpMLineIndex].dtlsTransport;\n    }\n  };\n\n  // Start the RTP Sender and Receiver for a transceiver.\n  RTCPeerConnection.prototype._transceive = function(transceiver,\n      send, recv) {\n    var params = getCommonCapabilities(transceiver.localCapabilities,\n        transceiver.remoteCapabilities);\n    if (send && transceiver.rtpSender) {\n      params.encodings = transceiver.sendEncodingParameters;\n      params.rtcp = {\n        cname: SDPUtils.localCName,\n        compound: transceiver.rtcpParameters.compound\n      };\n      if (transceiver.recvEncodingParameters.length) {\n        params.rtcp.ssrc = transceiver.recvEncodingParameters[0].ssrc;\n      }\n      transceiver.rtpSender.send(params);\n    }\n    if (recv && transceiver.rtpReceiver && params.codecs.length > 0) {\n      // remove RTX field in Edge 14942\n      if (transceiver.kind === 'video'\n          && transceiver.recvEncodingParameters\n          && edgeVersion < 15019) {\n        transceiver.recvEncodingParameters.forEach(function(p) {\n          delete p.rtx;\n        });\n      }\n      if (transceiver.recvEncodingParameters.length) {\n        params.encodings = transceiver.recvEncodingParameters;\n      }\n      params.rtcp = {\n        compound: transceiver.rtcpParameters.compound\n      };\n      if (transceiver.rtcpParameters.cname) {\n        params.rtcp.cname = transceiver.rtcpParameters.cname;\n      }\n      if (transceiver.sendEncodingParameters.length) {\n        params.rtcp.ssrc = transceiver.sendEncodingParameters[0].ssrc;\n      }\n      transceiver.rtpReceiver.receive(params);\n    }\n  };\n\n  RTCPeerConnection.prototype.setLocalDescription = function(description) {\n    var pc = this;\n\n    if (!isActionAllowedInSignalingState('setLocalDescription',\n        description.type, this.signalingState) || this._isClosed) {\n      return Promise.reject(makeError('InvalidStateError',\n          'Can not set local ' + description.type +\n          ' in state ' + pc.signalingState));\n    }\n\n    var sections;\n    var sessionpart;\n    if (description.type === 'offer') {\n      // VERY limited support for SDP munging. Limited to:\n      // * changing the order of codecs\n      sections = SDPUtils.splitSections(description.sdp);\n      sessionpart = sections.shift();\n      sections.forEach(function(mediaSection, sdpMLineIndex) {\n        var caps = SDPUtils.parseRtpParameters(mediaSection);\n        pc.transceivers[sdpMLineIndex].localCapabilities = caps;\n      });\n\n      this.transceivers.forEach(function(transceiver, sdpMLineIndex) {\n        pc._gather(transceiver.mid, sdpMLineIndex);\n      });\n    } else if (description.type === 'answer') {\n      sections = SDPUtils.splitSections(pc.remoteDescription.sdp);\n      sessionpart = sections.shift();\n      var isIceLite = SDPUtils.matchPrefix(sessionpart,\n          'a=ice-lite').length > 0;\n      sections.forEach(function(mediaSection, sdpMLineIndex) {\n        var transceiver = pc.transceivers[sdpMLineIndex];\n        var iceGatherer = transceiver.iceGatherer;\n        var iceTransport = transceiver.iceTransport;\n        var dtlsTransport = transceiver.dtlsTransport;\n        var localCapabilities = transceiver.localCapabilities;\n        var remoteCapabilities = transceiver.remoteCapabilities;\n\n        // treat bundle-only as not-rejected.\n        var rejected = SDPUtils.isRejected(mediaSection) &&\n            SDPUtils.matchPrefix(mediaSection, 'a=bundle-only').length === 0;\n\n        if (!rejected && !transceiver.isDatachannel) {\n          var remoteIceParameters = SDPUtils.getIceParameters(\n              mediaSection, sessionpart);\n          var remoteDtlsParameters = SDPUtils.getDtlsParameters(\n              mediaSection, sessionpart);\n          if (isIceLite) {\n            remoteDtlsParameters.role = 'server';\n          }\n\n          if (!pc.usingBundle || sdpMLineIndex === 0) {\n            pc._gather(transceiver.mid, sdpMLineIndex);\n            if (iceTransport.state === 'new') {\n              iceTransport.start(iceGatherer, remoteIceParameters,\n                  isIceLite ? 'controlling' : 'controlled');\n            }\n            if (dtlsTransport.state === 'new') {\n              dtlsTransport.start(remoteDtlsParameters);\n            }\n          }\n\n          // Calculate intersection of capabilities.\n          var params = getCommonCapabilities(localCapabilities,\n              remoteCapabilities);\n\n          // Start the RTCRtpSender. The RTCRtpReceiver for this\n          // transceiver has already been started in setRemoteDescription.\n          pc._transceive(transceiver,\n              params.codecs.length > 0,\n              false);\n        }\n      });\n    }\n\n    this.localDescription = {\n      type: description.type,\n      sdp: description.sdp\n    };\n    switch (description.type) {\n      case 'offer':\n        this._updateSignalingState('have-local-offer');\n        break;\n      case 'answer':\n        this._updateSignalingState('stable');\n        break;\n      default:\n        throw new TypeError('unsupported type \"' + description.type +\n            '\"');\n    }\n\n    return Promise.resolve();\n  };\n\n  RTCPeerConnection.prototype.setRemoteDescription = function(description) {\n    var pc = this;\n\n    if (!isActionAllowedInSignalingState('setRemoteDescription',\n        description.type, this.signalingState) || this._isClosed) {\n      return Promise.reject(makeError('InvalidStateError',\n          'Can not set remote ' + description.type +\n          ' in state ' + pc.signalingState));\n    }\n\n    var streams = {};\n    this.remoteStreams.forEach(function(stream) {\n      streams[stream.id] = stream;\n    });\n    var receiverList = [];\n    var sections = SDPUtils.splitSections(description.sdp);\n    var sessionpart = sections.shift();\n    var isIceLite = SDPUtils.matchPrefix(sessionpart,\n        'a=ice-lite').length > 0;\n    var usingBundle = SDPUtils.matchPrefix(sessionpart,\n        'a=group:BUNDLE ').length > 0;\n    this.usingBundle = usingBundle;\n    var iceOptions = SDPUtils.matchPrefix(sessionpart,\n        'a=ice-options:')[0];\n    if (iceOptions) {\n      this.canTrickleIceCandidates = iceOptions.substr(14).split(' ')\n          .indexOf('trickle') >= 0;\n    } else {\n      this.canTrickleIceCandidates = false;\n    }\n\n    sections.forEach(function(mediaSection, sdpMLineIndex) {\n      var lines = SDPUtils.splitLines(mediaSection);\n      var kind = SDPUtils.getKind(mediaSection);\n      // treat bundle-only as not-rejected.\n      var rejected = SDPUtils.isRejected(mediaSection) &&\n          SDPUtils.matchPrefix(mediaSection, 'a=bundle-only').length === 0;\n      var protocol = lines[0].substr(2).split(' ')[2];\n\n      var direction = SDPUtils.getDirection(mediaSection, sessionpart);\n      var remoteMsid = SDPUtils.parseMsid(mediaSection);\n\n      var mid = SDPUtils.getMid(mediaSection) || SDPUtils.generateIdentifier();\n\n      // Reject datachannels which are not implemented yet.\n      if (kind === 'application' && protocol === 'DTLS/SCTP') {\n        pc.transceivers[sdpMLineIndex] = {\n          mid: mid,\n          isDatachannel: true\n        };\n        return;\n      }\n\n      var transceiver;\n      var iceGatherer;\n      var iceTransport;\n      var dtlsTransport;\n      var rtpReceiver;\n      var sendEncodingParameters;\n      var recvEncodingParameters;\n      var localCapabilities;\n\n      var track;\n      // FIXME: ensure the mediaSection has rtcp-mux set.\n      var remoteCapabilities = SDPUtils.parseRtpParameters(mediaSection);\n      var remoteIceParameters;\n      var remoteDtlsParameters;\n      if (!rejected) {\n        remoteIceParameters = SDPUtils.getIceParameters(mediaSection,\n            sessionpart);\n        remoteDtlsParameters = SDPUtils.getDtlsParameters(mediaSection,\n            sessionpart);\n        remoteDtlsParameters.role = 'client';\n      }\n      recvEncodingParameters =\n          SDPUtils.parseRtpEncodingParameters(mediaSection);\n\n      var rtcpParameters = SDPUtils.parseRtcpParameters(mediaSection);\n\n      var isComplete = SDPUtils.matchPrefix(mediaSection,\n          'a=end-of-candidates', sessionpart).length > 0;\n      var cands = SDPUtils.matchPrefix(mediaSection, 'a=candidate:')\n          .map(function(cand) {\n            return SDPUtils.parseCandidate(cand);\n          })\n          .filter(function(cand) {\n            return cand.component === 1;\n          });\n\n      // Check if we can use BUNDLE and dispose transports.\n      if ((description.type === 'offer' || description.type === 'answer') &&\n          !rejected && usingBundle && sdpMLineIndex > 0 &&\n          pc.transceivers[sdpMLineIndex]) {\n        pc._disposeIceAndDtlsTransports(sdpMLineIndex);\n        pc.transceivers[sdpMLineIndex].iceGatherer =\n            pc.transceivers[0].iceGatherer;\n        pc.transceivers[sdpMLineIndex].iceTransport =\n            pc.transceivers[0].iceTransport;\n        pc.transceivers[sdpMLineIndex].dtlsTransport =\n            pc.transceivers[0].dtlsTransport;\n        if (pc.transceivers[sdpMLineIndex].rtpSender) {\n          pc.transceivers[sdpMLineIndex].rtpSender.setTransport(\n              pc.transceivers[0].dtlsTransport);\n        }\n        if (pc.transceivers[sdpMLineIndex].rtpReceiver) {\n          pc.transceivers[sdpMLineIndex].rtpReceiver.setTransport(\n              pc.transceivers[0].dtlsTransport);\n        }\n      }\n      if (description.type === 'offer' && !rejected) {\n        transceiver = pc.transceivers[sdpMLineIndex] ||\n            pc._createTransceiver(kind);\n        transceiver.mid = mid;\n\n        if (!transceiver.iceGatherer) {\n          transceiver.iceGatherer = pc._createIceGatherer(sdpMLineIndex,\n              usingBundle);\n        }\n\n        if (cands.length && transceiver.iceTransport.state === 'new') {\n          if (isComplete && (!usingBundle || sdpMLineIndex === 0)) {\n            transceiver.iceTransport.setRemoteCandidates(cands);\n          } else {\n            cands.forEach(function(candidate) {\n              maybeAddCandidate(transceiver.iceTransport, candidate);\n            });\n          }\n        }\n\n        localCapabilities = window.RTCRtpReceiver.getCapabilities(kind);\n\n        // filter RTX until additional stuff needed for RTX is implemented\n        // in adapter.js\n        if (edgeVersion < 15019) {\n          localCapabilities.codecs = localCapabilities.codecs.filter(\n              function(codec) {\n                return codec.name !== 'rtx';\n              });\n        }\n\n        sendEncodingParameters = transceiver.sendEncodingParameters || [{\n          ssrc: (2 * sdpMLineIndex + 2) * 1001\n        }];\n\n        // TODO: rewrite to use http://w3c.github.io/webrtc-pc/#set-associated-remote-streams\n        var isNewTrack = false;\n        if (direction === 'sendrecv' || direction === 'sendonly') {\n          isNewTrack = !transceiver.rtpReceiver;\n          rtpReceiver = transceiver.rtpReceiver ||\n              new window.RTCRtpReceiver(transceiver.dtlsTransport, kind);\n\n          if (isNewTrack) {\n            var stream;\n            track = rtpReceiver.track;\n            // FIXME: does not work with Plan B.\n            if (remoteMsid && remoteMsid.stream === '-') {\n              // no-op. a stream id of '-' means: no associated stream.\n            } else if (remoteMsid) {\n              if (!streams[remoteMsid.stream]) {\n                streams[remoteMsid.stream] = new window.MediaStream();\n                Object.defineProperty(streams[remoteMsid.stream], 'id', {\n                  get: function() {\n                    return remoteMsid.stream;\n                  }\n                });\n              }\n              Object.defineProperty(track, 'id', {\n                get: function() {\n                  return remoteMsid.track;\n                }\n              });\n              stream = streams[remoteMsid.stream];\n            } else {\n              if (!streams.default) {\n                streams.default = new window.MediaStream();\n              }\n              stream = streams.default;\n            }\n            if (stream) {\n              addTrackToStreamAndFireEvent(track, stream);\n              transceiver.associatedRemoteMediaStreams.push(stream);\n            }\n            receiverList.push([track, rtpReceiver, stream]);\n          }\n        } else if (transceiver.rtpReceiver && transceiver.rtpReceiver.track) {\n          transceiver.associatedRemoteMediaStreams.forEach(function(s) {\n            var nativeTrack = s.getTracks().find(function(t) {\n              return t.id === transceiver.rtpReceiver.track.id;\n            });\n            if (nativeTrack) {\n              removeTrackFromStreamAndFireEvent(nativeTrack, s);\n            }\n          });\n          transceiver.associatedRemoteMediaStreams = [];\n        }\n\n        transceiver.localCapabilities = localCapabilities;\n        transceiver.remoteCapabilities = remoteCapabilities;\n        transceiver.rtpReceiver = rtpReceiver;\n        transceiver.rtcpParameters = rtcpParameters;\n        transceiver.sendEncodingParameters = sendEncodingParameters;\n        transceiver.recvEncodingParameters = recvEncodingParameters;\n\n        // Start the RTCRtpReceiver now. The RTPSender is started in\n        // setLocalDescription.\n        pc._transceive(pc.transceivers[sdpMLineIndex],\n            false,\n            isNewTrack);\n      } else if (description.type === 'answer' && !rejected) {\n        transceiver = pc.transceivers[sdpMLineIndex];\n        iceGatherer = transceiver.iceGatherer;\n        iceTransport = transceiver.iceTransport;\n        dtlsTransport = transceiver.dtlsTransport;\n        rtpReceiver = transceiver.rtpReceiver;\n        sendEncodingParameters = transceiver.sendEncodingParameters;\n        localCapabilities = transceiver.localCapabilities;\n\n        pc.transceivers[sdpMLineIndex].recvEncodingParameters =\n            recvEncodingParameters;\n        pc.transceivers[sdpMLineIndex].remoteCapabilities =\n            remoteCapabilities;\n        pc.transceivers[sdpMLineIndex].rtcpParameters = rtcpParameters;\n\n        if (cands.length && iceTransport.state === 'new') {\n          if ((isIceLite || isComplete) &&\n              (!usingBundle || sdpMLineIndex === 0)) {\n            iceTransport.setRemoteCandidates(cands);\n          } else {\n            cands.forEach(function(candidate) {\n              maybeAddCandidate(transceiver.iceTransport, candidate);\n            });\n          }\n        }\n\n        if (!usingBundle || sdpMLineIndex === 0) {\n          if (iceTransport.state === 'new') {\n            iceTransport.start(iceGatherer, remoteIceParameters,\n                'controlling');\n          }\n          if (dtlsTransport.state === 'new') {\n            dtlsTransport.start(remoteDtlsParameters);\n          }\n        }\n\n        pc._transceive(transceiver,\n            direction === 'sendrecv' || direction === 'recvonly',\n            direction === 'sendrecv' || direction === 'sendonly');\n\n        // TODO: rewrite to use http://w3c.github.io/webrtc-pc/#set-associated-remote-streams\n        if (rtpReceiver &&\n            (direction === 'sendrecv' || direction === 'sendonly')) {\n          track = rtpReceiver.track;\n          if (remoteMsid) {\n            if (!streams[remoteMsid.stream]) {\n              streams[remoteMsid.stream] = new window.MediaStream();\n            }\n            addTrackToStreamAndFireEvent(track, streams[remoteMsid.stream]);\n            receiverList.push([track, rtpReceiver, streams[remoteMsid.stream]]);\n          } else {\n            if (!streams.default) {\n              streams.default = new window.MediaStream();\n            }\n            addTrackToStreamAndFireEvent(track, streams.default);\n            receiverList.push([track, rtpReceiver, streams.default]);\n          }\n        } else {\n          // FIXME: actually the receiver should be created later.\n          delete transceiver.rtpReceiver;\n        }\n      }\n    });\n\n    if (this._dtlsRole === undefined) {\n      this._dtlsRole = description.type === 'offer' ? 'active' : 'passive';\n    }\n\n    this.remoteDescription = {\n      type: description.type,\n      sdp: description.sdp\n    };\n    switch (description.type) {\n      case 'offer':\n        this._updateSignalingState('have-remote-offer');\n        break;\n      case 'answer':\n        this._updateSignalingState('stable');\n        break;\n      default:\n        throw new TypeError('unsupported type \"' + description.type +\n            '\"');\n    }\n    Object.keys(streams).forEach(function(sid) {\n      var stream = streams[sid];\n      if (stream.getTracks().length) {\n        if (pc.remoteStreams.indexOf(stream) === -1) {\n          pc.remoteStreams.push(stream);\n          var event = new Event('addstream');\n          event.stream = stream;\n          window.setTimeout(function() {\n            pc._dispatchEvent('addstream', event);\n          });\n        }\n\n        receiverList.forEach(function(item) {\n          var track = item[0];\n          var receiver = item[1];\n          if (stream.id !== item[2].id) {\n            return;\n          }\n          fireAddTrack(pc, track, receiver, [stream]);\n        });\n      }\n    });\n    receiverList.forEach(function(item) {\n      if (item[2]) {\n        return;\n      }\n      fireAddTrack(pc, item[0], item[1], []);\n    });\n\n    // check whether addIceCandidate({}) was called within four seconds after\n    // setRemoteDescription.\n    window.setTimeout(function() {\n      if (!(pc && pc.transceivers)) {\n        return;\n      }\n      pc.transceivers.forEach(function(transceiver) {\n        if (transceiver.iceTransport &&\n            transceiver.iceTransport.state === 'new' &&\n            transceiver.iceTransport.getRemoteCandidates().length > 0) {\n          console.warn('Timeout for addRemoteCandidate. Consider sending ' +\n              'an end-of-candidates notification');\n          transceiver.iceTransport.addRemoteCandidate({});\n        }\n      });\n    }, 4000);\n\n    return Promise.resolve();\n  };\n\n  RTCPeerConnection.prototype.close = function() {\n    this.transceivers.forEach(function(transceiver) {\n      /* not yet\n      if (transceiver.iceGatherer) {\n        transceiver.iceGatherer.close();\n      }\n      */\n      if (transceiver.iceTransport) {\n        transceiver.iceTransport.stop();\n      }\n      if (transceiver.dtlsTransport) {\n        transceiver.dtlsTransport.stop();\n      }\n      if (transceiver.rtpSender) {\n        transceiver.rtpSender.stop();\n      }\n      if (transceiver.rtpReceiver) {\n        transceiver.rtpReceiver.stop();\n      }\n    });\n    // FIXME: clean up tracks, local streams, remote streams, etc\n    this._isClosed = true;\n    this._updateSignalingState('closed');\n  };\n\n  // Update the signaling state.\n  RTCPeerConnection.prototype._updateSignalingState = function(newState) {\n    this.signalingState = newState;\n    var event = new Event('signalingstatechange');\n    this._dispatchEvent('signalingstatechange', event);\n  };\n\n  // Determine whether to fire the negotiationneeded event.\n  RTCPeerConnection.prototype._maybeFireNegotiationNeeded = function() {\n    var pc = this;\n    if (this.signalingState !== 'stable' || this.needNegotiation === true) {\n      return;\n    }\n    this.needNegotiation = true;\n    window.setTimeout(function() {\n      if (pc.needNegotiation === false) {\n        return;\n      }\n      pc.needNegotiation = false;\n      var event = new Event('negotiationneeded');\n      pc._dispatchEvent('negotiationneeded', event);\n    }, 0);\n  };\n\n  // Update the connection state.\n  RTCPeerConnection.prototype._updateConnectionState = function() {\n    var newState;\n    var states = {\n      'new': 0,\n      closed: 0,\n      connecting: 0,\n      checking: 0,\n      connected: 0,\n      completed: 0,\n      disconnected: 0,\n      failed: 0\n    };\n    this.transceivers.forEach(function(transceiver) {\n      states[transceiver.iceTransport.state]++;\n      states[transceiver.dtlsTransport.state]++;\n    });\n    // ICETransport.completed and connected are the same for this purpose.\n    states.connected += states.completed;\n\n    newState = 'new';\n    if (states.failed > 0) {\n      newState = 'failed';\n    } else if (states.connecting > 0 || states.checking > 0) {\n      newState = 'connecting';\n    } else if (states.disconnected > 0) {\n      newState = 'disconnected';\n    } else if (states.new > 0) {\n      newState = 'new';\n    } else if (states.connected > 0 || states.completed > 0) {\n      newState = 'connected';\n    }\n\n    if (newState !== this.iceConnectionState) {\n      this.iceConnectionState = newState;\n      var event = new Event('iceconnectionstatechange');\n      this._dispatchEvent('iceconnectionstatechange', event);\n    }\n  };\n\n  RTCPeerConnection.prototype.createOffer = function() {\n    var pc = this;\n\n    if (this._isClosed) {\n      return Promise.reject(makeError('InvalidStateError',\n          'Can not call createOffer after close'));\n    }\n\n    var numAudioTracks = this.transceivers.filter(function(t) {\n      return t.kind === 'audio';\n    }).length;\n    var numVideoTracks = this.transceivers.filter(function(t) {\n      return t.kind === 'video';\n    }).length;\n\n    // Determine number of audio and video tracks we need to send/recv.\n    var offerOptions = arguments[0];\n    if (offerOptions) {\n      // Reject Chrome legacy constraints.\n      if (offerOptions.mandatory || offerOptions.optional) {\n        throw new TypeError(\n            'Legacy mandatory/optional constraints not supported.');\n      }\n      if (offerOptions.offerToReceiveAudio !== undefined) {\n        if (offerOptions.offerToReceiveAudio === true) {\n          numAudioTracks = 1;\n        } else if (offerOptions.offerToReceiveAudio === false) {\n          numAudioTracks = 0;\n        } else {\n          numAudioTracks = offerOptions.offerToReceiveAudio;\n        }\n      }\n      if (offerOptions.offerToReceiveVideo !== undefined) {\n        if (offerOptions.offerToReceiveVideo === true) {\n          numVideoTracks = 1;\n        } else if (offerOptions.offerToReceiveVideo === false) {\n          numVideoTracks = 0;\n        } else {\n          numVideoTracks = offerOptions.offerToReceiveVideo;\n        }\n      }\n    }\n\n    this.transceivers.forEach(function(transceiver) {\n      if (transceiver.kind === 'audio') {\n        numAudioTracks--;\n        if (numAudioTracks < 0) {\n          transceiver.wantReceive = false;\n        }\n      } else if (transceiver.kind === 'video') {\n        numVideoTracks--;\n        if (numVideoTracks < 0) {\n          transceiver.wantReceive = false;\n        }\n      }\n    });\n\n    // Create M-lines for recvonly streams.\n    while (numAudioTracks > 0 || numVideoTracks > 0) {\n      if (numAudioTracks > 0) {\n        this._createTransceiver('audio');\n        numAudioTracks--;\n      }\n      if (numVideoTracks > 0) {\n        this._createTransceiver('video');\n        numVideoTracks--;\n      }\n    }\n\n    var sdp = SDPUtils.writeSessionBoilerplate(this._sdpSessionId,\n        this._sdpSessionVersion++);\n    this.transceivers.forEach(function(transceiver, sdpMLineIndex) {\n      // For each track, create an ice gatherer, ice transport,\n      // dtls transport, potentially rtpsender and rtpreceiver.\n      var track = transceiver.track;\n      var kind = transceiver.kind;\n      var mid = SDPUtils.generateIdentifier();\n      transceiver.mid = mid;\n\n      if (!transceiver.iceGatherer) {\n        transceiver.iceGatherer = pc._createIceGatherer(sdpMLineIndex,\n            pc.usingBundle);\n      }\n\n      var localCapabilities = window.RTCRtpSender.getCapabilities(kind);\n      // filter RTX until additional stuff needed for RTX is implemented\n      // in adapter.js\n      if (edgeVersion < 15019) {\n        localCapabilities.codecs = localCapabilities.codecs.filter(\n            function(codec) {\n              return codec.name !== 'rtx';\n            });\n      }\n      localCapabilities.codecs.forEach(function(codec) {\n        // work around https://bugs.chromium.org/p/webrtc/issues/detail?id=6552\n        // by adding level-asymmetry-allowed=1\n        if (codec.name === 'H264' &&\n            codec.parameters['level-asymmetry-allowed'] === undefined) {\n          codec.parameters['level-asymmetry-allowed'] = '1';\n        }\n      });\n\n      // generate an ssrc now, to be used later in rtpSender.send\n      var sendEncodingParameters = transceiver.sendEncodingParameters || [{\n        ssrc: (2 * sdpMLineIndex + 1) * 1001\n      }];\n      if (track) {\n        // add RTX\n        if (edgeVersion >= 15019 && kind === 'video' &&\n            !sendEncodingParameters[0].rtx) {\n          sendEncodingParameters[0].rtx = {\n            ssrc: sendEncodingParameters[0].ssrc + 1\n          };\n        }\n      }\n\n      if (transceiver.wantReceive) {\n        transceiver.rtpReceiver = new window.RTCRtpReceiver(\n            transceiver.dtlsTransport, kind);\n      }\n\n      transceiver.localCapabilities = localCapabilities;\n      transceiver.sendEncodingParameters = sendEncodingParameters;\n    });\n\n    // always offer BUNDLE and dispose on return if not supported.\n    if (this._config.bundlePolicy !== 'max-compat') {\n      sdp += 'a=group:BUNDLE ' + this.transceivers.map(function(t) {\n        return t.mid;\n      }).join(' ') + '\\r\\n';\n    }\n    sdp += 'a=ice-options:trickle\\r\\n';\n\n    this.transceivers.forEach(function(transceiver, sdpMLineIndex) {\n      sdp += writeMediaSection(transceiver, transceiver.localCapabilities,\n          'offer', transceiver.stream, pc._dtlsRole);\n      sdp += 'a=rtcp-rsize\\r\\n';\n\n      if (transceiver.iceGatherer && pc.iceGatheringState !== 'new' &&\n          (sdpMLineIndex === 0 || !pc.usingBundle)) {\n        transceiver.iceGatherer.getLocalCandidates().forEach(function(cand) {\n          cand.component = 1;\n          sdp += 'a=' + SDPUtils.writeCandidate(cand) + '\\r\\n';\n        });\n\n        if (transceiver.iceGatherer.state === 'completed') {\n          sdp += 'a=end-of-candidates\\r\\n';\n        }\n      }\n    });\n\n    var desc = new window.RTCSessionDescription({\n      type: 'offer',\n      sdp: sdp\n    });\n    return Promise.resolve(desc);\n  };\n\n  RTCPeerConnection.prototype.createAnswer = function() {\n    var pc = this;\n\n    if (this._isClosed) {\n      return Promise.reject(makeError('InvalidStateError',\n          'Can not call createAnswer after close'));\n    }\n\n    var sdp = SDPUtils.writeSessionBoilerplate(this._sdpSessionId,\n        this._sdpSessionVersion++);\n    if (this.usingBundle) {\n      sdp += 'a=group:BUNDLE ' + this.transceivers.map(function(t) {\n        return t.mid;\n      }).join(' ') + '\\r\\n';\n    }\n    var mediaSectionsInOffer = SDPUtils.splitSections(\n        this.remoteDescription.sdp).length - 1;\n    this.transceivers.forEach(function(transceiver, sdpMLineIndex) {\n      if (sdpMLineIndex + 1 > mediaSectionsInOffer) {\n        return;\n      }\n      if (transceiver.isDatachannel) {\n        sdp += 'm=application 0 DTLS/SCTP 5000\\r\\n' +\n            'c=IN IP4 0.0.0.0\\r\\n' +\n            'a=mid:' + transceiver.mid + '\\r\\n';\n        return;\n      }\n\n      // FIXME: look at direction.\n      if (transceiver.stream) {\n        var localTrack;\n        if (transceiver.kind === 'audio') {\n          localTrack = transceiver.stream.getAudioTracks()[0];\n        } else if (transceiver.kind === 'video') {\n          localTrack = transceiver.stream.getVideoTracks()[0];\n        }\n        if (localTrack) {\n          // add RTX\n          if (edgeVersion >= 15019 && transceiver.kind === 'video' &&\n              !transceiver.sendEncodingParameters[0].rtx) {\n            transceiver.sendEncodingParameters[0].rtx = {\n              ssrc: transceiver.sendEncodingParameters[0].ssrc + 1\n            };\n          }\n        }\n      }\n\n      // Calculate intersection of capabilities.\n      var commonCapabilities = getCommonCapabilities(\n          transceiver.localCapabilities,\n          transceiver.remoteCapabilities);\n\n      var hasRtx = commonCapabilities.codecs.filter(function(c) {\n        return c.name.toLowerCase() === 'rtx';\n      }).length;\n      if (!hasRtx && transceiver.sendEncodingParameters[0].rtx) {\n        delete transceiver.sendEncodingParameters[0].rtx;\n      }\n\n      sdp += writeMediaSection(transceiver, commonCapabilities,\n          'answer', transceiver.stream, pc._dtlsRole);\n      if (transceiver.rtcpParameters &&\n          transceiver.rtcpParameters.reducedSize) {\n        sdp += 'a=rtcp-rsize\\r\\n';\n      }\n    });\n\n    var desc = new window.RTCSessionDescription({\n      type: 'answer',\n      sdp: sdp\n    });\n    return Promise.resolve(desc);\n  };\n\n  RTCPeerConnection.prototype.addIceCandidate = function(candidate) {\n    var sections;\n    if (!candidate || candidate.candidate === '') {\n      for (var j = 0; j < this.transceivers.length; j++) {\n        if (this.transceivers[j].isDatachannel) {\n          continue;\n        }\n        this.transceivers[j].iceTransport.addRemoteCandidate({});\n        sections = SDPUtils.splitSections(this.remoteDescription.sdp);\n        sections[j + 1] += 'a=end-of-candidates\\r\\n';\n        this.remoteDescription.sdp = sections.join('');\n        if (this.usingBundle) {\n          break;\n        }\n      }\n    } else if (!(candidate.sdpMLineIndex !== undefined || candidate.sdpMid)) {\n      throw new TypeError('sdpMLineIndex or sdpMid required');\n    } else if (!this.remoteDescription) {\n      return Promise.reject(makeError('InvalidStateError',\n          'Can not add ICE candidate without a remote description'));\n    } else {\n      var sdpMLineIndex = candidate.sdpMLineIndex;\n      if (candidate.sdpMid) {\n        for (var i = 0; i < this.transceivers.length; i++) {\n          if (this.transceivers[i].mid === candidate.sdpMid) {\n            sdpMLineIndex = i;\n            break;\n          }\n        }\n      }\n      var transceiver = this.transceivers[sdpMLineIndex];\n      if (transceiver) {\n        if (transceiver.isDatachannel) {\n          return Promise.resolve();\n        }\n        var cand = Object.keys(candidate.candidate).length > 0 ?\n            SDPUtils.parseCandidate(candidate.candidate) : {};\n        // Ignore Chrome's invalid candidates since Edge does not like them.\n        if (cand.protocol === 'tcp' && (cand.port === 0 || cand.port === 9)) {\n          return Promise.resolve();\n        }\n        // Ignore RTCP candidates, we assume RTCP-MUX.\n        if (cand.component && cand.component !== 1) {\n          return Promise.resolve();\n        }\n        // when using bundle, avoid adding candidates to the wrong\n        // ice transport. And avoid adding candidates added in the SDP.\n        if (sdpMLineIndex === 0 || (sdpMLineIndex > 0 &&\n            transceiver.iceTransport !== this.transceivers[0].iceTransport)) {\n          if (!maybeAddCandidate(transceiver.iceTransport, cand)) {\n            return Promise.reject(makeError('OperationError',\n                'Can not add ICE candidate'));\n          }\n        }\n\n        // update the remoteDescription.\n        var candidateString = candidate.candidate.trim();\n        if (candidateString.indexOf('a=') === 0) {\n          candidateString = candidateString.substr(2);\n        }\n        sections = SDPUtils.splitSections(this.remoteDescription.sdp);\n        sections[sdpMLineIndex + 1] += 'a=' +\n            (cand.type ? candidateString : 'end-of-candidates')\n            + '\\r\\n';\n        this.remoteDescription.sdp = sections.join('');\n      } else {\n        return Promise.reject(makeError('OperationError',\n            'Can not add ICE candidate'));\n      }\n    }\n    return Promise.resolve();\n  };\n\n  RTCPeerConnection.prototype.getStats = function() {\n    var promises = [];\n    this.transceivers.forEach(function(transceiver) {\n      ['rtpSender', 'rtpReceiver', 'iceGatherer', 'iceTransport',\n          'dtlsTransport'].forEach(function(method) {\n            if (transceiver[method]) {\n              promises.push(transceiver[method].getStats());\n            }\n          });\n    });\n    var fixStatsType = function(stat) {\n      return {\n        inboundrtp: 'inbound-rtp',\n        outboundrtp: 'outbound-rtp',\n        candidatepair: 'candidate-pair',\n        localcandidate: 'local-candidate',\n        remotecandidate: 'remote-candidate'\n      }[stat.type] || stat.type;\n    };\n    return new Promise(function(resolve) {\n      // shim getStats with maplike support\n      var results = new Map();\n      Promise.all(promises).then(function(res) {\n        res.forEach(function(result) {\n          Object.keys(result).forEach(function(id) {\n            result[id].type = fixStatsType(result[id]);\n            results.set(id, result[id]);\n          });\n        });\n        resolve(results);\n      });\n    });\n  };\n\n  // legacy callback shims. Should be moved to adapter.js some days.\n  var methods = ['createOffer', 'createAnswer'];\n  methods.forEach(function(method) {\n    var nativeMethod = RTCPeerConnection.prototype[method];\n    RTCPeerConnection.prototype[method] = function() {\n      var args = arguments;\n      if (typeof args[0] === 'function' ||\n          typeof args[1] === 'function') { // legacy\n        return nativeMethod.apply(this, [arguments[2]])\n        .then(function(description) {\n          if (typeof args[0] === 'function') {\n            args[0].apply(null, [description]);\n          }\n        }, function(error) {\n          if (typeof args[1] === 'function') {\n            args[1].apply(null, [error]);\n          }\n        });\n      }\n      return nativeMethod.apply(this, arguments);\n    };\n  });\n\n  methods = ['setLocalDescription', 'setRemoteDescription', 'addIceCandidate'];\n  methods.forEach(function(method) {\n    var nativeMethod = RTCPeerConnection.prototype[method];\n    RTCPeerConnection.prototype[method] = function() {\n      var args = arguments;\n      if (typeof args[1] === 'function' ||\n          typeof args[2] === 'function') { // legacy\n        return nativeMethod.apply(this, arguments)\n        .then(function() {\n          if (typeof args[1] === 'function') {\n            args[1].apply(null);\n          }\n        }, function(error) {\n          if (typeof args[2] === 'function') {\n            args[2].apply(null, [error]);\n          }\n        });\n      }\n      return nativeMethod.apply(this, arguments);\n    };\n  });\n\n  // getStats is special. It doesn't have a spec legacy method yet we support\n  // getStats(something, cb) without error callbacks.\n  ['getStats'].forEach(function(method) {\n    var nativeMethod = RTCPeerConnection.prototype[method];\n    RTCPeerConnection.prototype[method] = function() {\n      var args = arguments;\n      if (typeof args[1] === 'function') {\n        return nativeMethod.apply(this, arguments)\n        .then(function() {\n          if (typeof args[1] === 'function') {\n            args[1].apply(null);\n          }\n        });\n      }\n      return nativeMethod.apply(this, arguments);\n    };\n  });\n\n  return RTCPeerConnection;\n};\n\n},{\"sdp\":2}],2:[function(require,module,exports){\n /* eslint-env node */\n'use strict';\n\n// SDP helpers.\nvar SDPUtils = {};\n\n// Generate an alphanumeric identifier for cname or mids.\n// TODO: use UUIDs instead? https://gist.github.com/jed/982883\nSDPUtils.generateIdentifier = function() {\n  return Math.random().toString(36).substr(2, 10);\n};\n\n// The RTCP CNAME used by all peerconnections from the same JS.\nSDPUtils.localCName = SDPUtils.generateIdentifier();\n\n// Splits SDP into lines, dealing with both CRLF and LF.\nSDPUtils.splitLines = function(blob) {\n  return blob.trim().split('\\n').map(function(line) {\n    return line.trim();\n  });\n};\n// Splits SDP into sessionpart and mediasections. Ensures CRLF.\nSDPUtils.splitSections = function(blob) {\n  var parts = blob.split('\\nm=');\n  return parts.map(function(part, index) {\n    return (index > 0 ? 'm=' + part : part).trim() + '\\r\\n';\n  });\n};\n\n// Returns lines that start with a certain prefix.\nSDPUtils.matchPrefix = function(blob, prefix) {\n  return SDPUtils.splitLines(blob).filter(function(line) {\n    return line.indexOf(prefix) === 0;\n  });\n};\n\n// Parses an ICE candidate line. Sample input:\n// candidate:702786350 2 udp 41819902 8.8.8.8 60769 typ relay raddr 8.8.8.8\n// rport 55996\"\nSDPUtils.parseCandidate = function(line) {\n  var parts;\n  // Parse both variants.\n  if (line.indexOf('a=candidate:') === 0) {\n    parts = line.substring(12).split(' ');\n  } else {\n    parts = line.substring(10).split(' ');\n  }\n\n  var candidate = {\n    foundation: parts[0],\n    component: parseInt(parts[1], 10),\n    protocol: parts[2].toLowerCase(),\n    priority: parseInt(parts[3], 10),\n    ip: parts[4],\n    port: parseInt(parts[5], 10),\n    // skip parts[6] == 'typ'\n    type: parts[7]\n  };\n\n  for (var i = 8; i < parts.length; i += 2) {\n    switch (parts[i]) {\n      case 'raddr':\n        candidate.relatedAddress = parts[i + 1];\n        break;\n      case 'rport':\n        candidate.relatedPort = parseInt(parts[i + 1], 10);\n        break;\n      case 'tcptype':\n        candidate.tcpType = parts[i + 1];\n        break;\n      case 'ufrag':\n        candidate.ufrag = parts[i + 1]; // for backward compability.\n        candidate.usernameFragment = parts[i + 1];\n        break;\n      default: // extension handling, in particular ufrag\n        candidate[parts[i]] = parts[i + 1];\n        break;\n    }\n  }\n  return candidate;\n};\n\n// Translates a candidate object into SDP candidate attribute.\nSDPUtils.writeCandidate = function(candidate) {\n  var sdp = [];\n  sdp.push(candidate.foundation);\n  sdp.push(candidate.component);\n  sdp.push(candidate.protocol.toUpperCase());\n  sdp.push(candidate.priority);\n  sdp.push(candidate.ip);\n  sdp.push(candidate.port);\n\n  var type = candidate.type;\n  sdp.push('typ');\n  sdp.push(type);\n  if (type !== 'host' && candidate.relatedAddress &&\n      candidate.relatedPort) {\n    sdp.push('raddr');\n    sdp.push(candidate.relatedAddress); // was: relAddr\n    sdp.push('rport');\n    sdp.push(candidate.relatedPort); // was: relPort\n  }\n  if (candidate.tcpType && candidate.protocol.toLowerCase() === 'tcp') {\n    sdp.push('tcptype');\n    sdp.push(candidate.tcpType);\n  }\n  if (candidate.ufrag) {\n    sdp.push('ufrag');\n    sdp.push(candidate.ufrag);\n  }\n  return 'candidate:' + sdp.join(' ');\n};\n\n// Parses an ice-options line, returns an array of option tags.\n// a=ice-options:foo bar\nSDPUtils.parseIceOptions = function(line) {\n  return line.substr(14).split(' ');\n}\n\n// Parses an rtpmap line, returns RTCRtpCoddecParameters. Sample input:\n// a=rtpmap:111 opus/48000/2\nSDPUtils.parseRtpMap = function(line) {\n  var parts = line.substr(9).split(' ');\n  var parsed = {\n    payloadType: parseInt(parts.shift(), 10) // was: id\n  };\n\n  parts = parts[0].split('/');\n\n  parsed.name = parts[0];\n  parsed.clockRate = parseInt(parts[1], 10); // was: clockrate\n  // was: channels\n  parsed.numChannels = parts.length === 3 ? parseInt(parts[2], 10) : 1;\n  return parsed;\n};\n\n// Generate an a=rtpmap line from RTCRtpCodecCapability or\n// RTCRtpCodecParameters.\nSDPUtils.writeRtpMap = function(codec) {\n  var pt = codec.payloadType;\n  if (codec.preferredPayloadType !== undefined) {\n    pt = codec.preferredPayloadType;\n  }\n  return 'a=rtpmap:' + pt + ' ' + codec.name + '/' + codec.clockRate +\n      (codec.numChannels !== 1 ? '/' + codec.numChannels : '') + '\\r\\n';\n};\n\n// Parses an a=extmap line (headerextension from RFC 5285). Sample input:\n// a=extmap:2 urn:ietf:params:rtp-hdrext:toffset\n// a=extmap:2/sendonly urn:ietf:params:rtp-hdrext:toffset\nSDPUtils.parseExtmap = function(line) {\n  var parts = line.substr(9).split(' ');\n  return {\n    id: parseInt(parts[0], 10),\n    direction: parts[0].indexOf('/') > 0 ? parts[0].split('/')[1] : 'sendrecv',\n    uri: parts[1]\n  };\n};\n\n// Generates a=extmap line from RTCRtpHeaderExtensionParameters or\n// RTCRtpHeaderExtension.\nSDPUtils.writeExtmap = function(headerExtension) {\n  return 'a=extmap:' + (headerExtension.id || headerExtension.preferredId) +\n      (headerExtension.direction && headerExtension.direction !== 'sendrecv'\n          ? '/' + headerExtension.direction\n          : '') +\n      ' ' + headerExtension.uri + '\\r\\n';\n};\n\n// Parses an ftmp line, returns dictionary. Sample input:\n// a=fmtp:96 vbr=on;cng=on\n// Also deals with vbr=on; cng=on\nSDPUtils.parseFmtp = function(line) {\n  var parsed = {};\n  var kv;\n  var parts = line.substr(line.indexOf(' ') + 1).split(';');\n  for (var j = 0; j < parts.length; j++) {\n    kv = parts[j].trim().split('=');\n    parsed[kv[0].trim()] = kv[1];\n  }\n  return parsed;\n};\n\n// Generates an a=ftmp line from RTCRtpCodecCapability or RTCRtpCodecParameters.\nSDPUtils.writeFmtp = function(codec) {\n  var line = '';\n  var pt = codec.payloadType;\n  if (codec.preferredPayloadType !== undefined) {\n    pt = codec.preferredPayloadType;\n  }\n  if (codec.parameters && Object.keys(codec.parameters).length) {\n    var params = [];\n    Object.keys(codec.parameters).forEach(function(param) {\n      params.push(param + '=' + codec.parameters[param]);\n    });\n    line += 'a=fmtp:' + pt + ' ' + params.join(';') + '\\r\\n';\n  }\n  return line;\n};\n\n// Parses an rtcp-fb line, returns RTCPRtcpFeedback object. Sample input:\n// a=rtcp-fb:98 nack rpsi\nSDPUtils.parseRtcpFb = function(line) {\n  var parts = line.substr(line.indexOf(' ') + 1).split(' ');\n  return {\n    type: parts.shift(),\n    parameter: parts.join(' ')\n  };\n};\n// Generate a=rtcp-fb lines from RTCRtpCodecCapability or RTCRtpCodecParameters.\nSDPUtils.writeRtcpFb = function(codec) {\n  var lines = '';\n  var pt = codec.payloadType;\n  if (codec.preferredPayloadType !== undefined) {\n    pt = codec.preferredPayloadType;\n  }\n  if (codec.rtcpFeedback && codec.rtcpFeedback.length) {\n    // FIXME: special handling for trr-int?\n    codec.rtcpFeedback.forEach(function(fb) {\n      lines += 'a=rtcp-fb:' + pt + ' ' + fb.type +\n      (fb.parameter && fb.parameter.length ? ' ' + fb.parameter : '') +\n          '\\r\\n';\n    });\n  }\n  return lines;\n};\n\n// Parses an RFC 5576 ssrc media attribute. Sample input:\n// a=ssrc:3735928559 cname:something\nSDPUtils.parseSsrcMedia = function(line) {\n  var sp = line.indexOf(' ');\n  var parts = {\n    ssrc: parseInt(line.substr(7, sp - 7), 10)\n  };\n  var colon = line.indexOf(':', sp);\n  if (colon > -1) {\n    parts.attribute = line.substr(sp + 1, colon - sp - 1);\n    parts.value = line.substr(colon + 1);\n  } else {\n    parts.attribute = line.substr(sp + 1);\n  }\n  return parts;\n};\n\n// Extracts the MID (RFC 5888) from a media section.\n// returns the MID or undefined if no mid line was found.\nSDPUtils.getMid = function(mediaSection) {\n  var mid = SDPUtils.matchPrefix(mediaSection, 'a=mid:')[0];\n  if (mid) {\n    return mid.substr(6);\n  }\n}\n\nSDPUtils.parseFingerprint = function(line) {\n  var parts = line.substr(14).split(' ');\n  return {\n    algorithm: parts[0].toLowerCase(), // algorithm is case-sensitive in Edge.\n    value: parts[1]\n  };\n};\n\n// Extracts DTLS parameters from SDP media section or sessionpart.\n// FIXME: for consistency with other functions this should only\n//   get the fingerprint line as input. See also getIceParameters.\nSDPUtils.getDtlsParameters = function(mediaSection, sessionpart) {\n  var lines = SDPUtils.matchPrefix(mediaSection + sessionpart,\n      'a=fingerprint:');\n  // Note: a=setup line is ignored since we use the 'auto' role.\n  // Note2: 'algorithm' is not case sensitive except in Edge.\n  return {\n    role: 'auto',\n    fingerprints: lines.map(SDPUtils.parseFingerprint)\n  };\n};\n\n// Serializes DTLS parameters to SDP.\nSDPUtils.writeDtlsParameters = function(params, setupType) {\n  var sdp = 'a=setup:' + setupType + '\\r\\n';\n  params.fingerprints.forEach(function(fp) {\n    sdp += 'a=fingerprint:' + fp.algorithm + ' ' + fp.value + '\\r\\n';\n  });\n  return sdp;\n};\n// Parses ICE information from SDP media section or sessionpart.\n// FIXME: for consistency with other functions this should only\n//   get the ice-ufrag and ice-pwd lines as input.\nSDPUtils.getIceParameters = function(mediaSection, sessionpart) {\n  var lines = SDPUtils.splitLines(mediaSection);\n  // Search in session part, too.\n  lines = lines.concat(SDPUtils.splitLines(sessionpart));\n  var iceParameters = {\n    usernameFragment: lines.filter(function(line) {\n      return line.indexOf('a=ice-ufrag:') === 0;\n    })[0].substr(12),\n    password: lines.filter(function(line) {\n      return line.indexOf('a=ice-pwd:') === 0;\n    })[0].substr(10)\n  };\n  return iceParameters;\n};\n\n// Serializes ICE parameters to SDP.\nSDPUtils.writeIceParameters = function(params) {\n  return 'a=ice-ufrag:' + params.usernameFragment + '\\r\\n' +\n      'a=ice-pwd:' + params.password + '\\r\\n';\n};\n\n// Parses the SDP media section and returns RTCRtpParameters.\nSDPUtils.parseRtpParameters = function(mediaSection) {\n  var description = {\n    codecs: [],\n    headerExtensions: [],\n    fecMechanisms: [],\n    rtcp: []\n  };\n  var lines = SDPUtils.splitLines(mediaSection);\n  var mline = lines[0].split(' ');\n  for (var i = 3; i < mline.length; i++) { // find all codecs from mline[3..]\n    var pt = mline[i];\n    var rtpmapline = SDPUtils.matchPrefix(\n        mediaSection, 'a=rtpmap:' + pt + ' ')[0];\n    if (rtpmapline) {\n      var codec = SDPUtils.parseRtpMap(rtpmapline);\n      var fmtps = SDPUtils.matchPrefix(\n          mediaSection, 'a=fmtp:' + pt + ' ');\n      // Only the first a=fmtp:<pt> is considered.\n      codec.parameters = fmtps.length ? SDPUtils.parseFmtp(fmtps[0]) : {};\n      codec.rtcpFeedback = SDPUtils.matchPrefix(\n          mediaSection, 'a=rtcp-fb:' + pt + ' ')\n        .map(SDPUtils.parseRtcpFb);\n      description.codecs.push(codec);\n      // parse FEC mechanisms from rtpmap lines.\n      switch (codec.name.toUpperCase()) {\n        case 'RED':\n        case 'ULPFEC':\n          description.fecMechanisms.push(codec.name.toUpperCase());\n          break;\n        default: // only RED and ULPFEC are recognized as FEC mechanisms.\n          break;\n      }\n    }\n  }\n  SDPUtils.matchPrefix(mediaSection, 'a=extmap:').forEach(function(line) {\n    description.headerExtensions.push(SDPUtils.parseExtmap(line));\n  });\n  // FIXME: parse rtcp.\n  return description;\n};\n\n// Generates parts of the SDP media section describing the capabilities /\n// parameters.\nSDPUtils.writeRtpDescription = function(kind, caps) {\n  var sdp = '';\n\n  // Build the mline.\n  sdp += 'm=' + kind + ' ';\n  sdp += caps.codecs.length > 0 ? '9' : '0'; // reject if no codecs.\n  sdp += ' UDP/TLS/RTP/SAVPF ';\n  sdp += caps.codecs.map(function(codec) {\n    if (codec.preferredPayloadType !== undefined) {\n      return codec.preferredPayloadType;\n    }\n    return codec.payloadType;\n  }).join(' ') + '\\r\\n';\n\n  sdp += 'c=IN IP4 0.0.0.0\\r\\n';\n  sdp += 'a=rtcp:9 IN IP4 0.0.0.0\\r\\n';\n\n  // Add a=rtpmap lines for each codec. Also fmtp and rtcp-fb.\n  caps.codecs.forEach(function(codec) {\n    sdp += SDPUtils.writeRtpMap(codec);\n    sdp += SDPUtils.writeFmtp(codec);\n    sdp += SDPUtils.writeRtcpFb(codec);\n  });\n  var maxptime = 0;\n  caps.codecs.forEach(function(codec) {\n    if (codec.maxptime > maxptime) {\n      maxptime = codec.maxptime;\n    }\n  });\n  if (maxptime > 0) {\n    sdp += 'a=maxptime:' + maxptime + '\\r\\n';\n  }\n  sdp += 'a=rtcp-mux\\r\\n';\n\n  caps.headerExtensions.forEach(function(extension) {\n    sdp += SDPUtils.writeExtmap(extension);\n  });\n  // FIXME: write fecMechanisms.\n  return sdp;\n};\n\n// Parses the SDP media section and returns an array of\n// RTCRtpEncodingParameters.\nSDPUtils.parseRtpEncodingParameters = function(mediaSection) {\n  var encodingParameters = [];\n  var description = SDPUtils.parseRtpParameters(mediaSection);\n  var hasRed = description.fecMechanisms.indexOf('RED') !== -1;\n  var hasUlpfec = description.fecMechanisms.indexOf('ULPFEC') !== -1;\n\n  // filter a=ssrc:... cname:, ignore PlanB-msid\n  var ssrcs = SDPUtils.matchPrefix(mediaSection, 'a=ssrc:')\n  .map(function(line) {\n    return SDPUtils.parseSsrcMedia(line);\n  })\n  .filter(function(parts) {\n    return parts.attribute === 'cname';\n  });\n  var primarySsrc = ssrcs.length > 0 && ssrcs[0].ssrc;\n  var secondarySsrc;\n\n  var flows = SDPUtils.matchPrefix(mediaSection, 'a=ssrc-group:FID')\n  .map(function(line) {\n    var parts = line.split(' ');\n    parts.shift();\n    return parts.map(function(part) {\n      return parseInt(part, 10);\n    });\n  });\n  if (flows.length > 0 && flows[0].length > 1 && flows[0][0] === primarySsrc) {\n    secondarySsrc = flows[0][1];\n  }\n\n  description.codecs.forEach(function(codec) {\n    if (codec.name.toUpperCase() === 'RTX' && codec.parameters.apt) {\n      var encParam = {\n        ssrc: primarySsrc,\n        codecPayloadType: parseInt(codec.parameters.apt, 10),\n        rtx: {\n          ssrc: secondarySsrc\n        }\n      };\n      encodingParameters.push(encParam);\n      if (hasRed) {\n        encParam = JSON.parse(JSON.stringify(encParam));\n        encParam.fec = {\n          ssrc: secondarySsrc,\n          mechanism: hasUlpfec ? 'red+ulpfec' : 'red'\n        };\n        encodingParameters.push(encParam);\n      }\n    }\n  });\n  if (encodingParameters.length === 0 && primarySsrc) {\n    encodingParameters.push({\n      ssrc: primarySsrc\n    });\n  }\n\n  // we support both b=AS and b=TIAS but interpret AS as TIAS.\n  var bandwidth = SDPUtils.matchPrefix(mediaSection, 'b=');\n  if (bandwidth.length) {\n    if (bandwidth[0].indexOf('b=TIAS:') === 0) {\n      bandwidth = parseInt(bandwidth[0].substr(7), 10);\n    } else if (bandwidth[0].indexOf('b=AS:') === 0) {\n      // use formula from JSEP to convert b=AS to TIAS value.\n      bandwidth = parseInt(bandwidth[0].substr(5), 10) * 1000 * 0.95\n          - (50 * 40 * 8);\n    } else {\n      bandwidth = undefined;\n    }\n    encodingParameters.forEach(function(params) {\n      params.maxBitrate = bandwidth;\n    });\n  }\n  return encodingParameters;\n};\n\n// parses http://draft.ortc.org/#rtcrtcpparameters*\nSDPUtils.parseRtcpParameters = function(mediaSection) {\n  var rtcpParameters = {};\n\n  var cname;\n  // Gets the first SSRC. Note that with RTX there might be multiple\n  // SSRCs.\n  var remoteSsrc = SDPUtils.matchPrefix(mediaSection, 'a=ssrc:')\n      .map(function(line) {\n        return SDPUtils.parseSsrcMedia(line);\n      })\n      .filter(function(obj) {\n        return obj.attribute === 'cname';\n      })[0];\n  if (remoteSsrc) {\n    rtcpParameters.cname = remoteSsrc.value;\n    rtcpParameters.ssrc = remoteSsrc.ssrc;\n  }\n\n  // Edge uses the compound attribute instead of reducedSize\n  // compound is !reducedSize\n  var rsize = SDPUtils.matchPrefix(mediaSection, 'a=rtcp-rsize');\n  rtcpParameters.reducedSize = rsize.length > 0;\n  rtcpParameters.compound = rsize.length === 0;\n\n  // parses the rtcp-mux attrbute.\n  // Note that Edge does not support unmuxed RTCP.\n  var mux = SDPUtils.matchPrefix(mediaSection, 'a=rtcp-mux');\n  rtcpParameters.mux = mux.length > 0;\n\n  return rtcpParameters;\n};\n\n// parses either a=msid: or a=ssrc:... msid lines and returns\n// the id of the MediaStream and MediaStreamTrack.\nSDPUtils.parseMsid = function(mediaSection) {\n  var parts;\n  var spec = SDPUtils.matchPrefix(mediaSection, 'a=msid:');\n  if (spec.length === 1) {\n    parts = spec[0].substr(7).split(' ');\n    return {stream: parts[0], track: parts[1]};\n  }\n  var planB = SDPUtils.matchPrefix(mediaSection, 'a=ssrc:')\n  .map(function(line) {\n    return SDPUtils.parseSsrcMedia(line);\n  })\n  .filter(function(parts) {\n    return parts.attribute === 'msid';\n  });\n  if (planB.length > 0) {\n    parts = planB[0].value.split(' ');\n    return {stream: parts[0], track: parts[1]};\n  }\n};\n\n// Generate a session ID for SDP.\n// https://tools.ietf.org/html/draft-ietf-rtcweb-jsep-20#section-5.2.1\n// recommends using a cryptographically random +ve 64-bit value\n// but right now this should be acceptable and within the right range\nSDPUtils.generateSessionId = function() {\n  return Math.random().toString().substr(2, 21);\n};\n\n// Write boilder plate for start of SDP\n// sessId argument is optional - if not supplied it will\n// be generated randomly\n// sessVersion is optional and defaults to 2\nSDPUtils.writeSessionBoilerplate = function(sessId, sessVer) {\n  var sessionId;\n  var version = sessVer !== undefined ? sessVer : 2;\n  if (sessId) {\n    sessionId = sessId;\n  } else {\n    sessionId = SDPUtils.generateSessionId();\n  }\n  // FIXME: sess-id should be an NTP timestamp.\n  return 'v=0\\r\\n' +\n      'o=thisisadapterortc ' + sessionId + ' ' + version + ' IN IP4 127.0.0.1\\r\\n' +\n      's=-\\r\\n' +\n      't=0 0\\r\\n';\n};\n\nSDPUtils.writeMediaSection = function(transceiver, caps, type, stream) {\n  var sdp = SDPUtils.writeRtpDescription(transceiver.kind, caps);\n\n  // Map ICE parameters (ufrag, pwd) to SDP.\n  sdp += SDPUtils.writeIceParameters(\n      transceiver.iceGatherer.getLocalParameters());\n\n  // Map DTLS parameters to SDP.\n  sdp += SDPUtils.writeDtlsParameters(\n      transceiver.dtlsTransport.getLocalParameters(),\n      type === 'offer' ? 'actpass' : 'active');\n\n  sdp += 'a=mid:' + transceiver.mid + '\\r\\n';\n\n  if (transceiver.direction) {\n    sdp += 'a=' + transceiver.direction + '\\r\\n';\n  } else if (transceiver.rtpSender && transceiver.rtpReceiver) {\n    sdp += 'a=sendrecv\\r\\n';\n  } else if (transceiver.rtpSender) {\n    sdp += 'a=sendonly\\r\\n';\n  } else if (transceiver.rtpReceiver) {\n    sdp += 'a=recvonly\\r\\n';\n  } else {\n    sdp += 'a=inactive\\r\\n';\n  }\n\n  if (transceiver.rtpSender) {\n    // spec.\n    var msid = 'msid:' + stream.id + ' ' +\n        transceiver.rtpSender.track.id + '\\r\\n';\n    sdp += 'a=' + msid;\n\n    // for Chrome.\n    sdp += 'a=ssrc:' + transceiver.sendEncodingParameters[0].ssrc +\n        ' ' + msid;\n    if (transceiver.sendEncodingParameters[0].rtx) {\n      sdp += 'a=ssrc:' + transceiver.sendEncodingParameters[0].rtx.ssrc +\n          ' ' + msid;\n      sdp += 'a=ssrc-group:FID ' +\n          transceiver.sendEncodingParameters[0].ssrc + ' ' +\n          transceiver.sendEncodingParameters[0].rtx.ssrc +\n          '\\r\\n';\n    }\n  }\n  // FIXME: this should be written by writeRtpDescription.\n  sdp += 'a=ssrc:' + transceiver.sendEncodingParameters[0].ssrc +\n      ' cname:' + SDPUtils.localCName + '\\r\\n';\n  if (transceiver.rtpSender && transceiver.sendEncodingParameters[0].rtx) {\n    sdp += 'a=ssrc:' + transceiver.sendEncodingParameters[0].rtx.ssrc +\n        ' cname:' + SDPUtils.localCName + '\\r\\n';\n  }\n  return sdp;\n};\n\n// Gets the direction from the mediaSection or the sessionpart.\nSDPUtils.getDirection = function(mediaSection, sessionpart) {\n  // Look for sendrecv, sendonly, recvonly, inactive, default to sendrecv.\n  var lines = SDPUtils.splitLines(mediaSection);\n  for (var i = 0; i < lines.length; i++) {\n    switch (lines[i]) {\n      case 'a=sendrecv':\n      case 'a=sendonly':\n      case 'a=recvonly':\n      case 'a=inactive':\n        return lines[i].substr(2);\n      default:\n        // FIXME: What should happen here?\n    }\n  }\n  if (sessionpart) {\n    return SDPUtils.getDirection(sessionpart);\n  }\n  return 'sendrecv';\n};\n\nSDPUtils.getKind = function(mediaSection) {\n  var lines = SDPUtils.splitLines(mediaSection);\n  var mline = lines[0].split(' ');\n  return mline[0].substr(2);\n};\n\nSDPUtils.isRejected = function(mediaSection) {\n  return mediaSection.split(' ', 2)[1] === '0';\n};\n\nSDPUtils.parseMLine = function(mediaSection) {\n  var lines = SDPUtils.splitLines(mediaSection);\n  var mline = lines[0].split(' ');\n  return {\n    kind: mline[0].substr(2),\n    port: parseInt(mline[1], 10),\n    protocol: mline[2],\n    fmt: mline.slice(3).join(' ')\n  };\n};\n\n// Expose public methods.\nif (typeof module === 'object') {\n  module.exports = SDPUtils;\n}\n\n},{}],3:[function(require,module,exports){\n(function (global){\n/*\n *  Copyright (c) 2016 The WebRTC project authors. All Rights Reserved.\n *\n *  Use of this source code is governed by a BSD-style license\n *  that can be found in the LICENSE file in the root of the source\n *  tree.\n */\n /* eslint-env node */\n\n'use strict';\n\nvar adapterFactory = require('./adapter_factory.js');\nmodule.exports = adapterFactory({window: global.window});\n\n}).call(this,typeof global !== \"undefined\" ? global : typeof self !== \"undefined\" ? self : typeof window !== \"undefined\" ? window : {})\n},{\"./adapter_factory.js\":4}],4:[function(require,module,exports){\n/*\n *  Copyright (c) 2016 The WebRTC project authors. All Rights Reserved.\n *\n *  Use of this source code is governed by a BSD-style license\n *  that can be found in the LICENSE file in the root of the source\n *  tree.\n */\n /* eslint-env node */\n\n'use strict';\n\nvar utils = require('./utils');\n// Shimming starts here.\nmodule.exports = function(dependencies, opts) {\n  var window = dependencies && dependencies.window;\n\n  var options = {\n    shimChrome: true,\n    shimFirefox: true,\n    shimEdge: true,\n    shimSafari: true,\n  };\n\n  for (var key in opts) {\n    if (hasOwnProperty.call(opts, key)) {\n      options[key] = opts[key];\n    }\n  }\n\n  // Utils.\n  var logging = utils.log;\n  var browserDetails = utils.detectBrowser(window);\n\n  // Export to the adapter global object visible in the browser.\n  var adapter = {\n    browserDetails: browserDetails,\n    extractVersion: utils.extractVersion,\n    disableLog: utils.disableLog,\n    disableWarnings: utils.disableWarnings\n  };\n\n  // Uncomment the line below if you want logging to occur, including logging\n  // for the switch statement below. Can also be turned on in the browser via\n  // adapter.disableLog(false), but then logging from the switch statement below\n  // will not appear.\n  // require('./utils').disableLog(false);\n\n  // Browser shims.\n  var chromeShim = require('./chrome/chrome_shim') || null;\n  var edgeShim = require('./edge/edge_shim') || null;\n  var firefoxShim = require('./firefox/firefox_shim') || null;\n  var safariShim = require('./safari/safari_shim') || null;\n  var commonShim = require('./common_shim') || null;\n\n  // Shim browser if found.\n  switch (browserDetails.browser) {\n    case 'chrome':\n      if (!chromeShim || !chromeShim.shimPeerConnection ||\n          !options.shimChrome) {\n        logging('Chrome shim is not included in this adapter release.');\n        return adapter;\n      }\n      logging('adapter.js shimming chrome.');\n      // Export to the adapter global object visible in the browser.\n      adapter.browserShim = chromeShim;\n      commonShim.shimCreateObjectURL(window);\n\n      chromeShim.shimGetUserMedia(window);\n      chromeShim.shimMediaStream(window);\n      chromeShim.shimSourceObject(window);\n      chromeShim.shimPeerConnection(window);\n      chromeShim.shimOnTrack(window);\n      chromeShim.shimAddTrackRemoveTrack(window);\n      chromeShim.shimGetSendersWithDtmf(window);\n\n      commonShim.shimRTCIceCandidate(window);\n      break;\n    case 'firefox':\n      if (!firefoxShim || !firefoxShim.shimPeerConnection ||\n          !options.shimFirefox) {\n        logging('Firefox shim is not included in this adapter release.');\n        return adapter;\n      }\n      logging('adapter.js shimming firefox.');\n      // Export to the adapter global object visible in the browser.\n      adapter.browserShim = firefoxShim;\n      commonShim.shimCreateObjectURL(window);\n\n      firefoxShim.shimGetUserMedia(window);\n      firefoxShim.shimSourceObject(window);\n      firefoxShim.shimPeerConnection(window);\n      firefoxShim.shimOnTrack(window);\n      firefoxShim.shimRemoveStream(window);\n\n      commonShim.shimRTCIceCandidate(window);\n      break;\n    case 'edge':\n      if (!edgeShim || !edgeShim.shimPeerConnection || !options.shimEdge) {\n        logging('MS edge shim is not included in this adapter release.');\n        return adapter;\n      }\n      logging('adapter.js shimming edge.');\n      // Export to the adapter global object visible in the browser.\n      adapter.browserShim = edgeShim;\n      commonShim.shimCreateObjectURL(window);\n\n      edgeShim.shimGetUserMedia(window);\n      edgeShim.shimPeerConnection(window);\n      edgeShim.shimReplaceTrack(window);\n\n      // the edge shim implements the full RTCIceCandidate object.\n      break;\n    case 'safari':\n      if (!safariShim || !options.shimSafari) {\n        logging('Safari shim is not included in this adapter release.');\n        return adapter;\n      }\n      logging('adapter.js shimming safari.');\n      // Export to the adapter global object visible in the browser.\n      adapter.browserShim = safariShim;\n      commonShim.shimCreateObjectURL(window);\n\n      safariShim.shimRTCIceServerUrls(window);\n      safariShim.shimCallbacksAPI(window);\n      safariShim.shimLocalStreamsAPI(window);\n      safariShim.shimRemoteStreamsAPI(window);\n      safariShim.shimTrackEventTransceiver(window);\n      safariShim.shimGetUserMedia(window);\n      safariShim.shimCreateOfferLegacy(window);\n\n      commonShim.shimRTCIceCandidate(window);\n      break;\n    default:\n      logging('Unsupported browser!');\n      break;\n  }\n\n  return adapter;\n};\n\n},{\"./chrome/chrome_shim\":5,\"./common_shim\":7,\"./edge/edge_shim\":8,\"./firefox/firefox_shim\":10,\"./safari/safari_shim\":12,\"./utils\":13}],5:[function(require,module,exports){\n\n/*\n *  Copyright (c) 2016 The WebRTC project authors. All Rights Reserved.\n *\n *  Use of this source code is governed by a BSD-style license\n *  that can be found in the LICENSE file in the root of the source\n *  tree.\n */\n /* eslint-env node */\n'use strict';\nvar utils = require('../utils.js');\nvar logging = utils.log;\n\nmodule.exports = {\n  shimGetUserMedia: require('./getusermedia'),\n  shimMediaStream: function(window) {\n    window.MediaStream = window.MediaStream || window.webkitMediaStream;\n  },\n\n  shimOnTrack: function(window) {\n    if (typeof window === 'object' && window.RTCPeerConnection && !('ontrack' in\n        window.RTCPeerConnection.prototype)) {\n      Object.defineProperty(window.RTCPeerConnection.prototype, 'ontrack', {\n        get: function() {\n          return this._ontrack;\n        },\n        set: function(f) {\n          if (this._ontrack) {\n            this.removeEventListener('track', this._ontrack);\n          }\n          this.addEventListener('track', this._ontrack = f);\n        }\n      });\n      var origSetRemoteDescription =\n          window.RTCPeerConnection.prototype.setRemoteDescription;\n      window.RTCPeerConnection.prototype.setRemoteDescription = function() {\n        var pc = this;\n        if (!pc._ontrackpoly) {\n          pc._ontrackpoly = function(e) {\n            // onaddstream does not fire when a track is added to an existing\n            // stream. But stream.onaddtrack is implemented so we use that.\n            e.stream.addEventListener('addtrack', function(te) {\n              var receiver;\n              if (window.RTCPeerConnection.prototype.getReceivers) {\n                receiver = pc.getReceivers().find(function(r) {\n                  return r.track && r.track.id === te.track.id;\n                });\n              } else {\n                receiver = {track: te.track};\n              }\n\n              var event = new Event('track');\n              event.track = te.track;\n              event.receiver = receiver;\n              event.transceiver = {receiver: receiver};\n              event.streams = [e.stream];\n              pc.dispatchEvent(event);\n            });\n            e.stream.getTracks().forEach(function(track) {\n              var receiver;\n              if (window.RTCPeerConnection.prototype.getReceivers) {\n                receiver = pc.getReceivers().find(function(r) {\n                  return r.track && r.track.id === track.id;\n                });\n              } else {\n                receiver = {track: track};\n              }\n              var event = new Event('track');\n              event.track = track;\n              event.receiver = receiver;\n              event.transceiver = {receiver: receiver};\n              event.streams = [e.stream];\n              pc.dispatchEvent(event);\n            });\n          };\n          pc.addEventListener('addstream', pc._ontrackpoly);\n        }\n        return origSetRemoteDescription.apply(pc, arguments);\n      };\n    }\n  },\n\n  shimGetSendersWithDtmf: function(window) {\n    // Overrides addTrack/removeTrack, depends on shimAddTrackRemoveTrack.\n    if (typeof window === 'object' && window.RTCPeerConnection &&\n        !('getSenders' in window.RTCPeerConnection.prototype) &&\n        'createDTMFSender' in window.RTCPeerConnection.prototype) {\n      var shimSenderWithDtmf = function(pc, track) {\n        return {\n          track: track,\n          get dtmf() {\n            if (this._dtmf === undefined) {\n              if (track.kind === 'audio') {\n                this._dtmf = pc.createDTMFSender(track);\n              } else {\n                this._dtmf = null;\n              }\n            }\n            return this._dtmf;\n          },\n          _pc: pc\n        };\n      };\n\n      // augment addTrack when getSenders is not available.\n      if (!window.RTCPeerConnection.prototype.getSenders) {\n        window.RTCPeerConnection.prototype.getSenders = function() {\n          this._senders = this._senders || [];\n          return this._senders.slice(); // return a copy of the internal state.\n        };\n        var origAddTrack = window.RTCPeerConnection.prototype.addTrack;\n        window.RTCPeerConnection.prototype.addTrack = function(track, stream) {\n          var pc = this;\n          var sender = origAddTrack.apply(pc, arguments);\n          if (!sender) {\n            sender = shimSenderWithDtmf(pc, track);\n            pc._senders.push(sender);\n          }\n          return sender;\n        };\n\n        var origRemoveTrack = window.RTCPeerConnection.prototype.removeTrack;\n        window.RTCPeerConnection.prototype.removeTrack = function(sender) {\n          var pc = this;\n          origRemoveTrack.apply(pc, arguments);\n          var idx = pc._senders.indexOf(sender);\n          if (idx !== -1) {\n            pc._senders.splice(idx, 1);\n          }\n        };\n      }\n      var origAddStream = window.RTCPeerConnection.prototype.addStream;\n      window.RTCPeerConnection.prototype.addStream = function(stream) {\n        var pc = this;\n        pc._senders = pc._senders || [];\n        origAddStream.apply(pc, [stream]);\n        stream.getTracks().forEach(function(track) {\n          pc._senders.push(shimSenderWithDtmf(pc, track));\n        });\n      };\n\n      var origRemoveStream = window.RTCPeerConnection.prototype.removeStream;\n      window.RTCPeerConnection.prototype.removeStream = function(stream) {\n        var pc = this;\n        pc._senders = pc._senders || [];\n        origRemoveStream.apply(pc, [stream]);\n\n        stream.getTracks().forEach(function(track) {\n          var sender = pc._senders.find(function(s) {\n            return s.track === track;\n          });\n          if (sender) {\n            pc._senders.splice(pc._senders.indexOf(sender), 1); // remove sender\n          }\n        });\n      };\n    } else if (typeof window === 'object' && window.RTCPeerConnection &&\n               'getSenders' in window.RTCPeerConnection.prototype &&\n               'createDTMFSender' in window.RTCPeerConnection.prototype &&\n               window.RTCRtpSender &&\n               !('dtmf' in window.RTCRtpSender.prototype)) {\n      var origGetSenders = window.RTCPeerConnection.prototype.getSenders;\n      window.RTCPeerConnection.prototype.getSenders = function() {\n        var pc = this;\n        var senders = origGetSenders.apply(pc, []);\n        senders.forEach(function(sender) {\n          sender._pc = pc;\n        });\n        return senders;\n      };\n\n      Object.defineProperty(window.RTCRtpSender.prototype, 'dtmf', {\n        get: function() {\n          if (this._dtmf === undefined) {\n            if (this.track.kind === 'audio') {\n              this._dtmf = this._pc.createDTMFSender(this.track);\n            } else {\n              this._dtmf = null;\n            }\n          }\n          return this._dtmf;\n        }\n      });\n    }\n  },\n\n  shimSourceObject: function(window) {\n    var URL = window && window.URL;\n\n    if (typeof window === 'object') {\n      if (window.HTMLMediaElement &&\n        !('srcObject' in window.HTMLMediaElement.prototype)) {\n        // Shim the srcObject property, once, when HTMLMediaElement is found.\n        Object.defineProperty(window.HTMLMediaElement.prototype, 'srcObject', {\n          get: function() {\n            return this._srcObject;\n          },\n          set: function(stream) {\n            var self = this;\n            // Use _srcObject as a private property for this shim\n            this._srcObject = stream;\n            if (this.src) {\n              URL.revokeObjectURL(this.src);\n            }\n\n            if (!stream) {\n              this.src = '';\n              return undefined;\n            }\n            this.src = URL.createObjectURL(stream);\n            // We need to recreate the blob url when a track is added or\n            // removed. Doing it manually since we want to avoid a recursion.\n            stream.addEventListener('addtrack', function() {\n              if (self.src) {\n                URL.revokeObjectURL(self.src);\n              }\n              self.src = URL.createObjectURL(stream);\n            });\n            stream.addEventListener('removetrack', function() {\n              if (self.src) {\n                URL.revokeObjectURL(self.src);\n              }\n              self.src = URL.createObjectURL(stream);\n            });\n          }\n        });\n      }\n    }\n  },\n\n  shimAddTrackRemoveTrackWithNative: function(window) {\n    // shim addTrack/removeTrack with native variants in order to make\n    // the interactions with legacy getLocalStreams behave as in other browsers.\n    // Keeps a mapping stream.id => [stream, rtpsenders...]\n    window.RTCPeerConnection.prototype.getLocalStreams = function() {\n      var pc = this;\n      this._shimmedLocalStreams = this._shimmedLocalStreams || {};\n      return Object.keys(this._shimmedLocalStreams).map(function(streamId) {\n        return pc._shimmedLocalStreams[streamId][0];\n      });\n    };\n\n    var origAddTrack = window.RTCPeerConnection.prototype.addTrack;\n    window.RTCPeerConnection.prototype.addTrack = function(track, stream) {\n      if (!stream) {\n        return origAddTrack.apply(this, arguments);\n      }\n      this._shimmedLocalStreams = this._shimmedLocalStreams || {};\n\n      var sender = origAddTrack.apply(this, arguments);\n      if (!this._shimmedLocalStreams[stream.id]) {\n        this._shimmedLocalStreams[stream.id] = [stream, sender];\n      } else if (this._shimmedLocalStreams[stream.id].indexOf(sender) === -1) {\n        this._shimmedLocalStreams[stream.id].push(sender);\n      }\n      return sender;\n    };\n\n    var origAddStream = window.RTCPeerConnection.prototype.addStream;\n    window.RTCPeerConnection.prototype.addStream = function(stream) {\n      var pc = this;\n      this._shimmedLocalStreams = this._shimmedLocalStreams || {};\n\n      stream.getTracks().forEach(function(track) {\n        var alreadyExists = pc.getSenders().find(function(s) {\n          return s.track === track;\n        });\n        if (alreadyExists) {\n          throw new DOMException('Track already exists.',\n              'InvalidAccessError');\n        }\n      });\n      var existingSenders = pc.getSenders();\n      origAddStream.apply(this, arguments);\n      var newSenders = pc.getSenders().filter(function(newSender) {\n        return existingSenders.indexOf(newSender) === -1;\n      });\n      this._shimmedLocalStreams[stream.id] = [stream].concat(newSenders);\n    };\n\n    var origRemoveStream = window.RTCPeerConnection.prototype.removeStream;\n    window.RTCPeerConnection.prototype.removeStream = function(stream) {\n      this._shimmedLocalStreams = this._shimmedLocalStreams || {};\n      delete this._shimmedLocalStreams[stream.id];\n      return origRemoveStream.apply(this, arguments);\n    };\n\n    var origRemoveTrack = window.RTCPeerConnection.prototype.removeTrack;\n    window.RTCPeerConnection.prototype.removeTrack = function(sender) {\n      var pc = this;\n      this._shimmedLocalStreams = this._shimmedLocalStreams || {};\n      if (sender) {\n        Object.keys(this._shimmedLocalStreams).forEach(function(streamId) {\n          var idx = pc._shimmedLocalStreams[streamId].indexOf(sender);\n          if (idx !== -1) {\n            pc._shimmedLocalStreams[streamId].splice(idx, 1);\n          }\n          if (pc._shimmedLocalStreams[streamId].length === 1) {\n            delete pc._shimmedLocalStreams[streamId];\n          }\n        });\n      }\n      return origRemoveTrack.apply(this, arguments);\n    };\n  },\n\n  shimAddTrackRemoveTrack: function(window) {\n    var browserDetails = utils.detectBrowser(window);\n    // shim addTrack and removeTrack.\n    if (window.RTCPeerConnection.prototype.addTrack &&\n        browserDetails.version >= 65) {\n      return this.shimAddTrackRemoveTrackWithNative(window);\n    }\n\n    // also shim pc.getLocalStreams when addTrack is shimmed\n    // to return the original streams.\n    var origGetLocalStreams = window.RTCPeerConnection.prototype\n        .getLocalStreams;\n    window.RTCPeerConnection.prototype.getLocalStreams = function() {\n      var pc = this;\n      var nativeStreams = origGetLocalStreams.apply(this);\n      pc._reverseStreams = pc._reverseStreams || {};\n      return nativeStreams.map(function(stream) {\n        return pc._reverseStreams[stream.id];\n      });\n    };\n\n    var origAddStream = window.RTCPeerConnection.prototype.addStream;\n    window.RTCPeerConnection.prototype.addStream = function(stream) {\n      var pc = this;\n      pc._streams = pc._streams || {};\n      pc._reverseStreams = pc._reverseStreams || {};\n\n      stream.getTracks().forEach(function(track) {\n        var alreadyExists = pc.getSenders().find(function(s) {\n          return s.track === track;\n        });\n        if (alreadyExists) {\n          throw new DOMException('Track already exists.',\n              'InvalidAccessError');\n        }\n      });\n      // Add identity mapping for consistency with addTrack.\n      // Unless this is being used with a stream from addTrack.\n      if (!pc._reverseStreams[stream.id]) {\n        var newStream = new window.MediaStream(stream.getTracks());\n        pc._streams[stream.id] = newStream;\n        pc._reverseStreams[newStream.id] = stream;\n        stream = newStream;\n      }\n      origAddStream.apply(pc, [stream]);\n    };\n\n    var origRemoveStream = window.RTCPeerConnection.prototype.removeStream;\n    window.RTCPeerConnection.prototype.removeStream = function(stream) {\n      var pc = this;\n      pc._streams = pc._streams || {};\n      pc._reverseStreams = pc._reverseStreams || {};\n\n      origRemoveStream.apply(pc, [(pc._streams[stream.id] || stream)]);\n      delete pc._reverseStreams[(pc._streams[stream.id] ?\n          pc._streams[stream.id].id : stream.id)];\n      delete pc._streams[stream.id];\n    };\n\n    window.RTCPeerConnection.prototype.addTrack = function(track, stream) {\n      var pc = this;\n      if (pc.signalingState === 'closed') {\n        throw new DOMException(\n          'The RTCPeerConnection\\'s signalingState is \\'closed\\'.',\n          'InvalidStateError');\n      }\n      var streams = [].slice.call(arguments, 1);\n      if (streams.length !== 1 ||\n          !streams[0].getTracks().find(function(t) {\n            return t === track;\n          })) {\n        // this is not fully correct but all we can manage without\n        // [[associated MediaStreams]] internal slot.\n        throw new DOMException(\n          'The adapter.js addTrack polyfill only supports a single ' +\n          ' stream which is associated with the specified track.',\n          'NotSupportedError');\n      }\n\n      var alreadyExists = pc.getSenders().find(function(s) {\n        return s.track === track;\n      });\n      if (alreadyExists) {\n        throw new DOMException('Track already exists.',\n            'InvalidAccessError');\n      }\n\n      pc._streams = pc._streams || {};\n      pc._reverseStreams = pc._reverseStreams || {};\n      var oldStream = pc._streams[stream.id];\n      if (oldStream) {\n        // this is using odd Chrome behaviour, use with caution:\n        // https://bugs.chromium.org/p/webrtc/issues/detail?id=7815\n        // Note: we rely on the high-level addTrack/dtmf shim to\n        // create the sender with a dtmf sender.\n        oldStream.addTrack(track);\n\n        // Trigger ONN async.\n        Promise.resolve().then(function() {\n          pc.dispatchEvent(new Event('negotiationneeded'));\n        });\n      } else {\n        var newStream = new window.MediaStream([track]);\n        pc._streams[stream.id] = newStream;\n        pc._reverseStreams[newStream.id] = stream;\n        pc.addStream(newStream);\n      }\n      return pc.getSenders().find(function(s) {\n        return s.track === track;\n      });\n    };\n\n    // replace the internal stream id with the external one and\n    // vice versa.\n    function replaceInternalStreamId(pc, description) {\n      var sdp = description.sdp;\n      Object.keys(pc._reverseStreams || []).forEach(function(internalId) {\n        var externalStream = pc._reverseStreams[internalId];\n        var internalStream = pc._streams[externalStream.id];\n        sdp = sdp.replace(new RegExp(internalStream.id, 'g'),\n            externalStream.id);\n      });\n      return new RTCSessionDescription({\n        type: description.type,\n        sdp: sdp\n      });\n    }\n    function replaceExternalStreamId(pc, description) {\n      var sdp = description.sdp;\n      Object.keys(pc._reverseStreams || []).forEach(function(internalId) {\n        var externalStream = pc._reverseStreams[internalId];\n        var internalStream = pc._streams[externalStream.id];\n        sdp = sdp.replace(new RegExp(externalStream.id, 'g'),\n            internalStream.id);\n      });\n      return new RTCSessionDescription({\n        type: description.type,\n        sdp: sdp\n      });\n    }\n    ['createOffer', 'createAnswer'].forEach(function(method) {\n      var nativeMethod = window.RTCPeerConnection.prototype[method];\n      window.RTCPeerConnection.prototype[method] = function() {\n        var pc = this;\n        var args = arguments;\n        var isLegacyCall = arguments.length &&\n            typeof arguments[0] === 'function';\n        if (isLegacyCall) {\n          return nativeMethod.apply(pc, [\n            function(description) {\n              var desc = replaceInternalStreamId(pc, description);\n              args[0].apply(null, [desc]);\n            },\n            function(err) {\n              if (args[1]) {\n                args[1].apply(null, err);\n              }\n            }, arguments[2]\n          ]);\n        }\n        return nativeMethod.apply(pc, arguments)\n        .then(function(description) {\n          return replaceInternalStreamId(pc, description);\n        });\n      };\n    });\n\n    var origSetLocalDescription =\n        window.RTCPeerConnection.prototype.setLocalDescription;\n    window.RTCPeerConnection.prototype.setLocalDescription = function() {\n      var pc = this;\n      if (!arguments.length || !arguments[0].type) {\n        return origSetLocalDescription.apply(pc, arguments);\n      }\n      arguments[0] = replaceExternalStreamId(pc, arguments[0]);\n      return origSetLocalDescription.apply(pc, arguments);\n    };\n\n    // TODO: mangle getStats: https://w3c.github.io/webrtc-stats/#dom-rtcmediastreamstats-streamidentifier\n\n    var origLocalDescription = Object.getOwnPropertyDescriptor(\n        window.RTCPeerConnection.prototype, 'localDescription');\n    Object.defineProperty(window.RTCPeerConnection.prototype,\n        'localDescription', {\n          get: function() {\n            var pc = this;\n            var description = origLocalDescription.get.apply(this);\n            if (description.type === '') {\n              return description;\n            }\n            return replaceInternalStreamId(pc, description);\n          }\n        });\n\n    window.RTCPeerConnection.prototype.removeTrack = function(sender) {\n      var pc = this;\n      if (pc.signalingState === 'closed') {\n        throw new DOMException(\n          'The RTCPeerConnection\\'s signalingState is \\'closed\\'.',\n          'InvalidStateError');\n      }\n      // We can not yet check for sender instanceof RTCRtpSender\n      // since we shim RTPSender. So we check if sender._pc is set.\n      if (!sender._pc) {\n        throw new DOMException('Argument 1 of RTCPeerConnection.removeTrack ' +\n            'does not implement interface RTCRtpSender.', 'TypeError');\n      }\n      var isLocal = sender._pc === pc;\n      if (!isLocal) {\n        throw new DOMException('Sender was not created by this connection.',\n            'InvalidAccessError');\n      }\n\n      // Search for the native stream the senders track belongs to.\n      pc._streams = pc._streams || {};\n      var stream;\n      Object.keys(pc._streams).forEach(function(streamid) {\n        var hasTrack = pc._streams[streamid].getTracks().find(function(track) {\n          return sender.track === track;\n        });\n        if (hasTrack) {\n          stream = pc._streams[streamid];\n        }\n      });\n\n      if (stream) {\n        if (stream.getTracks().length === 1) {\n          // if this is the last track of the stream, remove the stream. This\n          // takes care of any shimmed _senders.\n          pc.removeStream(pc._reverseStreams[stream.id]);\n        } else {\n          // relying on the same odd chrome behaviour as above.\n          stream.removeTrack(sender.track);\n        }\n        pc.dispatchEvent(new Event('negotiationneeded'));\n      }\n    };\n  },\n\n  shimPeerConnection: function(window) {\n    var browserDetails = utils.detectBrowser(window);\n\n    // The RTCPeerConnection object.\n    if (!window.RTCPeerConnection) {\n      window.RTCPeerConnection = function(pcConfig, pcConstraints) {\n        // Translate iceTransportPolicy to iceTransports,\n        // see https://code.google.com/p/webrtc/issues/detail?id=4869\n        // this was fixed in M56 along with unprefixing RTCPeerConnection.\n        logging('PeerConnection');\n        if (pcConfig && pcConfig.iceTransportPolicy) {\n          pcConfig.iceTransports = pcConfig.iceTransportPolicy;\n        }\n\n        return new window.webkitRTCPeerConnection(pcConfig, pcConstraints);\n      };\n      window.RTCPeerConnection.prototype =\n          window.webkitRTCPeerConnection.prototype;\n      // wrap static methods. Currently just generateCertificate.\n      if (window.webkitRTCPeerConnection.generateCertificate) {\n        Object.defineProperty(window.RTCPeerConnection, 'generateCertificate', {\n          get: function() {\n            return window.webkitRTCPeerConnection.generateCertificate;\n          }\n        });\n      }\n    } else {\n      // migrate from non-spec RTCIceServer.url to RTCIceServer.urls\n      var OrigPeerConnection = window.RTCPeerConnection;\n      window.RTCPeerConnection = function(pcConfig, pcConstraints) {\n        if (pcConfig && pcConfig.iceServers) {\n          var newIceServers = [];\n          for (var i = 0; i < pcConfig.iceServers.length; i++) {\n            var server = pcConfig.iceServers[i];\n            if (!server.hasOwnProperty('urls') &&\n                server.hasOwnProperty('url')) {\n              utils.deprecated('RTCIceServer.url', 'RTCIceServer.urls');\n              server = JSON.parse(JSON.stringify(server));\n              server.urls = server.url;\n              newIceServers.push(server);\n            } else {\n              newIceServers.push(pcConfig.iceServers[i]);\n            }\n          }\n          pcConfig.iceServers = newIceServers;\n        }\n        return new OrigPeerConnection(pcConfig, pcConstraints);\n      };\n      window.RTCPeerConnection.prototype = OrigPeerConnection.prototype;\n      // wrap static methods. Currently just generateCertificate.\n      Object.defineProperty(window.RTCPeerConnection, 'generateCertificate', {\n        get: function() {\n          return OrigPeerConnection.generateCertificate;\n        }\n      });\n    }\n\n    var origGetStats = window.RTCPeerConnection.prototype.getStats;\n    window.RTCPeerConnection.prototype.getStats = function(selector,\n        successCallback, errorCallback) {\n      var pc = this;\n      var args = arguments;\n\n      // If selector is a function then we are in the old style stats so just\n      // pass back the original getStats format to avoid breaking old users.\n      if (arguments.length > 0 && typeof selector === 'function') {\n        return origGetStats.apply(this, arguments);\n      }\n\n      // When spec-style getStats is supported, return those when called with\n      // either no arguments or the selector argument is null.\n      if (origGetStats.length === 0 && (arguments.length === 0 ||\n          typeof arguments[0] !== 'function')) {\n        return origGetStats.apply(this, []);\n      }\n\n      var fixChromeStats_ = function(response) {\n        var standardReport = {};\n        var reports = response.result();\n        reports.forEach(function(report) {\n          var standardStats = {\n            id: report.id,\n            timestamp: report.timestamp,\n            type: {\n              localcandidate: 'local-candidate',\n              remotecandidate: 'remote-candidate'\n            }[report.type] || report.type\n          };\n          report.names().forEach(function(name) {\n            standardStats[name] = report.stat(name);\n          });\n          standardReport[standardStats.id] = standardStats;\n        });\n\n        return standardReport;\n      };\n\n      // shim getStats with maplike support\n      var makeMapStats = function(stats) {\n        return new Map(Object.keys(stats).map(function(key) {\n          return [key, stats[key]];\n        }));\n      };\n\n      if (arguments.length >= 2) {\n        var successCallbackWrapper_ = function(response) {\n          args[1](makeMapStats(fixChromeStats_(response)));\n        };\n\n        return origGetStats.apply(this, [successCallbackWrapper_,\n          arguments[0]]);\n      }\n\n      // promise-support\n      return new Promise(function(resolve, reject) {\n        origGetStats.apply(pc, [\n          function(response) {\n            resolve(makeMapStats(fixChromeStats_(response)));\n          }, reject]);\n      }).then(successCallback, errorCallback);\n    };\n\n    // add promise support -- natively available in Chrome 51\n    if (browserDetails.version < 51) {\n      ['setLocalDescription', 'setRemoteDescription', 'addIceCandidate']\n          .forEach(function(method) {\n            var nativeMethod = window.RTCPeerConnection.prototype[method];\n            window.RTCPeerConnection.prototype[method] = function() {\n              var args = arguments;\n              var pc = this;\n              var promise = new Promise(function(resolve, reject) {\n                nativeMethod.apply(pc, [args[0], resolve, reject]);\n              });\n              if (args.length < 2) {\n                return promise;\n              }\n              return promise.then(function() {\n                args[1].apply(null, []);\n              },\n              function(err) {\n                if (args.length >= 3) {\n                  args[2].apply(null, [err]);\n                }\n              });\n            };\n          });\n    }\n\n    // promise support for createOffer and createAnswer. Available (without\n    // bugs) since M52: crbug/619289\n    if (browserDetails.version < 52) {\n      ['createOffer', 'createAnswer'].forEach(function(method) {\n        var nativeMethod = window.RTCPeerConnection.prototype[method];\n        window.RTCPeerConnection.prototype[method] = function() {\n          var pc = this;\n          if (arguments.length < 1 || (arguments.length === 1 &&\n              typeof arguments[0] === 'object')) {\n            var opts = arguments.length === 1 ? arguments[0] : undefined;\n            return new Promise(function(resolve, reject) {\n              nativeMethod.apply(pc, [resolve, reject, opts]);\n            });\n          }\n          return nativeMethod.apply(this, arguments);\n        };\n      });\n    }\n\n    // shim implicit creation of RTCSessionDescription/RTCIceCandidate\n    ['setLocalDescription', 'setRemoteDescription', 'addIceCandidate']\n        .forEach(function(method) {\n          var nativeMethod = window.RTCPeerConnection.prototype[method];\n          window.RTCPeerConnection.prototype[method] = function() {\n            arguments[0] = new ((method === 'addIceCandidate') ?\n                window.RTCIceCandidate :\n                window.RTCSessionDescription)(arguments[0]);\n            return nativeMethod.apply(this, arguments);\n          };\n        });\n\n    // support for addIceCandidate(null or undefined)\n    var nativeAddIceCandidate =\n        window.RTCPeerConnection.prototype.addIceCandidate;\n    window.RTCPeerConnection.prototype.addIceCandidate = function() {\n      if (!arguments[0]) {\n        if (arguments[1]) {\n          arguments[1].apply(null);\n        }\n        return Promise.resolve();\n      }\n      return nativeAddIceCandidate.apply(this, arguments);\n    };\n  }\n};\n\n},{\"../utils.js\":13,\"./getusermedia\":6}],6:[function(require,module,exports){\n/*\n *  Copyright (c) 2016 The WebRTC project authors. All Rights Reserved.\n *\n *  Use of this source code is governed by a BSD-style license\n *  that can be found in the LICENSE file in the root of the source\n *  tree.\n */\n /* eslint-env node */\n'use strict';\nvar utils = require('../utils.js');\nvar logging = utils.log;\n\n// Expose public methods.\nmodule.exports = function(window) {\n  var browserDetails = utils.detectBrowser(window);\n  var navigator = window && window.navigator;\n\n  var constraintsToChrome_ = function(c) {\n    if (typeof c !== 'object' || c.mandatory || c.optional) {\n      return c;\n    }\n    var cc = {};\n    Object.keys(c).forEach(function(key) {\n      if (key === 'require' || key === 'advanced' || key === 'mediaSource') {\n        return;\n      }\n      var r = (typeof c[key] === 'object') ? c[key] : {ideal: c[key]};\n      if (r.exact !== undefined && typeof r.exact === 'number') {\n        r.min = r.max = r.exact;\n      }\n      var oldname_ = function(prefix, name) {\n        if (prefix) {\n          return prefix + name.charAt(0).toUpperCase() + name.slice(1);\n        }\n        return (name === 'deviceId') ? 'sourceId' : name;\n      };\n      if (r.ideal !== undefined) {\n        cc.optional = cc.optional || [];\n        var oc = {};\n        if (typeof r.ideal === 'number') {\n          oc[oldname_('min', key)] = r.ideal;\n          cc.optional.push(oc);\n          oc = {};\n          oc[oldname_('max', key)] = r.ideal;\n          cc.optional.push(oc);\n        } else {\n          oc[oldname_('', key)] = r.ideal;\n          cc.optional.push(oc);\n        }\n      }\n      if (r.exact !== undefined && typeof r.exact !== 'number') {\n        cc.mandatory = cc.mandatory || {};\n        cc.mandatory[oldname_('', key)] = r.exact;\n      } else {\n        ['min', 'max'].forEach(function(mix) {\n          if (r[mix] !== undefined) {\n            cc.mandatory = cc.mandatory || {};\n            cc.mandatory[oldname_(mix, key)] = r[mix];\n          }\n        });\n      }\n    });\n    if (c.advanced) {\n      cc.optional = (cc.optional || []).concat(c.advanced);\n    }\n    return cc;\n  };\n\n  var shimConstraints_ = function(constraints, func) {\n    if (browserDetails.version >= 61) {\n      return func(constraints);\n    }\n    constraints = JSON.parse(JSON.stringify(constraints));\n    if (constraints && typeof constraints.audio === 'object') {\n      var remap = function(obj, a, b) {\n        if (a in obj && !(b in obj)) {\n          obj[b] = obj[a];\n          delete obj[a];\n        }\n      };\n      constraints = JSON.parse(JSON.stringify(constraints));\n      remap(constraints.audio, 'autoGainControl', 'googAutoGainControl');\n      remap(constraints.audio, 'noiseSuppression', 'googNoiseSuppression');\n      constraints.audio = constraintsToChrome_(constraints.audio);\n    }\n    if (constraints && typeof constraints.video === 'object') {\n      // Shim facingMode for mobile & surface pro.\n      var face = constraints.video.facingMode;\n      face = face && ((typeof face === 'object') ? face : {ideal: face});\n      var getSupportedFacingModeLies = browserDetails.version < 66;\n\n      if ((face && (face.exact === 'user' || face.exact === 'environment' ||\n                    face.ideal === 'user' || face.ideal === 'environment')) &&\n          !(navigator.mediaDevices.getSupportedConstraints &&\n            navigator.mediaDevices.getSupportedConstraints().facingMode &&\n            !getSupportedFacingModeLies)) {\n        delete constraints.video.facingMode;\n        var matches;\n        if (face.exact === 'environment' || face.ideal === 'environment') {\n          matches = ['back', 'rear'];\n        } else if (face.exact === 'user' || face.ideal === 'user') {\n          matches = ['front'];\n        }\n        if (matches) {\n          // Look for matches in label, or use last cam for back (typical).\n          return navigator.mediaDevices.enumerateDevices()\n          .then(function(devices) {\n            devices = devices.filter(function(d) {\n              return d.kind === 'videoinput';\n            });\n            var dev = devices.find(function(d) {\n              return matches.some(function(match) {\n                return d.label.toLowerCase().indexOf(match) !== -1;\n              });\n            });\n            if (!dev && devices.length && matches.indexOf('back') !== -1) {\n              dev = devices[devices.length - 1]; // more likely the back cam\n            }\n            if (dev) {\n              constraints.video.deviceId = face.exact ? {exact: dev.deviceId} :\n                                                        {ideal: dev.deviceId};\n            }\n            constraints.video = constraintsToChrome_(constraints.video);\n            logging('chrome: ' + JSON.stringify(constraints));\n            return func(constraints);\n          });\n        }\n      }\n      constraints.video = constraintsToChrome_(constraints.video);\n    }\n    logging('chrome: ' + JSON.stringify(constraints));\n    return func(constraints);\n  };\n\n  var shimError_ = function(e) {\n    return {\n      name: {\n        PermissionDeniedError: 'NotAllowedError',\n        InvalidStateError: 'NotReadableError',\n        DevicesNotFoundError: 'NotFoundError',\n        ConstraintNotSatisfiedError: 'OverconstrainedError',\n        TrackStartError: 'NotReadableError',\n        MediaDeviceFailedDueToShutdown: 'NotReadableError',\n        MediaDeviceKillSwitchOn: 'NotReadableError'\n      }[e.name] || e.name,\n      message: e.message,\n      constraint: e.constraintName,\n      toString: function() {\n        return this.name + (this.message && ': ') + this.message;\n      }\n    };\n  };\n\n  var getUserMedia_ = function(constraints, onSuccess, onError) {\n    shimConstraints_(constraints, function(c) {\n      navigator.webkitGetUserMedia(c, onSuccess, function(e) {\n        if (onError) {\n          onError(shimError_(e));\n        }\n      });\n    });\n  };\n\n  navigator.getUserMedia = getUserMedia_;\n\n  // Returns the result of getUserMedia as a Promise.\n  var getUserMediaPromise_ = function(constraints) {\n    return new Promise(function(resolve, reject) {\n      navigator.getUserMedia(constraints, resolve, reject);\n    });\n  };\n\n  if (!navigator.mediaDevices) {\n    navigator.mediaDevices = {\n      getUserMedia: getUserMediaPromise_,\n      enumerateDevices: function() {\n        return new Promise(function(resolve) {\n          var kinds = {audio: 'audioinput', video: 'videoinput'};\n          return window.MediaStreamTrack.getSources(function(devices) {\n            resolve(devices.map(function(device) {\n              return {label: device.label,\n                kind: kinds[device.kind],\n                deviceId: device.id,\n                groupId: ''};\n            }));\n          });\n        });\n      },\n      getSupportedConstraints: function() {\n        return {\n          deviceId: true, echoCancellation: true, facingMode: true,\n          frameRate: true, height: true, width: true\n        };\n      }\n    };\n  }\n\n  // A shim for getUserMedia method on the mediaDevices object.\n  // TODO(KaptenJansson) remove once implemented in Chrome stable.\n  if (!navigator.mediaDevices.getUserMedia) {\n    navigator.mediaDevices.getUserMedia = function(constraints) {\n      return getUserMediaPromise_(constraints);\n    };\n  } else {\n    // Even though Chrome 45 has navigator.mediaDevices and a getUserMedia\n    // function which returns a Promise, it does not accept spec-style\n    // constraints.\n    var origGetUserMedia = navigator.mediaDevices.getUserMedia.\n        bind(navigator.mediaDevices);\n    navigator.mediaDevices.getUserMedia = function(cs) {\n      return shimConstraints_(cs, function(c) {\n        return origGetUserMedia(c).then(function(stream) {\n          if (c.audio && !stream.getAudioTracks().length ||\n              c.video && !stream.getVideoTracks().length) {\n            stream.getTracks().forEach(function(track) {\n              track.stop();\n            });\n            throw new DOMException('', 'NotFoundError');\n          }\n          return stream;\n        }, function(e) {\n          return Promise.reject(shimError_(e));\n        });\n      });\n    };\n  }\n\n  // Dummy devicechange event methods.\n  // TODO(KaptenJansson) remove once implemented in Chrome stable.\n  if (typeof navigator.mediaDevices.addEventListener === 'undefined') {\n    navigator.mediaDevices.addEventListener = function() {\n      logging('Dummy mediaDevices.addEventListener called.');\n    };\n  }\n  if (typeof navigator.mediaDevices.removeEventListener === 'undefined') {\n    navigator.mediaDevices.removeEventListener = function() {\n      logging('Dummy mediaDevices.removeEventListener called.');\n    };\n  }\n};\n\n},{\"../utils.js\":13}],7:[function(require,module,exports){\n/*\n *  Copyright (c) 2017 The WebRTC project authors. All Rights Reserved.\n *\n *  Use of this source code is governed by a BSD-style license\n *  that can be found in the LICENSE file in the root of the source\n *  tree.\n */\n /* eslint-env node */\n'use strict';\n\nvar SDPUtils = require('sdp');\nvar utils = require('./utils');\n\n// Wraps the peerconnection event eventNameToWrap in a function\n// which returns the modified event object.\nfunction wrapPeerConnectionEvent(window, eventNameToWrap, wrapper) {\n  if (!window.RTCPeerConnection) {\n    return;\n  }\n  var proto = window.RTCPeerConnection.prototype;\n  var nativeAddEventListener = proto.addEventListener;\n  proto.addEventListener = function(nativeEventName, cb) {\n    if (nativeEventName !== eventNameToWrap) {\n      return nativeAddEventListener.apply(this, arguments);\n    }\n    var wrappedCallback = function(e) {\n      cb(wrapper(e));\n    };\n    this._eventMap = this._eventMap || {};\n    this._eventMap[cb] = wrappedCallback;\n    return nativeAddEventListener.apply(this, [nativeEventName,\n      wrappedCallback]);\n  };\n\n  var nativeRemoveEventListener = proto.removeEventListener;\n  proto.removeEventListener = function(nativeEventName, cb) {\n    if (nativeEventName !== eventNameToWrap || !this._eventMap\n        || !this._eventMap[cb]) {\n      return nativeRemoveEventListener.apply(this, arguments);\n    }\n    var unwrappedCb = this._eventMap[cb];\n    delete this._eventMap[cb];\n    return nativeRemoveEventListener.apply(this, [nativeEventName,\n      unwrappedCb]);\n  };\n\n  Object.defineProperty(proto, 'on' + eventNameToWrap, {\n    get: function() {\n      return this['_on' + eventNameToWrap];\n    },\n    set: function(cb) {\n      if (this['_on' + eventNameToWrap]) {\n        this.removeEventListener(eventNameToWrap,\n            this['_on' + eventNameToWrap]);\n        delete this['_on' + eventNameToWrap];\n      }\n      if (cb) {\n        this.addEventListener(eventNameToWrap,\n            this['_on' + eventNameToWrap] = cb);\n      }\n    }\n  });\n}\n\nmodule.exports = {\n  shimRTCIceCandidate: function(window) {\n    // foundation is arbitrarily chosen as an indicator for full support for\n    // https://w3c.github.io/webrtc-pc/#rtcicecandidate-interface\n    if (window.RTCIceCandidate && 'foundation' in\n        window.RTCIceCandidate.prototype) {\n      return;\n    }\n\n    var NativeRTCIceCandidate = window.RTCIceCandidate;\n    window.RTCIceCandidate = function(args) {\n      // Remove the a= which shouldn't be part of the candidate string.\n      if (typeof args === 'object' && args.candidate &&\n          args.candidate.indexOf('a=') === 0) {\n        args = JSON.parse(JSON.stringify(args));\n        args.candidate = args.candidate.substr(2);\n      }\n\n      // Augment the native candidate with the parsed fields.\n      var nativeCandidate = new NativeRTCIceCandidate(args);\n      var parsedCandidate = SDPUtils.parseCandidate(args.candidate);\n      var augmentedCandidate = Object.assign(nativeCandidate,\n          parsedCandidate);\n\n      // Add a serializer that does not serialize the extra attributes.\n      augmentedCandidate.toJSON = function() {\n        return {\n          candidate: augmentedCandidate.candidate,\n          sdpMid: augmentedCandidate.sdpMid,\n          sdpMLineIndex: augmentedCandidate.sdpMLineIndex,\n          usernameFragment: augmentedCandidate.usernameFragment,\n        };\n      };\n      return augmentedCandidate;\n    };\n\n    // Hook up the augmented candidate in onicecandidate and\n    // addEventListener('icecandidate', ...)\n    wrapPeerConnectionEvent(window, 'icecandidate', function(e) {\n      if (e.candidate) {\n        Object.defineProperty(e, 'candidate', {\n          value: new window.RTCIceCandidate(e.candidate),\n          writable: 'false'\n        });\n      }\n      return e;\n    });\n  },\n\n  // shimCreateObjectURL must be called before shimSourceObject to avoid loop.\n\n  shimCreateObjectURL: function(window) {\n    var URL = window && window.URL;\n\n    if (!(typeof window === 'object' && window.HTMLMediaElement &&\n          'srcObject' in window.HTMLMediaElement.prototype &&\n        URL.createObjectURL && URL.revokeObjectURL)) {\n      // Only shim CreateObjectURL using srcObject if srcObject exists.\n      return undefined;\n    }\n\n    var nativeCreateObjectURL = URL.createObjectURL.bind(URL);\n    var nativeRevokeObjectURL = URL.revokeObjectURL.bind(URL);\n    var streams = new Map(), newId = 0;\n\n    URL.createObjectURL = function(stream) {\n      if ('getTracks' in stream) {\n        var url = 'polyblob:' + (++newId);\n        streams.set(url, stream);\n        utils.deprecated('URL.createObjectURL(stream)',\n            'elem.srcObject = stream');\n        return url;\n      }\n      return nativeCreateObjectURL(stream);\n    };\n    URL.revokeObjectURL = function(url) {\n      nativeRevokeObjectURL(url);\n      streams.delete(url);\n    };\n\n    var dsc = Object.getOwnPropertyDescriptor(window.HTMLMediaElement.prototype,\n                                              'src');\n    Object.defineProperty(window.HTMLMediaElement.prototype, 'src', {\n      get: function() {\n        return dsc.get.apply(this);\n      },\n      set: function(url) {\n        this.srcObject = streams.get(url) || null;\n        return dsc.set.apply(this, [url]);\n      }\n    });\n\n    var nativeSetAttribute = window.HTMLMediaElement.prototype.setAttribute;\n    window.HTMLMediaElement.prototype.setAttribute = function() {\n      if (arguments.length === 2 &&\n          ('' + arguments[0]).toLowerCase() === 'src') {\n        this.srcObject = streams.get(arguments[1]) || null;\n      }\n      return nativeSetAttribute.apply(this, arguments);\n    };\n  }\n};\n\n},{\"./utils\":13,\"sdp\":2}],8:[function(require,module,exports){\n/*\n *  Copyright (c) 2016 The WebRTC project authors. All Rights Reserved.\n *\n *  Use of this source code is governed by a BSD-style license\n *  that can be found in the LICENSE file in the root of the source\n *  tree.\n */\n /* eslint-env node */\n'use strict';\n\nvar utils = require('../utils');\nvar shimRTCPeerConnection = require('rtcpeerconnection-shim');\n\nmodule.exports = {\n  shimGetUserMedia: require('./getusermedia'),\n  shimPeerConnection: function(window) {\n    var browserDetails = utils.detectBrowser(window);\n\n    if (window.RTCIceGatherer) {\n      // ORTC defines an RTCIceCandidate object but no constructor.\n      // Not implemented in Edge.\n      if (!window.RTCIceCandidate) {\n        window.RTCIceCandidate = function(args) {\n          return args;\n        };\n      }\n      // ORTC does not have a session description object but\n      // other browsers (i.e. Chrome) that will support both PC and ORTC\n      // in the future might have this defined already.\n      if (!window.RTCSessionDescription) {\n        window.RTCSessionDescription = function(args) {\n          return args;\n        };\n      }\n      // this adds an additional event listener to MediaStrackTrack that signals\n      // when a tracks enabled property was changed. Workaround for a bug in\n      // addStream, see below. No longer required in 15025+\n      if (browserDetails.version < 15025) {\n        var origMSTEnabled = Object.getOwnPropertyDescriptor(\n            window.MediaStreamTrack.prototype, 'enabled');\n        Object.defineProperty(window.MediaStreamTrack.prototype, 'enabled', {\n          set: function(value) {\n            origMSTEnabled.set.call(this, value);\n            var ev = new Event('enabled');\n            ev.enabled = value;\n            this.dispatchEvent(ev);\n          }\n        });\n      }\n    }\n\n    // ORTC defines the DTMF sender a bit different.\n    // https://github.com/w3c/ortc/issues/714\n    if (window.RTCRtpSender && !('dtmf' in window.RTCRtpSender.prototype)) {\n      Object.defineProperty(window.RTCRtpSender.prototype, 'dtmf', {\n        get: function() {\n          if (this._dtmf === undefined) {\n            if (this.track.kind === 'audio') {\n              this._dtmf = new window.RTCDtmfSender(this);\n            } else if (this.track.kind === 'video') {\n              this._dtmf = null;\n            }\n          }\n          return this._dtmf;\n        }\n      });\n    }\n\n    window.RTCPeerConnection =\n        shimRTCPeerConnection(window, browserDetails.version);\n  },\n  shimReplaceTrack: function(window) {\n    // ORTC has replaceTrack -- https://github.com/w3c/ortc/issues/614\n    if (window.RTCRtpSender &&\n        !('replaceTrack' in window.RTCRtpSender.prototype)) {\n      window.RTCRtpSender.prototype.replaceTrack =\n          window.RTCRtpSender.prototype.setTrack;\n    }\n  }\n};\n\n},{\"../utils\":13,\"./getusermedia\":9,\"rtcpeerconnection-shim\":1}],9:[function(require,module,exports){\n/*\n *  Copyright (c) 2016 The WebRTC project authors. All Rights Reserved.\n *\n *  Use of this source code is governed by a BSD-style license\n *  that can be found in the LICENSE file in the root of the source\n *  tree.\n */\n /* eslint-env node */\n'use strict';\n\n// Expose public methods.\nmodule.exports = function(window) {\n  var navigator = window && window.navigator;\n\n  var shimError_ = function(e) {\n    return {\n      name: {PermissionDeniedError: 'NotAllowedError'}[e.name] || e.name,\n      message: e.message,\n      constraint: e.constraint,\n      toString: function() {\n        return this.name;\n      }\n    };\n  };\n\n  // getUserMedia error shim.\n  var origGetUserMedia = navigator.mediaDevices.getUserMedia.\n      bind(navigator.mediaDevices);\n  navigator.mediaDevices.getUserMedia = function(c) {\n    return origGetUserMedia(c).catch(function(e) {\n      return Promise.reject(shimError_(e));\n    });\n  };\n};\n\n},{}],10:[function(require,module,exports){\n/*\n *  Copyright (c) 2016 The WebRTC project authors. All Rights Reserved.\n *\n *  Use of this source code is governed by a BSD-style license\n *  that can be found in the LICENSE file in the root of the source\n *  tree.\n */\n /* eslint-env node */\n'use strict';\n\nvar utils = require('../utils');\n\nmodule.exports = {\n  shimGetUserMedia: require('./getusermedia'),\n  shimOnTrack: function(window) {\n    if (typeof window === 'object' && window.RTCPeerConnection && !('ontrack' in\n        window.RTCPeerConnection.prototype)) {\n      Object.defineProperty(window.RTCPeerConnection.prototype, 'ontrack', {\n        get: function() {\n          return this._ontrack;\n        },\n        set: function(f) {\n          if (this._ontrack) {\n            this.removeEventListener('track', this._ontrack);\n            this.removeEventListener('addstream', this._ontrackpoly);\n          }\n          this.addEventListener('track', this._ontrack = f);\n          this.addEventListener('addstream', this._ontrackpoly = function(e) {\n            e.stream.getTracks().forEach(function(track) {\n              var event = new Event('track');\n              event.track = track;\n              event.receiver = {track: track};\n              event.transceiver = {receiver: event.receiver};\n              event.streams = [e.stream];\n              this.dispatchEvent(event);\n            }.bind(this));\n          }.bind(this));\n        }\n      });\n    }\n    if (typeof window === 'object' && window.RTCTrackEvent &&\n        ('receiver' in window.RTCTrackEvent.prototype) &&\n        !('transceiver' in window.RTCTrackEvent.prototype)) {\n      Object.defineProperty(window.RTCTrackEvent.prototype, 'transceiver', {\n        get: function() {\n          return {receiver: this.receiver};\n        }\n      });\n    }\n  },\n\n  shimSourceObject: function(window) {\n    // Firefox has supported mozSrcObject since FF22, unprefixed in 42.\n    if (typeof window === 'object') {\n      if (window.HTMLMediaElement &&\n        !('srcObject' in window.HTMLMediaElement.prototype)) {\n        // Shim the srcObject property, once, when HTMLMediaElement is found.\n        Object.defineProperty(window.HTMLMediaElement.prototype, 'srcObject', {\n          get: function() {\n            return this.mozSrcObject;\n          },\n          set: function(stream) {\n            this.mozSrcObject = stream;\n          }\n        });\n      }\n    }\n  },\n\n  shimPeerConnection: function(window) {\n    var browserDetails = utils.detectBrowser(window);\n\n    if (typeof window !== 'object' || !(window.RTCPeerConnection ||\n        window.mozRTCPeerConnection)) {\n      return; // probably media.peerconnection.enabled=false in about:config\n    }\n    // The RTCPeerConnection object.\n    if (!window.RTCPeerConnection) {\n      window.RTCPeerConnection = function(pcConfig, pcConstraints) {\n        if (browserDetails.version < 38) {\n          // .urls is not supported in FF < 38.\n          // create RTCIceServers with a single url.\n          if (pcConfig && pcConfig.iceServers) {\n            var newIceServers = [];\n            for (var i = 0; i < pcConfig.iceServers.length; i++) {\n              var server = pcConfig.iceServers[i];\n              if (server.hasOwnProperty('urls')) {\n                for (var j = 0; j < server.urls.length; j++) {\n                  var newServer = {\n                    url: server.urls[j]\n                  };\n                  if (server.urls[j].indexOf('turn') === 0) {\n                    newServer.username = server.username;\n                    newServer.credential = server.credential;\n                  }\n                  newIceServers.push(newServer);\n                }\n              } else {\n                newIceServers.push(pcConfig.iceServers[i]);\n              }\n            }\n            pcConfig.iceServers = newIceServers;\n          }\n        }\n        return new window.mozRTCPeerConnection(pcConfig, pcConstraints);\n      };\n      window.RTCPeerConnection.prototype =\n          window.mozRTCPeerConnection.prototype;\n\n      // wrap static methods. Currently just generateCertificate.\n      if (window.mozRTCPeerConnection.generateCertificate) {\n        Object.defineProperty(window.RTCPeerConnection, 'generateCertificate', {\n          get: function() {\n            return window.mozRTCPeerConnection.generateCertificate;\n          }\n        });\n      }\n\n      window.RTCSessionDescription = window.mozRTCSessionDescription;\n      window.RTCIceCandidate = window.mozRTCIceCandidate;\n    }\n\n    // shim away need for obsolete RTCIceCandidate/RTCSessionDescription.\n    ['setLocalDescription', 'setRemoteDescription', 'addIceCandidate']\n        .forEach(function(method) {\n          var nativeMethod = window.RTCPeerConnection.prototype[method];\n          window.RTCPeerConnection.prototype[method] = function() {\n            arguments[0] = new ((method === 'addIceCandidate') ?\n                window.RTCIceCandidate :\n                window.RTCSessionDescription)(arguments[0]);\n            return nativeMethod.apply(this, arguments);\n          };\n        });\n\n    // support for addIceCandidate(null or undefined)\n    var nativeAddIceCandidate =\n        window.RTCPeerConnection.prototype.addIceCandidate;\n    window.RTCPeerConnection.prototype.addIceCandidate = function() {\n      if (!arguments[0]) {\n        if (arguments[1]) {\n          arguments[1].apply(null);\n        }\n        return Promise.resolve();\n      }\n      return nativeAddIceCandidate.apply(this, arguments);\n    };\n\n    // shim getStats with maplike support\n    var makeMapStats = function(stats) {\n      var map = new Map();\n      Object.keys(stats).forEach(function(key) {\n        map.set(key, stats[key]);\n        map[key] = stats[key];\n      });\n      return map;\n    };\n\n    var modernStatsTypes = {\n      inboundrtp: 'inbound-rtp',\n      outboundrtp: 'outbound-rtp',\n      candidatepair: 'candidate-pair',\n      localcandidate: 'local-candidate',\n      remotecandidate: 'remote-candidate'\n    };\n\n    var nativeGetStats = window.RTCPeerConnection.prototype.getStats;\n    window.RTCPeerConnection.prototype.getStats = function(\n      selector,\n      onSucc,\n      onErr\n    ) {\n      return nativeGetStats.apply(this, [selector || null])\n        .then(function(stats) {\n          if (browserDetails.version < 48) {\n            stats = makeMapStats(stats);\n          }\n          if (browserDetails.version < 53 && !onSucc) {\n            // Shim only promise getStats with spec-hyphens in type names\n            // Leave callback version alone; misc old uses of forEach before Map\n            try {\n              stats.forEach(function(stat) {\n                stat.type = modernStatsTypes[stat.type] || stat.type;\n              });\n            } catch (e) {\n              if (e.name !== 'TypeError') {\n                throw e;\n              }\n              // Avoid TypeError: \"type\" is read-only, in old versions. 34-43ish\n              stats.forEach(function(stat, i) {\n                stats.set(i, Object.assign({}, stat, {\n                  type: modernStatsTypes[stat.type] || stat.type\n                }));\n              });\n            }\n          }\n          return stats;\n        })\n        .then(onSucc, onErr);\n    };\n  },\n\n  shimRemoveStream: function(window) {\n    if (!window.RTCPeerConnection ||\n        'removeStream' in window.RTCPeerConnection.prototype) {\n      return;\n    }\n    window.RTCPeerConnection.prototype.removeStream = function(stream) {\n      var pc = this;\n      utils.deprecated('removeStream', 'removeTrack');\n      this.getSenders().forEach(function(sender) {\n        if (sender.track && stream.getTracks().indexOf(sender.track) !== -1) {\n          pc.removeTrack(sender);\n        }\n      });\n    };\n  }\n};\n\n},{\"../utils\":13,\"./getusermedia\":11}],11:[function(require,module,exports){\n/*\n *  Copyright (c) 2016 The WebRTC project authors. All Rights Reserved.\n *\n *  Use of this source code is governed by a BSD-style license\n *  that can be found in the LICENSE file in the root of the source\n *  tree.\n */\n /* eslint-env node */\n'use strict';\n\nvar utils = require('../utils');\nvar logging = utils.log;\n\n// Expose public methods.\nmodule.exports = function(window) {\n  var browserDetails = utils.detectBrowser(window);\n  var navigator = window && window.navigator;\n  var MediaStreamTrack = window && window.MediaStreamTrack;\n\n  var shimError_ = function(e) {\n    return {\n      name: {\n        InternalError: 'NotReadableError',\n        NotSupportedError: 'TypeError',\n        PermissionDeniedError: 'NotAllowedError',\n        SecurityError: 'NotAllowedError'\n      }[e.name] || e.name,\n      message: {\n        'The operation is insecure.': 'The request is not allowed by the ' +\n        'user agent or the platform in the current context.'\n      }[e.message] || e.message,\n      constraint: e.constraint,\n      toString: function() {\n        return this.name + (this.message && ': ') + this.message;\n      }\n    };\n  };\n\n  // getUserMedia constraints shim.\n  var getUserMedia_ = function(constraints, onSuccess, onError) {\n    var constraintsToFF37_ = function(c) {\n      if (typeof c !== 'object' || c.require) {\n        return c;\n      }\n      var require = [];\n      Object.keys(c).forEach(function(key) {\n        if (key === 'require' || key === 'advanced' || key === 'mediaSource') {\n          return;\n        }\n        var r = c[key] = (typeof c[key] === 'object') ?\n            c[key] : {ideal: c[key]};\n        if (r.min !== undefined ||\n            r.max !== undefined || r.exact !== undefined) {\n          require.push(key);\n        }\n        if (r.exact !== undefined) {\n          if (typeof r.exact === 'number') {\n            r. min = r.max = r.exact;\n          } else {\n            c[key] = r.exact;\n          }\n          delete r.exact;\n        }\n        if (r.ideal !== undefined) {\n          c.advanced = c.advanced || [];\n          var oc = {};\n          if (typeof r.ideal === 'number') {\n            oc[key] = {min: r.ideal, max: r.ideal};\n          } else {\n            oc[key] = r.ideal;\n          }\n          c.advanced.push(oc);\n          delete r.ideal;\n          if (!Object.keys(r).length) {\n            delete c[key];\n          }\n        }\n      });\n      if (require.length) {\n        c.require = require;\n      }\n      return c;\n    };\n    constraints = JSON.parse(JSON.stringify(constraints));\n    if (browserDetails.version < 38) {\n      logging('spec: ' + JSON.stringify(constraints));\n      if (constraints.audio) {\n        constraints.audio = constraintsToFF37_(constraints.audio);\n      }\n      if (constraints.video) {\n        constraints.video = constraintsToFF37_(constraints.video);\n      }\n      logging('ff37: ' + JSON.stringify(constraints));\n    }\n    return navigator.mozGetUserMedia(constraints, onSuccess, function(e) {\n      onError(shimError_(e));\n    });\n  };\n\n  // Returns the result of getUserMedia as a Promise.\n  var getUserMediaPromise_ = function(constraints) {\n    return new Promise(function(resolve, reject) {\n      getUserMedia_(constraints, resolve, reject);\n    });\n  };\n\n  // Shim for mediaDevices on older versions.\n  if (!navigator.mediaDevices) {\n    navigator.mediaDevices = {getUserMedia: getUserMediaPromise_,\n      addEventListener: function() { },\n      removeEventListener: function() { }\n    };\n  }\n  navigator.mediaDevices.enumerateDevices =\n      navigator.mediaDevices.enumerateDevices || function() {\n        return new Promise(function(resolve) {\n          var infos = [\n            {kind: 'audioinput', deviceId: 'default', label: '', groupId: ''},\n            {kind: 'videoinput', deviceId: 'default', label: '', groupId: ''}\n          ];\n          resolve(infos);\n        });\n      };\n\n  if (browserDetails.version < 41) {\n    // Work around http://bugzil.la/1169665\n    var orgEnumerateDevices =\n        navigator.mediaDevices.enumerateDevices.bind(navigator.mediaDevices);\n    navigator.mediaDevices.enumerateDevices = function() {\n      return orgEnumerateDevices().then(undefined, function(e) {\n        if (e.name === 'NotFoundError') {\n          return [];\n        }\n        throw e;\n      });\n    };\n  }\n  if (browserDetails.version < 49) {\n    var origGetUserMedia = navigator.mediaDevices.getUserMedia.\n        bind(navigator.mediaDevices);\n    navigator.mediaDevices.getUserMedia = function(c) {\n      return origGetUserMedia(c).then(function(stream) {\n        // Work around https://bugzil.la/802326\n        if (c.audio && !stream.getAudioTracks().length ||\n            c.video && !stream.getVideoTracks().length) {\n          stream.getTracks().forEach(function(track) {\n            track.stop();\n          });\n          throw new DOMException('The object can not be found here.',\n                                 'NotFoundError');\n        }\n        return stream;\n      }, function(e) {\n        return Promise.reject(shimError_(e));\n      });\n    };\n  }\n  if (!(browserDetails.version > 55 &&\n      'autoGainControl' in navigator.mediaDevices.getSupportedConstraints())) {\n    var remap = function(obj, a, b) {\n      if (a in obj && !(b in obj)) {\n        obj[b] = obj[a];\n        delete obj[a];\n      }\n    };\n\n    var nativeGetUserMedia = navigator.mediaDevices.getUserMedia.\n        bind(navigator.mediaDevices);\n    navigator.mediaDevices.getUserMedia = function(c) {\n      if (typeof c === 'object' && typeof c.audio === 'object') {\n        c = JSON.parse(JSON.stringify(c));\n        remap(c.audio, 'autoGainControl', 'mozAutoGainControl');\n        remap(c.audio, 'noiseSuppression', 'mozNoiseSuppression');\n      }\n      return nativeGetUserMedia(c);\n    };\n\n    if (MediaStreamTrack && MediaStreamTrack.prototype.getSettings) {\n      var nativeGetSettings = MediaStreamTrack.prototype.getSettings;\n      MediaStreamTrack.prototype.getSettings = function() {\n        var obj = nativeGetSettings.apply(this, arguments);\n        remap(obj, 'mozAutoGainControl', 'autoGainControl');\n        remap(obj, 'mozNoiseSuppression', 'noiseSuppression');\n        return obj;\n      };\n    }\n\n    if (MediaStreamTrack && MediaStreamTrack.prototype.applyConstraints) {\n      var nativeApplyConstraints = MediaStreamTrack.prototype.applyConstraints;\n      MediaStreamTrack.prototype.applyConstraints = function(c) {\n        if (this.kind === 'audio' && typeof c === 'object') {\n          c = JSON.parse(JSON.stringify(c));\n          remap(c, 'autoGainControl', 'mozAutoGainControl');\n          remap(c, 'noiseSuppression', 'mozNoiseSuppression');\n        }\n        return nativeApplyConstraints.apply(this, [c]);\n      };\n    }\n  }\n  navigator.getUserMedia = function(constraints, onSuccess, onError) {\n    if (browserDetails.version < 44) {\n      return getUserMedia_(constraints, onSuccess, onError);\n    }\n    // Replace Firefox 44+'s deprecation warning with unprefixed version.\n    utils.deprecated('navigator.getUserMedia',\n        'navigator.mediaDevices.getUserMedia');\n    navigator.mediaDevices.getUserMedia(constraints).then(onSuccess, onError);\n  };\n};\n\n},{\"../utils\":13}],12:[function(require,module,exports){\n/*\n *  Copyright (c) 2016 The WebRTC project authors. All Rights Reserved.\n *\n *  Use of this source code is governed by a BSD-style license\n *  that can be found in the LICENSE file in the root of the source\n *  tree.\n */\n'use strict';\nvar utils = require('../utils');\n\nmodule.exports = {\n  shimLocalStreamsAPI: function(window) {\n    if (typeof window !== 'object' || !window.RTCPeerConnection) {\n      return;\n    }\n    if (!('getLocalStreams' in window.RTCPeerConnection.prototype)) {\n      window.RTCPeerConnection.prototype.getLocalStreams = function() {\n        if (!this._localStreams) {\n          this._localStreams = [];\n        }\n        return this._localStreams;\n      };\n    }\n    if (!('getStreamById' in window.RTCPeerConnection.prototype)) {\n      window.RTCPeerConnection.prototype.getStreamById = function(id) {\n        var result = null;\n        if (this._localStreams) {\n          this._localStreams.forEach(function(stream) {\n            if (stream.id === id) {\n              result = stream;\n            }\n          });\n        }\n        if (this._remoteStreams) {\n          this._remoteStreams.forEach(function(stream) {\n            if (stream.id === id) {\n              result = stream;\n            }\n          });\n        }\n        return result;\n      };\n    }\n    if (!('addStream' in window.RTCPeerConnection.prototype)) {\n      var _addTrack = window.RTCPeerConnection.prototype.addTrack;\n      window.RTCPeerConnection.prototype.addStream = function(stream) {\n        if (!this._localStreams) {\n          this._localStreams = [];\n        }\n        if (this._localStreams.indexOf(stream) === -1) {\n          this._localStreams.push(stream);\n        }\n        var pc = this;\n        stream.getTracks().forEach(function(track) {\n          _addTrack.call(pc, track, stream);\n        });\n      };\n\n      window.RTCPeerConnection.prototype.addTrack = function(track, stream) {\n        if (stream) {\n          if (!this._localStreams) {\n            this._localStreams = [stream];\n          } else if (this._localStreams.indexOf(stream) === -1) {\n            this._localStreams.push(stream);\n          }\n        }\n        return _addTrack.call(this, track, stream);\n      };\n    }\n    if (!('removeStream' in window.RTCPeerConnection.prototype)) {\n      window.RTCPeerConnection.prototype.removeStream = function(stream) {\n        if (!this._localStreams) {\n          this._localStreams = [];\n        }\n        var index = this._localStreams.indexOf(stream);\n        if (index === -1) {\n          return;\n        }\n        this._localStreams.splice(index, 1);\n        var pc = this;\n        var tracks = stream.getTracks();\n        this.getSenders().forEach(function(sender) {\n          if (tracks.indexOf(sender.track) !== -1) {\n            pc.removeTrack(sender);\n          }\n        });\n      };\n    }\n  },\n  shimRemoteStreamsAPI: function(window) {\n    if (typeof window !== 'object' || !window.RTCPeerConnection) {\n      return;\n    }\n    if (!('getRemoteStreams' in window.RTCPeerConnection.prototype)) {\n      window.RTCPeerConnection.prototype.getRemoteStreams = function() {\n        return this._remoteStreams ? this._remoteStreams : [];\n      };\n    }\n    if (!('onaddstream' in window.RTCPeerConnection.prototype)) {\n      Object.defineProperty(window.RTCPeerConnection.prototype, 'onaddstream', {\n        get: function() {\n          return this._onaddstream;\n        },\n        set: function(f) {\n          if (this._onaddstream) {\n            this.removeEventListener('addstream', this._onaddstream);\n            this.removeEventListener('track', this._onaddstreampoly);\n          }\n          this.addEventListener('addstream', this._onaddstream = f);\n          this.addEventListener('track', this._onaddstreampoly = function(e) {\n            var stream = e.streams[0];\n            if (!this._remoteStreams) {\n              this._remoteStreams = [];\n            }\n            if (this._remoteStreams.indexOf(stream) >= 0) {\n              return;\n            }\n            this._remoteStreams.push(stream);\n            var event = new Event('addstream');\n            event.stream = e.streams[0];\n            this.dispatchEvent(event);\n          }.bind(this));\n        }\n      });\n    }\n  },\n  shimCallbacksAPI: function(window) {\n    if (typeof window !== 'object' || !window.RTCPeerConnection) {\n      return;\n    }\n    var prototype = window.RTCPeerConnection.prototype;\n    var createOffer = prototype.createOffer;\n    var createAnswer = prototype.createAnswer;\n    var setLocalDescription = prototype.setLocalDescription;\n    var setRemoteDescription = prototype.setRemoteDescription;\n    var addIceCandidate = prototype.addIceCandidate;\n\n    prototype.createOffer = function(successCallback, failureCallback) {\n      var options = (arguments.length >= 2) ? arguments[2] : arguments[0];\n      var promise = createOffer.apply(this, [options]);\n      if (!failureCallback) {\n        return promise;\n      }\n      promise.then(successCallback, failureCallback);\n      return Promise.resolve();\n    };\n\n    prototype.createAnswer = function(successCallback, failureCallback) {\n      var options = (arguments.length >= 2) ? arguments[2] : arguments[0];\n      var promise = createAnswer.apply(this, [options]);\n      if (!failureCallback) {\n        return promise;\n      }\n      promise.then(successCallback, failureCallback);\n      return Promise.resolve();\n    };\n\n    var withCallback = function(description, successCallback, failureCallback) {\n      var promise = setLocalDescription.apply(this, [description]);\n      if (!failureCallback) {\n        return promise;\n      }\n      promise.then(successCallback, failureCallback);\n      return Promise.resolve();\n    };\n    prototype.setLocalDescription = withCallback;\n\n    withCallback = function(description, successCallback, failureCallback) {\n      var promise = setRemoteDescription.apply(this, [description]);\n      if (!failureCallback) {\n        return promise;\n      }\n      promise.then(successCallback, failureCallback);\n      return Promise.resolve();\n    };\n    prototype.setRemoteDescription = withCallback;\n\n    withCallback = function(candidate, successCallback, failureCallback) {\n      var promise = addIceCandidate.apply(this, [candidate]);\n      if (!failureCallback) {\n        return promise;\n      }\n      promise.then(successCallback, failureCallback);\n      return Promise.resolve();\n    };\n    prototype.addIceCandidate = withCallback;\n  },\n  shimGetUserMedia: function(window) {\n    var navigator = window && window.navigator;\n\n    if (!navigator.getUserMedia) {\n      if (navigator.webkitGetUserMedia) {\n        navigator.getUserMedia = navigator.webkitGetUserMedia.bind(navigator);\n      } else if (navigator.mediaDevices &&\n          navigator.mediaDevices.getUserMedia) {\n        navigator.getUserMedia = function(constraints, cb, errcb) {\n          navigator.mediaDevices.getUserMedia(constraints)\n          .then(cb, errcb);\n        }.bind(navigator);\n      }\n    }\n  },\n  shimRTCIceServerUrls: function(window) {\n    // migrate from non-spec RTCIceServer.url to RTCIceServer.urls\n    var OrigPeerConnection = window.RTCPeerConnection;\n    window.RTCPeerConnection = function(pcConfig, pcConstraints) {\n      if (pcConfig && pcConfig.iceServers) {\n        var newIceServers = [];\n        for (var i = 0; i < pcConfig.iceServers.length; i++) {\n          var server = pcConfig.iceServers[i];\n          if (!server.hasOwnProperty('urls') &&\n              server.hasOwnProperty('url')) {\n            utils.deprecated('RTCIceServer.url', 'RTCIceServer.urls');\n            server = JSON.parse(JSON.stringify(server));\n            server.urls = server.url;\n            delete server.url;\n            newIceServers.push(server);\n          } else {\n            newIceServers.push(pcConfig.iceServers[i]);\n          }\n        }\n        pcConfig.iceServers = newIceServers;\n      }\n      return new OrigPeerConnection(pcConfig, pcConstraints);\n    };\n    window.RTCPeerConnection.prototype = OrigPeerConnection.prototype;\n    // wrap static methods. Currently just generateCertificate.\n    if ('generateCertificate' in window.RTCPeerConnection) {\n      Object.defineProperty(window.RTCPeerConnection, 'generateCertificate', {\n        get: function() {\n          return OrigPeerConnection.generateCertificate;\n        }\n      });\n    }\n  },\n  shimTrackEventTransceiver: function(window) {\n    // Add event.transceiver member over deprecated event.receiver\n    if (typeof window === 'object' && window.RTCPeerConnection &&\n        ('receiver' in window.RTCTrackEvent.prototype) &&\n        // can't check 'transceiver' in window.RTCTrackEvent.prototype, as it is\n        // defined for some reason even when window.RTCTransceiver is not.\n        !window.RTCTransceiver) {\n      Object.defineProperty(window.RTCTrackEvent.prototype, 'transceiver', {\n        get: function() {\n          return {receiver: this.receiver};\n        }\n      });\n    }\n  },\n\n  shimCreateOfferLegacy: function(window) {\n    var origCreateOffer = window.RTCPeerConnection.prototype.createOffer;\n    window.RTCPeerConnection.prototype.createOffer = function(offerOptions) {\n      var pc = this;\n      if (offerOptions) {\n        var audioTransceiver = pc.getTransceivers().find(function(transceiver) {\n          return transceiver.sender.track &&\n              transceiver.sender.track.kind === 'audio';\n        });\n        if (offerOptions.offerToReceiveAudio === false && audioTransceiver) {\n          if (audioTransceiver.direction === 'sendrecv') {\n            audioTransceiver.setDirection('sendonly');\n          } else if (audioTransceiver.direction === 'recvonly') {\n            audioTransceiver.setDirection('inactive');\n          }\n        } else if (offerOptions.offerToReceiveAudio === true &&\n            !audioTransceiver) {\n          pc.addTransceiver('audio');\n        }\n\n        var videoTransceiver = pc.getTransceivers().find(function(transceiver) {\n          return transceiver.sender.track &&\n              transceiver.sender.track.kind === 'video';\n        });\n        if (offerOptions.offerToReceiveVideo === false && videoTransceiver) {\n          if (videoTransceiver.direction === 'sendrecv') {\n            videoTransceiver.setDirection('sendonly');\n          } else if (videoTransceiver.direction === 'recvonly') {\n            videoTransceiver.setDirection('inactive');\n          }\n        } else if (offerOptions.offerToReceiveVideo === true &&\n            !videoTransceiver) {\n          pc.addTransceiver('video');\n        }\n      }\n      return origCreateOffer.apply(pc, arguments);\n    };\n  }\n};\n\n},{\"../utils\":13}],13:[function(require,module,exports){\n/*\n *  Copyright (c) 2016 The WebRTC project authors. All Rights Reserved.\n *\n *  Use of this source code is governed by a BSD-style license\n *  that can be found in the LICENSE file in the root of the source\n *  tree.\n */\n /* eslint-env node */\n'use strict';\n\nvar logDisabled_ = true;\nvar deprecationWarnings_ = true;\n\n/**\n * Extract browser version out of the provided user agent string.\n *\n * @param {!string} uastring userAgent string.\n * @param {!string} expr Regular expression used as match criteria.\n * @param {!number} pos position in the version string to be returned.\n * @return {!number} browser version.\n */\nfunction extractVersion(uastring, expr, pos) {\n  var match = uastring.match(expr);\n  return match && match.length >= pos && parseInt(match[pos], 10);\n}\n\n// Utility methods.\nmodule.exports = {\n  extractVersion: extractVersion,\n  disableLog: function(bool) {\n    if (typeof bool !== 'boolean') {\n      return new Error('Argument type: ' + typeof bool +\n          '. Please use a boolean.');\n    }\n    logDisabled_ = bool;\n    return (bool) ? 'adapter.js logging disabled' :\n        'adapter.js logging enabled';\n  },\n\n  /**\n   * Disable or enable deprecation warnings\n   * @param {!boolean} bool set to true to disable warnings.\n   */\n  disableWarnings: function(bool) {\n    if (typeof bool !== 'boolean') {\n      return new Error('Argument type: ' + typeof bool +\n          '. Please use a boolean.');\n    }\n    deprecationWarnings_ = !bool;\n    return 'adapter.js deprecation warnings ' + (bool ? 'disabled' : 'enabled');\n  },\n\n  log: function() {\n    if (typeof window === 'object') {\n      if (logDisabled_) {\n        return;\n      }\n      if (typeof console !== 'undefined' && typeof console.log === 'function') {\n        console.log.apply(console, arguments);\n      }\n    }\n  },\n\n  /**\n   * Shows a deprecation warning suggesting the modern and spec-compatible API.\n   */\n  deprecated: function(oldMethod, newMethod) {\n    if (!deprecationWarnings_) {\n      return;\n    }\n    console.warn(oldMethod + ' is deprecated, please use ' + newMethod +\n        ' instead.');\n  },\n\n  /**\n   * Browser detector.\n   *\n   * @return {object} result containing browser and version\n   *     properties.\n   */\n  detectBrowser: function(window) {\n    var navigator = window && window.navigator;\n\n    // Returned result object.\n    var result = {};\n    result.browser = null;\n    result.version = null;\n\n    // Fail early if it's not a browser\n    if (typeof window === 'undefined' || !window.navigator) {\n      result.browser = 'Not a browser.';\n      return result;\n    }\n\n    // Firefox.\n    if (navigator.mozGetUserMedia) {\n      result.browser = 'firefox';\n      result.version = extractVersion(navigator.userAgent,\n          /Firefox\\/(\\d+)\\./, 1);\n    } else if (navigator.webkitGetUserMedia) {\n      // Chrome, Chromium, Webview, Opera, all use the chrome shim for now\n      if (window.webkitRTCPeerConnection) {\n        result.browser = 'chrome';\n        result.version = extractVersion(navigator.userAgent,\n          /Chrom(e|ium)\\/(\\d+)\\./, 2);\n      } else { // Safari (in an unpublished version) or unknown webkit-based.\n        if (navigator.userAgent.match(/Version\\/(\\d+).(\\d+)/)) {\n          result.browser = 'safari';\n          result.version = extractVersion(navigator.userAgent,\n            /AppleWebKit\\/(\\d+)\\./, 1);\n        } else { // unknown webkit-based browser.\n          result.browser = 'Unsupported webkit-based browser ' +\n              'with GUM support but no WebRTC support.';\n          return result;\n        }\n      }\n    } else if (navigator.mediaDevices &&\n        navigator.userAgent.match(/Edge\\/(\\d+).(\\d+)$/)) { // Edge.\n      result.browser = 'edge';\n      result.version = extractVersion(navigator.userAgent,\n          /Edge\\/(\\d+).(\\d+)$/, 2);\n    } else if (navigator.mediaDevices &&\n        navigator.userAgent.match(/AppleWebKit\\/(\\d+)\\./)) {\n        // Safari, with webkitGetUserMedia removed.\n      result.browser = 'safari';\n      result.version = extractVersion(navigator.userAgent,\n          /AppleWebKit\\/(\\d+)\\./, 1);\n    } else { // Default fallthrough: not supported.\n      result.browser = 'Not a supported browser.';\n      return result;\n    }\n\n    return result;\n  }\n};\n\n},{}]},{},[3]);\n\n\n\n// WEBPACK FOOTER //\n// ./node_modules/webrtc-adapter/out/adapter_no_global.js","var g;\r\n\r\n// This works in non-strict mode\r\ng = (function() {\r\n\treturn this;\r\n})();\r\n\r\ntry {\r\n\t// This works if eval is allowed (see CSP)\r\n\tg = g || Function(\"return this\")() || (1,eval)(\"this\");\r\n} catch(e) {\r\n\t// This works if the window reference is available\r\n\tif(typeof window === \"object\")\r\n\t\tg = window;\r\n}\r\n\r\n// g can still be undefined, but nothing to do about it...\r\n// We return undefined, instead of nothing here, so it's\r\n// easier to handle this case. if(!global) { ...}\r\n\r\nmodule.exports = g;\r\n\n\n\n// WEBPACK FOOTER //\n// (webpack)/buildin/global.js","import initializeCamera from './mediaDevice';\nimport ButtonCameraPermission from './components/ButtonCameraPermission';\n// initializeCamera();\n\n\n\n// WEBPACK FOOTER //\n// ./src/index.js","import Component from '../Component';\nimport CameraScreen from './CameraScreen';\n\nconst ButtonCameraPermission = new Component('ButtonCameraPermission', {\n  permitted: false\n});\n\nButtonCameraPermission.on('click', function(evt) {\n  CameraScreen.setState({show: true});\n})\n\nButtonCameraPermission.render((state) => {\n  console.log(state.permitted);\n\n})\n\nexport default ButtonCameraPermission;\n\n\n\n// WEBPACK FOOTER //\n// ./src/components/ButtonCameraPermission.js","import Component from '../Component';\nimport Error from './Error';\nimport {hasMediaDeviceAPI, startingCamera} from '../mediaDevice';\n\nconst CameraScreen = new Component('CameraScreen', {\n  show: false\n})\n\nCameraScreen.render((state) => {\n  if (CameraScreen.getState().show) {\n    if (hasMediaDeviceAPI()) {\n      startingCamera(CameraScreen.dom)\n        .then(() => CameraScreen.addClass('camera__screen--show'))\n        .catch(err => Error.setState({message: `${err.name}: \\n${err.message}`}))\n    }\n\n  } else {\n    CameraScreen.removeClass('camera__screen--show');\n  }\n})\n\nexport default CameraScreen;\n\n\n\n// WEBPACK FOOTER //\n// ./src/components/CameraScreen.js","import Component from '../Component';\n\nconst Error = new Component('Error', {\n  message: ''\n})\n\nError.render(state => {\n  Error.dom.textContent = state.message;\n});\n\n\nexport default Error;\n\n\n\n\n\n// WEBPACK FOOTER //\n// ./src/components/Error.js"],"sourceRoot":""}